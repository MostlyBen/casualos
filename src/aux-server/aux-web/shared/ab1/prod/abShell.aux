{"version":2,"updates":[{"id":0,"timestamp":1721760609290,"update":"AdMBr9Gk0AkAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwCv0aTQCQAGc3lzdGVtAgQAr9Gk0AkBEWFiLnNoZWxsLnJlZ3VsYXRlJwCv0aTQCQAEZm9ybQIEAK/RpNAJEwdub3RoaW5nJwCv0aTQCQAMb25BbnlCb3REcmFnAgQAr9Gk0AkbuwFALy9jb250cm9scyBncmlkIHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZ3JpZCIpOwp9CgovL2NvbnRyb2xzIGJvdCBzbmFwCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZmFjZSIpOwp9JwCv0aTQCQAIcmVtZW1iZXICBACv0aTQCdcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAK/RpNAJAAhhYklnbm9yZQIEAK/RpNAJ/gEEdHJ1ZSgAr9Gk0AkADGFiQm90VmVyc2lvbgF9jgMnAK/RpNAJAAdhYlNoZWxsAgQAr9Gk0AmEAgR0cnVlJwEEYm90cyQyNGI3ZTY2Zi0wZDViLTQwNjQtYmY0OC1iNTYyYjllNmUzZWIBJwCv0aTQCYkCB0FwcC5jc3MCBACv0aTQCYoCyhQ6cm9vdCB7CiAgLS1hYi1jb25zb2xlLWJnOiAjZjhmOWZhOwogIC0tb24tYWItY29uc29sZS1iZzogIzIxMjUyOTsKICAtLWFiLWNvbnNvbGUtaGVpZ2h0OiAzM3ZoOwp9Ci8qIERhcmsgbW9kZSBzdXBwb3J0ICovCkBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKICA6cm9vdCB7CiAgICAtLWFiLWNvbnNvbGUtYmc6ICMyMTI1Mjk7CiAgICAtLW9uLWFiLWNvbnNvbGUtYmc6ICNmOGY5ZmE7CiAgfQp9CgouYWItY29uc29sZS1idG4gewogIGN1cnNvcjogcG9pbnRlcjsKICBjb2xvcjogaW5oZXJpdDsKICBsZXR0ZXItc3BhY2luZzogaW5oZXJpdDsKICBsaW5lLWhlaWdodDogaW5oZXJpdDsKICB0ZXh0LXRyYW5zZm9ybTogaW5oZXJpdDsKICB0ZXh0LWluZGVudDogaW5oZXJpdDsKICB0ZXh0LXNoYWRvdzogaW5oZXJpdDsKICBiYWNrZ3JvdW5kLWNvbG9yOiBpbmhlcml0OwogIG1hcmdpbjogaW5oZXJpdDsKICBwYWRkaW5nLWJsb2NrOiBpbmhlcml0OwogIHBhZGRpbmctaW5saW5lOiBpbmhlcml0OwogIGJvcmRlcjogbm9uZTsKICB0cmFuc2Zvcm06IHNjYWxlKDEuMik7Cn0KCi5hYi1jb25zb2xlIHsKICB3aWR0aDogMTAwdnc7CiAgbWF4LWhlaWdodDogdmFyKC0tYWItY29uc29sZS1oZWlnaHQpOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBwYWRkaW5nOiAwOwogIGNvbG9yOiB2YXIoLS1vbi1hYi1jb25zb2xlLWJnKTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCkgYnJpZ2h0bmVzcygyMDAlKTsKICBhbmltYXRpb24tbmFtZTogc2xpZGUtYXBwLWluOwogIGFuaW1hdGlvbi1kdXJhdGlvbjogMC41czsKICBvdmVyZmxvdy15OiBoaWRkZW47CiAgei1pbmRleDogMTsKfQoKLmFiLWNvbnNvbGU6OmFmdGVyIHsKICBjb250ZW50OiAiIjsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hYi1jb25zb2xlLWJnKTsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIG9wYWNpdHk6IDAuOTsKICB6LWluZGV4OiAwOwp9CgpAa2V5ZnJhbWVzIHNsaWRlLWFwcC1pbiB7CiAgZnJvbSB7CiAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoLjYsMCwuNzksMS4wMyk7CiAgICAvKiB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTEwJSk7ICovCiAgICAvKiBoZWlnaHQ6IDBweDsgKi8KICAgIC8qIG1pbi1oZWlnaHQ6IDBweDsgKi8KICAgIG1heC1oZWlnaHQ6IDBweDsKICB9CgogIHRvIHsKICAgIG1heC1oZWlnaHQ6IHZhcigtLWFiLWNvbnNvbGUtaGVpZ2h0KTsKICAgIC8qIG1pbi1oZWlnaHQ6IHZhcigtLWFiLWNvbnNvbGUtaGVpZ2h0KTsgKi8KICB9Cn0KCi5hYi1jb25zb2xlID4gZGl2IHsKICB6LWluZGV4OiAxOwogIHBvc2l0aW9uOiByZWxhdGl2ZQp9CgouYWItY29uc29sZS10b3AtYmFyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hYi1jb25zb2xlLWJnKTsKICB3aWR0aDogMTAwJTsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogZW5kOwogIHBhZGRpbmc6IDAuNXJlbTsKfQoKLmFiLWNvbnNvbGUtbG9nIHsKICBvdmVyZmxvdy15OiBhdXRvOwogIGZsZXgtZ3JvdzogMTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW4tcmV2ZXJzZTsKICBtaW4taGVpZ2h0OiAyNHB4OwogIHBhZGRpbmc6IDAgMXJlbTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi5hYi1jb25zb2xlLWNvbnRlbnQgewogIGN1cnNvcjogaW5pdGlhbDsKfQoKLmFiLWNvbnNvbGUtbWVzc2FnZS1jb250YWluZXIgewogIG1hcmdpbjogMC41cmVtIDA7Cn0KLmFiLWNvbnNvbGUtbWVzc2FnZSB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiA4cHg7Cn0KCi5hYi1jb25zb2xlLXNwYWNlciB7CiAgZmxleC1zaHJpbms6IDA7CiAgZmxleC1ncm93OiAxOwp9CgouYWItY29uc29sZS1jb250ZW50IHsKICBtYXgtd2lkdGg6IDgwdnc7CiAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hYi1jb25zb2xlLWJnKTsKICBjb2xvcjogdmFyKC0tb24tYWItY29uc29sZS1iZyk7CiAgcGFkZGluZzogMC41cmVtIDFyZW07Cn0KCi5hYi1jb25zb2xlLXRpbWVzdGFtcCB7CiAgb3BhY2l0eTogMC42Owp9CgouY29uc29sZS1zZW5kLWJ0biB7CiAgbWFyZ2luOiAwICFpbXBvcnRhbnQ7CiAgcGFkZGluZzogMCAxcmVtICFpbXBvcnRhbnQ7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWItY29uc29sZS1iZyk7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9CgouY29uc29sZS1zZW5kLWJ0biA+IHNwYW4gewogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgzcHgpCn0KCi5hYi1jb25zb2xlLWlucHV0LWNvbnRhaW5lciB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIGdhcDogMC43NXJlbTsKICBtYXJnaW46IDAuNXJlbSAxcmVtOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0nAK/RpNAJiQIGZ2V0QXBwAgQAr9Gk0AnVFrcsQGNvbnN0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlTWVtbywgdXNlUmVmIH0gPSBvcy5hcHBIb29rcwpjb25zdCBUb3BCYXIgPSB0aGlzQm90LlRvcEJhcigpCgpjb25zdCBNZXNzYWdlID0gKHsgdGltZXN0YW1wLCBtZXNzYWdlIH0pID0+IHsKICAgIGNvbnN0IFtuYW1lLCBzZXROYW1lXSA9IHVzZVN0YXRlKCcnKTsKICAgIGNvbnN0IFtzaG93VGltZSwgc2V0U2hvd1RpbWVdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgdGltZVRleHQgPSB1c2VNZW1vKAogICAgICAgICgpID0+IHRpbWVzdGFtcC50b0xvY2FsZVN0cmluZygKICAgICAgICAgICAgICAgICdlbi11cycsIHt0aW1lU3R5bGU6ICdtZWRpdW0nfSksCiAgICAgICAgW3RpbWVzdGFtcF0KICAgICkKICAgIGNvbnN0IG1lc3NhZ2VUZXh0ID0gdXNlTWVtbygoKSA9PiB7CiAgICAgICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJzogJykpIHsKICAgICAgICAgICAgY29uc3QgX21lc3NhZ2VUZXh0ID0gbWVzc2FnZS5zcGxpdCgnOiAnKTsKICAgICAgICAgICAgY29uc3QgX25hbWUgPSBfbWVzc2FnZVRleHQuc2hpZnQoKTsKICAgICAgICAgICAgc2V0TmFtZShfbmFtZSk7CiAgICAgICAgICAgIHJldHVybiBfbWVzc2FnZVRleHQuam9pbignOiAnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbWVzc2FnZQogICAgICAgIH0KICAgIH0sIFttZXNzYWdlXSkKCiAgICByZXR1cm4gKAogICAgICAgIDxkaXYKICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlLW1lc3NhZ2UtY29udGFpbmVyIgogICAgICAgICAgICBvblBvaW50ZXJFbnRlcj17KCkgPT4gc2V0U2hvd1RpbWUodHJ1ZSl9CiAgICAgICAgICAgIG9uUG9pbnRlckxlYXZlPXsoKSA9PiBzZXRTaG93VGltZShmYWxzZSl9CiAgICAgICAgPgogICAgICAgICAgICA8ZGl2CiAgICAgICAgICAgICAgICBzdHlsZT17bmFtZSA9PT0gJ3VzZXInICYmIHt0ZXh0QWxpZ246ICdyaWdodCd9fQogICAgICAgICAgICA+CiAgICAgICAgICAgICAgICB7bmFtZX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJhYi1jb25zb2xlLW1lc3NhZ2UiIHN0eWxlPXt7CiAgICAgICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiBtZXNzYWdlLnN0YXJ0c1dpdGgoJ3VzZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAncm93JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAncm93LXJldmVyc2UnCiAgICAgICAgICAgIH19PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFiLWNvbnNvbGUtc3BhY2VyIgogICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRBbGlnbjogbmFtZSA9PT0gJ3VzZXInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAncmlnaHQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnbGVmdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IHNob3dUaW1lID8gMC42IDogMAogICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAge3RpbWVUZXh0fQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS1jb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICB7bWVzc2FnZVRleHR9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICApCn0KCmNvbnN0IEFwcCA9ICgpID0+IHsKICAgIGNvbnN0IFtwb2ludGVyRG93blBvcywgc2V0UG9pbnRlckRvd25Qb3NdID0gdXNlU3RhdGUoe3g6IC0xLCB5OiAtMX0pOwogICAgY29uc3QgW2NvbnNvbGVMb2csIHNldENvbnNvbGVMb2ddID0gdXNlU3RhdGUodGhpc0JvdC5tYXNrcy5oaXN0b3J5KQogICAgY29uc3QgW3Nob3dDaGF0LCBzZXRTaG93Q2hhdF0gPSB1c2VTdGF0ZSh0YWdzLnNob3dDaGF0SW5wdXQpOwogICAgY29uc3QgW3VzZXJJbnB1dCwgc2V0VXNlcklucHV0XSA9IHVzZVN0YXRlKCcnKTsKICAgIGNvbnN0IFtzaG93QWxsLCBzZXRTaG93QWxsXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIGNvbnN0IGlucHV0UmVmID0gdXNlUmVmKCk7CgogICAgY29uc3QgdXBkYXRlTG9nID0gKCkgPT4gewogICAgICAgIHNldENvbnNvbGVMb2coKCkgPT4gWyAuLi50aGlzQm90Lm1hc2tzLmhpc3RvcnkgXSk7CiAgICB9CgogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICB0aGlzQm90LnZhcnMudXBkYXRlTG9nID0gdXBkYXRlTG9nCiAgICAgICAgcmV0dXJuICgoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy51cGRhdGVMb2cgPSBudWxsCiAgICAgICAgfSkKICAgIH0sIFtdKTsKCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGlmIChpbnB1dFJlZi5jdXJyZW50KSBpbnB1dFJlZi5jdXJyZW50LmZvY3VzKCk7CiAgICB9LCBbc2hvd0NoYXRdKTsKCiAgICBjb25zdCBoYW5kbGVQb2ludGVyRG93biA9IChlKSA9PiB7CiAgICAgICAgc2V0UG9pbnRlckRvd25Qb3MoewogICAgICAgICAgICB4OiBlLmNsaWVudFgsCiAgICAgICAgICAgIHk6IGUuY2xpZW50WSwKICAgICAgICB9KQogICAgfQoKICAgIGNvbnN0IGhhbmRsZVBvaW50ZXJVcCA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGlmZlggPSBNYXRoLmFicyhlLmNsaWVudFggLSBwb2ludGVyRG93blBvcy54KTsKICAgICAgICBjb25zdCBkaWZmWSA9IE1hdGguYWJzKGUuY2xpZW50WSAtIHBvaW50ZXJEb3duUG9zLnkpOwoKICAgICAgICBpZiAoZGlmZlggPCA1ICYmIGRpZmZZIDwgNSkgewogICAgICAgICAgICBzZXRTaG93QWxsKHMgPT4gIXMpOwogICAgICAgIH0KCiAgICAgICAgc2V0UG9pbnRlckRvd25Qb3Moe3g6IC0xLCB5OiAtMX0pOwogICAgfQoKICAgIGNvbnN0IGhhbmRsZVN1Ym1pdCA9ICgpID0+IHsKICAgICAgICBpZiAodXNlcklucHV0KSB7CiAgICAgICAgICAgIHdoaXNwZXIoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpLCAnYWJDb3JlTWVudUFjdGlvbicsIHVzZXJJbnB1dCkKICAgICAgICAgICAgc2V0VXNlcklucHV0KCcnKTsKICAgICAgICAgICAgY29uc29sZS5sb2coImlucHV0UmVmOiIsIGlucHV0UmVmLmN1cnJlbnQpOwogICAgICAgICAgICBpZiAoaW5wdXRSZWYuY3VycmVudCkgaW5wdXRSZWYuY3VycmVudC52YWx1ZSA9ICcnOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gKDw+CiAgICAgICAgPHN0eWxlPnt0YWdzWydBcHAuY3NzJ119PC9zdHlsZT4KCiAgICAgICAgPGRpdgogICAgICAgICAgICBpZD0iYWItY29uc29sZSIKICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlIgogICAgICAgICAgICBvblBvaW50ZXJFbnRlcj17CiAgICAgICAgICAgICAgICAoKSA9PiBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbFpvb21hYmxlID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBvblBvaW50ZXJMZWF2ZT17KGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlLmN1cnJlbnRUYXJnZXQuaWQgPT0gImFiLWNvbnNvbGUiKXsKICAgICAgICAgICAgICAgICAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbFpvb21hYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9fQogICAgICAgID4KICAgICAgICAgICAge3RhZ3Muc2hvd1RvcEJhciAmJiA8VG9wQmFyIC8+fQoKICAgICAgICAgICAgPGRpdgogICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlLWxvZyIKICAgICAgICAgICAgICAgIG9uUG9pbnRlckRvd249e2hhbmRsZVBvaW50ZXJEb3dufQogICAgICAgICAgICAgICAgb25Qb2ludGVyVXA9e2hhbmRsZVBvaW50ZXJVcH0KICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgey8qIE1lc3NhZ2UgaGlzdG9yeSAqLyBBcnJheS5pc0FycmF5KGNvbnNvbGVMb2cpCiAgICAgICAgICAgICAgICA/IHNob3dBbGwKICAgICAgICAgICAgICAgICAgICA/IGNvbnNvbGVMb2cubWFwKChtLCBpKSA9PgogICAgICAgICAgICAgICAgICAgICAgICA8TWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wPXttLnRpbWVzdGFtcH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U9e20ubWVzc2FnZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17YG1lc3NhZ2UtJHtpfWB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8+KQogICAgICAgICAgICAgICAgICAgIDogPE1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wPXtjb25zb2xlTG9nWzBdLnRpbWVzdGFtcH0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZT17Y29uc29sZUxvZ1swXS5tZXNzYWdlfQogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICA6IDw+PC8+fQoKICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAge3Nob3dDaGF0ICYmCiAgICAgICAgICAgICAgICA8ZGl2CiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlLWlucHV0LWNvbnRhaW5lciIKICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9ImFzayBhYi0xIgogICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17ZSA9PiBzZXRVc2VySW5wdXQoZS50YXJnZXQudmFsdWUpfQogICAgICAgICAgICAgICAgICAgICAgICBvbktleURvd249e2UgPT4geyBpZiAoZS5rZXkgPT09ICdFbnRlcicpIGhhbmRsZVN1Ym1pdCgpIH19CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17aW5wdXRSZWZ9CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndmFyKC0tYWItY29uc29sZS1iZyknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICd2YXIoLS1vbi1hYi1jb25zb2xlLWJnKScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGV4R3JvdzogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmU6ICdub25lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogJzFyZW0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlLWJ0biBjb25zb2xlLXNlbmQtYnRuIG1kLWljb24gbWQtaWNvbi1mb250IgogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVTdWJtaXR9CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICc0MHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnNDhweCcsCiAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgPnNlbmQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2Pn0KICAgICAgICA8L2Rpdj4KICAgIDwvPikKfQoKcmV0dXJuIEFwcAonAK/RpNAJiQILaGlkZUNvbnNvbGUCBACv0aTQCY1DnwFAdmFyIGN1cnJlbnRWZXIgPSBtYXNrcy5jb25zb2xlVmVyc2lvbiA/PyAwOwphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKTsKbWFza3Mub3BlbiA9IGZhbHNlOwpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbFpvb21hYmxlID0gbnVsbDsnAK/RpNAJiQIDbG9nAgQAr9Gk0AmtRNIDQGNvbnN0IG1lc3NhZ2UgPSBTdHJpbmcodGhhdCkKCi8vIENyZWF0ZSBsb2NhbCBjb3B5IG9mIGhpc3RvcnkgbWFzawp2YXIgX2hpc3RvcnkgPSB0aGlzQm90Lm1hc2tzLmhpc3RvcnkKCi8vIFB1c2ggbWVzc2FnZSBpZiB0aGUgbWFzayBleGlzdGVkCmlmICggQXJyYXkuaXNBcnJheShfaGlzdG9yeSkgKSB7CiAgICBfaGlzdG9yeS51bnNoaWZ0KHsKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksCiAgICAgICAgbWVzc2FnZQogICAgfSkKCi8vIEluaXRpYWxpemUgdGhlIGFycmF5IGlmIGl0IGRpZG4ndAp9IGVsc2UgewogICAgX2hpc3RvcnkgPSBbewogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSwKICAgICAgICBtZXNzYWdlCiAgICB9XQp9Cgp0aGlzQm90Lm1hc2tzLmhpc3RvcnkgPSBbIC4uLl9oaXN0b3J5IF0KaWYgKHRoaXNCb3QudmFycy51cGRhdGVMb2cpIHRoaXNCb3QudmFycy51cGRhdGVMb2coKScAr9Gk0AmJAgtzaG93Q29uc29sZQIEAK/RpNAJgEjtA0BpZiAobWFza3Mub3BlbikgeyByZXR1cm4gfTsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwpjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKLy8gVW5yZWdpc3RlciBpbiBjYXNlIGl0IHdhcyBhbHJlYWR5IG9wZW4KdmFyIGN1cnJlbnRWZXIgPSBtYXNrcy5jb25zb2xlVmVyc2lvbiA/PyAwOwphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKTsKCmN1cnJlbnRWZXIgKz0gMTsKbWFza3MuY29uc29sZVZlcnNpb24gPSBjdXJyZW50VmVyOwovLyBHZXQsIHJlZ2lzdGVyLCBhbmQgY29tcGlsZSB0aGUgYXBwCmNvbnN0IEFwcCA9IHRoaXNCb3QuZ2V0QXBwKCk7CmF3YWl0IG9zLnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gLCB0aGlzQm90KTsKb3MuY29tcGlsZUFwcChgYWItY29uc29sZS0ke2N1cnJlbnRWZXJ9YCwgPEFwcCAvPik7Cm1hc2tzLm9wZW4gPSB0cnVlOwonAK/RpNAJiQIGc3lzdGVtAgQAr9Gk0AnuSxBhYi5zaGVsbC5jb25zb2xlKACv0aTQCYkCCGFiSWdub3JlAXgnAK/RpNAJiQINdG9nZ2xlQ29uc29sZQIEAK/RpNAJgEyWAUBpZiAobWFza3Mub3BlbikgewogICAgd2hpc3Blcih0aGlzQm90LCAiaGlkZUNvbnNvbGUiKTsKICAgIG1hc2tzLm9wZW4gPSBmYWxzZTsKfSBlbHNlIHsKICAgIHdoaXNwZXIodGhpc0JvdCwgInNob3dDb25zb2xlIik7CiAgICBtYXNrcy5vcGVuID0gdHJ1ZTsKfSgAr9Gk0AmJAgxhYkJvdFZlcnNpb24BfR4nAK/RpNAJiQIEZm9ybQIEAK/RpNAJmE0Hbm90aGluZycAr9Gk0AmJAgdhYlNoZWxsAgQAr9Gk0AmgTQR0cnVlJwCv0aTQCYkCCmFiSURPcmlnaW4CBACv0aTQCaVNFWFiQ29uc29sZSB1cGRhdGUgNy0xNicAr9Gk0AmJAgZUb3BCYXICBACv0aTQCbtN8wRAY29uc3Qgb2Zmc2V0ID0gOApjb25zdCBpbml0aWFsSGVpZ2h0ID0gMjU2CmNvbnN0IGRyYWdJbnRlcnZhbCA9IDI1Cgpjb25zdCBCdXR0b25zQmFyID0gKCkgPT4gewoKICAgIGNvbnN0IGhhbmRsZUNsb3NlID0gKCkgPT4gewogICAgICAgIHNob3V0KCdoaWRlQ29uc29sZScpOwogICAgfQoKICAgIHJldHVybiAoPD4KICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZS10b3AtYmFyIgogICAgICAgID4KCiAgICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZS1idG4gbWQtaWNvbiBtZC1pY29uLWZvbnQiCiAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVDbG9zZX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgdG9wOiAiOHB4IiwKICAgICAgICAgICAgICAgICAgICByaWdodDogIjhweCIsCiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyLAogICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgY2xvc2UKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIAogICAgICAgIDwvZGl2PgogICAgPC8+KQp9CgpyZXR1cm4gQnV0dG9uc0JhcgonAK/RpNAJiQINc2hvd0NoYXRJbnB1dAIEAK/RpNAJr1IFZmFsc2UnAK/RpNAJiQIKc2hvd1RvcEJhcgIEAK/RpNAJtVIEdHJ1ZScBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScAr9Gk0Am6UgZzeXN0ZW0CBACv0aTQCbtSD2FiLnNoZWxsLmNyZWF0ZScAr9Gk0Am6UgRmb3JtAgQAr9Gk0AnLUgdub3RoaW5nJwCv0aTQCbpSC2Rlc2NyaXB0aW9uAgQAr9Gk0AnTUj1Cb3QgdXNlZCB0byBjcmVhdGUvbWFuaWZlc3QgYm90cyBpbnRvIGFuIGFjdHVhbCBzY2VuZS9wb3J0YWwuJwCv0aTQCbpSDGFiQ3JlYXRlQm90cwIEAK/RpNAJkVPCIEAvL0RFViBOT1RFOiBORUVEIFRPIFVOREVSU1RBTkQgV0hBVCBUTyBETyBJRiBBTiBBUlJBWSBJUyBHSVZFTgoKLy9jaGVja3MgZm9yIGluaXRpYWwgYm9vdCBib29sZWFuCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7Ci8vYm90cyB0byBiZSBnZW5lcmF0ZWQKbGV0IGJvdERhdGEgPSB0aGF0LmJvdHM7Ci8vd2hlcmUgZGlkIHRoZSBkYXRhIGNvbWUgZnJvbSAob3B0aW9uYWwpCmxldCBvcmlnaW4gPSB0aGF0Lm9yaWdpbjsKLy93aGF0IHN0dWRpbyBpcyB0aGlzIGRhdGEgZnJvbSAob3B0aW9uYWwpCmNvbnN0IHN0dWRpbyA9IHRoYXQuc3R1ZGlvCi8vdmVyc2lvbiBvZiB0aGUgZGF0YSAob3B0aW9uYWwpCmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwovL2lkTWFwIGFuZCBuZXdCb3RzIGFyZSB1c2VkIHRvIG1hbmFnZSB0aGUgaW5jb21pbmcgYm90IGRhdGEKbGV0IGlkTWFwID0gbmV3IE1hcCgpOwpsZXQgbmV3Qm90cyA9IFtdOwoKLy90aGlzIGxvb3AgY3JlYXRlcyB0aGUgbmV3IGJvdHMgYW5kIHRoZW4gcGFja2FnZXMgdGhlbSBmb3IgYWRkaXRpb25hbCBwcm9jZXNzaW5nLCB3aGlsZSBhZGRpbmcgYW55IG5lZWRlZCBhZGRpdGlvbmFsIHRhZ3MKZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBib3REYXRhKQp7CiAgICBjb25zdCBuZXdCb3QgPSBib3REYXRhW3Byb3BlcnR5XTsKICAgIGNvbnN0IGJvdFRvdGFsID0gT2JqZWN0LmtleXMoYm90RGF0YSkubGVuZ3RoOwogICAgY29uc3QgYWJJRE9yaWdpbiA9IHthYklET3JpZ2luOiBvcmlnaW4sIGFiSURTdHVkaW86IHRoYXQuc3R1ZGlvfTsKICAgIGNvbnN0IGFiR3JpZEZvY3VzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmICgoYm90VG90YWwgPCAyIHx8IGJvdFRvdGFsIDwgMyAmJiBib3REYXRhLmFiWFBCb3QgIT0gbnVsbCkgJiYgYWJHcmlkRm9jdXMpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0RGltZW5zaW9uID0gYWJHcmlkRm9jdXMuZGltZW5zaW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YXJnZXRQb3NpdGlvbiA9IHsgW3RhcmdldERpbWVuc2lvbl06IHRydWUsIFt0YXJnZXREaW1lbnNpb24gKyAiWCJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWJHcmlkRm9jdXMucG9zaXRpb24ueSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgYiA9IGNyZWF0ZShuZXdCb3QudGFncywgdGFyZ2V0UG9zaXRpb24sIGFiSURPcmlnaW4pOwoKICAgICAgICAgICAgaWRNYXAuc2V0KGJvdERhdGFbcHJvcGVydHldLmlkLCBiLmlkKTsKICAgICAgICAgICAgbmV3Qm90cy5wdXNoKGIpOwoKICAgICAgICAgICAgaWYgKGIudGFncy5jcmVhdG9yID09IHRoaXNCb3QuaWQpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBiLnRhZ3MuY3JlYXRvciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnZhbGlkIGJvdCIsIGVycm9yKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKCJza2lwcGVkIGJvdDogIiArIG5ld0JvdCk7CiAgICB9Cn0KCi8vYXJyYXkgb2YgdGFnIHJlbGF0aW9uc2hpcHMgdG8gYmUgcHJlc2VydmVkCmxldCBsaW5rVGFncyA9IFsibGluayIsICJjcmVhdG9yIiwgImNvbmZpZ0JvdCIsICJsaW5lVG8iLCAidHJhbnNmb3JtZXIiXTsKCi8vdGhpcyBsb29wIGNvbnRhaW5zIHRoZSBsb2dpYyBmb3IgcHJlc2VydmluZyB0aGUgbGlua1RhZ3MKZm9yIChsZXQgbmV3Qm90IG9mIG5ld0JvdHMpIAp7CiAgICBmb3IgKGxldCB0YWcgb2YgbGlua1RhZ3MpIAogICAgewogICAgICAgIGxldCB2YWx1ZSA9IG5ld0JvdC50YWdzW3RhZ107CgogICAgICAgIGlmICh0YWcgPT0gImNyZWF0b3IiKSAKICAgICAgICB7CiAgICAgICAgICAgIHZhbHVlID0gbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvcjsKICAgICAgICAgICAgbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVCb3RMaW5rcyhuZXdCb3QsIGlkTWFwKTsKCiAgICAgICAgaWYgKHZhbHVlKSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlLm1hcChpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkTWFwLmdldChpZCkgfHwgaWQ7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0lEID0gaWRNYXAuZ2V0KHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZiAobmV3SUQpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld0lEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgovL3RvYXN0cyBmb3IgaGF0Y2hlcywgYnV0IG9ubHkgb24gYnVpbGRlcgppZiAoY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmlmIChvcmlnaW4pCnsKICAgIGxldCBhYkVnZyA9IHt9OwoKICAgIGFiRWdnLmFiID0gdHJ1ZTsKICAgIGFiRWdnLmFiRWdnID0gdHJ1ZTsKICAgIC8vYWJFZ2cuc3BhY2UgPSAibG9jYWwiOwogICAgYWJFZ2cuYWJJZ25vcmUgPSB0cnVlOwogICAgYWJFZ2cub3JpZ2luX2FiID0gb3JpZ2luOwogICAgYWJFZ2cub3JpZ2luX3ZlcnNpb24gPSB2ZXJzaW9uOwogICAgYWJFZ2cub3JpZ2luX3JlY29yZCA9IHRoYXQucmVjb3JkOwogICAgYWJFZ2cuZm9ybSA9ICJlZ2ciOwogICAgYWJFZ2cubGFiZWwgPSBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbjsKICAgIGFiRWdnLmFiWCA9IGdldEJvdHMoImFiIikubGVuZ3RoICogMS41OwoKICAgIGNyZWF0ZShhYkVnZyk7Cn0KCi8vYWRkaXRpb25hbCBoYXRjaCBkYXRhCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKLy9jaGVjayBhbmQgZXhlY3V0ZSBvblByZUhhdGNoIGNvZGUKZm9yIChjb25zdCBoYXRjaGluZ0JvdCBvZiBuZXdCb3RzKQp7CiAgICBpZiAoaGF0Y2hpbmdCb3QudGFncy5vblByZUhhdGNoKQogICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgYXdhaXQgaGF0Y2hpbmdCb3Qub25QcmVIYXRjaCh7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwogICAgICAgIH0KICAgICAgICBjYXRjaAogICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYG9uUHJlSGF0Y2ggbm90IHZhbGlkIG9uIGJvdCAke2hhdGNoaW5nQm90LmlkfWApOwogICAgICAgIH0KICAgIH0KfQoKLy9pbml0aWFsIGJvb3QgbG9naWMgV0hBVCBJUyBUSElTPz8/CmlmIChpbml0aWFsQm9vdCkgCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9CgovL29uRWdnSGF0Y2ggZm9yIGFsbCBqdXN0IGhhdGNoZWQgYm90cwp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb24sIGluc3Q6IGFiLnRhZ3MuYWJJbnN0LCBlZ2dQYXJhbWV0ZXJzOiB0aGF0LmVnZ1BhcmFtZXRlcnN9KTsKCi8vb25BYkFkZGVkIGZvciBhbGwgYm90cyBpbiB0aGUgZXhwZXJpZW5jZQpzdXBlclNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbiwgaW5zdDogYWIudGFncy5hYkluc3R9KTsKCnJldHVybjsnAK/RpNAJulIIcmVtZW1iZXICBACv0aTQCdRzKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAK/RpNAJulIJb25BYkFkZGVkAgQAr9Gk0An7c5QBQC8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7Cgpjb25zb2xlLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycAr9Gk0Am6UghhYklnbm9yZQIEAK/RpNAJkHUEdHJ1ZSgAr9Gk0Am6UgxhYkJvdFZlcnNpb24BfY4DJwCv0aTQCbpSB2FiU2hlbGwCBACv0aTQCZZ1BHRydWUnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAK/RpNAJm3UGc3lzdGVtAgQAr9Gk0AmcdQ5hYi5zaGVsbC5zdG9yZScAr9Gk0AmbdQRmb3JtAgQAr9Gk0AmrdQdub3RoaW5nJwCv0aTQCZt1C2Rlc2NyaXB0aW9uAgQAr9Gk0AmzdT9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nAK/RpNAJm3UPYWJQdWJsaXNoUmVjb3JkAgQAr9Gk0AnzdbIGQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgpsZXQgcHVibGljRmFjaW5nID0gdGhhdC5wdWJsaWNGYWNpbmc7CmxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IGVuZHBvaW50ID0gdGhhdC5lbmRwb2ludCA/IHRoYXQuZW5kcG9pbnQgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKaWYgKHB1YmxpY0ZhY2luZykKewogICAgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEodXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwge2VuZHBvaW50OiBlbmRwb2ludCwgbWFya2VyczogWyJwdWJsaWNSZWFkIl19KTsKfQplbHNlCnsgICAgCiAgICByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YSh1c2VyUmVjb3JkLCByZWNvcmROYW1lLCByZWNvcmREYXRhLCB7ZW5kcG9pbnQ6IGVuZHBvaW50LCBtYXJrZXJzOiBbcmVjb3JkTmFtZV19KTsKfQoKaWYgKHJlY29yZERhdGEuc3VjY2VzcykKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGRhdGEgcmVjb3JkZWQgdG8gIiArIHVzZXJSZWNvcmQpOwp9CmVsc2UKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGRhdGEgZmFpbGVkIHRvIHJlY29yZCIpOwp9CgpyZXR1cm4gcmVjb3JkRGF0YTsnAK/RpNAJm3UNYWJQdWJsaXNoRmlsZQIEAK/RpNAJpnzZBUBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwogICAgCmlmICghZmlsZVVwbG9hZC5zdWNjZXNzKSAKewogICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHVzZXJSZWNvcmQpOwoKICAgIGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwp9CgppZiAoZmlsZVVwbG9hZC5zdWNjZXNzKQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZmlsZSByZWNvcmRlZCB0byAiICsgdXNlclJlY29yZCk7Cn0KZWxzZQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZmlsZSBmYWlsZWQgdG8gcmVjb3JkIik7Cn0KCnJldHVybiBmaWxlVXBsb2FkOycAr9Gk0AmbdRBhYkNvcmVNZW51QWN0aW9uAgQAr9Gk0AmAggFNQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgovL3NldCB1cCB0aGUgcHVibGlzaCBtZW51CnRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAK/RpNAJm3ULb25TdG9yZU1lbnUCBACv0aTQCc6CAbdsQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CgpsZXQgcmVsZXZhbnRUYXJnZXRCb3RzOwoKaWYgKGFsbFRhcmdldEJvdHMpCnsKICAgIHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKfQoKbGV0IHBvc3NpYmxlUHVibGlzaEJvdCA9IHJlbGV2YW50VGFyZ2V0Qm90cz8ubGVuZ3RoID4gMCA/IHJlbGV2YW50VGFyZ2V0Qm90cyA6IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgpjb25zdCBiYXNlQUIgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOiBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzLmlkOwpjb25zdCBiYXNlQm90cyA9IGdldEJvdHMoYnlNb2Qoe2FiSURPcmlnaW46IGJhc2VBQiwgc3BhY2U6ICJzaGFyZWQifSkpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsaW5rcy5tZW51Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsKCmNvbnN0IGRlZmF1bHRzID0gewogICAgYWJNZW51OiB0cnVlLAogICAgYWJNZW51UmVmcmVzaDogIkAgZGVzdHJveSh0aGlzQm90KTsiLAogICAgY29sb3I6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IsCiAgICBtYW5hZ2VyOiAi8J+UlyIgKyB0aGlzQm90LmlkLAogICAgbWFuaWZlc3RhdGlvbjogdGFncy5tYW5pZmVzdGF0aW9uLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YCwKfQoKLy8gQ3JlYXRlIGRvd25sb2FkIGJ1dHRvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGFiTWVudVNvcnRPcmRlcjogOSwKICAgIGxhYmVsOiAiZG93bmxvYWQiLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgIGZvcm1BZGRyZXNzOiAiZ2V0X2FwcCIsCiAgICByZW1lbWJlcjogdGFncy5yZW1lbWJlciwKICAgIHBvc3NpYmxlQm90OiBnZXRMaW5rKHBvc3NpYmxlUHVibGlzaEJvdCksCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5tYW5hZ2VyLmFiRG93bmxvYWQoe2Jhc2VBQjogbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIsIHBvc3NpYmxlQm90czogbGlua3MucG9zc2libGVCb3R9KTtgLAp9KQoKaWYgKCFhdXRoQm90KSAKewogICAgLy8gQ3JlYXRlIGxvZ2luIG1lc3NhZ2UKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDksCiAgICAgICAgbGFiZWw6ICJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3Mgc2hhcmUgZmVhdHVyZXMiLAogICAgICAgIGZvcm1BZGRyZXNzOiAibG9jayIsCiAgICAgICAgb25DbGljazogYEAgb3MucmVxdWVzdEF1dGhCb3QoKWAsCiAgICB9KQoKICAgIHJldHVybjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKSAKewogICAgLy8gQ3JlYXRlIHVwZ3JhZGUgc3Vic2NyaXB0aW9uIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGxhYmVsOiAicGxlYXNlIHVwZ3JhZGUgeW91ciBzdWJzY3JpcHRpb24gdG8gYWNjZXNzIHNoYXJlIGZlYXR1cmVzIiwKICAgICAgICBmb3JtQWRkcmVzczogImxvY2siLAogICAgfSkKCiAgICByZXR1cm47Cn0KCgpsZXQgdXNlclN0dWRpb3MgPSBjb25maWdCb3QudGFncy51c2VyX3N0dWRpb3M7CgppZiAoIXVzZXJTdHVkaW9zKSAKewogICAgdXNlclN0dWRpb3MgPSBhd2FpdCBvcy5saXN0VXNlclN0dWRpb3MoKTsKfQoKaWYgKHVzZXJTdHVkaW9zLnN1Y2Nlc3MpIAp7CiAgICBjb25zdCBhY3RpdmVTdHVkaW8gPSB1c2VyU3R1ZGlvcy5zdHVkaW9zLmZpbmRJbmRleChzdHVkaW8gPT4gc3R1ZGlvLnN0dWRpb0lkID09IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEKTsKCiAgICBsZXQgYmFzZVN0dWRpbyA9IGF1dGhCb3QuaWQ7CgogICAgaWYgKGJhc2VTdHVkaW8gPT0gYXV0aEJvdC5pZCkgCiAgICB7CiAgICAgICAgYmFzZVN0dWRpbyA9ICJwbGF5ZXIiOwogICAgfQoKICAgIGlmIChhY3RpdmVTdHVkaW8gPT0gLTEgJiYgYmFzZVN0dWRpbyAhPSAicGxheWVyIikgCiAgICB7CiAgICAgICAgY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBiYXNlU3R1ZGlvOwogICAgfQoKICAgIGlmIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgIWFjdGl2ZVN0dWRpbykgCiAgICB7CiAgICAgICAgY29uc3Qgc3R1ZGlvTWF0Y2ggPSB1c2VyU3R1ZGlvcy5zdHVkaW9zLmZpbmRJbmRleChzdHVkaW8gPT4gc3R1ZGlvLnN0dWRpb0lkID09IGNvbmZpZ0JvdC50YWdzLnN0dWRpbykKCiAgICAgICAgaWYgKHN0dWRpb01hdGNoICE9IC0xKSB7CiAgICAgICAgICAgIGJhc2VTdHVkaW8gPSBiYXNlU3R1ZGlvOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBzdHVkaW9MYWJlbCA9IGFjdGl2ZVN0dWRpbyA9PSAtMSA/IGJhc2VTdHVkaW8gOiB1c2VyU3R1ZGlvcy5zdHVkaW9zW2FjdGl2ZVN0dWRpb10uZGlzcGxheU5hbWU7CgogICAgLy8gQ3JlYXRlIHN0dWRpbyBzZWxlY3QgYnV0dG9uCiAgICBjb25zdCBzdHVkaW9EaXNwbGF5QnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGxhYmVsOiAic3R1ZGlvPSIgKyBzdHVkaW9MYWJlbCwKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNSwKICAgICAgICBzdHVkaW9JbmZvcm1hdGlvbjogdXNlclN0dWRpb3MsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJpbnZlbnRvcnlfMiIsCiAgICAgICAgb25DbGljazogYEAgbGlua3MubWFuYWdlci5zdHVkaW9TZWxlY3QodGFncy5zdHVkaW9JbmZvcm1hdGlvbik7YCwKICAgIH0pCgogICAgbWFza3Muc3R1ZGlvU2VsZWN0QnV0dG9uID0gZ2V0TGluayhzdHVkaW9EaXNwbGF5QnV0dG9uKTsKfQoKLy8gQ3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgbGFiZWw6ICJwdWJsaXNoIHBhdHRlcm4iLC8vdGhhdC5rZXlzWzBdID09ICJTaGlmdCIKICAgIGFiTWVudVNvcnRPcmRlcjogMSwKICAgIGxhYmVsQWxpZ25tZW50OiAiY2VudGVyIiwKICAgIGZvcm1BZGRyZXNzOiBudWxsLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgIHNoaWZ0U3RhdGU6IGZhbHNlLAogICAgb25DbGljazogYEAgaWYgKHRhZ3Muc2hpZnRTdGF0ZSkKICAgICAgICB7CiAgICAgICAgICAgIHNob3V0KCJvbktleVVwIiwge2tleXM6IFsiU2hpZnQiXX0pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBzaG91dCgib25LZXlEb3duIiwge2tleXM6IFsiU2hpZnQiXX0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0YWdzLnNoaWZ0U3RhdGUgPSAhdGFncy5zaGlmdFN0YXRlO2AsCiAgICBzY2FsZVk6IDAuNzUsCn0pOwoKLy8gQ3JlYXRlIGVuY3J5cHQgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51OiBudWxsLAogICAgYWJNZW51U29ydE9yZGVyOiAyLAogICAgZGltZW5zaW9uOiAiYWJNZW51IiwKICAgIGxhYmVsOiAiZW5jcnlwdCIsCiAgICBmb3JtQWRkcmVzczogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIiwKICAgIGVuY3J5cHRTdGF0ZTogZmFsc2UsCiAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5lbmNyeXB0U3RhdGUgPSB0cnVlOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSB0cnVlOwogICAgICAgIH1gLAp9KTsKCi8vIC8vY3JlYXRlIGFsbEJvdHMKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnU6IG51bGwsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNTIsCiAgICBkaW1lbnNpb246ICJhYk1lbnUiLAogICAgbGFiZWw6ICJpZ25vcmUgbmV3IGJvdHMiLAogICAgZm9ybUFkZHJlc3M6ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayIsCiAgICB1bmNsYWltZWRTdGF0ZTogZmFsc2UsCiAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQCBpZih0YWdzLnVuY2xhaW1lZFN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgdGFncy51bmNsYWltZWRTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy51bmNsYWltZWRTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkID0gdHJ1ZTsKICAgICAgICB9YCwKfSk7CgovLyBDcmVhdGUgcHVibGljIGJ1dHRvbgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEpIAp7CiAgICBjb25maWdCb3QudGFncy5wdWJsaWNGYWNpbmcgPSBmYWxzZTsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiAyLAogICAgICAgIGxhYmVsOiAiaXNQdWJsaWMiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiLAogICAgICAgIHB1YmxpY1N0YXRlOiBmYWxzZSwKICAgICAgICBvbkNsaWNrOiBgQCBpZih0YWdzLnB1YmxpY1N0YXRlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IHRydWU7CiAgICAgICAgICAgIH1gCiAgICB9KTsKfQoKLy8gQ3JlYXRlIHZlcnNpb24gc2VsZWN0IGJ1dHRvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGFiTWVudTogbnVsbCwKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNiwKICAgIGxhYmVsOiAndmVyc2lvbj1jdXJyZW50JywKICAgIGZvcm1BZGRyZXNzOiAnYWx0X3JvdXRlJywKICAgIC8vbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjhweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgIHNob3dWZXJzaW9uU2VsZWN0b3I6IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDtgLAogICAgaGlkZVZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlO2AsCiAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQCBzaG91dCgnc2hvd1ZlcnNpb25TZWxlY3RvcicpO2AsCiAgICB2ZXJzaW9uT3B0aW9uQ2xpY2s6IGBACiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAndmVyc2lvbj0nICsgdGhhdDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIGAsCn0pOwoKLy8gQ3VycmVudCBWZXJzaW9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51OiBudWxsLAogICAgbGFiZWw6ICdjdXJyZW50JywKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNjEsCiAgICBmb3JtQWRkcmVzczogJ3JhZGlvX2J1dHRvbl9jaGVja2VkJywKICAgIC8vbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjhweCA4cHggMCAwIiwgIm1hcmdpbi10b3AiOiAiM3B4In1gLAogICAgc2hvd1ZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlO2AsCiAgICBoaWRlVmVyc2lvblNlbGVjdG9yOiBgQCB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl9jaGVja2VkJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgICAgICBzaG91dCgndmVyc2lvbk9wdGlvbkNsaWNrJywgdGFncy5sYWJlbCk7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICBgLAogICAgdmVyc2lvbk9wdGlvbkNsaWNrOiBgQCBpZiAodGhhdCA9PSB0YWdzLmxhYmVsKSB7IHJldHVybjsgfQogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl91bmNoZWNrZWQnOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgYAp9KTsKCi8vIEZlZWRiYWNrIFZlcnNpb24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnU6IG51bGwsCiAgICBsYWJlbDogJ2ZlZWRiYWNrJywKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNjIsCiAgICBmb3JtQWRkcmVzczogJ3JhZGlvX2J1dHRvbl91bmNoZWNrZWQnLAogICAgc2hvd1ZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlO2AsCiAgICBoaWRlVmVyc2lvblNlbGVjdG9yOiBgQCB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl9jaGVja2VkJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSAnZmVlZGJhY2snOwogICAgICAgICAgICBzaG91dCgndmVyc2lvbk9wdGlvbkNsaWNrJywgdGFncy5sYWJlbCk7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICBgLAogICAgdmVyc2lvbk9wdGlvbkNsaWNrOiBgQCBpZiAodGhhdCA9PSB0YWdzLmxhYmVsKSB7IHJldHVybjsgfQogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl91bmNoZWNrZWQnOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgYAp9KTsKCi8vIFN0YWJsZSBWZXJzaW9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51OiBudWxsLAogICAgbGFiZWw6ICdzdGFibGUnLAogICAgZGltZW5zaW9uOiAnYWJNZW51JywKICAgIGFiTWVudVNvcnRPcmRlcjogMS42MywKICAgIGZvcm1BZGRyZXNzOiAncmFkaW9fYnV0dG9uX3VuY2hlY2tlZCcsCiAgICAvL21lbnVJdGVtU3R5bGU6IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwIDAgOHB4IDhweCJ9YCwKICAgIHNob3dWZXJzaW9uU2VsZWN0b3I6IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gdHJ1ZTtgLAogICAgaGlkZVZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsO2AsCiAgICBvbktleVVwOiBgQCBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CiAgICAgICAgICAgIH1gLAogICAgb25DbGljazogYEAKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdyYWRpb19idXR0b25fY2hlY2tlZCc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gJ3N0YWJsZSc7CiAgICAgICAgICAgIHNob3V0KCd2ZXJzaW9uT3B0aW9uQ2xpY2snLCB0YWdzLmxhYmVsKTsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsOwogICAgICAgIGAsCiAgICB2ZXJzaW9uT3B0aW9uQ2xpY2s6IGBAIGlmICh0aGF0ID09IHRhZ3MubGFiZWwpIHsgcmV0dXJuOyB9CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAncmFkaW9fYnV0dG9uX3VuY2hlY2tlZCc7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICBgCn0pOwoKLy8gQ3JlYXRlIGluY2x1ZGVCb3RzIGJ1dHRvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGFiTWVudTogbnVsbCwKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNTEsCiAgICBhYlNlbGVjdGlvbkJ1dHRvbjogdHJ1ZSwKICAgIGxhYmVsOiBiYXNlQm90cy5sZW5ndGggPiAwICYmIGJhc2VBQiAhPSB1bmRlZmluZWQgPyBgc2VsZWN0ZWQgcGF0dGVybiBib3RzOiAke2Jhc2VBQn0gKCR7YmFzZUJvdHMubGVuZ3RofSlgIDogIm5vIHBhdHRlcm4gYm90cyBzZWxlY3RlZCIsCiAgICBmb3JtQWRkcmVzczogJ2VnZycsCiAgICAvL21lbnVJdGVtU3R5bGU6IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI4cHgiLCAibWFyZ2luLXRvcCI6ICIzcHgifWAsCiAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5tYW5hZ2VyLmFiUHVibGlzaFNlbGVjdCgpO2AsCn0pOwoKLy8gQ3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51U29ydE9yZGVyOiA0LAogICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YCwKICAgIGZvcm06ICJpbnB1dCIsCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IHRydWUsCiAgICB0YXJnZXRCb3Q6IGdldExpbmsocG9zc2libGVQdWJsaXNoQm90KSwKICAgIG1lbnVJdGVtVGV4dDogYmFzZUFCLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBvblN1Ym1pdDogYEAKICAgICAgICAgICAgaWYgKHRoYXQudGV4dCA9PSBudWxsICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aGF0LnRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdGFyZ2V0U3R1ZGlvID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKICAgICAgICAgICAgY29uc3QgY29uZmlybVB1c2ggPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICB0aXRsZTogImNvbmZpcm0gcHVibGlzaCIsCiAgICAgICAgICAgICAgICBjb250ZW50OiAicHVibGlzaCAiICsgdGhhdC50ZXh0ICsgIiB0byAiICsgdGFyZ2V0U3R1ZGlvICsgIj8iLAogICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICJwdWJsaXNoIiwKICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICJjYW5jZWwiCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKCFjb25maXJtUHVzaCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmICh0aGF0LnRleHQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWUsIGJvdDogbGlua3MudGFyZ2V0Qm90LCBiYXNlQUI6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy50b2FzdCgiYWIgbm90IHNwZWNpZmllZCIpOwogICAgICAgICAgICB9CiAgICAgICAgYCwKfSk7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykgCnsKICAgIC8vIENyZWF0ZSBjb3B5IHRvIGNsaXBib2FyZCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDgsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgICAgICBsYWJlbDogImNvcHkgdG8gY2xpcGJvYXJkIiwKICAgICAgICBmb3JtQWRkcmVzczogImZpbGVfY29weSIsCiAgICAgICAgdGFyZ2V0Qm90OiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXMsCiAgICAgICAgb25DbGljazogYEAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MudGFyZ2V0Qm90OwogICAgICAgICAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgICAgICAgICAgbGV0IHN0YXRlID0ge30KCiAgICAgICAgICAgIHN0YXRlW2FiSW5zdE1lbW9yeS50YWdzLmFiRm9jdXNEYXRhXSA9IHNlbGVjdGVkQm90OwoKICAgICAgICAgICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgICAgICAgICBuZXdGaWxlLnZlcnNpb24gPSAxOwogICAgICAgICAgICBuZXdGaWxlLnN0YXRlID0gc3RhdGU7CgogICAgICAgICAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwogICAgICAgICAgICBvcy5zZXRDbGlwYm9hcmQoZm9ybWF0dGVkRmlsZSk7CgogICAgICAgICAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgIGAsCiAgICB9KTsKfQplbHNlIAp7CiAgICAvLyBDcmVhdGUgc2NhbiBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDEwLAogICAgICAgIG1lbnVJdGVtU3R5bGU6IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIzcHgifWAsCiAgICAgICAgbGFiZWw6ICJzY2FuIiwKICAgICAgICBmb3JtQWRkcmVzczogInFyX2NvZGVfc2Nhbm5lciIsCiAgICAgICAgb25DbGljazogYEAgY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSB0cnVlOyBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpO2AsCiAgICB9KTsKfQoKbGV0IGhvc3RCdXR0b24gPSB7CiAgICBhYk1lbnU6IHRydWUsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDUwLAogICAgYWJNZW51UmVmcmVzaDogIkAgZGVzdHJveSh0aGlzQm90KTsiLAogICAgZm9ybUFkZHJlc3M6ICJncm91cF9hZGQiLAogICAgY29sb3I6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgb25DbGljazogYEAgbGlua3MubGVhcm4uYWJDcmVhdGVIb3N0KHRoaXNCb3QpOwogICAgaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKICAgIHsKICAgICAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwogICAgfWAsCn07CgppZiAobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpIAp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLCAzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKTsKfQplbHNlIAp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImdlbmVyYXRlIGpvaW4gY29kZSI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicAr9Gk0AmbdQ5hYkNvcmVNZW51SWNvbgIEAK/RpNAJ8O4BCWlvc19zaGFyZScAr9Gk0AmbdQ9hYkNvcmVNZW51TGFiZWwCBACv0aTQCfruAQVzaGFyZScAr9Gk0AmbdRNhYkNvcmVNZW51U29ydE9yZGVyAgQAr9Gk0AmA7wEBMycAr9Gk0AmbdQhyZW1lbWJlcgIEAK/RpNAJgu8BKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAK/RpNAJm3ULYWJQdWJsaXNoQUICBACv0aTQCanvAfwtQC8vc2hvdXQoImFiUHVibGlzaEFCIiwge2FiOiAiIiwga2V5OiAiIiwgdGFyZ2V0OiAiIn0pOwppZiAodGhhdC5hYi5pbmRleE9mKCIgIikgIT0gLTEpCnsKICAgIG9zLnRvYXN0KCJwYXR0ZXJuIG5hbWVzIG1heSBub3QgY29udGFpbiBzcGFjZSwgcGxlYXNlIHRyeSBhZ2Fpbi4iKTsKCiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBwdWJsaXNoaW5nICIgKyB0aGF0LmFiKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovL2NsZWFyIGFiIGJ1aWxkZXIKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCi8vcHJvZ3Jlc3MgYmFyIGZvciBtYW51YWwgcHVibGlzaGluZyBjb25maXJtYXRpb24KaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCnsKICAgIHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgdXBsb2FkaW5nICR7dGhhdC5hYn1gKTsKfQoKLy9hYiB2YXJpYWJsZXMKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldCA/IHRoYXQudGFyZ2V0IDogdGhhdC5ib3Q7CmxldCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpsZXQgcHVibGljRmFjaW5nID0gdGhhdC5wdWJsaWNGYWNpbmcgPz8gY29uZmlnQm90LnRhZ3MucHVibGljRmFjaW5nOwpsZXQgc3RhdGUgPSB7fTsKbGV0IGZvcm1hdHRlZEZpbGUgPSB7fTsKCmNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IG51bGw7CgovL3RoaXMgbG9naWMgZm9ybWF0cyB0aGUgc3BlY2lmaWVkIGJvdHMgYW5kIHBhY2thZ2VzIHRoZW0gZm9yIHB1Ymxpc2hpbmcKaWYgKCFBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgdGFyZ2V0ICE9IG51bGwgJiYgdGFyZ2V0ICE9IHVuZGVmaW5lZCkKewoKfQplbHNlIGlmICghdGFyZ2V0IHx8IHRhcmdldC5sZW5ndGggPCAxKQp7CiAgICBjb25zdCBiYXNlQUIgPSB0aGF0LmJhc2VBQiA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKCiAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkICYmIGFiSUQgPT0gYmFzZUFCKQogICAgewogICAgICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGwsIGFiSURPcmlnaW46IGFiSUR9KSk7CgogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiRXhjbHVkZVVuY2xhaW1lZCA9IG51bGw7CiAgICB9CiAgICBlbHNlIGlmIChhYklEID09IGJhc2VBQiAmJiBnZXRCb3QoImFiSURPcmlnaW4iLCBiYXNlQUIpKQogICAgewogICAgICAgIGNvbnN0IGVnZ0JvdHMgPSBnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsLCBhYklET3JpZ2luOiBhYklEfSkpOwogICAgICAgIGNvbnN0IG5ld0JvdHMgPSBnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsLCBhYklET3JpZ2luOiBudWxsfSkpOwoKICAgICAgICBzZXRUYWcobmV3Qm90cywgImFiSURPcmlnaW4iLCBhYklEKTsKCiAgICAgICAgdGFyZ2V0ID0gWy4uLmVnZ0JvdHMsIC4uLm5ld0JvdHNdOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSk7CiAgICB9CgogICAgaWYgKHRhcmdldC5sZW5ndGggPCAxKQogICAgewogICAgICAgIG9zLnRvYXN0KCJObyBib3RzIGZvdW5kIHRvIHB1Ymxpc2giKTsKCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgZ2VuZXJhdGluZyBhIGtleSBmb3IgZW5jcnlwdGlvbiAob3B0aW9uYWwpCmlmIChjb25maWdCb3QudGFncy5lbmNyeXB0aW9uKQp7CiAgICBsZXQga2V5Q2hlY2s7CgogICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IG51bGw7CgogICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCIiLCB7CiAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgdGl0bGU6ICdlbnRlciBhIHNlY3JldCBrZXknCiAgICB9KTsKCiAgICBpZiAoa2V5KQogICAgewogICAgICAgIGtleUNoZWNrID0gYXdhaXQgb3Muc2hvd0lucHV0KCIiLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ2NvbmZpcm0gc2VjcmV0IGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoa2V5ICE9IGtleUNoZWNrKSB7CiAgICAgICAgaWYgKCFrZXlDaGVjaykKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJubyBrZXkgZW50ZXJlZCIpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgia2V5cyBkbyBub3QgbWF0Y2giKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCi8vZm9ybWF0dGluZyBib3RzIGZvciBmaWxlIHN0b3JhZ2UKaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSkgCnsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGN1cnJlbnRCb3RJRCA9IHRhcmdldFtpXS5pZDsKICAgICAgICBsZXQgY3VycmVudEJvdCA9IHRhcmdldFtpXTsKICAgICAgICAKICAgICAgICBzdGF0ZVtjdXJyZW50Qm90SURdID0gY3VycmVudEJvdDsKICAgIH0KfQplbHNlIAp7CiAgICBzdGF0ZVt0YXJnZXQuaWRdID0gdGFyZ2V0Owp9CgovL2NoZWNrcyBmb3IgcHJldmlvdXMgZWdncyBhbmQgcmV0dXJucyBkYXRhIGZvciBwcmV2aW91c2x5IHB1Ymxpc2hlZCBhYidzCmxldCBlZ2dDaGVjayA9IGF3YWl0IHRoaXNCb3QuYWJQcmV2aW91c0VnZ0NoZWNrKHthYklEOiBhYklEfSk7CgovL2FkZCB4cCBib3QgaGVyZQpjb25zdCB4cFZlcnNpb25Cb3QgPSB7fTsKCnhwVmVyc2lvbkJvdC5zcGFjZSA9ICJzaGFyZWQiOwp4cFZlcnNpb25Cb3QuaWQgPSAiYWJYUEJvdCI7CnhwVmVyc2lvbkJvdC50YWdzID0ge307CnhwVmVyc2lvbkJvdC50YWdzLmZvcm0gPSAibm90aGluZyI7CnhwVmVyc2lvbkJvdC50YWdzLnN5c3RlbSA9ICJhYi5wYXR0ZXJuLmFiWFBCb3QiOwp4cFZlcnNpb25Cb3QudGFncy5hdXRob3JJRCA9IGF1dGhCb3QuaWQ7CnhwVmVyc2lvbkJvdC50YWdzLnZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLm1heFZlcnNpb247CnhwVmVyc2lvbkJvdC50YWdzLnhwID0gbGlua3MubGVhcm4udGFncy5hYlhQOwp4cFZlcnNpb25Cb3QudGFncy5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CnhwVmVyc2lvbkJvdC50YWdzLmFiSWdub3JlID0gdHJ1ZTsKCnN0YXRlLmFiWFBCb3QgPSB4cFZlcnNpb25Cb3Q7CgovL2FkZGl0aW9uYWwgZmlsZSBkYXRhCmZvcm1hdHRlZEZpbGUudmVyc2lvbiA9IDE7CmZvcm1hdHRlZEZpbGUuc2lnbmF0dXJlID0gZWdnQ2hlY2suc2lnbmF0dXJlOwpmb3JtYXR0ZWRGaWxlLnN0YXRlID0gc3RhdGU7CgovL2FjdHVhbCBlbmNyeXB0aW9uIGlmIGNob3NlbgppZiAoa2V5KSAKewogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KGZvcm1hdHRlZEZpbGUpOwoKICAgIGZvcm1hdHRlZEZpbGUgPSBjcnlwdG8uZW5jcnlwdChrZXksIGZvcm1hdHRlZEZpbGUpOwp9CgovL3B1Ymxpc2ggdGhlIGZpbGUKbGV0IHB1Ymxpc2hGaWxlID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hGaWxlKHtmaWxlOiBmb3JtYXR0ZWRGaWxlLCBmaWxlTmFtZTogYWJJRH0pOwoKLy9nYXRoZXIgYWRkaW9uYWwgZWdnIGRhdGEKZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5wdXNoKHB1Ymxpc2hGaWxlLnVybCk7CmVnZ0NoZWNrLmVnZ0RhdGEubWF4VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwplZ2dDaGVjay5lZ2dEYXRhLnRhcmdldFZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKCi8vcHVibGlzaCBlZ2cvYWIgcmVjb3JkCmxldCBwdWJsaXNoUmVjb3JkID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUQsIHB1YmxpY0ZhY2luZzogcHVibGljRmFjaW5nfSk7CmxldCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKCi8vcHVibGlzaGluZyBzaG91dApzdXBlclNob3V0KCJvbkFCUHVibGlzaGVkIiwge3N1Y2Nlc3M6IHB1Ymxpc2hGaWxlLnN1Y2Nlc3MsIGFiOiBhYklELCBmaWxlQWRkcmVzczogcHVibGlzaEZpbGUudXJsfSk7Cgpjb25zdCBzdHVkaW9MaW5rID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCi8vc2VuZCBkYXRhIGFuZCBmb3JtYXQgdXJsIGlmIGRhdGEgc3VjY2Vzc2Z1bGx5IHNlbnQKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgY29uc3QgYmlvcyA9IHB1YmxpY0ZhY2luZyA/ICJmcmVlJTIwaW5zdCIgOiAibG9jYWwlMjBpbnN0IjsKICAgIGNvbnN0IGluc3RUeXBlID0gcHVibGljRmFjaW5nID8gImZyZWUiIDogImxvY2FsIgoKICAgIHNldFRhZ01hc2sobGlua3MubGVhcm4sICJhYlhQIiwgIjAiLCAibG9jYWwiKTsKCiAgICBpZiAoa2V5ICYmIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpIAogICAgewogICAgICAgIG9zLnNldENsaXBib2FyZChzaXRlT3JpZ2luICsgIi8/cGF0dGVybj0iICsgYWJJRCArICIma2V5PSIgKyBrZXkgKyAiJnN0dWRpbz0iICsgc3R1ZGlvTGluayArICImYmlvcz0iICsgYmlvcyk7CiAgICAgICAgCiAgICAgICAgb3MudG9hc3QoYGVuY3J5cHRlZCBkYXRhIHdpdGggYSAke2luc3RUeXBlfSBpbnN0IHVybCBjb3BpZWQgdG8gY2xpcGJvYXJkYCk7CiAgICB9CiAgICBlbHNlIGlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQogICAgewogICAgICAgIG9zLnNldENsaXBib2FyZChzaXRlT3JpZ2luICsgIi8/cGF0dGVybj0iICsgYWJJRCArICImc3R1ZGlvPSIgKyBzdHVkaW9MaW5rICsgIiZiaW9zPSIgKyBiaW9zKTsKCiAgICAgICAgb3MudG9hc3QoYCR7aW5zdFR5cGV9IGluc3QgdXJsIGNvcGllZCB0byBjbGlwYm9hcmRgKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYl9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgaWYgKCFjb25maWdCb3QudGFncy5hYlNpbGVudE1vZGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoInB1Ymxpc2hpbmcgZmFpbGVkLCBwbGVhc2UgdHJ5IGFnYWluIik7CiAgICB9CgogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHB1Ymxpc2hpbmcgZmFpbGVkIik7CiAgICAKICAgIGNvbnNvbGUubG9nKHB1Ymxpc2hSZWNvcmQpOwp9CgovL2NsZWFyIHByb2dyZXNzIGJhcgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9Cgpjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gbnVsbDsKCnJldHVybiBwdWJsaXNoUmVjb3JkOycAr9Gk0AmbdQhhYklnbm9yZQIEAK/RpNAJpp0CBHRydWUnAK/RpNAJm3UKYWJEb3dubG9hZAIEAK/RpNAJq50CuwZALy9kb3dubG9hZCBib3RzIChlaXRoZXIgc2VsZWN0ZWQgb3IgYWxsIGV4cGVyaWVuY2UpCmxldCBkb3dubG9hZEJvdHM7Cgpjb25zb2xlLmxvZygiZG93bmxvYWQiLCB0aGF0KTsKCmlmIChBcnJheS5pc0FycmF5KHRoYXQucG9zc2libGVCb3RzKSkKewogICAgaWYgKHRoYXQucG9zc2libGVCb3RzLmxlbmd0aCA+IDApCiAgICB7CiAgICAgICAgZG93bmxvYWRCb3RzID0gdGhhdC5wb3NzaWJsZUJvdHM7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBib3RzIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZG93bmxvYWRCb3RzID0gZ2V0Qm90cyhieU1vZCh7ImFiSWdub3JlIjogbnVsbCwgInNwYWNlIjogInNoYXJlZCJ9KSk7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBpbnN0Iik7CiAgICB9ICAgIAp9CmVsc2UKewoKCiAgICBkb3dubG9hZEJvdHMgPSBbdGhhdC5wb3NzaWJsZUJvdHNdOwoKICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBib3QiKTsKfQoKaWYgKCFBcnJheS5pc0FycmF5KGRvd25sb2FkQm90cykpCnsKICAgIGRvd25sb2FkQm90cyA9IFtkb3dubG9hZEJvdHNdOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycAr9Gk0AmbdQ1tYW5pZmVzdGF0aW9uAgQAr9Gk0AnnowIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAr9Gk0AmbdQRtZW51AgQAr9Gk0AmOpAIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAr9Gk0AmbdRJhYlByZXZpb3VzRWdnQ2hlY2sCBACv0aTQCbWkAtkPQC8vdGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYXQgYSBzcGVjaWZpZWQgYWIsIHJldHVybmluZyBhbnkgZGF0YSB0aGF0IGl0IGZpbmRzCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7Cgphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCBzdGFibGVWZXJzaW9uOwpsZXQgZmVlZGJhY2tWZXJzaW9uOwpsZXQgcHJldmlvdXNYUDsKbGV0IHVzZXJSZWNvcmQgPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc3R1ZGlvID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogYXV0aEJvdC5pZDsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEodXNlclJlY29yZCwgYWJJRCkuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgcHJldmlvdXNYUCA9IHJlY29yZExvb2t1cC5kYXRhLnhwID8/IDA7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwogICAgbGFzdEhhc2ggPSBlZ2dIaXN0b3J5W3RhcmdldFZlcnNpb25OdW0gLSAxXTsKICAgIHN0YWJsZVZlcnNpb24gPSByZWNvcmRMb29rdXAuZGF0YS5zdGFibGVWZXJzaW9uOwogICAgZmVlZGJhY2tWZXJzaW9uID0gcmVjb3JkTG9va3VwLmRhdGEuZmVlZGJhY2tWZXJzaW9uOwogICAgbWF4VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKfSAKZWxzZSAKewogICAgZWdnSGlzdG9yeSA9IFtdOwogICAgZWdnSUQgPSB1dWlkKCk7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gMTsKICAgIGxhc3RIYXNoID0gIm5vbmUiOwogICAgbWF4VmVyc2lvbk51bSA9IDE7CiAgICBwcmV2aW91c1hQID0gMDsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID09ICJmZWVkYmFjayIpIAp7CiAgICBmZWVkYmFja1ZlcnNpb24gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPT0gInN0YWJsZSIpCnsKICAgIHN0YWJsZVZlcnNpb24gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0KCmNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLnN0YWJsZVZlcnNpb24gPSBzdGFibGVWZXJzaW9uOwplZ2cuZmVlZGJhY2tWZXJzaW9uID0gZmVlZGJhY2tWZXJzaW9uOwplZ2cuYWJJRCA9IGFiSUQ7CmVnZy54cCA9IGxpbmtzLmxlYXJuLnRhZ3MuYWJYUDsKCmxldCBzaWduYXR1cmUgPSB7fTsKbGV0IGRhdGUgPSBuZXcgRGF0ZSgpOwpsZXQgdGltZSA9IGRhdGUuZ2V0VGltZSgpOwoKc2lnbmF0dXJlLnByZXZpb3VzSGFzaCA9IGxhc3RIYXNoOwpzaWduYXR1cmUuYWJWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVWZXJzaW9uKyIuIitsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbjsKc2lnbmF0dXJlLmVnZ1ZlcnNpb24gPSB0YWdzLmVnZ1VVSUQ7CnNpZ25hdHVyZS5lZ2dWZXJzaW9uTnVtID0gdGFncy5vdm9WZXJzaW9uOwpzaWduYXR1cmUudGltZVN0YW1wID0gdGltZTsKc2lnbmF0dXJlLmNhc3VhbE9TVmVyc2lvbiA9IFtvcy52ZXJzaW9uKCldOwoKcmV0dXJuIHtzaWduYXR1cmU6IHNpZ25hdHVyZSwgZWdnRGF0YTogZWdnfTsoAK/RpNAJm3UMYWJCb3RWZXJzaW9uAX2OAycAr9Gk0AmbdQ9hYkJvdE1lbnVBY3Rpb24CBACv0aTQCZC0Ak1AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycAr9Gk0AmbdQ5hYkJvdE1lbnVMYWJlbAIEAK/RpNAJ3rQCBXNoYXJlJwCv0aTQCZt1DWFiQm90TWVudUljb24CBACv0aTQCeS0Aglpb3Nfc2hhcmUnAK/RpNAJm3USYWJCb3RNZW51U29ydE9yZGVyAgQAr9Gk0AnutAIBMycAr9Gk0AmbdQVsZWFybgIEAK/RpNAJ8LQCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAK/RpNAJm3ULYWJRUlB1Ymxpc2gCBACv0aTQCZe1AsYBQGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gbnVsbDsKCmxldCBzY2FubmVkVVJMOwoKdHJ5IAp7CiAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKfQpjYXRjaCAoZSkgCnsKICAgIHNob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9JwCv0aTQCZt1BnNlYXJjaAIEAK/RpNAJ3rYCKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAK/RpNAJm3UHYWJTaGVsbAIEAK/RpNAJhbcCBHRydWUnAK/RpNAJm3UMc3R1ZGlvU2VsZWN0AgQAr9Gk0AmKtwLRC0AvL3Nob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYlN0dWRpb01lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBzdHVkaW9zID0gdGhhdC5zdHVkaW9zOwpjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc3R1ZGlvID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogYXV0aEJvdC5pZDsKY29uc3QgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDA7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gInBsYXllciBzdHVkaW8iOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gdGFyZ2V0U3R1ZGlvID09IGF1dGhCb3QuaWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5zdHVkaW9JRCA9IGF1dGhCb3QuaWQ7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gdGFncy5zdHVkaW9JRDsKCmxpbmtzLm1hbmFnZXIubGlua3Muc3R1ZGlvU2VsZWN0QnV0dG9uLnRhZ3MubGFiZWwgPSB0YWdzLmxhYmVsOwoKc2hvdXQoImFiU3R1ZGlvTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBzdHVkaW9zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlU3R1ZGlvID0gc3R1ZGlvc1tpXTsKICAgIGNvbnNvbGUubG9nKCJBQ1RJVkUiLCB0YXJnZXRTdHVkaW8gKyAiLCAiICsgYWN0aXZlU3R1ZGlvLnN0dWRpb0lkKQogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRhcmdldFN0dWRpbyA9PSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9IGFjdGl2ZVN0dWRpby5kaXNwbGF5TmFtZTsKICAgIG1lbnVCdXR0b24uc3R1ZGlvSUQgPSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQ7CgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0nAK/RpNAJm3UOYWJQdWJsaXNoQXNrSUQCBACv0aTQCdrCAvQEQGxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYHB1Ymxpc2hpbmcgJHt0aGF0LmFza0lEfWApOwoKYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmNvbnN0IHBhdHRlcm5JRCA9IHRoYXQucGF0dGVybklEOwpjb25zdCBzdHVkaW9JRCA9IHRoYXQuc3R1ZGlvSUQgPyB0aGF0LnN0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPyBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA6IGF1dGhCb3QuaWQ7CmNvbnN0IGFza0lEID0gImFza18iICsgdGhhdC5hc2tJRC5yZXBsYWNlQWxsKCItIiwgIiIpOwpjb25zdCBlbmRwb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKY29uc3QgcHVibGlzaEFzayA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgYXNrSUQsIHtwYXR0ZXJuSUQ6IHBhdHRlcm5JRCwgc3R1ZGlvSUQ6IHN0dWRpb0lEfSwge2VuZHBvaW50OiBlbmRwb2ludCwgdXBkYXRlUG9saWN5OiBbYXV0aEJvdC5pZF19KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBwdWJsaXNoQXNrOycAr9Gk0AmbdQVpbnB1dAIEAK/RpNAJz8cCKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAK/RpNAJm3ULYWJFbWJlZExpbmsCBACv0aTQCfbHAqQDQGNvbnN0IGFiID0gdGhhdCA/IHRydWUgOiBmYWxzZTsKY29uc3QgZW1iZWRMaW5rID0gYWIgPyAiYWI9IiArIHRoYXQgOiAiaW5zdD0iICsgY29uZmlnQm90LnRhZ3MuaW5zdDsKY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CmNvbnN0IGVtYmVkVGV4dCA9IGA8IURPQ1RZUEUgaHRtbD4KwqDCoMKgwqA8aHRtbD4KwqDCoMKgwqDCoMKgwqDCoDxoZWFkPjwvaGVhZD4KwqDCoMKgwqDCoMKgwqDCoDxib2R5PgrCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqA8aWZyYW1lIHNyYz0iJHtzaXRlT3JpZ2luICsgIi8/IiArIGVtYmVkTGlua30iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjQwMCIgLz4KwqDCoMKgwqDCoMKgwqDCoDwvYm9keT4KwqDCoMKgwqA8L2h0bWw+YDsKCnJldHVybiBlbWJlZFRleHQ7JwCv0aTQCZt1D2FiUGF0dGVyblVwZGF0ZQIEAK/RpNAJ78oC5wRALy9zaG91dCgiYWJQYXR0ZXJuVXBkYXRlIiwge2FiSUQ6IGFiSUQsIHN0dWRpbzpzdHVkaW8/LCBib3RzOiBib3RzP30pOwphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKaWYgKCFhdXRoQm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IHN0dWRpbyA9IHRoYXQuc3R1ZGlvID8gdGhhdC5zdHVkaW8gOiBjb25maWdCb3QudGFncy5zdHVkaW8gPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiBhdXRoQm90LmlkOwpjb25zdCBhYk1hbmlmZXN0ID0gZ2V0Qm90KGJ5TW9kKHthYkVnZzogdHJ1ZSwgb3JpZ2luX2FiOiBhYklEfSkpOwoKaWYgKCFhYk1hbmlmZXN0KQp7CiAgICBzaG91dCgib25Mb29rdXBBQkVnZ3MiLCB7YWJJRDogYWJJRCwgcmVjb3JkS2V5OiBzdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZX0pOwoKICAgIHJldHVybjsKfQoKY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBzdHVkaW87Cgpjb25zdCBhYkJvdHMgPSB0aGF0LmJvdHMgPz8gZ2V0Qm90cygiYWJJRE9yaWdpbiIsIGFiSUQpOwoKYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hBQih7YWI6IGFiSUQsIHRhcmdldDogYWJCb3RzLCBwdWJsaWNGYWNpbmc6IHRydWV9KTsnAK/RpNAJm3UXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACv0aTQCdfPAk1AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycAr9Gk0AmbdRphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAK/RpNAJpdACATInAK/RpNAJm3UVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAr9Gk0Amn0AIJaW9zX3NoYXJlJwCv0aTQCZt1FmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACv0aTQCbHQAgVzaGFyZScAr9Gk0AmbdQ9hYlB1Ymxpc2hTZWxlY3QCBACv0aTQCbfQAqsRQC8vc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiUGF0dGVybk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBhbGxCb3RzID0gZ2V0Qm90cygiYWJJRE9yaWdpbiIpOwpjb25zdCBhbGxQYXR0ZXJucyA9IFsibm9uZSJdOwoKYm90TG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxCb3RzLmxlbmd0aDsgaSsrKQp7CiAgICBjb25zdCBhY3RpdmVCb3QgPSBhbGxCb3RzW2ldOwoKICAgIGlmIChhY3RpdmVCb3QudGFncy5hYklnbm9yZSkKICAgIHsKICAgICAgICBjb250aW51ZSBib3RMb29wOwogICAgfQoKICAgIGNvbnN0IHBvc3NpYmxlUGF0dGVybiA9IGFjdGl2ZUJvdC50YWdzLmFiSURPcmlnaW47CgogICAgZm9yIChsZXQgaiA9IDA7IGogPCBhbGxQYXR0ZXJucy5sZW5ndGg7IGorKykKICAgIHsKICAgICAgICBjb25zdCBhY3RpdmVQYXR0ZXJuID0gYWxsUGF0dGVybnNbal07CgogICAgICAgIGlmIChhY3RpdmVQYXR0ZXJuID09IHBvc3NpYmxlUGF0dGVybiApCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBib3RMb29wOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChqID09IGFsbFBhdHRlcm5zLmxlbmd0aCAtIDEpCiAgICAgICAgewogICAgICAgICAgICBhbGxQYXR0ZXJucy5wdXNoKHBvc3NpYmxlUGF0dGVybik7CiAgICAgICAgfQogICAgfQp9Cgpjb25zdCB0YXJnZXRBQiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOwpjb25zdCBpbnB1dEJ1dHRvbiA9IGdldEJvdChieU1vZCh7Zm9ybTogImlucHV0IiwgYWJNZW51OiB0cnVlLCBmb3JtQWRkcmVzczogImVnZyJ9KSk7CmNvbnN0IGFiQnV0dG9uID0gZ2V0Qm90KCJhYlNlbGVjdGlvbkJ1dHRvbiIsIHRydWUpOwpjb25zdCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiUGF0dGVybk1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDA7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYlBhdHRlcm5NZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwptZW51QnV0dG9uLmlucHV0QnV0dG9uID0gZ2V0TGluayhpbnB1dEJ1dHRvbik7Cm1lbnVCdXR0b24uYWJCdXR0b24gPSBnZXRMaW5rKGFiQnV0dG9uKTsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgaWYgKHRhZ3MubGFiZWwgPT0gIm5vbmUiKQp7CiAgICB0YWdzLmxhYmVsID0gIm5vbmUiOwp9Cgpjb25zdCB0b3RhbFBhdHRlcm5Cb3RzID0gZ2V0Qm90cygnYWJJRE9yaWdpbicsIHRhZ3MubGFiZWwpOwoKbGlua3MucmVtZW1iZXIubWFza3MuYmFzZUFCID0gdGFncy5sYWJlbCA9PSAibm9uZSIgPyBudWxsIDogdGFncy5sYWJlbDsKbGlua3MuaW5wdXRCdXR0b24udGFncy5tZW51SXRlbVRleHQgPSB0YWdzLmxhYmVsID09ICJub25lIiA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCIDogdGFncy5sYWJlbDsKbGlua3MuYWJCdXR0b24udGFncy5sYWJlbCA9IHRhZ3MubGFiZWwgPT0gIm5vbmUiID8gIm5vIHBhdHRlbiBib3RzIHNlbGVjdGVkIiA6ICJzZWxlY3RlZCBwYXR0ZXJuIGJvdHM6ICIgKyB0YWdzLmxhYmVsICsgIigiICsgdG90YWxQYXR0ZXJuQm90cy5sZW5ndGggKyAiKSI7CgpzaG91dCgiYWJQYXR0ZXJuTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgYWxsUGF0dGVybnMubGVuZ3RoOyBpKyspCnsKICAgIGxldCBhY3RpdmVQYXR0ZXJuTmFtZSA9IGFsbFBhdHRlcm5zW2ldOwoKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSB0YXJnZXRBQiA9PSBhY3RpdmVQYXR0ZXJuTmFtZSA/ICJyYWRpb19idXR0b25fY2hlY2tlZCIgOiAicmFkaW9fYnV0dG9uX3VuY2hlY2tlZCI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gYWN0aXZlUGF0dGVybk5hbWU7CgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0nAQRib3RzJGQ4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNQEnAK/RpNAJ4eECBnN5c3RlbQIEAK/RpNAJ4uECD2FiLnNoZWxsLnNlYXJjaCcAr9Gk0Anh4QIEZm9ybQIEAK/RpNAJ8uECB25vdGhpbmcnAK/RpNAJ4eECDmFiUmV0cmlldmVGaWxlAgQAr9Gk0An64QKCAUAvL3B1bGwgZG93biBmaWxlIGRhdGEKaWYgKCF0aGF0LnVybCkKewogICAgcmV0dXJuICJubyBmaWxlIHVybCBzdXBwbGllZCI7Cn0KCmxldCBkYXRhID0gYXdhaXQgb3MuZ2V0RmlsZSh0aGF0LnVybCk7CgpyZXR1cm4gZGF0YTsnAK/RpNAJ4eECEGFiUmV0cmlldmVSZWNvcmQCBACv0aTQCf3iAuwEQC8vcmV0cmlldmUgc3BlY2lmaWVkIHJlY29yZApsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmxldCByZWNvcmRLZXkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwoKaWYgKHRoYXQucmVjb3JkS2V5KQp7CiAgICByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleTsKfQplbHNlIGlmIChhdXRoQm90KQp7CiAgICBpZiAoYXV0aEJvdC5pZCA9PSBjb25maWdCb3QudGFncy5zdHVkaW8pCiAgICB7CiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKCiAgICAgICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHJlY29yZEtleSk7CiAgICB9Cn0KCmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgovL0FERCBhZGRpdGlvbmFsIGVycm9yIGhhbmRsaW5nPwoKcmV0dXJuIGdldFJlY29yZDsnAK/RpNAJ4eECCHJlbWVtYmVyAgQAr9Gk0Anq5wIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAr9Gk0Anh4QINbWFuaWZlc3RhdGlvbgIEAK/RpNAJkegCKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAK/RpNAJ4eECDm9uTG9va3VwQUJFZ2dzAgQAr9Gk0Am46AKYIkAvL3Nob3V0KCJvbkxvb2t1cEFCRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGxvYWRpbmcgIiArIHRoYXQuYWJJRCk7CgovL2NsZWFyIGFiLTEKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwp9CgpsZXQgcHJvZ3Jlc3NCdXR0b24gPSBhd2FpdCBsaW5rcy5pbnB1dC5hYlByb2dyZXNzQmFyKGBsb2FkaW5nICR7dGhhdC5hYklEfWApOwoKLy9jb25zdGFudHMgaW4gcmVnYXJkcyB0byB0aGUgYWIgdG8gYmUgbG9va2VkIHVwCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKY29uc3QgYXV0b0hhdGNoID0gdGhhdC5hdXRvSGF0Y2g7CgovL3JlY29yZEtleSBpcyB2YXJpYWJsZSBkZXBlbmRpbmcgb24gaWYgcHVibGljCmxldCByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleSA/PyBjb25maWdCb3QudGFncy5zdHVkaW87CmxldCBwb3NzaWJsZUF1dGggPSBhdXRoQm90ID8gYXV0aEJvdCA6IHRydWU7CmxldCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgYWJJRCk7CgovL3ZhcmlhYmxlcyBmb3IgZWdnL2FiIGhhdGNoaW5nCmxldCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCBuZXdFZ2c7CgovL3RoaXMgbG9naWMgaGFuZGxlcyB0aGUgcmV0cmlldmVkIGRhdGEsIHNlYXJjaGVzIGFnYWluIGlmIG5vbmUgY2FtZSB0aHJvdWdoCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MgJiYgcG9zc2libGVBdXRoLmlkID09IHJlY29yZEtleSAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5ICYmIGdldFJlY29yZC5lcnJvckNvZGUgIT0gIm5vdF9hdXRob3JpemVkIikKewogICAgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBhYklEKTsKfQplbHNlIGlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGlmICghcmVjb3JkS2V5KQogICAgewogICAgICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgogICAgICAgIHJlY29yZEtleSA9IGF1dGhCb3QuaWQ7CiAgICB9CgogICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHJlY29yZEtleSk7CgogICAgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIGFiSUQpOwp9CgppZiAoIWdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdChgbm8gZGF0YSBmb3VuZCBpbiAke2FiSUR9YCk7CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBpZiAocHJvZ3Jlc3NCdXR0b24pCiAgICB7CiAgICAgICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CiAgICB9CgogICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07Cn0KZWxzZQp7CiAgICAvL3BhY2thZ2UgdGhlIHJlY29yZCBkYXRhCiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyB0aGF0LmFiSUQgKyAiIGxvYWRlZCwgdmVyc2lvbiAiICsgZ2V0UmVjb3JkLmRhdGEudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIGdldFJlY29yZC5kYXRhLm1heFZlcnNpb24pOwoKLy90aGlzIGxvZ2ljIHBhcnNlcyB0aGUgZGF0YSBkZXBlbmRhbnQgb24gaG93IGl0IHdhcyBhY2Nlc3NlZC9nYWluZWQKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgaWYgKHByb2dyZXNzQnV0dG9uKQogICAgewogICAgICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwogICAgfQoKICAgIHJldHVybiByZXR1cm5EYXRhOwp9CmVsc2UgaWYgKHJldHVyblR5cGUgPT0gImRhdGEiKQp7CiAgICBsZXQgdmVyc2lvbkFycmF5ID0gSlNPTi5wYXJzZShuZXdFZ2cuZWdnVmVyc2lvbkhpc3RvcnkpOwogICAgbGV0IGZpbGVVVUlEID0gdmVyc2lvbkFycmF5W25ld0VnZy5tYXhWZXJzaW9uIC0gMV07CiAgICBsZXQgZmlsZW5hbWVoYXNoTFRNID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2hMVE0gPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2hMVE0gKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0TFRNVVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2hMVE07CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0TFRNVVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICAgICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KCiAgICByZXR1cm4gZmlsZUdldDsKfQoKLy9hYiBzcGVjaWZpYyB2YXJpYWJsZXMgZm9yIHVuZGVyc3RhbmRpbmcgaWYgYSBwb3NpdGlvbiBpcyBzcGVjaWZpZWQKbGV0IGN1cnJlbnREaW07CmxldCBzcGFjZU1vZDsKbGV0IGRpbWVuc2lvblg7CmxldCBkaW1lbnNpb25ZOwpsZXQgZGltTW9kOwoKLy9oYW5kbGUgZGltZW5zaW9uIGlkZW50aWZpY2F0aW9uCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBjb25zdCBhYkJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7CgogICAgICAgIGN1cnJlbnREaW0gPSBhYkJvdC50YWdzLmRpbWVuc2lvbjsKICAgIH0KfQplbHNlCnsKICAgIGN1cnJlbnREaW0gPSBvcy5nZXRDdXJyZW50RGltZW5zaW9uKCk7Cn0KCi8vY2hlY2tzIGZvciBncmlkIGZvY3VzCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CgogICAgY3VycmVudERpbSA9IGhhdGNoUG9pbnQuZGltZW5zaW9uOwogICAgZGltZW5zaW9uWCA9IGhhdGNoUG9pbnQucG9zaXRpb24ueDsKICAgIGRpbWVuc2lvblkgPSBoYXRjaFBvaW50LnBvc2l0aW9uLnk7CiAgICBzcGFjZU1vZCA9IHtzcGFjZTogInNoYXJlZCJ9Owp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBsb2dpYyBhcm91bmQgYXV0b0hhdGNoIHZzIG1hbnVhbCBoYXRjaGluZwppZiAoIWF1dG9IYXRjaCAmJiBjb25maWdCb3QudGFncy5wYXR0ZXJuID09IG51bGwpCnsKICAgIGRpbU1vZCA9IHtbY3VycmVudERpbV06IHRydWUsIFtjdXJyZW50RGltKyJYIl06IGRpbWVuc2lvblgsIFtjdXJyZW50RGltKyJZIl06IGRpbWVuc2lvblksIGRpbWVuc2lvbjogY3VycmVudERpbX07Cn0KZWxzZQp7CiAgICBpZiAoY29uZmlnQm90LnRhZ3Mua2V5ICYmICF0aGF0LmtleSkKICAgIHsKICAgICAgICBrZXkgPSBjb25maWdCb3QudGFncy5rZXkKICAgIH0KCiAgICBkaW1Nb2QgPSB7YXV0b0hhdGNoOiB0cnVlLCBrZXk6IGtleX07Cn0KCi8vY2FsbCBmb3Igb3ZvIHdpdGggaW5mb3JtYXRpb24gcHJvdmlkZWQKYXdhaXQgdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgc3R1ZGlvOiByZWNvcmRLZXksIGRpbU1vZDogZGltTW9kLCBzcGFjZU1vZDogc3BhY2VNb2QsIGVnZ0RhdGE6IG5ld0VnZywgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290LCBlZ2dQYXJhbWV0ZXJzOiB0aGF0LmVnZ1BhcmFtZXRlcnN9KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiB7c3VjY2VzczogdHJ1ZX07JwCv0aTQCeHhAgttYW5pZmVzdE92bwIEAK/RpNAJ0YoDmAxALy9lZ2cgdmlzdWFsaXphdGlvbgpzaG91dCgiYWJNZW51UmVzZXQiKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dQYXJhbWV0ZXJzID0gdGhhdC5lZ2dQYXJhbWV0ZXJzOwpsZXQgZWdnTW9kID0ge307CgplZ2dNb2Quc3BhY2UgPSAidGVtcExvY2FsIjsKZWdnTW9kLmluaXRpYWxUaW1lciA9IHRydWU7CmVnZ01vZC5hYklEID0gdGhhdC5hYklEOwplZ2dNb2Quc3R1ZGlvID0gdGhhdC5zdHVkaW87CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5lZ2dQYXJhbWV0ZXJzID0gZWdnUGFyYW1ldGVyczsKZWdnTW9kLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNb2Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIuaW50ZXJhY3RPdm8oKTtgOwplZ2dNb2Qub25DcmVhdGUgPSBgYDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBhd2FpdCBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCmlmIChvdm8udGFncy5hdXRvSGF0Y2gpCnsKICAgIGF3YWl0IHRoaXNCb3QuaGF0Y2hPdm8ob3ZvKTsKfQplbHNlCnsKICAgIG92by50YWdzLnByb2dyZXNzQmFyID0gMDsgCiAgICAKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPSBvdm8udGFncy5tYXhWZXJzaW9uOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIob3ZvLCAiZWdnVGltZXIiKTt9LCA3NSk7Cn0KCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsKCnJldHVybjsnAK/RpNAJ4eECCW9uS2V5RG93bgIEAK/RpNAJ5pYD5gVALy9oaWRkZW4gdmVyc2lvbiBidXR0b24gZm9yIGhhdGNoIG1lbnUKaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAiYWJPdm9NZW51IikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5hYk92b01lbnUgPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHZlcnNpb25CdXR0b24pOwp9JwCv0aTQCeHhAghoYXRjaE92bwIEAK/RpNAJy5wDjRRALy9sb2dpYyBmb3IgaGF0Y2hpbmcgb2YgYW4gYWIKc2hvdXQoJ292b01lbnVSZXNldCcpOwoKLy9kYXRhIGluIHJlZ2FyZHMgdG8gd2hhdCBhYiBpcyBnb2luZyB0byBiZSBoYXRjaGVkCmNvbnN0IG92byA9IHRoYXQ7CgovL2hhdGNoIHNwZWNpZmljIHZhcmlhYmxlcwpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBvdm8udGFncy5zdGFibGVWZXJzaW9uID8/IG92by50YWdzLnRhcmdldFZlcnNpb247CgppZiAoKGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiB8fCBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbikgJiYgKG92by50YWdzLmFiSUQgPT0gY29uZmlnQm90LnRhZ3MucGF0dGVybiB8fCBvdm8udGFncy5hYklEID09IGNvbmZpZ0JvdC50YWdzLmFiKSkKewogICAgdGFyZ2V0VmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiA/PyBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbjsKfQoKLy90YXJnZXRlZCB2ZXJzaW9ucwppZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbiAmJiAob3ZvLnRhZ3MuYWJJRCA9PSBjb25maWdCb3QudGFncy5wYXR0ZXJuIHx8IG92by50YWdzLmFiSUQgPT0gY29uZmlnQm90LnRhZ3MuYWIgfHwgIWlzTmFOKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24pKSkKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPT0gImZlZWRiYWNrIikKICAgIHsKICAgICAgICB0YXJnZXRWZXJzaW9uID0gb3ZvLnRhZ3MuZmVlZGJhY2tWZXJzaW9uOwogICAgfQogICAgZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbiA9PSAiY3VycmVudCIpCiAgICB7CiAgICAgICAgdGFyZ2V0VmVyc2lvbiA9IG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKICAgIH0KICAgIGVsc2UgaWYgKCFpc05hTihjb25maWdCb3QudGFncy52ZXJzaW9uKSkKICAgIHsKICAgICAgICB0YXJnZXRWZXJzaW9uID0gY29uZmlnQm90LnRhZ3MudmVyc2lvbgogICAgfQoKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPSBudWxsOwp9CgppZiAoaXNOYU4odGFyZ2V0VmVyc2lvbikpCnsKICAgIHRhcmdldFZlcnNpb24gPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7Cn0KCmxldCB2ZXJzaW9uQXJyYXkgPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeTsKbGV0IGZpbGVVUkwgPSB2ZXJzaW9uQXJyYXlbdGFyZ2V0VmVyc2lvbiAtIDFdOwpsZXQga2V5ID0gb3ZvLnRhZ3Mua2V5ID8gb3ZvLnRhZ3Mua2V5IDogY29uZmlnQm90LnRhZ3Mua2V5OwpsZXQgZmlsZUdldDsKCi8vYWN0dWFsIGZpbGUgcmV0cmlldmFsCnRyeQp7CiAgICBmaWxlR2V0ID0gYXdhaXQgb3MuZ2V0RmlsZShmaWxlVVJMKTsKfQpjYXRjaCAoZXJyb3IpCnsKICAgIGNvbnNvbGUubG9nKGVycm9yKTsKCiAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgIHJldHVybjsKfQoKLy9oYW5kbGluZyBmb3IgZW5jcnlwdGVkIGFiIGZpbGUKaWYgKGNyeXB0by5pc0VuY3J5cHRlZChmaWxlR2V0KSkKewogICAgaWYgKCFrZXkpCiAgICB7CiAgICAgICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCcnLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ0VudGVyIGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICB0cnkKICAgIHsKICAgICAgICBmaWxlR2V0ID0gY3J5cHRvLmRlY3J5cHQoa2V5LCBmaWxlR2V0KTsKICAgIH0KICAgIGNhdGNoIChlcnJvcikKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKCiAgICAgICAgb3MudG9hc3QoImtleSBkb2VzIG5vdCBtYXRjaCBmaWxlIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgCiAgICBmaWxlR2V0ID0gSlNPTi5wYXJzZShmaWxlR2V0KTsKCiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQplbHNlCnsKICAgIGZpbGVHZXQgPSBmaWxlR2V0LnN0YXRlOwp9CgovL2NsZWFuIHVwCmRlc3Ryb3kob3ZvKTsKCi8vdG9hc3QgaWYgbm90IG9uIHN0YWJsZQppZihvdm8udGFncy5zdGFibGVWZXJzaW9uICE9IHRhcmdldFZlcnNpb24pCnsKICAgIGlmIChvdm8udGFncy5mZWVkYmFja1ZlcnNpb24gPT0gdGFyZ2V0VmVyc2lvbikKICAgIHsKICAgICAgICBvcy50b2FzdCgibG9hZGluZyBmZWVkYmFjayB2ZXJzaW9uIG9mICIgKyBvdm8udGFncy5hYklEKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibG9hZGluZyB2ZXJzaW9uICIgKyB0YXJnZXRWZXJzaW9uICsgIiBvZiAiICsgb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoICsgIiBvZiAiICsgb3ZvLnRhZ3MuYWJJRCk7CiAgICB9Cn0KCi8vZ2VuZXJhdGUgYm90cyBiYXNlZCBvbiB0aGUgZmlsZSByZXRyaWV2ZWQgKkhFUkUqCmF3YWl0IGxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGZpbGVHZXQsIG9yaWdpbjogb3ZvLnRhZ3MuYWJJRCwgc3R1ZGlvOiBvdm8udGFncy5zdHVkaW8sIHZlcnNpb246IHRhcmdldFZlcnNpb24sIGluaXRpYWxCb290OiBpbml0aWFsQm9vdCwgZWdnUGFyYW1ldGVyczogb3ZvLnRhZ3MuZWdnUGFyYW1ldGVyc30pOwoKcmV0dXJuOycAr9Gk0Anh4QILaW50ZXJhY3RPdm8CBACv0aTQCdmwA5oHQC8vbWFudWFsIGhhdGNoIG1lbnUKY29uc3Qgb3ZvQm90ID0gdGhhdCA/IHRoYXQgOiBsaW5rcy5vdm9Cb3Q7CgppZiAoIW92b0JvdCkKewogICAgcmV0dXJuOwp9CgpzaG91dCgib3ZvTWVudVJlc2V0Iik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk92b01lbnUiOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgib3ZvTWVudVJlc2V0Iik7YDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gYEAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwptYXNrcy5vdm9NZW51UmVzZXQgPSBudWxsOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwpgOwoKbGV0IGVnZ01lbnVCdXR0b24gPSB7fTsKCm9zLnR3ZWVuVG8ob3ZvQm90LCAxNSw0NSw0NSwgNSk7CgplZ2dNZW51QnV0dG9uLmFiT3ZvTWVudSA9IHRydWU7CmVnZ01lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmVnZ01lbnVCdXR0b24ub3ZvQm90ID0gIvCflJciICsgb3ZvQm90LmlkOwplZ2dNZW51QnV0dG9uLnRhcmdldFZlcnNpb24gPSBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsID0gImhhdGNoICIgKyBvdm9Cb3QudGFncy5hYklEICsgIiB2IiArIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CmVnZ01lbnVCdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwplZ2dNZW51QnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwplZ2dNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKGxpbmtzLm92b0JvdCk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGVnZ01lbnVCdXR0b24pOycAr9Gk0Anh4QIGY3JlYXRlAgQAr9Gk0AnwtwMo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAr9Gk0Anh4QIQY2hhbmdlT3ZvVmVyc2lvbgIEAK/RpNAJl7gD8AJALy9sb2dpYyBmb3IgdmVyc2lvbiBjaGFuZ2luZyB3aGVuIG1hbnVhbGx5IGhhdGNoaW5nIGFuIGFiCmNvbnN0IG92b0JvdCA9IGxpbmtzLm92b0JvdDsKCmxldCBuZXdWZXJzaW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24sIHsKICAgIHBsYWNlaG9sZGVyOiAiZW50ZXIgYSB2ZXJzaW9uIGZyb20gMSB0byAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbgp9KTsKCm92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gPSBuZXdWZXJzaW9uOwpvdm9Cb3QudGFncy5sYWJlbCA9ICd2JysgbmV3VmVyc2lvbjsKCmNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPSBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycAr9Gk0Anh4QIEbWVudQIEAK/RpNAJiLsDKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAK/RpNAJ4eECCGFiSWdub3JlAgQAr9Gk0AmvuwMEdHJ1ZSgAr9Gk0Anh4QIMYWJCb3RWZXJzaW9uAX2OAycAr9Gk0Anh4QIHYWJTaGVsbAIEAK/RpNAJtbsDBHRydWUnAK/RpNAJ4eECDGFiMUxUTVNlYXJjaAIEAK/RpNAJursDM0AvL3N1cHBvcnQgb2xkIHN5bnRheAp0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOycAr9Gk0Anh4QINb25Mb29rdXBBc2tJRAIEAK/RpNAJ7rsD0AVAbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgbG9va2luZyB1cCAke3RoYXQuYXNrSUR9YCk7Cgpjb25zdCBhc2tJRCA9ICJhc2tfIiArIHRoYXQuYXNrSUQ7CmNvbnN0IGVuZHBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwpsZXQgbG9va3VwQXNrOyAKCnRyeQp7CiAgICBsb29rdXBBc2sgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFza0lELCBlbmRwb2ludCk7Cn0KY2F0Y2gKewogICAgbG9va3VwQXNrID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCB0aGF0LmFza0lELCBlbmRwb2ludCk7Cn0KCmlmIChsb29rdXBBc2suc3VjY2VzcyAmJiBsb29rdXBBc2suZGF0YS5wYXR0ZXJuSUQpCnsKICAgIHRoaXNCb3Qub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGxvb2t1cEFzay5kYXRhLnBhdHRlcm5JRCwgcmVjb3JkS2V5OiBsb29rdXBBc2suZGF0YS5zdHVkaW9JRCwgYXV0b0hhdGNoOiB0cnVlfSk7ICAKfQplbHNlIGlmIChsb29rdXBBc2suc3VjY2VzcyAmJiAhbG9va3VwQXNrLmRhdGEudXJsKQp7CiAgICBsb29rdXBBc2suc3VjY2VzcyA9ICFsb29rdXBBc2suc3VjY2VzczsKfQoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIGxvb2t1cEFzazsnAK/RpNAJ4eECBWlucHV0AgQAr9Gk0Am/wQMo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAr9Gk0Anh4QIFaGF0Y2gCBACv0aTQCebBA8ABQC8vc2hvdXQoImhhdGNoIiwge2FiSUQ6IGFiSUQsIHJlY29yZEtleTogc3R1ZGlvLCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGwsIGVnZ1BhcmFtZXRlcnM6IGFyZ30pOwoKY29uc3QgbG9va1VwID0gYXdhaXQgdGhpc0JvdC5vbkxvb2t1cEFCRWdncyh0aGF0KTsKCnJldHVybiBsb29rVXA7JwEEYm90cyRmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjABJwCv0aTQCafDAwZzeXN0ZW0CBACv0aTQCajDAw5hYi5zaGVsbC5pbnB1dCcAr9Gk0AmnwwMEZm9ybQIEAK/RpNAJt8MDB25vdGhpbmcnAK/RpNAJp8MDCW9uS2V5RG93bgIEAK/RpNAJv8MDbUAvL2FsbG93IHB1bGxpbmcgdXAgY2hhdCBpbiBidWlsZGVyIHZlcnNpb24KaWYgKHRoYXQua2V5cyA9PSAiYCIgJiYgYnVpbGRlclZlcnNpb24pCnsKICAgIG9zLnNob3dDaGF0KCI+Iik7Cn0nAK/RpNAJp8MDBm9uQ2hhdAIEAK/RpNAJrcQD7xpALy9ub3Qgc3VwcG9ydGVkIG91dHNpZGUgb2YgYnVpbGRlciB2ZXJzaW9uCmlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKLy90aGlzIGxvb3AgaWRlbnRpZmllcyBwb3NzaWJsZSBhYiBzcGVjaWZpYyBtZXNzYWdlcywgYW5kIGNhbGxzIGEgc2V0IGxpc3Qgb2YgY29tbWFuZHMKaWYgKHRoYXQubWVzc2FnZVswXSA9PSAiLiIpIAp7CiAgICBvcy5oaWRlQ2hhdCgpOwoKICAgIHN3aXRjaCAodGhhdC5tZXNzYWdlKQogICAgewogICAgICAgIGNhc2UgJy5kb3dubG9hZEFCJzoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYkNvbmZpZyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChncm91cCA9PSAiYWJDb3JlIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MubGVhcm4udGFncy5hYkluc3QgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBhYkdyb3VwID0gZ2V0Qm90cyhncm91cCk7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFiR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiR3JvdXBbaV0udGFncy5hYkJvdFZlcnNpb24rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuZG93bmxvYWRCb3RzQXNJbml0aWFsemF0aW9uVXBkYXRlKGFiR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoc2tpbGwpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc3lzdGVtYDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIWNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgOiBjb25maWdCb3QudGFncy5tYXBQb3J0YWw7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAubWVudVNoZWV0YDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmRvd25sb2FkYDoKICAgICAgICAgICAgb3MuZG93bmxvYWRCb3RzKGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSksIG9zLmdldEN1cnJlbnRJbnN0KCkpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnVwbG9hZGA6CiAgICAgICAgICAgIG9zLnNob3dVcGxvYWRBdXhGaWxlKCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2xlZXBgOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC4uYDoKICAgICAgICBjYXNlIGAud2FrZWA6CgogICAgICAgICAgICBsZXQgc2tpbGxBcnJheSA9IFsiYWJJbnRlcmZhY2UiLCAiYWJBY3Rpb24iLCAiYWJUZXN0cyJdOwoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBza2lsbEFycmF5Lmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgzMDApOwoKICAgICAgICAgICAgLy9rZWVwIGFiIGF3YWtlCiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IHV1aWQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkF3YWtlIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwogICAgICAgICAgICAKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmxvZyc6CiAgICAgICAgICAgIHNob3V0KCJ0b2dnbGVDb25zb2xlIikKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CiAgICAgICAgICAgIGxldCBleGVjdXRhYmxlID0gbWVzc2FnZS5zbGljZSgxKTsKCiAgICAgICAgICAgIGlmIChtZXNzYWdlLmluZGV4T2YoIi5hc2siKSA9PSAtMSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgb3MucnVuKGV4ZWN1dGFibGUpOyAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChsaW5rcy5hc2spCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKG1lc3NhZ2Uuc3Vic3RyaW5nKDQpKTsKICAgICAgICAgICAgfQogICAgfQp9JwCv0aTQCafDAwtkZXNjcmlwdGlvbgIEAK/RpNAJnd8DQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicAr9Gk0AmnwwMMb25GaWxlVXBsb2FkAgQAr9Gk0Ang3wPXGEAvL2ZpbHRlciBvdXQgdGltZXMgd2hlbiBmaWxlIGxvYWRpbmcgaXMgbm90IGFsbG93ZWQKaWYgKCFidWlsZGVyVmVyc2lvbiB8fCBsaW5rcy5yZW1lbWJlci50YWdzLmFiTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMgIT09IHRydWUpCnsKICAgIHJldHVybjsKfQoKLy92YXJpb3VzIGZpbGUgc3BlY2lmaWMgdmFyaWFibGVzCmxldCBmaWxlRXh0ZW5zaW9uID0gdGhhdC5maWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKS50b0xvd2VyQ2FzZSgpOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnNoaWZ0KCk7CmxldCBzaXplID0gdGhhdC5maWxlLnNpemU7CmxldCBtaW1lVHlwZTsKbGV0IGJvdEluZm8gPSB7fTsKCi8vaGFyZCBsaW1pdCBiYXNlZCBvbiBmaWxlIHNpemUKaWYgKHNpemUgPiAyMDAwMDAwMDApCnsKICBvcy50b2FzdCgibWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQgKDIwMCBtYikiKTsKCiAgcmV0dXJuOwp9CgovL3RoaXMgc3dpdGNoIGhhbmRsZXMgcG9zc2libGUgZmlsZXMgZXh0ZW5zaW9ucywgd2hpbGUgcmVqZWN0aW5nIGFueSBpdCBkb2VzIG5vdCByZWNvZ25pemUKc3dpdGNoKGZpbGVFeHRlbnNpb24pCnsKICBjYXNlICdqcGcnOgogIGNhc2UgJ2pwZWcnOgogIGNhc2UgJ3dlYnAnOgogIGNhc2UgJ2dpZic6CiAgY2FzZSAncG5nJzoKICAgIG1pbWVUeXBlID0gImltYWdlLyIgKyBmaWxlRXh0ZW5zaW9uOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdzdmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ2dsYic6CiAgY2FzZSAnZXhyJzoKICBjYXNlICdnbHRmJzoKICAgIG1pbWVUeXBlID0gInRleHQveG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJtZXNoIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAiZ2x0ZiI7CiAgICBicmVhazsKICBjYXNlICdhdXgnOgogIGNhc2UgJ3BkZic6CiAgICBsZXQgYm90RGF0YSA9IGZpbGVFeHRlbnNpb24gPT0gIi5hdXgiID8gSlNPTi5wYXJzZSh0aGF0LmZpbGUuZGF0YSkuc3RhdGUgOiBvcy5wYXJzZUJvdHNGcm9tRGF0YSh0aGF0LmZpbGUuZGF0YSk7CgogICAgbGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7Ym90czogYm90RGF0YSwgb3JpZ2luOiBmaWxlTmFtZX0pOwoKICAgIHJldHVybjsKLy8gICBjYXNlICdwZGYnOgovLyAgICAgYnJlYWs7CiAgY2FzZSAnbXAzJzoKICAgIG1pbWVUeXBlID0gJ2F1ZGlvL21wZWcnOwogICAgYm90SW5mby5vbkNsaWNrID0gIkAgb3MucGxheVNvdW5kKHRhZ3MuZm9ybUFkZHJlc3MpOyI7CiAgICBib3RJbmZvLmxhYmVsID0gIkNsaWNrIHRvIFBsYXkiOwogICAgYnJlYWs7CiAgY2FzZSAnbXA0JzoKICAgIG1pbWVUeXBlID0gJ3ZpZGVvL21wNCc7CiAgICBib3RJbmZvLmZvcm0gPSAiaWZyYW1lIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAic3JjIjsKICAgIGJyZWFrOwogIGNhc2UgJ290Zic6CiAgICBtaW1lVHlwZSA9ICdmb250L290Zic7CiAgICBib3RJbmZvLmxhYmVsID0gImV4YW1wbGUiOwogICAgYnJlYWs7CiAgY2FzZSAnd29mZic6CiAgICBtaW1lVHlwZSA9ICdmb250L3dvZmYnOwogICAgYm90SW5mby5sYWJlbCA9ICJleGFtcGxlIjsKICAgIGJyZWFrOwogIGRlZmF1bHQ6CiAgICBsZXQgcmVzdWx0ID0gbmV3IEVycm9yKCJ1bmhhbmRsZWQgZmlsZSB0eXBlOiAiICsgZmlsZUV4dGVuc2lvbik7CiAgICBvcy50b2FzdCgiZmlsZSB0eXBlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIGNvbnNvbGUud2FybihyZXN1bHQpCiAgICByZXR1cm4gcmVzdWx0Owp9CgovL3RoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFuZCBvYmplY3RzIHNldCB1cCBhIGxvYWRpbmcgYmFyIGJ1dHRvbgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHVwbG9hZFJlc3VsdDsKbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgdGhpc0JvdC5hYlByb2dyZXNzQmFyKGB1cGxvYWRpbmdgKTsKCmNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gY29uZmlnQm90LnRhZ3Muc3R1ZGlvSUQgPz8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvOwoKaWYgKCFjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCkKewogIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgogIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gYXV0aEJvdC5pZDsKfQoKLy90aGlzIGlzIHRoZSBhY3R1YWwgdXBsb2FkIGZ1bmN0aW9uYWxpdHkKdXBsb2FkUmVzdWx0ID0gYXdhaXQgbGlua3Muc3RvcmUuYWJQdWJsaXNoRmlsZSh7ZmlsZTogdGhhdC5maWxlLmRhdGEsIGZpbGVOYW1lOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSk7CgovL2lmIHRoZSBmaWxlIHNob3VsZCBiZSBpbmNsdWRlZCBhcyBhIGJvdCB3aXRoIGEgbGluaywgdGhpcyBsb2dpYyBoYW5kbGVzIHRoYXQKCmlmIChtaW1lVHlwZS5pbmNsdWRlcygiZm9udCIpKQp7CiAgICBib3RJbmZvW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWxdID0gdHJ1ZTsKICAgIGJvdEluZm8ubGFiZWxGb250QWRkcmVzcyA9IHVwbG9hZFJlc3VsdC51cmwgPyB1cGxvYWRSZXN1bHQudXJsIDogdXBsb2FkUmVzdWx0LmV4aXN0aW5nRmlsZVVybDsKCiAgICBjcmVhdGUoYm90SW5mbyk7Cn0KZWxzZSBpZiAoT2JqZWN0LmtleXMoYm90SW5mbykubGVuZ3RoID4gMCkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmZvcm1BZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQoKY29uc3QgY2xpcFVSTCA9IHVwbG9hZFJlc3VsdC51cmwgPz8gdXBsb2FkUmVzdWx0LmV4aXN0aW5nRmlsZVVybDsKCm9zLnNldENsaXBib2FyZChjbGlwVVJMKTsKCm9zLnRvYXN0KCJmaWxlIHVybCBhZGRlZCBzZXQgdG8gY2xpcGJvYXJkIik7CgovL2NsZWFyIHRoZSBwcm9ncmVzcyBiYXIgYnV0dG9uCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9CgpyZXR1cm4gdXBsb2FkUmVzdWx0OycAr9Gk0AmnwwMFbGVhcm4CBACv0aTQCbj4Ayjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCv0aTQCafDAwhyZW1lbWJlcgIEAK/RpNAJ3/gDKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAK/RpNAJp8MDDW1hbmlmZXN0YXRpb24CBACv0aTQCYb5Ayjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCv0aTQCafDAwhhYklnbm9yZQIEAK/RpNAJrfkDBHRydWUoAK/RpNAJp8MDDGFiQm90VmVyc2lvbgF9jgMnAK/RpNAJp8MDBmNyZWF0ZQIEAK/RpNAJs/kDKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAK/RpNAJp8MDBXN0b3JlAgQAr9Gk0Ana+QMo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAr9Gk0AmnwwMEbWVudQIEAK/RpNAJgfoDKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAK/RpNAJp8MDB2FiU2hlbGwCBACv0aTQCaj6AwR0cnVlJwCv0aTQCafDAw1hYlByb2dyZXNzQmFyAgQAr9Gk0Amt+gPfCEBpZiAoIWNvbmZpZ0JvdC50YWdzLmFiU2lsZW50TW9kZSkKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKfQoKbGV0IGxvYWRMYWJlbCA9IHRoYXQgPz8gInVwZGF0aW5nIjsKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwptZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSB7ICJib3JkZXItcmFkaXVzIjoiOHB4IiwgIm1hcmdpbi10b3AiOiIzcHgifTsKbWVudUJ1dHRvbi50cmFja051bSA9IC0xOwptZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7Cm1lbnVCdXR0b24ubGFiZWwwID0gbG9hZExhYmVsICsgIi4iOwptZW51QnV0dG9uLmxhYmVsMSA9IGxvYWRMYWJlbCArICIuLiI7Cm1lbnVCdXR0b24ubGFiZWwyID0gbG9hZExhYmVsICsgIi4uLiI7Cm1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7Cm1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwptZW51QnV0dG9uLmxhYmVsQ29sb3IgPSAiYmxhY2siOwptZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7Cm1lbnVCdXR0b24uYWJQcm9ncmVzc1Jlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKbWVudUJ1dHRvbiA9IGNyZWF0ZShtZW51QnV0dG9uKTsKCnJldHVybiBtZW51QnV0dG9uOycAr9Gk0AmnwwMJb25UYXBDb2RlAgQAr9Gk0AmNgwSiAkBjb25zdCB0YXBDb2RlID0gdGhhdDsKCnN3aXRjaCAodGFwQ29kZSkKewogICAgY2FzZSAiMzM0MiI6CiAgICAgICAgb3MudG9hc3QoIndha2luZyAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSk7CgogICAgICAgIHRoaXNCb3Qub25DaGF0KHttZXNzYWdlOiAiLi4ifSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICI0MjQyIjoKICAgICAgICBvcy5zaG93Q2hhdCgiPiIpOwogICAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgICAvL2NvbnNvbGUubG9nKHRhcENvZGUpOwp9JwCv0aTQCafDAwNhc2sCBACv0aTQCbCFBCjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3AA=="}]}