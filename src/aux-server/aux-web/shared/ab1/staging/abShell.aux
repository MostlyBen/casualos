{"version":2,"updates":[{"id":0,"timestamp":1702587929089,"update":"AagBs8GpoAcAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwCzwamgBwAGc3lzdGVtAgQAs8GpoAcBEWFiLnNoZWxsLnJlZ3VsYXRlJwCzwamgBwAEZm9ybQIEALPBqaAHEwdub3RoaW5nJwCzwamgBwAMb25BbnlCb3REcmFnAgQAs8GpoAcbuwFALy9jb250cm9scyBncmlkIHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZ3JpZCIpOwp9CgovL2NvbnRyb2xzIGJvdCBzbmFwCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZmFjZSIpOwp9JwCzwamgBwAIcmVtZW1iZXICBACzwamgB9cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnALPBqaAHAAhhYklnbm9yZQIEALPBqaAH/gEEdHJ1ZSgAs8GpoAcADGFiQm90VmVyc2lvbgF9hgInALPBqaAHAAdhYlNoZWxsAgQAs8GpoAeEAgR0cnVlJwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwCzwamgB4kCBnN5c3RlbQIEALPBqaAHigIPYWIuc2hlbGwuY3JlYXRlJwCzwamgB4kCBGZvcm0CBACzwamgB5oCB25vdGhpbmcnALPBqaAHiQILZGVzY3JpcHRpb24CBACzwamgB6ICPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nALPBqaAHiQIMYWJDcmVhdGVCb3RzAgQAs8GpoAfgAoAaQC8vREVWIE5PVEU6IE5FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCgovL2NoZWNrcyBmb3IgaW5pdGlhbCBib290IGJvb2xlYW4KbGV0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKLy9ib3RzIHRvIGJlIGdlbmVyYXRlZApsZXQgYm90RGF0YSA9IHRoYXQuYm90czsKLy93aGVyZSBkaWQgdGhlIGRhdGEgY29tZSBmcm9tIChvcHRpb25hbCkKbGV0IG9yaWdpbiA9IHRoYXQub3JpZ2luOwovL3ZlcnNpb24gb2YgdGhlIGRhdGEgKG9wdGlvbmFsKQpsZXQgdmVyc2lvbiA9IHRoYXQudmVyc2lvbjsKLy9pZE1hcCBhbmQgbmV3Qm90cyBhcmUgdXNlZCB0byBtYW5hZ2UgdGhlIGluY29taW5nIGJvdCBkYXRhCmxldCBpZE1hcCA9IG5ldyBNYXAoKTsKbGV0IG5ld0JvdHMgPSBbXTsKCi8vdGhpcyBsb29wIGNyZWF0ZXMgdGhlIG5ldyBib3RzIGFuZCB0aGVuIHBhY2thZ2VzIHRoZW0gZm9yIGFkZGl0aW9uYWwgcHJvY2Vzc2luZywgd2hpbGUgYWRkaW5nIGFueSBuZWVkZWQgYWRkaXRpb25hbCB0YWdzCmZvciAoY29uc3QgcHJvcGVydHkgaW4gYm90RGF0YSkKewogICAgY29uc3QgbmV3Qm90ID0gYm90RGF0YVtwcm9wZXJ0eV07CiAgICBjb25zdCBib3RUb3RhbCA9IE9iamVjdC5rZXlzKGJvdERhdGEpLmxlbmd0aDsKICAgIGNvbnN0IGFiSURPcmlnaW4gPSB7YWJJRE9yaWdpbjogb3JpZ2lufTsKICAgIGNvbnN0IGFiR3JpZEZvY3VzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWJHcmlkRm9jdXMpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0RGltZW5zaW9uID0gYWJHcmlkRm9jdXMuZGltZW5zaW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YXJnZXRQb3NpdGlvbiA9IHsgW3RhcmdldERpbWVuc2lvbl06IHRydWUsIFt0YXJnZXREaW1lbnNpb24gKyAiWCJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWJHcmlkRm9jdXMucG9zaXRpb24ueSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgYiA9IGNyZWF0ZShuZXdCb3QudGFncywgdGFyZ2V0UG9zaXRpb24sIGFiSURPcmlnaW4pOwoKICAgICAgICAgICAgaWRNYXAuc2V0KHByb3BlcnR5LCBiLmlkKTsKICAgICAgICAgICAgbmV3Qm90cy5wdXNoKGIpOwoKICAgICAgICAgICAgaWYgKGIudGFncy5jcmVhdG9yID09IHRoaXNCb3QuaWQpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBiLnRhZ3MuY3JlYXRvciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnZhbGlkIGJvdCIsIGVycm9yKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKCJza2lwcGVkIGJvdDogIiArIG5ld0JvdCk7CiAgICB9Cn0KCi8vYXJyYXkgb2YgdGFnIHJlbGF0aW9uc2hpcHMgdG8gYmUgcHJlc2VydmVkCmxldCBsaW5rVGFncyA9IFsibGluayIsICJjcmVhdG9yIiwgImNvbmZpZ0JvdCIsICJsaW5lVG8iLCAidHJhbnNmb3JtZXIiXTsKCi8vdGhpcyBsb29wIGNvbnRhaW5zIHRoZSBsb2dpYyBmb3IgcHJlc2VydmluZyB0aGUgbGlua1RhZ3MKZm9yIChsZXQgbmV3Qm90IG9mIG5ld0JvdHMpIAp7CiAgICBmb3IgKGxldCB0YWcgb2YgbGlua1RhZ3MpIAogICAgewogICAgICAgIGxldCB2YWx1ZSA9IG5ld0JvdC50YWdzW3RhZ107CgogICAgICAgIGlmICh0YWcgPT0gImNyZWF0b3IiKSAKICAgICAgICB7CiAgICAgICAgICAgIHZhbHVlID0gbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvcjsKICAgICAgICAgICAgbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVCb3RMaW5rcyhuZXdCb3QsIGlkTWFwKTsKCiAgICAgICAgaWYgKHZhbHVlKSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlLm1hcChpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkTWFwLmdldChpZCkgfHwgaWQ7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0lEID0gaWRNYXAuZ2V0KHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZiAobmV3SUQpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld0lEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgovL3RvYXN0cyBmb3IgaGF0Y2hlcywgYnV0IG9ubHkgb24gYnVpbGRlcgppZiAoY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCi8vYWRkaXRpb25hbCBoYXRjaCBkYXRhCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKLy9pbml0aWFsIGJvb3QgbG9naWMKaWYgKGluaXRpYWxCb290KSAKewogICAgbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgaWYgKCFwcmVoYXRjaCkgCiAgICB7CiAgICAgICAgYWJJbnN0TWVtb3J5LnRhZ3MuYmFzZUFCID0gb3JpZ2luOwogICAgfQogICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBvcmlnaW47Cn0KCi8vb25FZ2dIYXRjaCBmb3IgYWxsIGp1c3QgaGF0Y2hlZCBib3RzCndoaXNwZXIobmV3Qm90cywgIm9uRWdnSGF0Y2giLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKLy9vbkFiQWRkZWQgZm9yIGFsbCBib3RzIGluIHRoZSBleHBlcmllbmNlCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycAs8GpoAeJAghyZW1lbWJlcgIEALPBqaAH4Rwo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAs8GpoAeJAglvbkFiQWRkZWQCBACzwamgB4gdckAvL3Nob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKY29uc29sZS5sb2coImFiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycAs8GpoAeJAghhYklnbm9yZQIEALPBqaAH+x0EdHJ1ZSgAs8GpoAeJAgxhYkJvdFZlcnNpb24BfYYCJwCzwamgB4kCB2FiU2hlbGwCBACzwamgB4EeBHRydWUnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnALPBqaAHhh4Gc3lzdGVtAgQAs8GpoAeHHg5hYi5zaGVsbC5zdG9yZScAs8GpoAeGHgRmb3JtAgQAs8GpoAeWHgdub3RoaW5nJwCzwamgB4YeC2Rlc2NyaXB0aW9uAgQAs8GpoAeeHj9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nALPBqaAHhh4PYWJQdWJsaXNoUmVjb3JkAgQAs8GpoAfeHsEGQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgpsZXQgcHVibGljID0gdGhhdC5wdWJsaWM7CmxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IGVuZHBvaW50ID0gdGhhdC5lbmRwb2ludCA/IHRoYXQuZW5kcG9pbnQgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CmxldCB1c2VyUmVjb3JkID0gYXV0aEJvdC5pZDsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKaWYgKHB1YmxpYykKewogICAgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEodXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwge2VuZHBvaW50OiBlbmRwb2ludCwgbWFya2VyczogWyJwdWJsaWNSZWFkIl19KTsKfQplbHNlCnsKICAgIGxldCBwZXJtaXNzaW9uID0gewogICAgICAgIHR5cGU6ICdkYXRhLnJlYWQnLAogICAgICAgIHJvbGU6IHJlY29yZE5hbWUsCiAgICAgICAgYWRkcmVzc2VzOiB0cnVlCiAgICB9OwoKICAgIGF3YWl0IG9zLmdyYW50UmVjb3JkTWFya2VyUGVybWlzc2lvbih1c2VyUmVjb3JkLCByZWNvcmROYW1lLCBwZXJtaXNzaW9uKTsKCiAgICBhd2FpdCBvcy5ncmFudFJlY29yZE1hcmtlclBlcm1pc3Npb24odXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcGVybWlzc2lvbik7CiAgICAKICAgIHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHVzZXJSZWNvcmQsIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIHtlbmRwb2ludDogZW5kcG9pbnQsIG1hcmtlcnM6IFtyZWNvcmROYW1lXX0pOwp9CgpyZXR1cm4gcmVjb3JkRGF0YTsnALPBqaAHhh4NYWJQdWJsaXNoRmlsZQIEALPBqaAHoCWwBEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCB1c2VyUmVjb3JkID0gYXV0aEJvdC5pZDsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CiAgICAKaWYgKCFmaWxlVXBsb2FkLnN1Y2Nlc3MpIAp7CiAgICBhd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24odXNlclJlY29yZCk7CgogICAgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUodXNlclJlY29yZCwgZmlsZSwge2Rlc2NyaXB0aW9uOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKfQoKcmV0dXJuIGZpbGVVcGxvYWQ7JwCzwamgB4YeEGFiQ29yZU1lbnVBY3Rpb24CBACzwamgB9Ep0gFAaWYgKCFhdXRoQm90KQp7CiAgICB0aGlzQm90LmFiRG93bmxvYWQoKTsKICAgIAogICAgcmV0dXJuOwp9CmVsc2UgaWYgKCFhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhKQp7CiAgICB0aGlzQm90LmFiRG93bmxvYWQoKTsKICAgIAogICAgcmV0dXJuOwp9CgovL3NldCB1cCB0aGUgcHVibGlzaCBtZW51CnRoaXNCb3Qub25TdG9yZU1lbnUoKTsnALPBqaAHhh4Lb25TdG9yZU1lbnUCBACzwamgB6Qr00JAbGV0IHBvc3NpYmxlUHVibGlzaEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxpbmtzLm1lbnUubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKY29uc3QgdXVhYiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudXVhYiA/IHRydWUgOiBmYWxzZTsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gImRvd25sb2FkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJnZXRfYXBwIjsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYkRvd25sb2FkKCk7YDsKCi8vY3JlYXRlIGRvd25sb2FkIGJ1dHRvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmlmICghdXVhYikKewogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIHBhdHRlcm4iOyAKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgbWVudUJ1dHRvbi5wb2ludGFibGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IG51bGw7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDAuNzU7CiAgICAKICAgIC8vY3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCiAgICBtZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImVuY3J5cHQiOwogICAgbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgIG1lbnVCdXR0b24uZW5jcnlwdFN0YXRlID0gZmFsc2U7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKICAgIG1lbnVCdXR0b24uc2NhbGVZID0gMTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGlmKHRhZ3MuZW5jcnlwdFN0YXRlKQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gZmFsc2U7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IG51bGw7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy5lbmNyeXB0U3RhdGUgPSB0cnVlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gdHJ1ZTsKICAgIH1gOwoKICAgIC8vY3JlYXRlIGVuY3J5cHQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCiAgICBpZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEpCiAgICB7CiAgICAgICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAyOwogICAgICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiaXNQdWJsaWMiOwogICAgICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7CiAgICAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgICAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgICAgICBtZW51QnV0dG9uLnB1YmxpY1N0YXRlID0gZmFsc2U7CiAgICAgICAgbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CiAgICAgICAgbWVudUJ1dHRvbi5zY2FsZVkgPSAxOwogICAgICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGlmKHRhZ3MucHVibGljU3RhdGUpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy5wdWJsaWMgPSBudWxsOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy5wdWJsaWMgPSB0cnVlOwogICAgICAgIH1gOwoKICAgICAgICAvL2NyZWF0ZSBwdWJsaWMgYnV0dG9uCiAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CiAgICB9CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uZGltZW5zaW9uID0gImFiTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAtNDsKICAgIG1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSAiYXV0b21hdGljIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbWVudUJ1dHRvbi5kaW1lbnNpb24gPSBudWxsOwptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24ub25LZXlEb3duID0gbnVsbDsKbWVudUJ1dHRvbi5vbktleVVwID0gbnVsbDsKbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZWdnIjsKCmlmICh1dWFiKQp7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSB0cnVlOwoKICAgICAgICAgICAgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCiAgICAgICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2NhbiB5b3VyIHByYWN0aWNlIHBlcm1pdCIpOwogICAgICAgIH0KICAgICAgICBjYXRjaAogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoInFyIGNvZGUgc2NhbiBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlIik7CgogICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIGA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOwp9CmVsc2UKewogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eSA9IHRydWU7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtVGV4dCA9ICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzID8gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgOiBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzLmlkOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBnZXRMaW5rKHBvc3NpYmxlUHVibGlzaEJvdCk7CiAgICBtZW51QnV0dG9uLm9uU3VibWl0ID0gYEAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7ICAgCgogICAgICAgIGlmICh0aGF0LnRleHQgPT0gbnVsbCAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiAmJiAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKICAgICAgICB7CiAgICAgICAgICAgIHRoYXQudGV4dCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoYXQudGV4dCkKICAgICAgICB7CiAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWUsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJhYiBub3Qgc3BlY2lmaWVkIik7CgogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgfQogICAgYDsKfQoKLy9jcmVhdGUgcHVibGlzaCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSA4OwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImNvcHkgdG8gY2xpcGJvYXJkIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZmlsZV9jb3B5IjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgIGxldCBzdGF0ZSA9IHt9CgogICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgYDsKICAgIAogICAgLy9jcmVhdGUgIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YDsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgLy9ORUVEIFRPIFVQREFURQogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdpZykKICAgIHsKICAgICAgICBtZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IC01OwogICAgICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIzcHgifWA7CiAgICAgICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJzdWJtaXQgZ2lnIjsKICAgICAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInNlbmQiOwogICAgICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYkNvbGxhYlN1Ym1pdCIpO2A7CgogICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHt9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9Cgpob3N0QnV0dG9uLmFiTWVudSA9IHRydWU7Cmhvc3RCdXR0b24uYWJNZW51U29ydE9yZGVyID0gNTA7Cmhvc3RCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwpob3N0QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKaG9zdEJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cmhvc3RCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpob3N0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicAs8GpoAeGHg5hYkNvcmVNZW51SWNvbgIEALPBqaAH5m0JaW9zX3NoYXJlJwCzwamgB4YeD2FiQ29yZU1lbnVMYWJlbAIEALPBqaAH8G0Fc2hhcmUnALPBqaAHhh4TYWJDb3JlTWVudVNvcnRPcmRlcgIEALPBqaAH9m0BMycAs8GpoAeGHghyZW1lbWJlcgIEALPBqaAH+G0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAs8GpoAeGHgthYlB1Ymxpc2hBQgIEALPBqaAHn27qIEAvL3Nob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIubG9nKCJhYiBwdWJsaXNoIik7CgpsZXQgcHJvZ3Jlc3NCdXR0b247CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy9jbGVhciBhYiBidWlsZGVyCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgovL3Byb2dyZXNzIGJhciBmb3IgbWFudWFsIHB1Ymxpc2hpbmcgY29uZmlybWF0aW9uCmlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQp7CiAgICBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYHVwbG9hZGluZyAke3RoYXQuYWJ9YCk7Cn0KCi8vYWIgdmFyaWFibGVzCmxldCBhYklEID0gdGhhdC5hYjsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgdGFyZ2V0ID0gdGhhdC50YXJnZXQgPyB0aGF0LnRhcmdldCA6IHRoYXQuYm90OwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IHB1YmxpYyA9IGNvbmZpZ0JvdC50YWdzLnB1YmxpYzsKbGV0IHN0YXRlID0ge307CmxldCBmb3JtYXR0ZWRGaWxlID0ge307Cgpjb25maWdCb3QudGFncy5wdWJsaWMgPSBudWxsOwoKLy90aGlzIGxvZ2ljIGZvcm1hdHMgdGhlIHNwZWNpZmllZCBib3RzIGFuZCBwYWNrYWdlcyB0aGVtIGZvciBwdWJsaXNoaW5nCmlmICghQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIHRhcmdldCAhPSBudWxsICYmIHRhcmdldCAhPSB1bmRlZmluZWQpCnsKCn0KZWxzZSBpZiAoIXRhcmdldCB8fCB0YXJnZXQubGVuZ3RoIDwgMSkKewogICAgdGFyZ2V0ID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKCiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA8IDEpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIk5vIGJvdHMgZm91bmQgdG8gcHVibGlzaCIpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBnZW5lcmF0aW5nIGEga2V5IGZvciBlbmNyeXB0aW9uIChvcHRpb25hbCkKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKLy9mb3JtYXR0aW5nIGJvdHMgZm9yIGZpbGUgc3RvcmFnZQppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCi8vY2hlY2tzIGZvciBwcmV2aW91cyBlZ2dzIGFuZCByZXR1cm5zIGRhdGEgZm9yIHByZXZpb3VzbHkgcHVibGlzaGVkIGFiJ3MKbGV0IGVnZ0NoZWNrID0gYXdhaXQgdGhpc0JvdC5hYlByZXZpb3VzRWdnQ2hlY2soe2FiSUQ6IGFiSUR9KTsKCi8vYWRkaXRpb25hbCBmaWxlIGRhdGEKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCi8vYWN0dWFsIGVuY3J5cHRpb24gaWYgY2hvc2VuCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCi8vcHVibGlzaCB0aGUgZmlsZQpsZXQgcHVibGlzaEZpbGUgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgovL2dhdGhlciBhZGRpb25hbCBlZ2cgZGF0YQplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKLy9wdWJsaXNoIGVnZy9hYiByZWNvcmQKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaFJlY29yZCh7ZGF0YTogZWdnQ2hlY2suZWdnRGF0YSwgcmVjb3JkTmFtZTogYWJJRCwgcHVibGljOiBwdWJsaWN9KTsKbGV0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKLy9wdWJsaXNoaW5nIHNob3V0CnNob3V0KCJvbkFCUHVibGlzaGVkIiwge3N1Y2Nlc3M6IHB1Ymxpc2hGaWxlLnN1Y2Nlc3MsIGFiOiBhYklELCBmaWxlQWRkcmVzczogcHVibGlzaEZpbGUudXJsfSk7Cgpjb25zdCBzdHVkaW9MaW5rID0gYXV0aEJvdC5pZDsKCi8vc2VuZCBkYXRhIGFuZCBmb3JtYXQgdXJsIGlmIGRhdGEgc3VjY2Vzc2Z1bGx5IHNlbnQKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgY29uc3QgYmlvcyA9IHB1YmxpYyA/ICJwdWJsaWMgaW5zdCIgOiAicHJpdmF0ZSBpbnN0IjsKCiAgICBpZiAoa2V5ICYmIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpIAogICAgewogICAgICAgIGlmIChwdWJsaWMgPT09IHRydWUpCiAgICAgICAgewogICAgICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP3BhdHRlcm49IiArIGFiSUQgKyAiJmtleT0iICsga2V5ICsgIiZzdHVkaW89IiArIHN0dWRpb0xpbmsgKyAiJmJpb3M9IiArIGJpb3MpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9wYXR0ZXJuPSIgKyBhYklEICsgIiZzdHVkaW89IiArIHN0dWRpb0xpbmsgKyAiJmJpb3M9IiArIGJpb3MpOwoKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYl9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgY29uc29sZS5sb2cocHVibGlzaFJlY29yZCk7Cn0KCi8vY2xlYXIgcHJvZ3Jlc3MgYmFyCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSBudWxsOwoKcmV0dXJuIHB1Ymxpc2hSZWNvcmQ7JwCzwamgB4YeCGFiSWdub3JlAgQAs8GpoAeKjwEEdHJ1ZScAs8GpoAeGHgphYkRvd25sb2FkAgQAs8GpoAePjwHIA0AvL2Rvd25sb2FkIGJvdHMgKGVpdGhlciBzZWxlY3RlZCBvciBhbGwgZXhwZXJpZW5jZSkKbGV0IGRvd25sb2FkQm90czsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKQp7CiAgICBkb3dubG9hZEJvdHMgPSBbbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1c107CgogICAgYWIubG9nKCJkb3dubG9hZGluZyBib3QiKTsKfQplbHNlCnsKICAgIGRvd25sb2FkQm90cyA9IGdldEJvdHMoYnlNb2QoeyJhYklnbm9yZSI6IG51bGwsICJzcGFjZSI6ICJzaGFyZWQifSkpOwoKICAgIGFiLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycAs8GpoAeGHg1tYW5pZmVzdGF0aW9uAgQAs8GpoAfYkgEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAs8GpoAeGHgRtZW51AgQAs8GpoAf/kgEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAs8GpoAeGHhJhYlByZXZpb3VzRWdnQ2hlY2sCBACzwamgB6aTAYsOQC8vdGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYXQgYSBzcGVjaWZpZWQgYWIsIHJldHVybmluZyBhbnkgZGF0YSB0aGF0IGl0IGZpbmRzCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7Cgphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCB1c2VyUmVjb3JkID0gYXV0aEJvdC5pZDsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEodXNlclJlY29yZCwgYWJJRCwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KS5jYXRjaChlID0+IHt9KTsKCmlmIChyZWNvcmRMb29rdXAuc3VjY2VzcykgCnsKICAgIGVnZ0hpc3RvcnkgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeTsKICAgIGVnZ0lEID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnSUQ7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwogICAgbGFzdEhhc2ggPSBlZ2dIaXN0b3J5W3RhcmdldFZlcnNpb25OdW0gLSAxXTsKICAgIG1heFZlcnNpb25OdW0gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0gCmVsc2UgCnsKICAgIGVnZ0hpc3RvcnkgPSBbXTsKICAgIGVnZ0lEID0gdXVpZCgpOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IDE7CiAgICBsYXN0SGFzaCA9ICJub25lIjsKICAgIG1heFZlcnNpb25OdW0gPSAxOwp9CgppZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQpIAp7CiAgICBjb25zdCBkZWZpbmVkVmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChtYXhWZXJzaW9uTnVtLCB7CiAgICAgICAgdGl0bGU6ICdzZXQgZGVmYXVsdCB2ZXJzaW9uJywKICAgICAgICBwbGFjZWhvbGRlcjogYDEgdG8gJHttYXhWZXJzaW9uTnVtfSAobGVhdmUgYXMgJHttYXhWZXJzaW9uTnVtfSBmb3IgbGF0ZXN0KWAKICAgIH0pOwoKICAgIHRhcmdldFZlcnNpb25OdW0gPSBkZWZpbmVkVmVyc2lvbjsKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uKSAKewogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uID0gbnVsbDsKfQoKbGV0IGVnZyA9IHt9OwoKZWdnLmVnZ1ZlcnNpb25IaXN0b3J5ID0gZWdnSGlzdG9yeTsKZWdnLmVnZ0Zvcm1hdFZlcnNpb24gPSBlZ2dJRDsKZWdnLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uTnVtOwplZ2cubWF4VmVyc2lvbiA9IG1heFZlcnNpb25OdW07CmVnZy5sYWJlbCA9ICJ2Iit0YXJnZXRWZXJzaW9uTnVtOwplZ2cuYWJJRCA9IGFiSUQ7CgpsZXQgc2lnbmF0dXJlID0ge307CmxldCBkYXRlID0gbmV3IERhdGUoKTsKbGV0IHRpbWUgPSBkYXRlLmdldFRpbWUoKTsKCnNpZ25hdHVyZS5wcmV2aW91c0hhc2ggPSBsYXN0SGFzaDsKc2lnbmF0dXJlLmFiVmVyc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVJdGVyYXRpb247CnNpZ25hdHVyZS5lZ2dWZXJzaW9uID0gdGFncy5lZ2dVVUlEOwpzaWduYXR1cmUuZWdnVmVyc2lvbk51bSA9IHRhZ3Mub3ZvVmVyc2lvbjsKc2lnbmF0dXJlLnRpbWVTdGFtcCA9IHRpbWU7CnNpZ25hdHVyZS5jYXN1YWxPU1ZlcnNpb24gPSBbb3MudmVyc2lvbigpXTsKCnJldHVybiB7c2lnbmF0dXJlOiBzaWduYXR1cmUsIGVnZ0RhdGE6IGVnZ307KACzwamgB4YeDGFiQm90VmVyc2lvbgF9hgInALPBqaAHhh4PYWJCb3RNZW51QWN0aW9uAgQAs8GpoAezoQHSAUBpZiAoIWF1dGhCb3QpCnsKICAgIHRoaXNCb3QuYWJEb3dubG9hZCgpOwogICAgCiAgICByZXR1cm47Cn0KZWxzZSBpZiAoIWF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEpCnsKICAgIHRoaXNCb3QuYWJEb3dubG9hZCgpOwogICAgCiAgICByZXR1cm47Cn0KCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycAs8GpoAeGHg5hYkJvdE1lbnVMYWJlbAIEALPBqaAHhqMBBXNoYXJlJwCzwamgB4YeDWFiQm90TWVudUljb24CBACzwamgB4yjAQlpb3Nfc2hhcmUnALPBqaAHhh4SYWJCb3RNZW51U29ydE9yZGVyAgQAs8GpoAeWowEBMycAs8GpoAeGHgVsZWFybgIEALPBqaAHmKMBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnALPBqaAHhh4NYWJQdWJsaXNoVVVBQgIEALPBqaAHv6MB5w9AY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwoKbGV0IHV1YWJDb25maWcgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnV1YWIsIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbGV0IHBpbiA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLHsKICAgIHRpdGxlOiAiZW50ZXIgcGluIiwKICAgIHR5cGU6ICJzZWNyZXQiCn0pOwoKaWYgKHBpbikKewogICAgbGV0IHBoID0gY3J5cHRvLnNoYTI1NihwaW4pLnN1YnN0cmluZygwLDQpOwoKICAgIGlmIChwaCA9PSBjb25maWdCb3QudGFncy5waCkKICAgIHsKICAgICAgICBsZXQgcmVjb3JkS2V5OwogICAgICAgIGxldCBlZ2dEYXRhQ2hlY2s7CiAgICAgICAgbGV0IGVnZ0RhdGE7CgogICAgICAgIGZvciAodGFnIGluIHV1YWJDb25maWcuc3RhdGUpCiAgICAgICAgewogICAgICAgICAgICBpZiAodGFnKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWNvcmRLZXkgPSB1dWFiQ29uZmlnLnN0YXRlW3RhZ10udGFncy5yZWNvcmRLZXk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGF0KQogICAgICAgIHsKICAgICAgICAgICAgZWdnRGF0YUNoZWNrID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5zdWNjZXNzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLmRhdGEuZWdncykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBKU09OLnBhcnNlKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGEubGVuZ3RoID49IDEyKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy50b2FzdCgicHJhY3RpY2UgcGVybWl0IGZ1bGwiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZWdnIGRhdGEgbm90IHJlYWRhYmxlIik7CgogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJSZWNvcmRLZXkgPSByZWNvcmRLZXk7CgogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOwoKICAgICAgICB0aGlzQm90LmFiUHVibGlzaEFCKHthYjogY29uZmlnQm90LnRhZ3MuYWIsIGtleTogY29uZmlnQm90LnRhZ3Mua2V5fSk7CgogICAgICAgIGVnZ0RhdGEucHVzaChjb25maWdCb3QudGFncy5hYik7CgogICAgICAgIGVnZ0RhdGFUb1B1Ymxpc2ggPSB7ZWdnczogSlNPTi5zdHJpbmdpZnkoZWdnRGF0YSl9OwoKICAgICAgICBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGVnZ0RhdGFUb1B1Ymxpc2gsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgYXdhaXQgb3MudG9hc3QoInBpbiBkb2VzIG5vdCBtYXRjaCIsIDIpOwoKICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CiAgICB9Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy50b2FzdCgibm8gcGluIGdpdmVuIiwgMik7CgogICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgIHJldHVybgp9JwCzwamgB4YeC2FiUVJQdWJsaXNoAgQAs8GpoAenswHvBEBjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbiA9IG51bGw7CgpsZXQgc2Nhbm5lZFVSTDsKCnRyeSAKewogICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7Cn0KY2F0Y2ggKGUpIHsKICAgIHNob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9CgppZiAoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpKSAKewogICAgbGV0IHRhcmdldFJlY29yZCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiaW5zdCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLnV1YWIgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIik7CiAgICBjb25maWdCb3QudGFncy5waCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiID0gdXVpZCgpOwogICAgY29uZmlnQm90LnRhZ3Mua2V5ID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoVVVBQih7dGFyZ2V0UmVjb3JkOiB0YXJnZXRSZWNvcmR9KTsKfQplbHNlIAp7CiAgICBvcy50b2FzdCgidW5zdXBwb3J0ZWQgdXJsIGZvcm1hdCIpOwp9JwCzwamgB4YeBnNlYXJjaAIEALPBqaAHl7gBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALPBqaAHhh4HYWJTaGVsbAIEALPBqaAHvrgBBHRydWUnALPBqaAHhh4TYWJCb3RNZW51T25HZW5lcmF0ZQIEALPBqaAHw7gB9wFAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImRvd25sb2FkIGJvdCI7CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gImdldF9hcHAiOwp9CmVsc2UgaWYgKCFhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhKQp7CiAgICB0YWdzLmxhYmVsID0gImRvd25sb2FkIGJvdCI7CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gImdldF9hcHAiOwp9JwCzwamgB4YeDmFiUHVibGlzaEFza0lEAgQAs8GpoAe7ugG/BUBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKCFhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSB8fCAhYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5wdWJsaXNoRGF0YSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9CgpsZXQgcHJvZ3Jlc3NCdXR0b24gPSBhd2FpdCBsaW5rcy5pbnB1dC5hYlByb2dyZXNzQmFyKGBwdWJsaXNoaW5nICR7dGhhdC5hc2tJRH1gKTsKCmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7Cgpjb25zdCBwYXR0ZXJuSUQgPSB0aGF0LnBhdHRlcm5JRDsKY29uc3Qgc3R1ZGlvSUQgPSBhdXRoQm90LmlkOwpjb25zdCBhc2tJRCA9IHRoYXQuYXNrSUQucmVwbGFjZUFsbCgiLSIsICIiKTsKY29uc3QgZW5kcG9pbnQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CmNvbnN0IHB1Ymxpc2hBc2sgPSBhd2FpdCBvcy5yZWNvcmREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFza0lELCB7cGF0dGVybklEOiBwYXR0ZXJuSUQsIHN0dWRpb0lEOiBzdHVkaW9JRH0sIHtlbmRwb2ludDogZW5kcG9pbnQsIHVwZGF0ZVBvbGljeTogW2F1dGhCb3QuaWRdfSk7CgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9CgpyZXR1cm4gcHVibGlzaEFzazsnALPBqaAHhh4FaW5wdXQCBACzwamgB/u/ASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCzwamgB4YeC2FiRW1iZWRMaW5rAgQAs8GpoAeiwAGkA0Bjb25zdCBhYiA9IHRoYXQgPyB0cnVlIDogZmFsc2U7CmNvbnN0IGVtYmVkTGluayA9IGFiID8gImFiPSIgKyB0aGF0IDogImluc3Q9IiArIGNvbmZpZ0JvdC50YWdzLmluc3Q7CmNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwpjb25zdCBlbWJlZFRleHQgPSBgPCFET0NUWVBFIGh0bWw+CsKgwqDCoMKgPGh0bWw+CsKgwqDCoMKgwqDCoMKgwqA8aGVhZD48L2hlYWQ+CsKgwqDCoMKgwqDCoMKgwqA8Ym9keT4KwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgPGlmcmFtZSBzcmM9IiR7c2l0ZU9yaWdpbiArICIvPyIgKyBlbWJlZExpbmt9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSI0MDAiIC8+CsKgwqDCoMKgwqDCoMKgwqA8L2JvZHk+CsKgwqDCoMKgPC9odG1sPmA7CgpyZXR1cm4gZW1iZWRUZXh0OycAs8GpoAeGHhRhYkNvcmVNZW51T25HZW5lcmF0ZQIEALPBqaAHm8MB+gFAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJkb3dubG9hZCBpbnN0IjsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cn0KZWxzZSBpZiAoIWF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEpCnsKICAgIHRhZ3MubGFiZWwgPSAiZG93bmxvYWQgaW5zdCI7CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gImdldF9hcHAiOwp9JwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwCzwamgB5bFAQZzeXN0ZW0CBACzwamgB5fFAQ9hYi5zaGVsbC5zZWFyY2gnALPBqaAHlsUBBGZvcm0CBACzwamgB6fFAQdub3RoaW5nJwCzwamgB5bFAQ5hYlJldHJpZXZlRmlsZQIEALPBqaAHr8UBggFALy9wdWxsIGRvd24gZmlsZSBkYXRhCmlmICghdGhhdC51cmwpCnsKICAgIHJldHVybiAibm8gZmlsZSB1cmwgc3VwcGxpZWQiOwp9CgpsZXQgZGF0YSA9IGF3YWl0IG9zLmdldEZpbGUodGhhdC51cmwpOwoKcmV0dXJuIGRhdGE7JwCzwamgB5bFARBhYlJldHJpZXZlUmVjb3JkAgQAs8GpoAeyxgHKBEAvL3JldHJpZXZlIHNwZWNpZmllZCByZWNvcmQKbGV0IHJlY29yZE5hbWUgPSB0aGF0LnJlY29yZE5hbWU7CgpsZXQgcmVjb3JkS2V5OwoKaWYgKHRoYXQucmVjb3JkS2V5KQp7CiAgICByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleTsKfQplbHNlIGlmIChhdXRoQm90KQp7CiAgICBpZiAoYXV0aEJvdC5pZCA9PSBjb25maWdCb3QudGFncy5zdHVkaW8pCiAgICB7CiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKCiAgICAgICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHJlY29yZEtleSk7CiAgICB9Cn0KCmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgovL0FERCBhZGRpdGlvbmFsIGVycm9yIGhhbmRsaW5nPwoKcmV0dXJuIGdldFJlY29yZDsnALPBqaAHlsUBCHJlbWVtYmVyAgQAs8GpoAf9ygEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAs8GpoAeWxQENbWFuaWZlc3RhdGlvbgIEALPBqaAHpMsBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALPBqaAHlsUBDm9uTG9va3VwQUJFZ2dzAgQAs8GpoAfLywGwH0AvL3Nob3V0KCJvbkxvb2t1cEFCRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIubG9nKCJhYiBhYiBsb2FkICIgKyB0aGF0KTsKCi8vY2xlYXIgYWItMQppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7Cn0KCmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYGxvYWRpbmcgJHt0aGF0LmFiSUR9YCk7CgovL2NvbnN0YW50cyBpbiByZWdhcmRzIHRvIHRoZSBhYiB0byBiZSBsb29rZWQgdXAKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKCi8vcmVjb3JkS2V5IGlzIHZhcmlhYmxlIGRlcGVuZGluZyBvbiBpZiBwdWJsaWMKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbzsKbGV0IHBvc3NpYmxlQXV0aCA9IGF1dGhCb3QgPyBhdXRoQm90IDogdHJ1ZTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKLy92YXJpYWJsZXMgZm9yIGVnZy9hYiBoYXRjaGluZwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgbmV3RWdnOwoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgdGhlIHJldHJpZXZlZCBkYXRhLCBzZWFyY2hlcyBhZ2FpbiBpZiBub25lIGNhbWUgdGhyb3VnaAppZiAoIWdldFJlY29yZC5zdWNjZXNzICYmICghcmVjb3JkS2V5IHx8IHBvc3NpYmxlQXV0aCAhPSByZWNvcmRLZXkpKQp7CiAgICBpZiAoIXJlY29yZEtleSkKICAgIHsKICAgICAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgICAgICByZWNvcmRLZXkgPSBhdXRoQm90LmlkOwogICAgfQoKICAgIGF3YWl0IG9zLmdyYW50SW5zdEFkbWluUGVybWlzc2lvbihyZWNvcmRLZXkpOwoKICAgIGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwp9CgppZiAoIWdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdChgbm8gZGF0YSBmb3VuZCBpbiAke2FiSUR9YCk7CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBpZiAocHJvZ3Jlc3NCdXR0b24pCiAgICB7CiAgICAgICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CiAgICB9CgogICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07Cn0KZWxzZQp7CiAgICAvL3BhY2thZ2UgdGhlIHJlY29yZCBkYXRhCiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKLy90aGlzIGxvZ2ljIHBhcnNlcyB0aGUgZGF0YSBkZXBlbmRhbnQgb24gaG93IGl0IHdhcyBhY2Nlc3NlZC9nYWluZWQKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgaWYgKHByb2dyZXNzQnV0dG9uKQogICAgewogICAgICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwogICAgfQoKICAgIHJldHVybiByZXR1cm5EYXRhOwp9CmVsc2UgaWYgKHJldHVyblR5cGUgPT0gImRhdGEiKQp7CiAgICBsZXQgdmVyc2lvbkFycmF5ID0gSlNPTi5wYXJzZShuZXdFZ2cuZWdnVmVyc2lvbkhpc3RvcnkpOwogICAgbGV0IGZpbGVVVUlEID0gdmVyc2lvbkFycmF5W25ld0VnZy5tYXhWZXJzaW9uIC0gMV07CiAgICBsZXQgZmlsZW5hbWVoYXNoTFRNID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2hMVE0gPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2hMVE0gKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0TFRNVVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2hMVE07CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0TFRNVVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICAgICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KCiAgICByZXR1cm4gZmlsZUdldDsKfQoKLy9hYiBzcGVjaWZpYyB2YXJpYWJsZXMgZm9yIHVuZGVyc3RhbmRpbmcgaWYgYSBwb3NpdGlvbiBpcyBzcGVjaWZpZWQKbGV0IGN1cnJlbnREaW07CmxldCBzcGFjZU1vZDsKbGV0IGRpbWVuc2lvblg7CmxldCBkaW1lbnNpb25ZOwpsZXQgZGltTW9kOwoKLy9oYW5kbGUgZGltZW5zaW9uIGlkZW50aWZpY2F0aW9uCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBjb25zdCBhYkJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7CgogICAgICAgIGN1cnJlbnREaW0gPSBhYkJvdC50YWdzLmRpbWVuc2lvbjsKICAgIH0KfQplbHNlCnsKICAgIGN1cnJlbnREaW0gPSBvcy5nZXRDdXJyZW50RGltZW5zaW9uKCk7Cn0KCi8vY2hlY2tzIGZvciBncmlkIGZvY3VzCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CgogICAgY3VycmVudERpbSA9IGhhdGNoUG9pbnQuZGltZW5zaW9uOwogICAgZGltZW5zaW9uWCA9IGhhdGNoUG9pbnQucG9zaXRpb24ueDsKICAgIGRpbWVuc2lvblkgPSBoYXRjaFBvaW50LnBvc2l0aW9uLnk7CiAgICBzcGFjZU1vZCA9IHtzcGFjZTogInNoYXJlZCJ9Owp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBsb2dpYyBhcm91bmQgYXV0b0hhdGNoIHZzIG1hbnVhbCBoYXRjaGluZwppZiAoIWF1dG9IYXRjaCAmJiBjb25maWdCb3QudGFncy5wYXR0ZXJuID09IG51bGwpCnsKICAgIGRpbU1vZCA9IHtbY3VycmVudERpbV06IHRydWUsIFtjdXJyZW50RGltKyJYIl06IGRpbWVuc2lvblgsIFtjdXJyZW50RGltKyJZIl06IGRpbWVuc2lvblksIGRpbWVuc2lvbjogY3VycmVudERpbX07Cn0KZWxzZQp7CiAgICBpZiAoY29uZmlnQm90LnRhZ3Mua2V5ICYmICF0aGF0LmtleSkKICAgIHsKICAgICAgICBrZXkgPSBjb25maWdCb3QudGFncy5rZXkKICAgIH0KCiAgICBkaW1Nb2QgPSB7YXV0b0hhdGNoOiB0cnVlLCBrZXk6IGtleX07Cn0KCi8vY2FsbCBmb3Igb3ZvIHdpdGggaW5mb3JtYXRpb24gcHJvdmlkZWQKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiB7c3VjY2VzczogdHJ1ZX07JwCzwamgB5bFAQttYW5pZmVzdE92bwIEALPBqaAH/OoB5wpALy9lZ2cgdmlzdWFsaXphdGlvbgpzaG91dCgiYWJNZW51UmVzZXQiKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsnALPBqaAHlsUBCW9uS2V5RG93bgIEALPBqaAH4PUB2gVALy9oaWRkZW4gdmVyc2lvbiBidXR0b24gZm9yIGhhdGNoIG1lbnUKaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAib3ZvIikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5vdm8gPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHZlcnNpb25CdXR0b24pOwp9JwCzwamgB5bFAQhoYXRjaE92bwIEALPBqaAHufsBvAtALy9sb2dpYyBmb3IgaGF0Y2hpbmcgb2YgYW4gYWIKc2hvdXQoJ292b01lbnVSZXNldCcpOwoKLy9kYXRhIGluIHJlZ2FyZHMgdG8gd2hhdCBhYiBpcyBnb2luZyB0byBiZSBoYXRjaGVkCmNvbnN0IG92byA9IHRoYXQ7CgovL2hhdGNoIHNwZWNpZmljIHZhcmlhYmxlcwpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBvdm8udGFncy50YXJnZXRWZXJzaW9uOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiB8fCBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbikKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPT0gb3ZvLnRhZ3MuYWJJRCkKICAgIHsKICAgICAgICB0YXJnZXRWZXJzaW9uID0gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uID8/IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm5WZXJzaW9uOwogICAgfQp9CgpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7CgovL2FjdHVhbCBmaWxlIHJldHJpZXZhbAp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZyhlcnJvcik7CgogICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICByZXR1cm47Cn0KCi8vaGFuZGxpbmcgZm9yIGVuY3J5cHRlZCBhYiBmaWxlCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKLy9jbGVhbiB1cApkZXN0cm95KG92byk7CgovL2dlbmVyYXRlIGJvdHMgYmFzZWQgb24gdGhlIGZpbGUgcmV0cmlldmVkCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGZpbGVHZXQsIG9yaWdpbjogb3ZvLnRhZ3MuYWJJRCwgdmVyc2lvbjogdGFyZ2V0VmVyc2lvbiwgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290fSk7JwCzwamgB5bFAQtpbnRlcmFjdE92bwIEALPBqaAH9oYCjgdALy9tYW51YWwgaGF0Y2ggbWVudQpjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm92byI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24ub3ZvID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24udGFyZ2V0VmVyc2lvbiA9IG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWwgPSAiaGF0Y2ggIiArIG92b0JvdC50YWdzLmFiSUQgKyAiIHYiICsgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92b0JvdC50YWdzLm1heFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKZWdnTWVudUJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmVnZ01lbnVCdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CmVnZ01lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8obGlua3Mub3ZvQm90KTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oZWdnTWVudUJ1dHRvbik7JwCzwamgB5bFAQZjcmVhdGUCBACzwamgB4GOAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwCzwamgB5bFARBjaGFuZ2VPdm9WZXJzaW9uAgQAs8GpoAeojgLKAkAvL2xvZ2ljIGZvciB2ZXJzaW9uIGNoYW5naW5nIHdoZW4gbWFudWFsbHkgaGF0Y2hpbmcgYW4gYWIKY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQob3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG5ld1ZlcnNpb247Cm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycAs8GpoAeWxQEEbWVudQIEALPBqaAH85ACKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InALPBqaAHlsUBCGFiSWdub3JlAgQAs8GpoAeakQIEdHJ1ZSgAs8GpoAeWxQEMYWJCb3RWZXJzaW9uAX2GAicAs8GpoAeWxQEHYWJTaGVsbAIEALPBqaAHoJECBHRydWUnALPBqaAHlsUBDGFiMUxUTVNlYXJjaAIEALPBqaAHpZECM0AvL3N1cHBvcnQgb2xkIHN5bnRheAp0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOycAs8GpoAeWxQENb25Mb29rdXBBc2tJRAIEALPBqaAH2ZEC9wRAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmICghYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgbG9va2luZyB1cCAke3RoYXQuYXNrSUR9YCk7Cgpjb25zdCBhc2tJRCA9IHRoYXQuYXNrSUQ7CmNvbnN0IGVuZHBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50Owpjb25zdCBsb29rdXBBc2sgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFza0lELCBlbmRwb2ludCk7CgppZiAobG9va3VwQXNrLnN1Y2Nlc3MgJiYgbG9va3VwQXNrLmRhdGEucGF0dGVybklEKQp7CiAgICB0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHthYklEOiBsb29rdXBBc2suZGF0YS5wYXR0ZXJuSUQsIHJlY29yZEtleTogbG9va3VwQXNrLmRhdGEuc3R1ZGlvSUQsIGF1dG9IYXRjaDogdHJ1ZX0pOyAgCn0KCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBsb29rdXBBc2s7JwCzwamgB5bFAQVpbnB1dAIEALPBqaAH0ZYCKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnALPBqaAH+JYCBnN5c3RlbQIEALPBqaAH+ZYCDmFiLnNoZWxsLmlucHV0JwCzwamgB/iWAgRmb3JtAgQAs8GpoAeIlwIHbm90aGluZycAs8GpoAf4lgIJb25LZXlEb3duAgQAs8GpoAeQlwJtQC8vYWxsb3cgcHVsbGluZyB1cCBjaGF0IGluIGJ1aWxkZXIgdmVyc2lvbgppZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoIj4iKTsKfScAs8GpoAf4lgIGb25DaGF0AgQAs8GpoAf+lwKVHEAvL25vdCBzdXBwb3J0ZWQgb3V0c2lkZSBvZiBidWlsZGVyIHZlcnNpb24KaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgovL3RoaXMgbG9vcCBpZGVudGlmaWVzIHBvc3NpYmxlIGFiIHNwZWNpZmljIG1lc3NhZ2VzLCBhbmQgY2FsbHMgYSBzZXQgbGlzdCBvZiBjb21tYW5kcwppZiAodGhhdC5tZXNzYWdlWzBdID09ICIuIikgCnsKICAgIG9zLmhpZGVDaGF0KCk7CgogICAgc3dpdGNoICh0aGF0Lm1lc3NhZ2UpCiAgICB7CiAgICAgICAgY2FzZSAnLmRvd25sb2FkQUInOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBhd2FpdCBvcy5zaG93SW5wdXQoImdyb3VwIik7CgogICAgICAgICAgICBpZiAoZ3JvdXAgPT0gImFiQ29uZmlnIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVJdGVyYXRpb24rKzsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaW5pdGlhbEJvb3QgPSB0cnVlOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5jb3JlQUIgPSBudWxsOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBhYkdyb3VwID0gZ2V0Qm90cyhncm91cCk7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFiR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiR3JvdXBbaV0udGFncy5hYkJvdFZlcnNpb24rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuZG93bmxvYWRCb3RzQXNJbml0aWFsemF0aW9uVXBkYXRlKGFiR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoc2tpbGwpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc3lzdGVtYDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIWNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgOiBjb25maWdCb3QudGFncy5tYXBQb3J0YWw7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAubWVudVNoZWV0YDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmRvd25sb2FkYDoKICAgICAgICAgICAgb3MuZG93bmxvYWRCb3RzKGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSksIGNvbmZpZ0JvdC50YWdzLmluc3QpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnVwbG9hZGA6CiAgICAgICAgICAgIG9zLnNob3dVcGxvYWRBdXhGaWxlKCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2xlZXBgOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLi5gOgoKICAgICAgICAgICAgbGV0IHNraWxsQXJyYXkgPSBbImFiSW50ZXJmYWNlIiwgImFiQWN0aW9uIiwgImFiVGVzdHMiXTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbEFycmF5W2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMzAwKTsKCiAgICAgICAgICAgIC8va2VlcCBhYiBhd2FrZQogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IHRydWU7CgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSB1dWlkKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBd2FrZSIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID09IGFiLmlkICsgIi5hYkxvZyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgICAgIG9zLmhpZGVDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gYWIuaWQgKyAiLmFiTG9nIjsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9ICJ0ZW1wTG9jYWwiOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKICAgICAgICAgICAgICAgIG9zLnNob3dDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmhpZGVMb2cnOgogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICBvcy5oaWRlQ2hhdCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHRoYXQubWVzc2FnZTsKICAgICAgICAgICAgbGV0IGV4ZWN1dGFibGUgPSBtZXNzYWdlLnNsaWNlKDEpOwoKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG9zLnJ1bihleGVjdXRhYmxlKTsgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgfQp9JwCzwamgB/iWAgtkZXNjcmlwdGlvbgIEALPBqaAHlLQCQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicAs8GpoAf4lgIMb25GaWxlVXBsb2FkAgQAs8GpoAfXtALWE0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKLy9maWx0ZXIgb3V0IHRpbWVzIHdoZW4gZmlsZSBsb2FkaW5nIGlzIG5vdCBhbGxvd2VkCmlmICghYnVpbGRlclZlcnNpb24gfHwgbGlua3MucmVtZW1iZXIudGFncy5hYkxpc3RlbmluZ0ZvckZpbGVVcGxvYWRzICE9PSB0cnVlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEpCnsKICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgcmV0dXJuOwp9CgovL3ZhcmlvdXMgZmlsZSBzcGVjaWZpYyB2YXJpYWJsZXMKbGV0IGZpbGVFeHRlbnNpb24gPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnNoaWZ0KCk7CmxldCBzaXplID0gdGhhdC5maWxlLnNpemU7CmxldCBtaW1lVHlwZTsKbGV0IGJvdEluZm8gPSB7fTsKCi8vaGFyZCBsaW1pdCBiYXNlZCBvbiBmaWxlIHNpemUKaWYgKHNpemUgPiAyMDAwMDAwMDApCnsKICBvcy50b2FzdCgibWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQgKDIwMCBtYikiKTsKCiAgcmV0dXJuOwp9CgovL3RoaXMgc3dpdGNoIGhhbmRsZXMgcG9zc2libGUgZmlsZXMgZXh0ZW5zaW9ucywgd2hpbGUgcmVqZWN0aW5nIGFueSBpdCBkb2VzIG5vdCByZWNvZ25pemUKc3dpdGNoKGZpbGVFeHRlbnNpb24pCnsKICBjYXNlICdqcGcnOgogIGNhc2UgJ2pwZWcnOgogIGNhc2UgJ3dlYnAnOgogIGNhc2UgJ2dpZic6CiAgY2FzZSAncG5nJzoKICAgIG1pbWVUeXBlID0gImltYWdlLyIgKyBmaWxlRXh0ZW5zaW9uOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdzdmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ2dsYic6CiAgY2FzZSAnZ2x0Zic6CiAgICBtaW1lVHlwZSA9ICJ0ZXh0L3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAibWVzaCI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gImdsdGYiOwogICAgYnJlYWs7CiAgY2FzZSAnYXV4JzoKICBjYXNlICdwZGYnOgogICAgbGV0IGJvdERhdGEgPSBmaWxlRXh0ZW5zaW9uID09ICIuYXV4IiA/IEpTT04ucGFyc2UodGhhdC5maWxlLmRhdGEpLnN0YXRlIDogb3MucGFyc2VCb3RzRnJvbURhdGEodGhhdC5maWxlLmRhdGEpOwoKICAgIGxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGJvdERhdGEsIG9yaWdpbjogZmlsZU5hbWV9KTsKCiAgICByZXR1cm47Ci8vICAgY2FzZSAncGRmJzoKLy8gICAgIGJyZWFrOwogIGNhc2UgJ21wMyc6CiAgICBtaW1lVHlwZSA9ICdhdWRpby9tcGVnJzsKICAgIGJvdEluZm8ub25DbGljayA9ICJAIG9zLnBsYXlTb3VuZCh0YWdzLmZvcm1BZGRyZXNzKTsiOwogICAgYm90SW5mby5sYWJlbCA9ICJDbGljayB0byBQbGF5IjsKICAgIGJyZWFrOwogIGNhc2UgJ21wNCc6CiAgICBtaW1lVHlwZSA9ICd2aWRlby9tcDQnOwogICAgYm90SW5mby5mb3JtID0gImlmcmFtZSI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gInNyYyI7CiAgICBicmVhazsKICBkZWZhdWx0OgogICAgbGV0IHJlc3VsdCA9IG5ldyBFcnJvcigidW5oYW5kbGVkIGZpbGUgdHlwZTogIiArIGZpbGVFeHRlbnNpb24pOwogICAgb3MudG9hc3QoImZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIik7CiAgICBjb25zb2xlLndhcm4ocmVzdWx0KQogICAgcmV0dXJuIHJlc3VsdDsKfQoKLy90aGUgZm9sbG93aW5nIHZhcmlhYmxlcyBhbmQgb2JqZWN0cyBzZXQgdXAgYSBsb2FkaW5nIGJhciBidXR0b24KY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCB1cGxvYWRSZXN1bHQ7CmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IHRoaXNCb3QuYWJQcm9ncmVzc0JhcihgdXBsb2FkaW5nYCk7CgovL3RoaXMgaXMgdGhlIGFjdHVhbCB1cGxvYWQgZnVuY3Rpb25hbGl0eQp1cGxvYWRSZXN1bHQgPSBhd2FpdCBsaW5rcy5zdG9yZS5hYlB1Ymxpc2hGaWxlKHtmaWxlOiB0aGF0LmZpbGUuZGF0YSwgZmlsZU5hbWU6IGZpbGVOYW1lLCBtaW1lVHlwZTogbWltZVR5cGV9KTsKCi8vaWYgdGhlIGZpbGUgc2hvdWxkIGJlIGluY2x1ZGVkIGFzIGEgYm90IHdpdGggYSBsaW5rLCB0aGlzIGxvZ2ljIGhhbmRsZXMgdGhhdAppZiAoT2JqZWN0LmtleXMoYm90SW5mbykubGVuZ3RoID4gMCkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmZvcm1BZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQoKLy9jbGVhciB0aGUgcHJvZ3Jlc3MgYmFyIGJ1dHRvbgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIHVwbG9hZFJlc3VsdDsnALPBqaAH+JYCBWxlYXJuAgQAs8GpoAeuyAIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAs8GpoAf4lgIIcmVtZW1iZXICBACzwamgB9XIAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCzwamgB/iWAg1tYW5pZmVzdGF0aW9uAgQAs8GpoAf8yAIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAs8GpoAf4lgIIYWJJZ25vcmUCBACzwamgB6PJAgR0cnVlKACzwamgB/iWAgxhYkJvdFZlcnNpb24BfYYCJwCzwamgB/iWAgZjcmVhdGUCBACzwamgB6nJAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwCzwamgB/iWAgVzdG9yZQIEALPBqaAH0MkCKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALPBqaAH+JYCBG1lbnUCBACzwamgB/fJAijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCzwamgB/iWAgdhYlNoZWxsAgQAs8GpoAeeygIEdHJ1ZScAs8GpoAf4lgINYWJQcm9ncmVzc0JhcgIEALPBqaAHo8oC1QhAaWYgKCFjb25maWdCb3QudGFncy5hYlNpbGVudCkKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKfQoKbGV0IGxvYWRMYWJlbCA9IHRoYXQgPz8gInVwZGF0aW5nIjsKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwptZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSB7ICJib3JkZXItcmFkaXVzIjoiOHB4IiwgIm1hcmdpbi10b3AiOiIzcHgifTsKbWVudUJ1dHRvbi50cmFja051bSA9IC0xOwptZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7Cm1lbnVCdXR0b24ubGFiZWwwID0gbG9hZExhYmVsICsgIi4iOwptZW51QnV0dG9uLmxhYmVsMSA9IGxvYWRMYWJlbCArICIuLiI7Cm1lbnVCdXR0b24ubGFiZWwyID0gbG9hZExhYmVsICsgIi4uLiI7Cm1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7Cm1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwptZW51QnV0dG9uLmxhYmVsQ29sb3IgPSAiYmxhY2siOwptZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7Cm1lbnVCdXR0b24uYWJQcm9ncmVzc1Jlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKbWVudUJ1dHRvbiA9IGNyZWF0ZShtZW51QnV0dG9uKTsKCnJldHVybiBtZW51QnV0dG9uOwA="}]}