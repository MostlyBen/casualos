{"version":2,"updates":[{"id":0,"timestamp":1680877553981,"update":"AdwBrdyNyA8AJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwCt3I3IDwAGc3lzdGVtAgQArdyNyA8BEmFiLTEuY29yZS5yZWd1bGF0ZScArdyNyA8ABGZvcm0CBACt3I3IDxQHbm90aGluZycArdyNyA8AB2FiMUNvcmUCBACt3I3IDxwEdHJ1ZScArdyNyA8ADG9uQW55Qm90RHJhZwIEAK3cjcgPIZQBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImZhY2UiKTsKfScArdyNyA8ACHJlbWVtYmVyAgQArdyNyA+2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCt3I3IDwAJYWIxSWdub3JlAgQArdyNyA/dAQR0cnVlKACt3I3IDwANYWIxQm90VmVyc2lvbgF9GCcBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScArdyNyA/jAQZzeXN0ZW0CBACt3I3ID+QBEGFiLTEuY29yZS5jcmVhdGUoAK3cjcgP4wEHYWIxQ29yZQF4JwCt3I3ID+MBBGZvcm0CBACt3I3ID/YBB25vdGhpbmcnAK3cjcgP4wELZGVzY3JpcHRpb24CBACt3I3ID/4BPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAK3cjcgP4wENYWIxQ3JlYXRlQm90cwIEAK3cjcgPvAK/FUAvL05FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmxldCBib3REYXRhID0gdGhhdC5ib3RzOwpsZXQgb3JpZ2luID0gdGhhdC5vcmlnaW47CmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107Cgpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYjFHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWIxR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiMUdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiMUdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWIxR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgpsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07Cgpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5hYjFTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgLy8gbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgLy8gaWYgKCFwcmVoYXRjaCkgCiAgICAvLyB7CiAgICAvLyAgICAgYWIxSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIC8vIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9Cgp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycArdyNyA/jAQhyZW1lbWJlcgIEAK3cjcgP/Bco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycArdyNyA/jAQlvbkFiQWRkZWQCBACt3I3ID6MYSkAvL05FRUQgVE8gSU1QTEVNRU5UCi8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwCt3I3ID+MBCWFiMUlnbm9yZQIEAK3cjcgP7hgEdHJ1ZSgArdyNyA/jAQ1hYjFCb3RWZXJzaW9uAX0YJwEEYm90cyQ2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcBJwCt3I3ID/QYBnN5c3RlbQIEAK3cjcgP9RgPYWItMS5jb3JlLmxlYXJuJwCt3I3ID/QYBWFiMUlEAgQArdyNyA+FGQVsZWFybicArdyNyA/0GARmb3JtAgQArdyNyA+LGQdub3RoaW5nJwCt3I3ID/QYB2FiMUJvb3QCBACt3I3ID5MZiw1AbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiMSA9IHRoaXNCb3Q7CgppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsZXQgcHJldmlvdXNCb3RzID0gZ2V0Qm90cyhieU1vZCh7ICJzcGFjZSI6ICJzaGFyZWQiLCAiYWIxQ29yZSI6IG51bGwgfSkpOwoKICAgIGlmIChwcmV2aW91c0JvdHMpCiAgICB7CiAgICAgICAgZGVzdHJveShwcmV2aW91c0JvdHMpOwogICAgfQp9CgoKaWYgKGluaXRpYWxCb290ICYmIGJvb3RGbGFnKQp7CiAgICBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQjFFZ2dzKHthYklEOiBib290RmxhZywgaW5pdGlhbEJvb3Q6IHRydWUsIGF1dG9IYXRjaDogdHJ1ZX0pOwp9CgovL1VVQUIKLy9ib3QudmFycwoKLy8gaWYgKGF1dG9BQikKLy8gewovLyAgICAgbGV0IGVnZ0RhdGEgPSBhd2FpdCBsaW5rcy5zdG9yZS5hYjFSZXRyaWV2ZVJlY29yZChhdXRvQUIpOwoKLy8gICAgIGNvbnNvbGUubG9nKGVnZ0RhdGEpOwovLyB9CgppZiAoaW5zdE1vZGVDaGVjayA9PSAiYnVpbGRlciIpCnsKICAgIC8vQ0hFQ0sgRk9SIFZSL0FSIEhFUkUKICAgIC8vaWYgKGdldEJvdCgicmN4ciIpKQogICAgICAgICAgICAvLyB7CiAgICAgICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgLy8gYWIxTWVudUJ1dHRvbi5sYWJlbCA9ICJlbmFibGUgQVIvVlIgc3VwcG9ydCI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlld19pbl9hciI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlzaWJpbGl0eV9vZmYiOwogICAgICAgICAgICAvLyBhYjFNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWIxQWRhcHQnLCAncmN4cicpOyAKCiAgICAgICAgICAgIC8vIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyAKCiAgICAgICAgICAgIC8vIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKICAgICAgICAgICAgLy8gYDsKCiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSB0cnVlOwoKICAgIGF3YWl0IHRoaXNCb3QuYWIxQWRhcHQoImFiMUludGVyZmFjZSIpOwoKICAgIGlmIChpbml0aWFsQm9vdCAmJiAhYm9vdEZsYWcpCiAgICB7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKCiAgICAgICAgbGlua3MubWVudS5hYjFJbml0aWFsQm9vdE1lbnUoKTsKICAgIH0KfQoKaWYgKGluaXRpYWxCb290KQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gZmFsc2U7Cn0KCnNob3V0KCJvbkFCMUluaXRpYWxpemVkIik7KACt3I3ID/QYB2FiMUNvcmUBeCcArdyNyA/0GAhhYjFBZGFwdAIEAK3cjcgPoCbyBUBjb25zdCBzeXN0ZW1JRCA9IHRoYXQ7CmNvbnN0IGJvb3RTdHJhcCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpCmNvbnN0IHNraWxsRmlsZSA9IGJvb3RTdHJhcC5zbGljZSgwLCBib290U3RyYXAubGVuZ3RoLTcpICsgc3lzdGVtSUQgKyIuYXV4IjsKCnRyeQp7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soewogICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgdXJsOiBza2lsbEZpbGUKICAgIH0pOwoKICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbYWIxIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB1cGRhdGVzID0gcmVzcG9uc2UuZGF0YS51cGRhdGVzOwogICAgY29uc3Qgc3RhdGUgPSBhd2FpdCBvcy5nZXRJbnN0U3RhdGVGcm9tVXBkYXRlcyh1cGRhdGVzKTsKICAgIGNvbnN0IGlkcyA9IE9iamVjdC5rZXlzKHN0YXRlKTsKICAgIAogICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwoKICAgIHdoaXNwZXIoaWRzLCB0YWdOYW1lLCBjb25maWdCb3QudGFncy5pbnN0KTsKCiAgICAvL2FiMS5sb2coImFiLTEgYWRhcHQiKTsKICAgIGNvbnNvbGUubG9nKCJhYi0xIGFkYXB0Iik7CgogICAgcmV0dXJuIHRydWU7Cn0KY2F0Y2gKewogICAgY29uc29sZS5sb2coJ1thYjEgYm9vdHN0cmFwXSBDb3VsZCBub3QgZG93bmxvYWQgc2tpbGwuJyk7Cn0nAK3cjcgP9BgLZGVzY3JpcHRpb24CBACt3I3ID5MsUVRoaXMgc2tpbGwgaXMgZGVzaWduZWQgdG8gaGFuZGxlIGJvdGggcmVjb25maWd1cmF0aW9uIG9mIGFiLTEgYW5kIGluaXRpYWxpemF0aW9uLicArdyNyA/0GApvbkJvdEFkZGVkAgQArdyNyA/lLElAY29uc29sZS5sb2coImFiLTEgU1RBUlQgVVAiKTsKCnNldFRpbWVvdXQoKCkgPT4gdGhpc0JvdC5hYjFCb290KCksIDUwMCk7JwCt3I3ID/QYCHJlbWVtYmVyAgQArdyNyA+vLSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCt3I3ID/QYA2xvZwIEAK3cjcgP1i2TAUBsZXQgdXBkYXRlZExvZ3M7CgppZiAoIXRhZ3MuYWIxTG9nKQp7CiAgICB1cGRhdGVkTG9ncyA9IHRoYXQ7Cn0KZWxzZQp7CiAgICB1cGRhdGVkTG9ncyA9IHRhZ3MuYWIxTG9nICsgIlxuIiArIHRoYXQ7Cn0KCm1hc2tzLmFiMUxvZyA9IHVwZGF0ZWRMb2dzOycArdyNyA/0GA1tYW5pZmVzdGF0aW9uAgQArdyNyA/qLijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCt3I3ID/QYDWFiMUNyZWF0ZUhvc3QCBACt3I3ID5Ev5QdAaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBvcy50b2FzdCgiY29kZSBjb3BpZWQgdG8gY2xpcGJvYXJkIik7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpKTsKCiAgICByZXR1cm47Cn0KCmxldCBuZXdIb3N0SUQgPSB1dWlkKCkucmVwbGFjZUFsbCgiLSIsICIiKS5zdWJzdHJpbmcoMCw2KTsKbGV0IGRhdGUgPSBEYXRlVGltZS5ub3coKS50b01pbGxpcygpOwpsZXQgcmVjb3JkS2V5ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgImIyMDdhNWU0LWQ1MzEtNDg0Zi1hMGQ2LTY2MjZiZWY1OTAxMyIsICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKbGV0IHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleS5kYXRhLCBuZXdIb3N0SUQsIHt1cmw6IGNvbmZpZ0JvdC50YWdzLnVybCwgZGF0ZTogZGF0ZX0sICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKCmlmIChyZWNvcmREYXRhLnN1Y2Nlc3MpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpOwoKICAgIHRoYXQudGFncy5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpOwoKICAgIG9zLnRvYXN0KCJob3N0IGdlbmVyYXRlZCwgY29kZSBjb3BpZWQgdG8gY2xpcGJvYXJkOiAiICsgbmV3SG9zdElEKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwoKICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwp9JwCt3I3ID/QYC2FiMUpvaW5Ib3N0AgQArdyNyA/3Nq4GQHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKbGV0IGpvaW5Db2RlID0gdGhhdC50ZXh0LnJlcGxhY2VBbGwoIi0iLCAiIik7CmxldCByZWNvcmRLZXkgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5LCAiYjIwN2E1ZTQtZDUzMS00ODRmLWEwZDYtNjYyNmJlZjU5MDEzIiwgImh0dHBzOi8vcHVibGljb3MubGluayIpOwpsZXQgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXkuZGF0YSwgam9pbkNvZGUsICJodHRwczovL3B1YmxpY29zLmxpbmsvIik7CgppZiAoZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCBkYXRlID0gRGF0ZVRpbWUubm93KCk7CiAgICBsZXQgY3JlYXRlRGF0ZSA9IERhdGVUaW1lLmZyb21NaWxsaXMoZ2V0UmVjb3JkLmRhdGEuZGF0ZSk7CiAgICBsZXQgZGlmZmVyZW5jZSA9IGRhdGUuZGlmZihjcmVhdGVEYXRlLCAiZGF5cyIpLnRvT2JqZWN0KCk7CgogICAgZGlmZmVyZW5jZSA9IE1hdGguZmxvb3IoZGlmZmVyZW5jZS5kYXlzKTsKCiAgICBpZiAoZGlmZmVyZW5jZSA8IDgpCiAgICB7CiAgICAgICAgb3MudG9hc3QoImpvaW5pbmcgaG9zdCBub3ciKTsKICAgIAogICAgICAgIG9zLmdvVG9VUkwoZ2V0UmVjb3JkLmRhdGEudXJsKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgiam9pbiBjb2RlIG91dCBvZiBkYXRlLCBwbGVhc2UgZ2VuZXJhdGUgYSBuZXcgam9pbiBjb2RlIik7CiAgICB9Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgidW5hYmxlIHRvIGpvaW4sIHBsZWFzZSBjaGVjayBjb2RlIGFuZCB0cnkgYWdhaW4iKTsKfScArdyNyA/0GAZzZWFyY2gCBACt3I3ID6Y9KPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAK3cjcgP9BgJYWIxSWdub3JlAgQArdyNyA/NPQR0cnVlKACt3I3ID/QYDWFiMUJvdFZlcnNpb24BfRgnAK3cjcgP9BgEbWVudQIEAK3cjcgP0z0o8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicBBGJvdHMkNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmAScArdyNyA/6PQZzeXN0ZW0CBACt3I3ID/s9D2FiLTEuY29yZS5zdG9yZSgArdyNyA/6PQdhYjFDb3JlAXgnAK3cjcgP+j0EZm9ybQIEAK3cjcgPjD4Hbm90aGluZycArdyNyA/6PQtkZXNjcmlwdGlvbgIEAK3cjcgPlD4/VGhpcyBza2lsbCBpcyBtZWFudCB0byBiZSBhIGNvbmZpZ3VyYWJsZSBtZWFucyB0byBwdWJsaXNoIGRhdGEuJwCt3I3ID/o9EGFiMVB1Ymxpc2hSZWNvcmQCBACt3I3ID9Q+hQJAbGV0IHJlY29yZERhdGEgPSB0aGF0LmRhdGE7CmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwoKaWYgKCFyZWNvcmREYXRhKQp7CiAgICByZXR1cm4gIm5vIGRhdGEgc3VwcGxpZWQiOwp9CgpyZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CgpyZXR1cm4gcmVjb3JkRGF0YTsnAK3cjcgP+j0OYWIxUHVibGlzaEZpbGUCBACt3I3ID9pAhgNAbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleSA/IHRoYXQucmVjb3JkS2V5IDogbGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXk7CgppZiAoIWZpbGUpCnsKICAgIHJldHVybiAibm8gZmlsZSBzdXBwbGllZCI7Cn0KCmxldCBmaWxlVXBsb2FkID0gYXdhaXQgb3MucmVjb3JkRmlsZShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgZmlsZSwge2Rlc2NyaXB0aW9uOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CgpyZXR1cm4gZmlsZVVwbG9hZDsnAK3cjcgP+j0RYWIxQ29yZU1lbnVBY3Rpb24CBACt3I3ID+FDF0B0aGlzQm90Lm9uU3RvcmVNZW51KCk7JwCt3I3ID/o9C29uU3RvcmVNZW51AgQArdyNyA/5Q6I5QHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWIxTWVudSI7CgpsaW5rcy5tZW51Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiMU1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsiOwoKY29uc3QgdXVhYiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudXVhYiA/IHRydWUgOiBmYWxzZTsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSA5OwptZW51QnV0dG9uLmFiMU1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gImRvd25sb2FkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJnZXRfYXBwIjsKbWVudUJ1dHRvbi5jb2xvciA9ICIjNTVFNjc5IjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiMURvd25sb2FkKCk7YDsKCi8vY3JlYXRlIGRvd25sb2FkIGJ1dHRvbgpsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgppZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAicHVibGlzaCBhYiI7IAogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnBvaW50YWJsZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gbnVsbDsKICAgIG1lbnVCdXR0b24uc2NhbGVZID0gMC43NTsKICAgIAogICAgLy9jcmVhdGUgcHVibGlzaCBsYWJlbCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCiAgICBtZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAxOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJlbmNyeXB0IjsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiMHB4IDBweCAwcHggMHB4IiwgIm1hcmdpbi10b3AiOiAiMHB4In1gOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayI7CiAgICBtZW51QnV0dG9uLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIG1lbnVCdXR0b24uc2NhbGVZID0gMTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGlmKHRhZ3MuZW5jcnlwdFN0YXRlKQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gZmFsc2U7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IG51bGw7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy5lbmNyeXB0U3RhdGUgPSB0cnVlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gdHJ1ZTsKICAgIH1gOwoKICAgIC8vY3JlYXRlIGVuY3J5cHQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYjFNZW51ID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmRpbWVuc2lvbiA9ICJhYjFNZW51IjsKICAgIG1lbnVCdXR0b24ub25LZXlEb3duID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgfWA7CiAgICBtZW51QnV0dG9uLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CiAgICAgICAgfWA7CiAgICBtZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAtMTsKICAgIG1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSAiYXV0b21hdGljIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveCI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImF1dG9tYXRpYyB2ZXJzaW9uIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgaWYodGFncy5idXR0b25TdGF0ZSA9PSAnYXV0b21hdGljJykKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnbWFudWFsJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5idXR0b25TdGF0ZSA9ICdhdXRvbWF0aWMnOwogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ2F1dG9tYXRpYyB2ZXJzaW9uJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7CiAgICAgICAgfWA7CgogICAgLy9jcmVhdGUgdmVyc2lvbiBidXR0b24KICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbWVudUJ1dHRvbi5kaW1lbnNpb24gPSBudWxsOwptZW51QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwptZW51QnV0dG9uLm9uS2V5RG93biA9IG51bGw7Cm1lbnVCdXR0b24ub25LZXlVcCA9IG51bGw7Cm1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDI7Cm1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSBudWxsOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImVnZyI7CgppZiAodXVhYikKewogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gdHJ1ZTsKCiAgICAgICAgICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CgogICAgICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNjYW4geW91ciBwcmFjdGljZSBwZXJtaXQiKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJxciBjb2RlIHNjYW4gbm90IHN1cHBvcnRlZCBvbiB0aGlzIGRldmljZSIpOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKICAgIGA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOwp9CmVsc2UKewogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eSA9IHRydWU7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtVGV4dCA9ICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cyA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCIDogbGlua3MucmVtZW1iZXIudGFncy5hYjFGb2N1c0RhdGE7CiAgICBtZW51QnV0dG9uLm9uU3VibWl0ID0gYEAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7ICAgCgogICAgICAgIGlmICh0aGF0LnRleHQgPT0gbnVsbCAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiAmJiAhbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCiAgICAgICAgewogICAgICAgICAgICB0aGF0LnRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRleHQpCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiMVB1Ymxpc2hBQih7YWI6IHRoYXQudGV4dCwgbWFudWFsUHVibGlzaDogdHJ1ZX0pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgiYWIgbm90IHNwZWNpZmllZCIpOwoKICAgICAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICAgICAgfQogICAgYDsKfQoKLy9jcmVhdGUgcHVibGlzaCBidXR0b24KbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQp7CiAgICBtZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSA4OwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImNvcHkgdG8gY2xpcGJvYXJkIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZmlsZV9jb3B5IjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzU1RTY3OSI7CiAgICBtZW51QnV0dG9uLnRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxQm90Rm9jdXM7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgIGxldCBzdGF0ZSA9IHt9CgogICAgc3RhdGVbYWIxSW5zdE1lbW9yeS50YWdzLmFiMUZvY3VzRGF0YV0gPSBzZWxlY3RlZEJvdDsKCiAgICBsZXQgbmV3RmlsZSA9IHt9CiAgICBuZXdGaWxlLnZlcnNpb24gPSAxOwogICAgbmV3RmlsZS5zdGF0ZSA9IHN0YXRlOwoKICAgIHZhciBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkobmV3RmlsZSk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGZvcm1hdHRlZEZpbGUpOwoKICAgIG9zLnRvYXN0KCJib3QgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKICAgIGA7CiAgICAKICAgIC8vY3JlYXRlICBjb3B5IHRvIGNsaXBib2FyZCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQplbHNlIGlmICghdXVhYikKewogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSB0cnVlOyBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpO2A7CgogICAgLy9jcmVhdGUgIHNjYW4gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgLy9ORUVEIFRPIFVQREFURQogICAgLy8gaWYgKGNvbmZpZ0JvdC50YWdzLmdpZykKICAgIC8vIHsKICAgIC8vICAgICBtZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAtNTsKICAgIC8vICAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgLy8gICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic3VibWl0IGdpZyI7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJzZW5kIjsKICAgIC8vICAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgLy8gICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYjFDb2xsYWJTdWJtaXQiKTtgOwoKICAgIC8vICAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CiAgICAvLyB9Cn0KCmxldCBob3N0QnV0dG9uID0ge307CgppZiAobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpCnsKICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMyk7Cn0KZWxzZQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImdlbmVyYXRlIGpvaW4gY29kZSI7Cn0KCmhvc3RCdXR0b24uYWIxTWVudSA9IHRydWU7Cmhvc3RCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDUwOwpob3N0QnV0dG9uLmFiMU1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpob3N0QnV0dG9uLmZvcm1BZGRyZXNzID0gImdyb3VwX2FkZCI7Cmhvc3RCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7Cmhvc3RCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwpob3N0QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKaG9zdEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubGVhcm4uYWIxQ3JlYXRlSG9zdCh0aGlzQm90KTsKCmlmICghbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpCnsKICAgIHRhZ3MubGFiZWwgPSAnZ2VuZXJhdGluZyBjb2RlIG5vdyc7Cn1gOwoKbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicArdyNyA/6PQ9hYjFDb3JlTWVudUljb24CBACt3I3ID4x9CWlvc19zaGFyZScArdyNyA/6PRBhYjFDb3JlTWVudUxhYmVsAgQArdyNyA+WfQVzaGFyZScArdyNyA/6PRRhYjFDb3JlTWVudVNvcnRPcmRlcgIEAK3cjcgPnH0BMycArdyNyA/6PQhyZW1lbWJlcgIEAK3cjcgPnn0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycArdyNyA/6PQxhYjFQdWJsaXNoQUICBACt3I3ID8V95iZALy9zaG91dCgiYWIxUHVibGlzaEFCIiwge2FiOiAiIiwga2V5OiAiIiwgdGFyZ2V0OiAiIn0pOwphYjEubG9nKCJhYi0xIHB1Ymxpc2giKTsKCnNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKbGV0IHByb2dyZXNzQnV0dG9uOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KTsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKICAgIGxldCBtZW51QnV0dG9uID0ge307CgogICAgbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKICAgIG1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKICAgIG1lbnVCdXR0b24ub25DcmVhdGUgPSBgQAogICAgaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKICAgIG1lbnVCdXR0b24ubGFiZWwwID0gInVwbG9hZGluZy4iOwogICAgbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwogICAgbWVudUJ1dHRvbi5sYWJlbDIgPSAidXBsb2FkaW5nLi4uIjsKICAgIG1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwogICAgbWVudUJ1dHRvbi5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKICAgIHByb2dyZXNzQnV0dG9uID0gbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgpsZXQgYWJJRCA9IHRoYXQuYWI7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IHRhcmdldCA9IHRoYXQudGFyZ2V0OwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IHN0YXRlID0ge307CmxldCBmb3JtYXR0ZWRGaWxlID0ge30KCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgdGFyZ2V0ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXM7Cn0KZWxzZSBpZiAoIXRhcmdldCkKewogICAgdGFyZ2V0ID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYjFJZ25vcmU6IG51bGx9KSk7CgogICAgaWYgKHRhcmdldC5sZW5ndGggPCAxKQogICAgewogICAgICAgIG9zLnRvYXN0KCJObyBib3RzIGZvdW5kIHRvIHB1Ymxpc2giKTsKCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbikKewogICAgbGV0IGtleUNoZWNrOwoKICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwoKICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgIHRpdGxlOiAnZW50ZXIgYSBzZWNyZXQga2V5JwogICAgfSk7CgogICAgaWYgKGtleSkKICAgIHsKICAgICAgICBrZXlDaGVjayA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdjb25maXJtIHNlY3JldCBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGtleSAhPSBrZXlDaGVjaykgewogICAgICAgIGlmICgha2V5Q2hlY2spCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgibm8ga2V5IGVudGVyZWQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImtleXMgZG8gbm90IG1hdGNoIik7CiAgICAgICAgfQoKICAgICAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCmlmIChBcnJheS5pc0FycmF5KHRhcmdldCkpIAp7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldC5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBjdXJyZW50Qm90SUQgPSB0YXJnZXRbaV0uaWQ7CiAgICAgICAgbGV0IGN1cnJlbnRCb3QgPSB0YXJnZXRbaV07CiAgICAgICAgCiAgICAgICAgc3RhdGVbY3VycmVudEJvdElEXSA9IGN1cnJlbnRCb3Q7CiAgICB9Cn0KZWxzZSAKewogICAgc3RhdGVbdGFyZ2V0LmlkXSA9IHRhcmdldDsKfQoKbGV0IGVnZ0NoZWNrID0gYXdhaXQgdGhpc0JvdC5hYjFQcmV2aW91c0VnZ0NoZWNrKHthYklEOiBhYklEfSk7Cgpmb3JtYXR0ZWRGaWxlLnZlcnNpb24gPSAxOwpmb3JtYXR0ZWRGaWxlLnNpZ25hdHVyZSA9IGVnZ0NoZWNrLnNpZ25hdHVyZTsKZm9ybWF0dGVkRmlsZS5zdGF0ZSA9IHN0YXRlOwoKaWYgKGtleSkgCnsKICAgIGZvcm1hdHRlZEZpbGUgPSBKU09OLnN0cmluZ2lmeShmb3JtYXR0ZWRGaWxlKTsKCiAgICBmb3JtYXR0ZWRGaWxlID0gY3J5cHRvLmVuY3J5cHQoa2V5LCBmb3JtYXR0ZWRGaWxlKTsKfQoKbGV0IHB1Ymxpc2hGaWxlID0gYXdhaXQgdGhpc0JvdC5hYjFQdWJsaXNoRmlsZSh7ZmlsZTogZm9ybWF0dGVkRmlsZSwgZmlsZU5hbWU6IGFiSUR9KTsKCmVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkucHVzaChwdWJsaXNoRmlsZS51cmwpOwplZ2dDaGVjay5lZ2dEYXRhLm1heFZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKZWdnQ2hlY2suZWdnRGF0YS50YXJnZXRWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CgpsZXQgcHVibGlzaFJlY29yZCA9IGF3YWl0IHRoaXNCb3QuYWIxUHVibGlzaFJlY29yZCh7ZGF0YTogZWdnQ2hlY2suZWdnRGF0YSwgcmVjb3JkTmFtZTogYWJJRH0pOwpsZXQgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CgpzaG91dCgib25BQlB1Ymxpc2hlZCIsIHtzdWNjZXNzOiBwdWJsaXNoRmlsZS5zdWNjZXNzLCBhYjogYWJJRCwgZmlsZUFkZHJlc3M6IHB1Ymxpc2hGaWxlLnVybH0pCgppZiAocHVibGlzaFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgZ2lnQUIgPSBjb25maWdCb3QudGFncy5hYiB8fCBjb25maWdCb3QudGFncy5hdXRvTG9hZCB8fCBjb25maWdCb3QudGFncy5hdXhDb2RlOwogICAgbGV0IGdpZ0tleSA9IGdpZ0FCID8gZ2lnQUIuc3Vic3RyaW5nKDcpIDogIm5vbmUiOwogICAgbGV0IGdpZ0Zvcm1hdCA9ICJjb2xsYWJfIjsKICAgIGxldCBnaWdGb3JtYXRDaGVjayA9IGFiSUQuaW5jbHVkZXMoZ2lnRm9ybWF0KTsKCiAgICBpZiAoZ2lnRm9ybWF0Q2hlY2sgJiYga2V5ID09IGdpZ0tleSAmJiBrZXkpIAogICAgewogICAgICAgIC8vTk8gQ09QWSBORUNFU1NBUlkKICAgIH0KICAgIGVsc2UgaWYgKGtleSAmJiBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKSAKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEICsgIiZrZXk9IiArIGtleSk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEKTsKCiAgICAgICAgb3MudG9hc3QoInVybCBjb3BpZWQgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgaWYgKGtleSkgCiAgICB7CiAgICAgICAgd2ViaG9vay5wb3N0KCJodHRwczovL3FuaGNhMnM3aWMuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc2xhY2svVDAyOUFQNENRL0IwMUtOVEI4MjAxL2dDT1BscVFIc1JQM3RCSzlQWUhKQm1OcCIsIHsgInRleHQiOiBgUFJJVkFURSAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICB3ZWJob29rLnBvc3QoImh0dHBzOi8vcW5oY2EyczdpYy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9zbGFjay9UMDI5QVA0Q1EvQjAxS05UQjgyMDEvZ0NPUGxxUUhzUlAzdEJLOVBZSEpCbU5wIiwgeyAidGV4dCI6IGAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQoKICAgIHRyeSAKICAgIHsKICAgICAgICBhd2FpdCBhbmFseXRpY3MucmVjb3JkRXZlbnQoJ2FiMV9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgY29uc29sZS5sb2cocHVibGlzaFJlY29yZCk7Cn0KCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSBudWxsOwoKcmV0dXJuIHB1Ymxpc2hSZWNvcmQ7JwCt3I3ID/o9CWFiMUlnbm9yZQIEAK3cjcgPrKQBBHRydWUnAK3cjcgP+j0LYWIxRG93bmxvYWQCBACt3I3ID7GkAZsDQGxldCBkb3dubG9hZEJvdHM7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIGRvd25sb2FkQm90cyA9IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1c107CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgYm90Iik7Cn0KZWxzZQp7CiAgICBkb3dubG9hZEJvdHMgPSBnZXRCb3RzKGJ5TW9kKHsiYWIxSWdub3JlIjogbnVsbCwgInNwYWNlIjogInNoYXJlZCJ9KSk7CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7JwCt3I3ID/o9DW1hbmlmZXN0YXRpb24CBACt3I3ID82nASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCt3I3ID/o9BG1lbnUCBACt3I3ID/SnASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCt3I3ID/o9E2FiMVByZXZpb3VzRWdnQ2hlY2sCBACt3I3ID5uoAYgNQGNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CgpsZXQgZWdnSGlzdG9yeTsKbGV0IGVnZ0lEOwpsZXQgdGFyZ2V0VmVyc2lvbk51bTsKbGV0IGxhc3RIYXNoOwpsZXQgbWF4VmVyc2lvbk51bTsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGFiSUQsICJodHRwczovL3B1YmxpY29zLmxpbmsvIikuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBtYXhWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9IAplbHNlIAp7CiAgICBlZ2dIaXN0b3J5ID0gW107CiAgICBlZ2dJRCA9IHV1aWQoKTsKICAgIHRhcmdldFZlcnNpb25OdW0gPSAxOwogICAgbGFzdEhhc2ggPSAibm9uZSI7CiAgICBtYXhWZXJzaW9uTnVtID0gMTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkKSAKewogICAgY29uc3QgZGVmaW5lZFZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQobWF4VmVyc2lvbk51bSwgewogICAgICAgIHRpdGxlOiAnc2V0IGRlZmF1bHQgdmVyc2lvbicsCiAgICAgICAgcGxhY2Vob2xkZXI6IGAxIHRvICR7bWF4VmVyc2lvbk51bX0gKGxlYXZlIGFzICR7bWF4VmVyc2lvbk51bX0gZm9yIGxhdGVzdClgCiAgICB9KTsKCiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZGVmaW5lZFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbikgCnsKICAgIHRhcmdldFZlcnNpb25OdW0gPSBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uOwogICAgY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG51bGw7Cn0KCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLmFiSUQgPSBhYklEOwoKbGV0IHNpZ25hdHVyZSA9IHt9OwpsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CmxldCB0aW1lID0gZGF0ZS5nZXRUaW1lKCk7CgpzaWduYXR1cmUucHJldmlvdXNIYXNoID0gbGFzdEhhc2g7CnNpZ25hdHVyZS5hYjFWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uOwpzaWduYXR1cmUuZWdnVmVyc2lvbiA9IHRhZ3MuZWdnVVVJRDsKc2lnbmF0dXJlLmVnZ1ZlcnNpb25OdW0gPSB0YWdzLm92b1ZlcnNpb247CnNpZ25hdHVyZS50aW1lU3RhbXAgPSB0aW1lOwpzaWduYXR1cmUuY2FzdWFsT1NWZXJzaW9uID0gW29zLnZlcnNpb24oKV07CgpyZXR1cm4ge3NpZ25hdHVyZTogc2lnbmF0dXJlLCBlZ2dEYXRhOiBlZ2d9OygArdyNyA/6PQ1hYjFCb3RWZXJzaW9uAX0YJwCt3I3ID/o9EGFiMUJvdE1lbnVBY3Rpb24CBACt3I3ID6W1ARdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycArdyNyA/6PQ9hYjFCb3RNZW51TGFiZWwCBACt3I3ID721AQVzaGFyZScArdyNyA/6PQ5hYjFCb3RNZW51SWNvbgIEAK3cjcgPw7UBCWlvc19zaGFyZScArdyNyA/6PRNhYjFCb3RNZW51U29ydE9yZGVyAgQArdyNyA/NtQEBMygArdyNyA/6PQxvbkZpbGVVcGxvYWQBficArdyNyA/6PQVsZWFybgIEAK3cjcgP0LUBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAK3cjcgP+j0OYWIxUHVibGlzaFVVQUICBACt3I3ID/e1Ae8PQGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKCmxldCB1dWFiQ29uZmlnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUIxRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MudXVhYiwgcmV0dXJuVHlwZTogImRhdGEifSk7CgpsZXQgcGluID0gYXdhaXQgb3Muc2hvd0lucHV0KG51bGwsewogICAgdGl0bGU6ICJlbnRlciBwaW4iLAogICAgdHlwZTogInNlY3JldCIKfSk7CgppZiAocGluKQp7CiAgICBsZXQgcGggPSBjcnlwdG8uc2hhMjU2KHBpbikuc3Vic3RyaW5nKDAsNCk7CgogICAgaWYgKHBoID09IGNvbmZpZ0JvdC50YWdzLnBoKQogICAgewogICAgICAgIGxldCByZWNvcmRLZXk7CiAgICAgICAgbGV0IGVnZ0RhdGFDaGVjazsKICAgICAgICBsZXQgZWdnRGF0YTsKCiAgICAgICAgZm9yICh0YWcgaW4gdXVhYkNvbmZpZy5zdGF0ZSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0YWcpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlY29yZEtleSA9IHV1YWJDb25maWcuc3RhdGVbdGFnXS50YWdzLnJlY29yZEtleTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoYXQpCiAgICAgICAgewogICAgICAgICAgICBlZ2dEYXRhQ2hlY2sgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5zdWNjZXNzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLmRhdGEuZWdncykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBKU09OLnBhcnNlKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGEubGVuZ3RoID49IDEyKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy50b2FzdCgicHJhY3RpY2UgcGVybWl0IGZ1bGwiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVnZyBkYXRhIG5vdCByZWFkYWJsZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiMVJlY29yZEtleSA9IHJlY29yZEtleTsKCiAgICAgICAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7CgogICAgICAgIHRoaXNCb3QuYWIxUHVibGlzaEFCKHthYjogY29uZmlnQm90LnRhZ3MuYWIsIGtleTogY29uZmlnQm90LnRhZ3Mua2V5fSk7CgogICAgICAgIGVnZ0RhdGEucHVzaChjb25maWdCb3QudGFncy5hYik7CgogICAgICAgIGVnZ0RhdGFUb1B1Ymxpc2ggPSB7ZWdnczogSlNPTi5zdHJpbmdpZnkoZWdnRGF0YSl9OwoKICAgICAgICBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGVnZ0RhdGFUb1B1Ymxpc2gsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGF3YWl0IG9zLnRvYXN0KCJwaW4gZG9lcyBub3QgbWF0Y2giLCAyKTsKCiAgICAgICAgc2hvdXQoImFiMVJlZnJlc2giKTsKICAgIH0KfQplbHNlCnsKICAgIGF3YWl0IG9zLnRvYXN0KCJubyBwaW4gZ2l2ZW4iLCAyKTsKCiAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgIHJldHVybgp9JwCt3I3ID/o9DGFiMVFSUHVibGlzaAIEAK3cjcgP58UB8gRAY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSBudWxsOwoKbGV0IHNjYW5uZWRVUkw7Cgp0cnkgCnsKICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwp9CmNhdGNoIChlKSB7CiAgICBzaG91dCgiYWIxUHVibGlzaEFCIiwge2FiOiB0aGF0fSk7CgogICAgdGhpc0JvdC5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9CgppZiAoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpKSAKewogICAgbGV0IHRhcmdldFJlY29yZCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiaW5zdCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLnV1YWIgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIik7CiAgICBjb25maWdCb3QudGFncy5waCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiID0gdXVpZCgpOwogICAgY29uZmlnQm90LnRhZ3Mua2V5ID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwoKICAgIHRoaXNCb3QuYWIxUHVibGlzaFVVQUIoe3RhcmdldFJlY29yZDogdGFyZ2V0UmVjb3JkfSk7Cn0KZWxzZSAKewogICAgb3MudG9hc3QoInVuc3VwcG9ydGVkIHVybCBmb3JtYXQiKTsKfScArdyNyA/6PQZzZWFyY2gCBACt3I3ID9rKASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwCt3I3ID4HLAQZzeXN0ZW0CBACt3I3ID4LLARBhYi0xLmNvcmUuc2VhcmNoJwCt3I3ID4HLAQRmb3JtAgQArdyNyA+TywEHbm90aGluZycArdyNyA+BywEHYWIxQ29yZQIEAK3cjcgPm8sBBHRydWUnAK3cjcgPgcsBD2FiMVJldHJpZXZlRmlsZQIEAK3cjcgPoMsBbEBpZiAoIXRoYXQudXJsKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgdXJsIHN1cHBsaWVkIjsKfQoKbGV0IGRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKHRoYXQudXJsKTsKCnJldHVybiBkYXRhOycArdyNyA+BywERYWIxUmV0cmlldmVSZWNvcmQCBACt3I3ID43MAekCQGxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwpsZXQgcmVjb3JkRW5kcG9pbnQgPSB0aGF0LnJlY29yZEVuZHBvaW50ID8gdGhhdC5yZWNvcmRFbmRwb2ludCA6ICJodHRwczovL3B1YmxpY29zLmxpbmsiOwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgpyZXR1cm4gZ2V0UmVjb3JkOygArdyNyA+BywERYWIxQ29yZU1lbnVBY3Rpb24BfigArdyNyA+BywEMb25TZWFyY2hNZW51AX4oAK3cjcgPgcsBD2FiMUNvcmVNZW51SWNvbgF+KACt3I3ID4HLARBhYjFDb3JlTWVudUxhYmVsAX4oAK3cjcgPgcsBFWFiMUNvcmVNZW51T25HZW5lcmF0ZQF+KACt3I3ID4HLARRhYjFDb3JlTWVudVNvcnRPcmRlcgF+JwCt3I3ID4HLAQhyZW1lbWJlcgIEAK3cjcgP/c4BKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAK3cjcgPgcsBDW1hbmlmZXN0YXRpb24CBACt3I3ID6TPASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCt3I3ID4HLAQ9vbkxvb2t1cEFCMUVnZ3MCBACt3I3ID8vPAYYcQC8vc2hvdXQoIm9uTG9va3VwQUIxRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIxLmxvZygiYWItMSBhYiBsb2FkICIgKyB0aGF0KTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7Cn0KCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IGtleSA9IHRoYXQua2V5Owpjb25zdCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmNvbnN0IGF1dG9IYXRjaCA9IHRoYXQuYXV0b0hhdGNoOwpjb25zdCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpjb25zdCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUVuZHBvaW50KTsKCmxldCBuZXdFZ2c7CgppZiAoIWdldFJlY29yZC5zdWNjZXNzICYmIGNvbmZpZ0JvdC50YWdzLmdpZykvL0JSSU5HIElOIElOSVRBSUFMIENPTExBQiBTRVRVUAp7CiAgICBjb25zdCBjb2xsYWJCb3QgPSBnZXRCb3QoImFiSURPcmlnaW4iLCAiY29sbGFiU2V0dXAiKTsKCiAgICBpZiAoIWNvbGxhYkJvdCkKICAgIHsKICAgICAgICB0aGlzQm90Lm9uTG9va3VwQUIxRWdncyh7YWJJRDogImNvbGxhYlNldHVwIiwgYXV0b0hhdGNoOiB0cnVlfSk7CiAgICB9Cn0KZWxzZSBpZiAoIWdldFJlY29yZC5zdWNjZXNzKQp7CiAgICAvL01BWUJFIFJFTU9WRSBUSElTIFNPT04/Pz8KICAgIGNvbnNvbGUubG9nKGdldFJlY29yZCwgImNoZWNraW5nIG9sZCBTVE0iKTsKCiAgICBsZXQgZmlsZW5hbWVoYXNoID0gY3J5cHRvLnNoYTI1NihhYklEKTsKICAgIGxldCBmaWxldXJsaGFzaCA9ICJhdXhfIiArIGZpbGVuYW1laGFzaCArICcuYXV4JzsKICAgIGxldCB0YXJnZXRVUkwgPSAiaHR0cHM6Ly9idWlsZGVyLXN0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaDsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIGxldCBsdG1SZXNwb25zZSA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgICAgIG5ld0VnZyA9IGx0bVJlc3BvbnNlLmRhdGEuc3RhdGU7CgogICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gbmV3RWdnKQogICAgICAgIHsKICAgICAgICAgICAgY29uc3QgbmV3TU9EID0gbmV3RWdnW3Byb3BlcnR5XTsKCiAgICAgICAgICAgIG5ld0VnZyA9IG5ld01PRDsKICAgICAgICB9CiAgICB9IAogICAgY2F0Y2ggKGUpIAogICAgewoKICAgICAgICBvcy50b2FzdChgbm8gZGF0YSBmb3VuZCBpbiAke2FiSUR9YCk7CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gImFiSUQgbm90IGZvdW5kIjsKICAgIH0KfQplbHNlCnsKICAgIG5ld0VnZyA9IGdldFJlY29yZC5kYXRhOwp9CgppZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIgJiYgZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCB2ZXJzaW9uID0gZ2V0UmVjb3JkLmRhdGEudGFyZ2V0VmVyc2lvbiAtIDE7CgogICAgaWYgKHRoYXQuYWJWZXJzaW9uKQogICAgewogICAgICAgIGlmICghaXNOYU4odGhhdC5hYlZlcnNpb24pKQogICAgICAgIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHRoYXQuYWJWZXJzaW9uIC0gMTsKICAgICAgICB9CiAgICB9CgogICAgbGV0IGVnZ0RhdGFVUkwgPSBnZXRSZWNvcmQuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeVt2ZXJzaW9uXTsKICAgIGxldCByZXR1cm5EYXRhID0gYXdhaXQgb3MuZ2V0RmlsZShlZ2dEYXRhVVJMKTsKCiAgICByZXR1cm4gcmV0dXJuRGF0YTsKfQplbHNlIGlmIChyZXR1cm5UeXBlID09ICJkYXRhIikKewogICAgbGV0IHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2UobmV3RWdnLmVnZ1ZlcnNpb25IaXN0b3J5KTsKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtuZXdFZ2cubWF4VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaExUTSA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoTFRNID0gImF1eF8iICsgZmlsZW5hbWVoYXNoTFRNICsgJy5hdXgnOwogICAgbGV0IHRhcmdldExUTVVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoTFRNOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldExUTVVSTDsKCiAgICBmaWxlR2V0ID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYjFSZWZyZXNoIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBmaWxlR2V0ID0gZmlsZUdldC5kYXRhOwogICAgfQoKICAgIHJldHVybiBmaWxlR2V0Owp9CgpsZXQgY3VycmVudERpbTsKbGV0IHNwYWNlTW9kOwpsZXQgZGltZW5zaW9uWDsKbGV0IGRpbWVuc2lvblk7CmxldCBkaW1Nb2Q7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KQogICAgewogICAgICAgIGNvbnN0IGFiMUJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90OwoKICAgICAgICBjdXJyZW50RGltID0gYWIxQm90LnRhZ3MuZGltZW5zaW9uOwogICAgfQp9CmVsc2UKewogICAgY3VycmVudERpbSA9IG9zLmdldEN1cnJlbnREaW1lbnNpb24oKTsKfQoKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxR3JpZEZvY3VzOwoKICAgIGN1cnJlbnREaW0gPSBoYXRjaFBvaW50LmRpbWVuc2lvbjsKICAgIGRpbWVuc2lvblggPSBoYXRjaFBvaW50LnBvc2l0aW9uLng7CiAgICBkaW1lbnNpb25ZID0gaGF0Y2hQb2ludC5wb3NpdGlvbi55OwogICAgc3BhY2VNb2QgPSB7c3BhY2U6ICJzaGFyZWQifTsKfQoKaWYgKCFhdXRvSGF0Y2ggJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gbnVsbCkKewogICAgZGltTW9kID0ge1tjdXJyZW50RGltXTogdHJ1ZSwgW2N1cnJlbnREaW0rIlgiXTogZGltZW5zaW9uWCwgW2N1cnJlbnREaW0rIlkiXTogZGltZW5zaW9uWSwgZGltZW5zaW9uOiBjdXJyZW50RGltfTsKfQplbHNlCnsKICAgIGlmIChjb25maWdCb3QudGFncy5rZXkgJiYgIXRoYXQua2V5KQogICAgewogICAgICAgIGtleSA9IGNvbmZpZ0JvdC50YWdzLmtleQogICAgfQoKICAgIGRpbU1vZCA9IHthdXRvSGF0Y2g6IHRydWUsIGtleToga2V5fTsKfQoKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAK3cjcgPgcsBC21hbmlmZXN0T3ZvAgQArdyNyA/S6wHWCkBzaG91dCgiYWIxTWVudVJlc2V0Iik7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsoAK3cjcgPgcsBCG92b0hhdGNoAX4nAK3cjcgPgcsBCW9uS2V5RG93bgIEAK3cjcgPpvYBtAVAaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAib3ZvIikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5vdm8gPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScArdyNyA+BywEIaGF0Y2hPdm8CBACt3I3ID9n7Ae4MQHNob3V0KCdvdm9NZW51UmVzZXQnKTsKCmNvbnN0IG92byA9IHRoYXQ7CgpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBjb25maWdCb3QudGFncy5hYlZlcnNpb24gJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gb3ZvLnRhZ3MuYWJJRCA/IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiA6IG92by50YWdzLnRhcmdldFZlcnNpb247CmxldCB2ZXJzaW9uQXJyYXkgPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeTsKbGV0IGZpbGVVUkwgPSB2ZXJzaW9uQXJyYXlbdGFyZ2V0VmVyc2lvbiAtIDFdOwpsZXQga2V5ID0gb3ZvLnRhZ3Mua2V5ID8gb3ZvLnRhZ3Mua2V5IDogY29uZmlnQm90LnRhZ3Mua2V5OwpsZXQgZmlsZUdldDsKCnRyeQp7CiAgICBmaWxlR2V0ID0gYXdhaXQgb3MuZ2V0RmlsZShmaWxlVVJMKTsKfQpjYXRjaCAoZXJyb3IpCnsKICAgIGNvbnNvbGUubG9nKCJjaGVja2luZyBvbGQgTFRNIiwgZXJyb3IpOwoKICAgIHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2Uob3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkpOwoKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtvdm8udGFncy50YXJnZXRWZXJzaW9uXTsKICAgIGxldCBmaWxlbmFtZWhhc2ggPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaCA9ICJhdXhfIiArIGZpbGVuYW1laGFzaCArICcuYXV4JzsKICAgIGxldCB0YXJnZXRVUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaDsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRVUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KfQoKaWYgKGNyeXB0by5pc0VuY3J5cHRlZChmaWxlR2V0KSkKewogICAgaWYgKCFrZXkpCiAgICB7CiAgICAgICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCcnLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ0VudGVyIGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICB0cnkKICAgIHsKICAgICAgICBmaWxlR2V0ID0gY3J5cHRvLmRlY3J5cHQoa2V5LCBmaWxlR2V0KTsKICAgIH0KICAgIGNhdGNoIChlcnJvcikKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKCiAgICAgICAgb3MudG9hc3QoImtleSBkb2VzIG5vdCBtYXRjaCBmaWxlIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgCiAgICBmaWxlR2V0ID0gSlNPTi5wYXJzZShmaWxlR2V0KTsKCiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQplbHNlCnsKICAgIGZpbGVHZXQgPSBmaWxlR2V0LnN0YXRlOwp9CgpkZXN0cm95KG92byk7CgpsaW5rcy5jcmVhdGUuYWIxQ3JlYXRlQm90cyh7Ym90czogZmlsZUdldCwgb3JpZ2luOiBvdm8udGFncy5hYklELCB2ZXJzaW9uOiB0YXJnZXRWZXJzaW9uLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAK3cjcgPgcsBC2ludGVyYWN0T3ZvAgQArdyNyA/IiAL7BkBjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm92byI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24ub3ZvID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24udGFyZ2V0VmVyc2lvbiA9IG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWwgPSAiaGF0Y2ggIiArIG92b0JvdC50YWdzLmFiSUQgKyAiIHYiICsgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92b0JvdC50YWdzLm1heFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKZWdnTWVudUJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmVnZ01lbnVCdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CmVnZ01lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8obGlua3Mub3ZvQm90KTsiOwoKbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKGVnZ01lbnVCdXR0b24pOycArdyNyA+BywEGY3JlYXRlAgQArdyNyA/AjwIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycArdyNyA+BywEMYWIxTFRNU2VhcmNoAgQArdyNyA/njwIfQHRoaXNCb3Qub25Mb29rdXBBQjFFZ2dzKHRoYXQpOycArdyNyA+BywEQY2hhbmdlT3ZvVmVyc2lvbgIEAK3cjcgPh5AC+wFAY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXRGb3JUYWcob3ZvQm90LCAidGFyZ2V0VmVyc2lvbiIsIHsKICAgIHBsYWNlaG9sZGVyOiAiZW50ZXIgYSB2ZXJzaW9uIGZyb20gMSB0byAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbgp9KTsKCm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycArdyNyA+BywEEbWVudQIEAK3cjcgPg5ICKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAK3cjcgPgcsBCWFiMUlnbm9yZQIEAK3cjcgPqpICBHRydWUoAK3cjcgPgcsBDWFiMUJvdFZlcnNpb24BfRgnAQRib3RzJGU1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNwEnAK3cjcgPsJICBnN5c3RlbQIEAK3cjcgPsZICEmFiLTEuY29yZS5yZW1lbWJlcicArdyNyA+wkgIEZm9ybQIEAK3cjcgPxJICB25vdGhpbmcoAK3cjcgPsJICB2FiMUNvcmUBeCgArdyNyA+wkgINYWIxQXdha2VTdGF0ZQF5JwCt3I3ID7CSAgtkZXNjcmlwdGlvbgIEAK3cjcgPzpICK1RoaXMgaXMgbWVhbnQgdG8gYmUgdGhlIGxvY2FsIHN0YXRlIGhvbGRlci4nAK3cjcgPsJICDGFiMVJlY29yZEtleQIEAK3cjcgP+pICLnZSSzEuWVdJdE1RPT0uTkhac1VHdG9ObUZHWTNGSmRqSlRNbXMxTkZscVVUMDknAK3cjcgPsJICEmFiMUFjdGl2ZURpbWVuc2lvbgIEAK3cjcgPqZMCBGhvbWUnAK3cjcgPsJICDGFiMUJhc2VDb2xvcgIEAK3cjcgPrpMCByM5MDhCRkMoAK3cjcgPsJICEGFiMUdyaWRTbmFwU3RhdGUBeCgArdyNyA+wkgIPYWIxQm90U25hcFN0YXRlAXgnAK3cjcgPsJICDmFiMU1lbnVSZWZyZXNoAgQArdyNyA+4kwIYQGNsZWFyVGFnTWFza3ModGhpc0JvdCk7KACt3I3ID7CSAgtpbml0aWFsQm9vdAF4JwCt3I3ID7CSAgthYjFFbmRwb2ludAIEAK3cjcgP0pMCFmh0dHBzOi8vcHVibGljb3MubGluay8nAK3cjcgPsJICCWFiMUlnbm9yZQIEAK3cjcgP6ZMCBHRydWUnAK3cjcgPsJICDmFiMUNvcmVWZXJzaW9uAgQArdyNyA/ukwIBOSgArdyNyA+wkgINYWIxQm90VmVyc2lvbgF9GCgArdyNyA+wkgIQYWIxQ29yZUl0ZXJhdGlvbgF9GCcArdyNyA+wkgIaYWIxTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMCBACt3I3ID/KTAgR0cnVlJwEEYm90cyRmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjABJwCt3I3ID/eTAgZzeXN0ZW0CBACt3I3ID/iTAg9hYi0xLmNvcmUuaW5wdXQnAK3cjcgP95MCBGZvcm0CBACt3I3ID4iUAgdub3RoaW5nJwCt3I3ID/eTAglvbktleURvd24CBACt3I3ID5CUAj9AaWYgKHRoYXQua2V5cyA9PSAiYCIgJiYgYnVpbGRlclZlcnNpb24pCnsKICAgIG9zLnNob3dDaGF0KCk7Cn0nAK3cjcgP95MCBm9uQ2hhdAIEAK3cjcgP0JQCtBZAaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5tZXNzYWdlWzBdID09ICIuIikgCnsKICAgIG9zLmhpZGVDaGF0KCk7CgogICAgc3dpdGNoICh0aGF0Lm1lc3NhZ2UpCiAgICB7CiAgICAgICAgY2FzZSAnLmRvd25sb2FkQUIxJzoKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFBd2FrZVN0YXRlID0gZmFsc2U7CgogICAgICAgICAgICBjb25zdCBncm91cCA9IGF3YWl0IG9zLnNob3dJbnB1dCgiZ3JvdXAiKTsKCiAgICAgICAgICAgIGlmIChncm91cCA9PSAiYWIxQ29yZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxQ29yZUl0ZXJhdGlvbisrOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IHRydWU7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmNvcmVBQiA9IG51bGw7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGFiMUdyb3VwID0gZ2V0Qm90cyhncm91cCk7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFiMUdyb3VwLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBhYjFHcm91cFtpXS50YWdzLmFiMUJvdFZlcnNpb24rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuZG93bmxvYWRCb3RzQXNJbml0aWFsemF0aW9uVXBkYXRlKGFiMUdyb3VwLCBncm91cCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5sb2FkU2tpbGxgOgogICAgICAgICAgICBsZXQgc2tpbGwgPSBhd2FpdCBvcy5zaG93SW5wdXQoInNraWxsIik7CgogICAgICAgICAgICBsaW5rcy5sZWFybi5hYjFBZGFwdChza2lsbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zeXN0ZW1gOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgPSB0cnVlOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNoZWV0YDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSAhY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5tZW51U2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuZG93bmxvYWRgOgogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHMoZ2V0Qm90cygic3BhY2UiLCAic2hhcmVkIiksICJhYjFBbGwiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC51cGxvYWRgOgogICAgICAgICAgICBvcy5zaG93VXBsb2FkQXV4RmlsZSgpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNsZWVwYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYjFNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuLmA6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBd2FrZSIsICJhYjFNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICcubG9nJzoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCA9PSBhYjEuaWQgKyAiLmFiMUxvZyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgICAgIG9zLmhpZGVDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gYWIxLmlkICsgIi5hYjFMb2ciOwogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gInRlbXBMb2NhbCI7CgogICAgICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7CgogICAgICAgICAgICAgICAgb3Muc2hvd0NoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICcuaGlkZUxvZyc6CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKCiAgICAgICAgICAgIG9zLmhpZGVDaGF0KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwogICAgICAgICAgICBsZXQgZXhlY3V0YWJsZSA9IG1lc3NhZ2Uuc2xpY2UoMSk7CgogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3MucnVuKGV4ZWN1dGFibGUpOyAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB9CiAgICB9Cn0oAK3cjcgP95MCB2FiMUNvcmUBeCcArdyNyA/3kwILZGVzY3JpcHRpb24CBACt3I3ID4arAkJUaGlzIGlzIG1lYW50IHRvIGhhbmRsZSBhbnkgbm9uZSBtZW51IHJlbGF0ZWQgaW5wdXRzL2ludGVyYWN0aW9ucy4nAK3cjcgP95MCDG9uRmlsZVVwbG9hZAIEAK3cjcgPyasCzRRAaWYgKCFidWlsZGVyVmVyc2lvbiB8fCBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUxpc3RlbmluZ0ZvckZpbGVVcGxvYWRzICE9PSB0cnVlKQp7CiAgICByZXR1cm47Cn0KCmxldCBmaWxlRXh0ZW5zaW9uID0gdGhhdC5maWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTsKbGV0IGZpbGVOYW1lID0gdGhhdC5maWxlLm5hbWUuc3BsaXQoJy4nKS5zaGlmdCgpOwpsZXQgc2l6ZSA9IHRoYXQuZmlsZS5zaXplOwpsZXQgbWltZVR5cGU7CmxldCBib3RJbmZvID0ge307CgppZiAoc2l6ZSA+IDIwMDAwMDAwMCkKewogIG9zLnRvYXN0KCJtYXhpbXVtIGZpbGUgc2l6ZSBleGNlZWRlZCAoMjAwIG1iKSIpOwoKICByZXR1cm47Cn0KCnN3aXRjaChmaWxlRXh0ZW5zaW9uKQp7CiAgY2FzZSAnanBnJzoKICBjYXNlICdqcGVnJzoKICBjYXNlICd3ZWJwJzoKICBjYXNlICdnaWYnOgogIGNhc2UgJ3BuZyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS8iICsgZmlsZUV4dGVuc2lvbjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnc3ZnJzoKICAgIG1pbWVUeXBlID0gImltYWdlL3N2Zyt4bWwiOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdnbGInOgogIGNhc2UgJ2dsdGYnOgogICAgbWltZVR5cGUgPSAidGV4dC94bWwiOwogICAgYm90SW5mby5mb3JtID0gIm1lc2giOwogICAgYm90SW5mby5mb3JtU3VidHlwZSA9ICJnbHRmIjsKICAgIGJyZWFrOwogIGNhc2UgJ2F1eCc6CiAgY2FzZSAncGRmJzoKICAgIGxldCBib3REYXRhID0gZmlsZUV4dGVuc2lvbiA9PSAiLmF1eCIgPyBKU09OLnBhcnNlKHRoYXQuZmlsZS5kYXRhKS5zdGF0ZSA6IG9zLnBhcnNlQm90c0Zyb21EYXRhKHRoYXQuZmlsZS5kYXRhKTsKCiAgICBsaW5rcy5jcmVhdGUuYWIxQ3JlYXRlQm90cyh7Ym90czogYm90RGF0YSwgb3JpZ2luOiBmaWxlTmFtZX0pOwoKICAgIHJldHVybjsKLy8gICBjYXNlICdwZGYnOgovLyAgICAgYnJlYWs7CiAgY2FzZSAnbXAzJzoKICAgIG1pbWVUeXBlID0gJ2F1ZGlvL21wZWcnOwogICAgYm90SW5mby5vbkNsaWNrID0gIkAgb3MucGxheVNvdW5kKHRhZ3MuZm9ybUFkZHJlc3MpOyI7CiAgICBib3RJbmZvLmxhYmVsID0gIkNsaWNrIHRvIFBsYXkiOwogICAgYnJlYWs7CiAgY2FzZSAnbXA0JzoKICAgIG1pbWVUeXBlID0gJ3ZpZGVvL21wNCc7CiAgICBib3RJbmZvLmZvcm0gPSAiaWZyYW1lIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAic3JjIjsKICAgIGJyZWFrOwogIGRlZmF1bHQ6CiAgICBsZXQgcmVzdWx0ID0gbmV3IEVycm9yKCJ1bmhhbmRsZWQgZmlsZSB0eXBlOiAiICsgZmlsZUV4dGVuc2lvbik7CiAgICBvcy50b2FzdCgiZmlsZSB0eXBlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIGNvbnNvbGUud2FybihyZXN1bHQpCiAgICByZXR1cm4gcmVzdWx0Owp9Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYjFNZW51IjsKCmxldCB1cGxvYWRSZXN1bHQ7CmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwptZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7Cm1lbnVCdXR0b24ub25DcmVhdGUgPSBgQAogICAgaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKbWVudUJ1dHRvbi5sYWJlbDAgPSAidXBsb2FkaW5nLiI7Cm1lbnVCdXR0b24ubGFiZWwxID0gInVwbG9hZGluZy4uIjsKbWVudUJ1dHRvbi5sYWJlbDIgPSAidXBsb2FkaW5nLi4uIjsKbWVudUJ1dHRvbi5mb3JtMCA9ICJob3VyZ2xhc3NfYm90dG9tIjsKbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKbWVudUJ1dHRvbi5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCnByb2dyZXNzQnV0dG9uID0gbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKdXBsb2FkUmVzdWx0ID0gYXdhaXQgbGlua3Muc3RvcmUuYWIxUHVibGlzaEZpbGUoe2ZpbGU6IHRoYXQuZmlsZS5kYXRhLCBmaWxlTmFtZTogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwoKaWYgKE9iamVjdC5rZXlzKGJvdEluZm8pLmxlbmd0aCA+IDApCnsKICAgIGJvdEluZm9bY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbF0gPSB0cnVlOwogICAgYm90SW5mby5mb3JtQWRkcmVzcyA9IHVwbG9hZFJlc3VsdC51cmwgPyB1cGxvYWRSZXN1bHQudXJsIDogdXBsb2FkUmVzdWx0LmV4aXN0aW5nRmlsZVVybDsKCiAgICBjcmVhdGUoYm90SW5mbyk7Cn0KCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCmRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwoKcmV0dXJuIHVwbG9hZFJlc3VsdDsnAK3cjcgP95MCBWxlYXJuAgQArdyNyA+XwAIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycArdyNyA/3kwIIcmVtZW1iZXICBACt3I3ID77AAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCt3I3ID/eTAg1tYW5pZmVzdGF0aW9uAgQArdyNyA/lwAIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcArdyNyA/3kwIJYWIxSWdub3JlAgQArdyNyA+MwQIEdHJ1ZSgArdyNyA/3kwINYWIxQm90VmVyc2lvbgF9GCcArdyNyA/3kwIGY3JlYXRlAgQArdyNyA+SwQIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycArdyNyA/3kwIFc3RvcmUCBACt3I3ID7nBAijwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCt3I3ID/eTAgRtZW51AgQArdyNyA/gwQIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgA="}]}