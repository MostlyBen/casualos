{"version":2,"updates":[{"id":0,"timestamp":1679517240415,"update":"AcYB8JbE8gsAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwDwlsTyCwAGc3lzdGVtAgQA8JbE8gsBEmFiLTEuY29yZS5yZWd1bGF0ZScA8JbE8gsABGZvcm0CBADwlsTyCxQHbm90aGluZycA8JbE8gsAB2FiMUNvcmUCBADwlsTyCxwEdHJ1ZScA8JbE8gsADG9uQW55Qm90RHJhZwIEAPCWxPILIZQBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImZhY2UiKTsKfScA8JbE8gsACHJlbWVtYmVyAgQA8JbE8gu2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDwlsTyCwAJYWIxSWdub3JlAgQA8JbE8gvdAQR0cnVlKADwlsTyCwANYWIxQm90VmVyc2lvbgF9AScBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScA8JbE8gvjAQZzeXN0ZW0CBADwlsTyC+QBEGFiLTEuY29yZS5jcmVhdGUoAPCWxPIL4wEHYWIxQ29yZQF4JwDwlsTyC+MBBGZvcm0CBADwlsTyC/YBB25vdGhpbmcnAPCWxPIL4wELZGVzY3JpcHRpb24CBADwlsTyC/4BPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAPCWxPIL4wENYWIxQ3JlYXRlQm90cwIEAPCWxPILvAK/FUAvL05FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmxldCBib3REYXRhID0gdGhhdC5ib3RzOwpsZXQgb3JpZ2luID0gdGhhdC5vcmlnaW47CmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107Cgpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYjFHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWIxR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiMUdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiMUdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWIxR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgpsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07Cgpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5hYjFTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgLy8gbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgLy8gaWYgKCFwcmVoYXRjaCkgCiAgICAvLyB7CiAgICAvLyAgICAgYWIxSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIC8vIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9Cgp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycA8JbE8gvjAQhyZW1lbWJlcgIEAPCWxPIL/Bco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA8JbE8gvjAQlvbkFiQWRkZWQCBADwlsTyC6MYSkAvL05FRUQgVE8gSU1QTEVNRU5UCi8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwDwlsTyC+MBCWFiMUlnbm9yZQIEAPCWxPIL7hgEdHJ1ZSgA8JbE8gvjAQ1hYjFCb3RWZXJzaW9uAX0BJwEEYm90cyQ2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcBJwDwlsTyC/QYBnN5c3RlbQIEAPCWxPIL9RgPYWItMS5jb3JlLmxlYXJuJwDwlsTyC/QYBWFiMUlEAgQA8JbE8guFGQVsZWFybicA8JbE8gv0GARmb3JtAgQA8JbE8guLGQdub3RoaW5nJwDwlsTyC/QYB2FiMUJvb3QCBADwlsTyC5MZ1ghAbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiMSA9IHRoaXNCb3Q7CgppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsZXQgcHJldmlvdXNCb3RzID0gZ2V0Qm90cyhieU1vZCh7ICJzcGFjZSI6ICJzaGFyZWQiLCAiYWIxQ29yZSI6IG51bGwgfSkpOwoKICAgIGlmIChwcmV2aW91c0JvdHMpCiAgICB7CiAgICAgICAgZGVzdHJveShwcmV2aW91c0JvdHMpOwogICAgfQp9CgppZiAoaW5zdE1vZGVDaGVjayA9PSAiYnVpbGRlciIpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxQXdha2VTdGF0ZSA9IHRydWU7CgogICAgYXdhaXQgdGhpc0JvdC5hYjFBZGFwdCgiYWIxSW50ZXJmYWNlIik7CgogICAgaWYgKGluaXRpYWxCb290KQogICAgewogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCwgcG9zaXRpb246e3g6MCx5OjB9fSk7CiAgICB9Cn0KCmlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykKewogICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUIxRWdncyh7YWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKLy9VVUFCCi8vYm90LnZhcnMKCi8vIGlmIChhdXRvQUIpCi8vIHsKLy8gICAgIGxldCBlZ2dEYXRhID0gYXdhaXQgbGlua3Muc3RvcmUuYWIxUmV0cmlldmVSZWNvcmQoYXV0b0FCKTsKCi8vICAgICBjb25zb2xlLmxvZyhlZ2dEYXRhKTsKLy8gfQoKaWYgKGluaXRpYWxCb290KQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gZmFsc2U7Cn0oAPCWxPIL9BgHYWIxQ29yZQF4JwDwlsTyC/QYCGFiMUFkYXB0AgQA8JbE8gvrIfIFQGNvbnN0IHN5c3RlbUlEID0gdGhhdDsKY29uc3QgYm9vdFN0cmFwID0gb3MuZ2V0QUIxQm9vdHN0cmFwVVJMKCkKY29uc3Qgc2tpbGxGaWxlID0gYm9vdFN0cmFwLnNsaWNlKDAsIGJvb3RTdHJhcC5sZW5ndGgtNykgKyBzeXN0ZW1JRCArIi5hdXgiOwoKdHJ5CnsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7CiAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICB1cmw6IHNraWxsRmlsZQogICAgfSk7CgogICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1thYjEgYm9vdHN0cmFwXSBDb3VsZCBub3QgZG93bmxvYWQgc2tpbGwuJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHVwZGF0ZXMgPSByZXNwb25zZS5kYXRhLnVwZGF0ZXM7CiAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHVwZGF0ZXMpOwogICAgY29uc3QgaWRzID0gT2JqZWN0LmtleXMoc3RhdGUpOwogICAgCiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QodXBkYXRlcyk7CgogICAgd2hpc3BlcihpZHMsIHRhZ05hbWUsIGNvbmZpZ0JvdC50YWdzLmluc3QpOwoKICAgIC8vYWIxLmxvZygiYWItMSBhZGFwdCIpOwogICAgY29uc29sZS5sb2coImFiLTEgYWRhcHQiKTsKCiAgICByZXR1cm4gdHJ1ZTsKfQpjYXRjaAp7CiAgICBjb25zb2xlLmxvZygnW2FiMSBib290c3RyYXBdIENvdWxkIG5vdCBkb3dubG9hZCBza2lsbC4nKTsKfScA8JbE8gv0GAtkZXNjcmlwdGlvbgIEAPCWxPIL3idRVGhpcyBza2lsbCBpcyBkZXNpZ25lZCB0byBoYW5kbGUgYm90aCByZWNvbmZpZ3VyYXRpb24gb2YgYWItMSBhbmQgaW5pdGlhbGl6YXRpb24uJwDwlsTyC/QYCm9uQm90QWRkZWQCBADwlsTyC7AoSUBjb25zb2xlLmxvZygiYWItMSBTVEFSVCBVUCIpOwoKc2V0VGltZW91dCgoKSA9PiB0aGlzQm90LmFiMUJvb3QoKSwgNTAwKTsnAPCWxPIL9BgIcmVtZW1iZXICBADwlsTyC/ooKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPCWxPIL9BgDbG9nAgQA8JbE8guhKZMBQGxldCB1cGRhdGVkTG9nczsKCmlmICghdGFncy5hYjFMb2cpCnsKICAgIHVwZGF0ZWRMb2dzID0gdGhhdDsKfQplbHNlCnsKICAgIHVwZGF0ZWRMb2dzID0gdGFncy5hYjFMb2cgKyAiXG4iICsgdGhhdDsKfQoKbWFza3MuYWIxTG9nID0gdXBkYXRlZExvZ3M7JwDwlsTyC/QYDW1hbmlmZXN0YXRpb24CBADwlsTyC7UqKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPCWxPIL9BgNYWIxQ3JlYXRlSG9zdAIEAPCWxPIL3CrlB0BpZiAobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpCnsKICAgIG9zLnRvYXN0KCJjb2RlIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMykpOwoKICAgIHJldHVybjsKfQoKbGV0IG5ld0hvc3RJRCA9IHV1aWQoKS5yZXBsYWNlQWxsKCItIiwgIiIpLnN1YnN0cmluZygwLDYpOwpsZXQgZGF0ZSA9IERhdGVUaW1lLm5vdygpLnRvTWlsbGlzKCk7CmxldCByZWNvcmRLZXkgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5LCAiYjIwN2E1ZTQtZDUzMS00ODRmLWEwZDYtNjYyNmJlZjU5MDEzIiwgImh0dHBzOi8vcHVibGljb3MubGluayIpOwpsZXQgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEocmVjb3JkS2V5LmRhdGEsIG5ld0hvc3RJRCwge3VybDogY29uZmlnQm90LnRhZ3MudXJsLCBkYXRlOiBkYXRlfSwgImh0dHBzOi8vcHVibGljb3MubGluayIpOwoKaWYgKHJlY29yZERhdGEuc3VjY2VzcykKewogICAgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQgPSBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCk7CgogICAgdGhhdC50YWdzLmxhYmVsID0gImpvaW4gY29kZTogIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3MudG9hc3QoImhvc3QgZ2VuZXJhdGVkLCBjb2RlIGNvcGllZCB0byBjbGlwYm9hcmQ6ICIgKyBuZXdIb3N0SUQpOwp9CmVsc2UKewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7CgogICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7Cn0nAPCWxPIL9BgLYWIxSm9pbkhvc3QCBADwlsTyC8IyrgZAc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgpsZXQgam9pbkNvZGUgPSB0aGF0LnRleHQucmVwbGFjZUFsbCgiLSIsICIiKTsKbGV0IHJlY29yZEtleSA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksICJiMjA3YTVlNC1kNTMxLTQ4NGYtYTBkNi02NjI2YmVmNTkwMTMiLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CmxldCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleS5kYXRhLCBqb2luQ29kZSwgImh0dHBzOi8vcHVibGljb3MubGluay8iKTsKCmlmIChnZXRSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IGRhdGUgPSBEYXRlVGltZS5ub3coKTsKICAgIGxldCBjcmVhdGVEYXRlID0gRGF0ZVRpbWUuZnJvbU1pbGxpcyhnZXRSZWNvcmQuZGF0YS5kYXRlKTsKICAgIGxldCBkaWZmZXJlbmNlID0gZGF0ZS5kaWZmKGNyZWF0ZURhdGUsICJkYXlzIikudG9PYmplY3QoKTsKCiAgICBkaWZmZXJlbmNlID0gTWF0aC5mbG9vcihkaWZmZXJlbmNlLmRheXMpOwoKICAgIGlmIChkaWZmZXJlbmNlIDwgOCkKICAgIHsKICAgICAgICBvcy50b2FzdCgiam9pbmluZyBob3N0IG5vdyIpOwogICAgCiAgICAgICAgb3MuZ29Ub1VSTChnZXRSZWNvcmQuZGF0YS51cmwpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luIGNvZGUgb3V0IG9mIGRhdGUsIHBsZWFzZSBnZW5lcmF0ZSBhIG5ldyBqb2luIGNvZGUiKTsKICAgIH0KfQplbHNlCnsKICAgIG9zLnRvYXN0KCJ1bmFibGUgdG8gam9pbiwgcGxlYXNlIGNoZWNrIGNvZGUgYW5kIHRyeSBhZ2FpbiIpOwp9JwDwlsTyC/QYBnNlYXJjaAIEAPCWxPIL8Tgo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA8JbE8gv0GAlhYjFJZ25vcmUCBADwlsTyC5g5BHRydWUoAPCWxPIL9BgNYWIxQm90VmVyc2lvbgF9AScBBGJvdHMkNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmAScA8JbE8gueOQZzeXN0ZW0CBADwlsTyC585D2FiLTEuY29yZS5zdG9yZSgA8JbE8gueOQdhYjFDb3JlAXgnAPCWxPILnjkEZm9ybQIEAPCWxPILsDkHbm90aGluZycA8JbE8gueOQtkZXNjcmlwdGlvbgIEAPCWxPILuDk/VGhpcyBza2lsbCBpcyBtZWFudCB0byBiZSBhIGNvbmZpZ3VyYWJsZSBtZWFucyB0byBwdWJsaXNoIGRhdGEuJwDwlsTyC545EGFiMVB1Ymxpc2hSZWNvcmQCBADwlsTyC/g5iwNAbGV0IHJlY29yZERhdGEgPSB0aGF0LmRhdGE7CmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwpsZXQgcmVjb3JkRW5kcG9pbnQgPSB0aGF0LnJlY29yZEVuZHBvaW50ID8gdGhhdC5yZWNvcmRFbmRwb2ludCA6ICJodHRwczovL3B1YmxpY29zLmxpbmsiOwoKaWYgKCFyZWNvcmREYXRhKQp7CiAgICByZXR1cm4gIm5vIGRhdGEgc3VwcGxpZWQiOwp9CgpyZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIHJlY29yZEVuZHBvaW50KTsKCnJldHVybiByZWNvcmREYXRhOycA8JbE8gueOQ5hYjFQdWJsaXNoRmlsZQIEAPCWxPILhD24A0BsZXQgZmlsZSA9IHRoYXQuZmlsZTsKbGV0IGZpbGVOYW1lID0gdGhhdC5maWxlTmFtZTsKbGV0IG1pbWVUeXBlID0gdGhhdC5taW1lVHlwZTsKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8gdGhhdC5yZWNvcmRLZXkgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleTsKbGV0IHJlY29yZEVuZHBvaW50ID0gdGhhdC5yZWNvcmRFbmRwb2ludCA/IHRoYXQucmVjb3JkRW5kcG9pbnQgOiAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIjsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHJlY29yZEtleSwgZmlsZSwge2Rlc2NyaXB0aW9uOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSwgcmVjb3JkRW5kcG9pbnQpOwoKcmV0dXJuIGZpbGVVcGxvYWQ7JwDwlsTyC545EWFiMUNvcmVNZW51QWN0aW9uAgQA8JbE8gu9QBdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycA8JbE8gueOQtvblN0b3JlTWVudQIEAPCWxPIL1UD5OEBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7IjsKCmNvbnN0IHV1YWIgPSBsaW5rcy5yZW1lbWJlci50YWdzLnV1YWIgPyB0cnVlIDogZmFsc2U7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzU1RTY3OSI7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYjFEb3dubG9hZCgpO2A7CgovL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5wb2ludGFibGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IG51bGw7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDAuNzU7CiAgICAKICAgIC8vY3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5kaW1lbnNpb24gPSAiYWIxTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTE7CiAgICBtZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gImF1dG9tYXRpYyI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KCm1lbnVCdXR0b24uZGltZW5zaW9uID0gbnVsbDsKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJlZ2ciOwoKaWYgKHV1YWIpCnsKICAgIC8vIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAicXJfY29kZV9zY2FubmVyIjsKICAgIC8vIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAvLyAgICAgdHJ5CiAgICAvLyAgICAgewogICAgLy8gICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IHRydWU7CgogICAgLy8gICAgICAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKICAgIC8vICAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzY2FuIHlvdXIgcHJhY3RpY2UgcGVybWl0Iik7CiAgICAvLyAgICAgfQogICAgLy8gICAgIGNhdGNoCiAgICAvLyAgICAgewogICAgLy8gICAgICAgICBvcy50b2FzdCgicXIgY29kZSBzY2FuIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UiKTsKCiAgICAvLyAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKICAgIC8vICAgICB9CgogICAgLy8gICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgIC8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICAvLyBgOwogICAgLy8gbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMgPyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRm9jdXNEYXRhOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQogICAgICAgIHsKICAgICAgICAgICAgdGhhdC50ZXh0ID0gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50ZXh0KQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWV9KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImFiIG5vdCBzcGVjaWZpZWQiKTsKCiAgICAgICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdEZvY3VzOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MudGFyZ2V0Qm90OwogICAgbGV0IHByZXBwZWRCb3QgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEJvdCk7CiAgICBsZXQgc3RhdGUgPSB7fQoKICAgIHN0YXRlW2FiMUluc3RNZW1vcnkudGFncy5hYjFGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgCiAgICAvL2NyZWF0ZSAgY29weSB0byBjbGlwYm9hcmQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIC8vIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDEwOwogICAgLy8gbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIC8vIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICAvLyBtZW51QnV0dG9uLmxhYmVsID0gInNjYW4iOwogICAgLy8gbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgLy8gbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIC8vIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgLy8gbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIC8vIGlmIChjb25maWdCb3QudGFncy5naWcpCiAgICAvLyB7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTU7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIC8vICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgLy8gICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIC8vICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWIxQ29sbGFiU3VibWl0Iik7YDsKCiAgICAvLyAgICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgLy8gfQp9CgovLyoqKioqKiBETyBXRSBORUVEIFRISVMgSEVSRSBOT1c/CgovLyBsZXQgaG9zdEJ1dHRvbiA9IHt9Oy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbgoKLy8gaWYgKGFiMUluc3RNZW1vcnkudGFncy5ob3N0SUQpCi8vIHsKLy8gICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgYWIxSW5zdE1lbW9yeS50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGFiMUluc3RNZW1vcnkudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwovLyB9Ci8vIGVsc2UKLy8gewovLyAgICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwovLyB9CgovLyBob3N0QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAxMTsKLy8gaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwovLyBob3N0QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwovLyBob3N0QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWIxQ3JlYXRlSG9zdCcsIHRoaXNCb3QpOwoKLy8gdGFncy5sYWJlbCA9ICdnZW5lcmF0aW5nIGNvZGUgbm93JztgOwoKLy8gd2hpc3BlcihhYjFDb21tYW5kLCAnYWIxR2VuZXJhdGVNZW51QnV0dG9uJywgaG9zdEJ1dHRvbik7JwDwlsTyC545D2FiMUNvcmVNZW51SWNvbgIEAPCWxPILv3kJaW9zX3NoYXJlJwDwlsTyC545EGFiMUNvcmVNZW51TGFiZWwCBADwlsTyC8l5BXNoYXJlJwDwlsTyC545FGFiMUNvcmVNZW51U29ydE9yZGVyAgQA8JbE8gvPeQE0JwDwlsTyC545CHJlbWVtYmVyAgQA8JbE8gvReSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDwlsTyC545DGFiMVB1Ymxpc2hBQgIEAPCWxPIL+HneGEAvL0ZJWCBMT0FESU5HIEJBUgovL3Nob3V0KCJhYjFQdWJsaXNoQUIiLCB7YWI6ICIiLCBrZXk6ICIiLCB0YXJnZXQ6ICIifSk7CmFiMS5sb2coImFiLTEgcHVibGlzaCIpOwoKc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgppZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKewogICAgLy8gbGV0IG1lbnVEaW0gPSBvcy5nZXRNZW51RGltZW5zaW9uKCk7CgogICAgLy8gaWYoIW1lbnVEaW0pCiAgICAvLyB7CiAgICAvLyAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWIxTWVudSI7CgogICAgLy8gICAgIG1lbnVEaW0gPSAiYWIxTWVudSI7CiAgICAvLyB9CgogICAgLy8gbGV0IG1lbnVCdXR0b24gPSB7fTsKCiAgICAvLyBtZW51QnV0dG9uW21lbnVEaW1dID0gdHJ1ZTsKICAgIC8vIG1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKICAgIC8vIG1lbnVCdXR0b24ub25DcmVhdGUgPSBgQAogICAgLy8gaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIC8vIHsKICAgIC8vICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIC8vIH0KICAgIC8vIGVsc2UKICAgIC8vIHsKICAgIC8vICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICAvLyB9CgogICAgLy8gdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIC8vIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKICAgIC8vIG1lbnVCdXR0b24ubGFiZWwwID0gInVwbG9hZGluZy4iOwogICAgLy8gbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwogICAgLy8gbWVudUJ1dHRvbi5sYWJlbDIgPSAidXBsb2FkaW5nLi4uIjsKICAgIC8vIG1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICAvLyBtZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwogICAgLy8gbWVudUJ1dHRvbi5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKICAgIC8vIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CgogICAgLy8gbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgpsZXQgYWJJRCA9IHRoYXQuYWI7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IHRhcmdldCA9IHRoYXQudGFyZ2V0OwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IHN0YXRlID0ge307CmxldCBmb3JtYXR0ZWRGaWxlID0ge30KCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgdGFyZ2V0ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXM7Cn0KZWxzZSBpZiAoIXRhcmdldCkKewogICAgdGFyZ2V0ID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYjFJZ25vcmU6IG51bGx9KSk7CgogICAgaWYgKHRhcmdldC5sZW5ndGggPCAxKQogICAgewogICAgICAgIG9zLnRvYXN0KCJObyBib3RzIGZvdW5kIHRvIHB1Ymxpc2giKTsKCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbikKewogICAgbGV0IGtleUNoZWNrOwoKICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwoKICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgIHRpdGxlOiAnZW50ZXIgYSBzZWNyZXQga2V5JwogICAgfSk7CgogICAgaWYgKGtleSkKICAgIHsKICAgICAgICBrZXlDaGVjayA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdjb25maXJtIHNlY3JldCBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGtleSAhPSBrZXlDaGVjaykgewogICAgICAgIGlmICgha2V5Q2hlY2spCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgibm8ga2V5IGVudGVyZWQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImtleXMgZG8gbm90IG1hdGNoIik7CiAgICAgICAgfQoKICAgICAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCmlmIChBcnJheS5pc0FycmF5KHRhcmdldCkpIAp7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldC5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBjdXJyZW50Qm90SUQgPSB0YXJnZXRbaV0uaWQ7CiAgICAgICAgbGV0IGN1cnJlbnRCb3QgPSB0YXJnZXRbaV07CiAgICAgICAgCiAgICAgICAgc3RhdGVbY3VycmVudEJvdElEXSA9IGN1cnJlbnRCb3Q7CiAgICB9Cn0KZWxzZSAKewogICAgc3RhdGVbdGFyZ2V0LmlkXSA9IHRhcmdldDsKfQoKbGV0IGVnZ0NoZWNrID0gYXdhaXQgdGhpc0JvdC5hYjFQcmV2aW91c0VnZ0NoZWNrKHthYklEOiBhYklEfSk7CmNvbnNvbGUubG9nKGVnZ0NoZWNrKTsKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCmNvbnNvbGUubG9nKCJJTlRFTkRFRCBUTyBQVUJMSVNIIiwge2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGFiSUQ6IGFiSUQsIGtleToga2V5LCByZXR1cm5UeXBlOiByZXR1cm5UeXBlLCBlZ2dEYXRhOiBlZ2dDaGVjay5lZ2dEYXRhfSk7CgovL05FRUQgVE8gQUNUVUFMTFkgUFVCTElTSAovL2xldCBwdWJsaXNoVXBkYXRlID0gYXdhaXQgd2hpc3BlcihhYjFMb25nVGVybU1lbW9yeSwgImFiMUZpbGVVcGxvYWQiLCB7ZmlsZTogZm9ybWF0dGVkRmlsZSwgYWJJRDogYWJJRCwga2V5OiBrZXksIHJldHVyblR5cGU6IHJldHVyblR5cGUsIGVnZ0RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGF9KVswXTsKCnJldHVybiAvL3B1Ymxpc2hVcGRhdGUnAPCWxPILnjkJYWIxSWdub3JlAgQA8JbE8gvXkgEEdHJ1ZScA8JbE8gueOQthYjFEb3dubG9hZAIEAPCWxPIL3JIBogNALy9URVNUCmxldCBkb3dubG9hZEJvdHM7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIGRvd25sb2FkQm90cyA9IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1c107CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgYm90Iik7Cn0KZWxzZQp7CiAgICBkb3dubG9hZEJvdHMgPSBnZXRCb3RzKGJ5TW9kKHsiYWIxSWdub3JlIjogbnVsbCwgInNwYWNlIjogInNoYXJlZCJ9KSk7CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7JwDwlsTyC545DW1hbmlmZXN0YXRpb24CBADwlsTyC/+VASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDwlsTyC545BG1lbnUCBADwlsTyC6aWASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDwlsTyC545E2FiMVByZXZpb3VzRWdnQ2hlY2sCBADwlsTyC82WAYgNQGNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CgpsZXQgZWdnSGlzdG9yeTsKbGV0IGVnZ0lEOwpsZXQgdGFyZ2V0VmVyc2lvbk51bTsKbGV0IGxhc3RIYXNoOwpsZXQgbWF4VmVyc2lvbk51bTsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGFiSUQsICJodHRwczovL3B1YmxpY29zLmxpbmsvIikuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBtYXhWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9IAplbHNlIAp7CiAgICBlZ2dIaXN0b3J5ID0gW107CiAgICBlZ2dJRCA9IHV1aWQoKTsKICAgIHRhcmdldFZlcnNpb25OdW0gPSAxOwogICAgbGFzdEhhc2ggPSAibm9uZSI7CiAgICBtYXhWZXJzaW9uTnVtID0gMTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkKSAKewogICAgY29uc3QgZGVmaW5lZFZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQobWF4VmVyc2lvbk51bSwgewogICAgICAgIHRpdGxlOiAnc2V0IGRlZmF1bHQgdmVyc2lvbicsCiAgICAgICAgcGxhY2Vob2xkZXI6IGAxIHRvICR7bWF4VmVyc2lvbk51bX0gKGxlYXZlIGFzICR7bWF4VmVyc2lvbk51bX0gZm9yIGxhdGVzdClgCiAgICB9KTsKCiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZGVmaW5lZFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbikgCnsKICAgIHRhcmdldFZlcnNpb25OdW0gPSBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uOwogICAgY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG51bGw7Cn0KCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLmFiSUQgPSBhYklEOwoKbGV0IHNpZ25hdHVyZSA9IHt9OwpsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CmxldCB0aW1lID0gZGF0ZS5nZXRUaW1lKCk7CgpzaWduYXR1cmUucHJldmlvdXNIYXNoID0gbGFzdEhhc2g7CnNpZ25hdHVyZS5hYjFWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uOwpzaWduYXR1cmUuZWdnVmVyc2lvbiA9IHRhZ3MuZWdnVVVJRDsKc2lnbmF0dXJlLmVnZ1ZlcnNpb25OdW0gPSB0YWdzLm92b1ZlcnNpb247CnNpZ25hdHVyZS50aW1lU3RhbXAgPSB0aW1lOwpzaWduYXR1cmUuY2FzdWFsT1NWZXJzaW9uID0gW29zLnZlcnNpb24oKV07CgpyZXR1cm4ge3NpZ25hdHVyZTogc2lnbmF0dXJlLCBlZ2dEYXRhOiBlZ2d9OygA8JbE8gueOQ1hYjFCb3RWZXJzaW9uAX0BJwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwDwlsTyC9ejAQZzeXN0ZW0CBADwlsTyC9ijARBhYi0xLmNvcmUuc2VhcmNoJwDwlsTyC9ejAQRmb3JtAgQA8JbE8gvpowEHbm90aGluZycA8JbE8gvXowEHYWIxQ29yZQIEAPCWxPIL8aMBBHRydWUnAPCWxPIL16MBD2FiMVJldHJpZXZlRmlsZQIEAPCWxPIL9qMBbEBpZiAoIXRoYXQudXJsKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgdXJsIHN1cHBsaWVkIjsKfQoKbGV0IGRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKHRoYXQudXJsKTsKCnJldHVybiBkYXRhOycA8JbE8gvXowERYWIxUmV0cmlldmVSZWNvcmQCBADwlsTyC+OkAekCQGxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwpsZXQgcmVjb3JkRW5kcG9pbnQgPSB0aGF0LnJlY29yZEVuZHBvaW50ID8gdGhhdC5yZWNvcmRFbmRwb2ludCA6ICJodHRwczovL3B1YmxpY29zLmxpbmsiOwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgpyZXR1cm4gZ2V0UmVjb3JkOycA8JbE8gvXowERYWIxQ29yZU1lbnVBY3Rpb24CBADwlsTyC82nASxAdGhpc0JvdC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6IHRoYXQudGV4dH0pOygA8JbE8gvXowEMb25TZWFyY2hNZW51AX4nAPCWxPIL16MBD2FiMUNvcmVNZW51SWNvbgIEAPCWxPIL+6cBBnNlYXJjaCcA8JbE8gvXowEQYWIxQ29yZU1lbnVMYWJlbAIEAPCWxPILgqgBBnNlYXJjaCcA8JbE8gvXowEVYWIxQ29yZU1lbnVPbkdlbmVyYXRlAgQA8JbE8guJqAFoQHRhZ3MuZm9ybSA9ICJpbnB1dCI7CnRhZ3Mub25DbGljayA9IG51bGw7CnRhZ3Mub25TdWJtaXQgPSBgQCBsaW5rcy5iYXNlU2tpbGwuYWIxQ29yZU1lbnVBY3Rpb24odGhhdCk7YDsnAPCWxPIL16MBFGFiMUNvcmVNZW51U29ydE9yZGVyAgQA8JbE8gvyqAEBMicA8JbE8gvXowEIcmVtZW1iZXICBADwlsTyC/SoASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDwlsTyC9ejAQ1tYW5pZmVzdGF0aW9uAgQA8JbE8gubqQEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA8JbE8gvXowEPb25Mb29rdXBBQjFFZ2dzAgQA8JbE8gvCqQG3G0AvL3Nob3V0KCJvbkxvb2t1cEFCMUVnZ3MiLCB7YWJJRDogYWJJRCwga2V5OiBrZXksIGF1dG9IYXRjaDogYm9vbGVhbiwgcmV0dXJuVHlwZTogZGF0YS9udWxsfSk7CmFiMS5sb2coImFiLTEgYWIgbG9hZCAiICsgdGhhdCk7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwp9Cgpjb25zdCBhYklEID0gdGhhdC5hYklEOwpjb25zdCBrZXkgPSB0aGF0LmtleTsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKY29uc3QgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKY29uc3QgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgYWJJRCwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CgpsZXQgbmV3RWdnOwoKaWYgKCFnZXRSZWNvcmQuc3VjY2VzcyAmJiBjb25maWdCb3QudGFncy5naWcpLy9CUklORyBJTiBJTklUQUlBTCBDT0xMQUIgU0VUVVAKewogICAgY29uc3QgY29sbGFiQm90ID0gZ2V0Qm90KCJhYklET3JpZ2luIiwgImNvbGxhYlNldHVwIik7CgogICAgaWYgKCFjb2xsYWJCb3QpCiAgICB7CiAgICAgICAgdGhpc0JvdC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6ICJjb2xsYWJTZXR1cCIsIGF1dG9IYXRjaDogdHJ1ZX0pOwogICAgfQp9CmVsc2UgaWYgKCFnZXRSZWNvcmQuc3VjY2VzcykKewogICAgLy9NQVlCRSBSRU1PVkUgVEhJUyBTT09OPz8/CiAgICBjb25zb2xlLmxvZyhnZXRSZWNvcmQsICJjaGVja2luZyBvbGQgU1RNIik7CgogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoYWJJRCk7CiAgICBsZXQgZmlsZXVybGhhc2ggPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2ggKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0VVJMID0gImh0dHBzOi8vYnVpbGRlci1zdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2g7CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBsZXQgbHRtUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgICAgICBuZXdFZ2cgPSBsdG1SZXNwb25zZS5kYXRhLnN0YXRlOwoKICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIG5ld0VnZykKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IG5ld01PRCA9IG5ld0VnZ1twcm9wZXJ0eV07CgogICAgICAgICAgICBuZXdFZ2cgPSBuZXdNT0Q7CiAgICAgICAgfQogICAgfSAKICAgIGNhdGNoIChlKSAKICAgIHsKCiAgICAgICAgb3MudG9hc3QoYG5vIGRhdGEgZm91bmQgaW4gJHthYklEfWApOwoKICAgICAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgcmV0dXJuICJhYklEIG5vdCBmb3VuZCI7CiAgICB9Cn0KZWxzZQp7CiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgcmV0dXJuIHJldHVybkRhdGE7Cn0KZWxzZSBpZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIpCnsKICAgIGxldCB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG5ld0VnZy5lZ2dWZXJzaW9uSGlzdG9yeSk7CiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbbmV3RWdnLm1heFZlcnNpb24gLSAxXTsKICAgIGxldCBmaWxlbmFtZWhhc2hMVE0gPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaExUTSA9ICJhdXhfIiArIGZpbGVuYW1laGFzaExUTSArICcuYXV4JzsKICAgIGxldCB0YXJnZXRMVE1VUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaExUTTsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRMVE1VUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KCiAgICByZXR1cm4gZmlsZUdldDsKfQoKY29uc3QgYWIxQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3Q7CgpsZXQgY3VycmVudERpbTsKbGV0IHNwYWNlTW9kOwpsZXQgZGltZW5zaW9uWDsKbGV0IGRpbWVuc2lvblk7CmxldCBkaW1Nb2Q7CgppZiAoYWIxQm90KQp7CiAgICBjdXJyZW50RGltID0gYWIxQm90LnRhZ3MuZGltZW5zaW9uOwp9CmVsc2UKewogICAgY3VycmVudERpbSA9IG9zLmdldEN1cnJlbnREaW1lbnNpb24oKTsKfQoKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxR3JpZEZvY3VzOwoKICAgIGN1cnJlbnREaW0gPSBoYXRjaFBvaW50LmRpbWVuc2lvbjsKICAgIGRpbWVuc2lvblggPSBoYXRjaFBvaW50LnBvc2l0aW9uLng7CiAgICBkaW1lbnNpb25ZID0gaGF0Y2hQb2ludC5wb3NpdGlvbi55OwogICAgc3BhY2VNb2QgPSB7c3BhY2U6ICJzaGFyZWQifTsKfQoKaWYgKCFhdXRvSGF0Y2ggJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gbnVsbCkKewogICAgZGltTW9kID0ge1tjdXJyZW50RGltXTogdHJ1ZSwgW2N1cnJlbnREaW0rIlgiXTogZGltZW5zaW9uWCwgW2N1cnJlbnREaW0rIlkiXTogZGltZW5zaW9uWSwgZGltZW5zaW9uOiBjdXJyZW50RGltfTsKfQplbHNlCnsKICAgIGlmIChjb25maWdCb3QudGFncy5rZXkgJiYgIXRoYXQua2V5KQogICAgewogICAgICAgIGtleSA9IGNvbmZpZ0JvdC50YWdzLmtleQogICAgfQoKICAgIGRpbU1vZCA9IHthdXRvSGF0Y2g6IHRydWUsIGtleToga2V5fTsKfQoKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAPCWxPIL16MBC21hbmlmZXN0T3ZvAgQA8JbE8gv6xAGpCkBzaG91dCgiYWIxTWVudVJlc2V0Iik7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpCnsKICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpOwp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsoAPCWxPIL16MBCG92b0hhdGNoAX4nAPCWxPIL16MBCW9uS2V5RG93bgIEAPCWxPILoc8BtAVAaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAib3ZvIikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5vdm8gPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScA8JbE8gvXowEIaGF0Y2hPdm8CBADwlsTyC9TUAfgMQHNob3V0KCdvdm9NZW51UmVzZXQnKTsKCmNvbnN0IG92byA9IHRoYXQ7CgpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBjb25maWdCb3QudGFncy5hYlZlcnNpb24gJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gb3ZvLnRhZ3MuYWJJRCA/IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiA6IG92by50YWdzLnRhcmdldFZlcnNpb247CmxldCB2ZXJzaW9uQXJyYXkgPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeTsKbGV0IGZpbGVVUkwgPSB2ZXJzaW9uQXJyYXlbdGFyZ2V0VmVyc2lvbiAtIDFdOwpsZXQga2V5ID0gb3ZvLnRhZ3Mua2V5ID8gb3ZvLnRhZ3Mua2V5IDogY29uZmlnQm90LnRhZ3Mua2V5OwpsZXQgZmlsZUdldDsKCnRyeQp7CiAgICBmaWxlR2V0ID0gYXdhaXQgb3MuZ2V0RmlsZShmaWxlVVJMKTsKfQpjYXRjaCAoZXJyb3IpCnsKICAgIGNvbnNvbGUubG9nKCJjaGVja2luZyBvbGQgTFRNIiwgZXJyb3IpOwoKICAgIHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2Uob3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkpOwoKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtvdm8udGFncy50YXJnZXRWZXJzaW9uXTsKICAgIGxldCBmaWxlbmFtZWhhc2ggPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaCA9ICJhdXhfIiArIGZpbGVuYW1laGFzaCArICcuYXV4JzsKICAgIGxldCB0YXJnZXRVUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaDsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRVUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KfQoKaWYgKGNyeXB0by5pc0VuY3J5cHRlZChmaWxlR2V0KSkKewogICAgaWYgKCFrZXkpCiAgICB7CiAgICAgICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCcnLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ0VudGVyIGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICB0cnkKICAgIHsKICAgICAgICBmaWxlR2V0ID0gY3J5cHRvLmRlY3J5cHQoa2V5LCBmaWxlR2V0KTsKICAgIH0KICAgIGNhdGNoIChlcnJvcikKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKCiAgICAgICAgb3MudG9hc3QoImtleSBkb2VzIG5vdCBtYXRjaCBmaWxlIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgCiAgICBmaWxlR2V0ID0gSlNPTi5wYXJzZShmaWxlR2V0KTsKCiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQplbHNlCnsKICAgIGZpbGVHZXQgPSBmaWxlR2V0LnN0YXRlOwp9CgpkZXN0cm95KG92byk7CgpsaW5rcy5jcmVhdGUuYWIxQ3JlYXRlQm90cyh7Ym90czogZmlsZUdldCwgb3JpZ2luOiBvdm8udGFncy5hYklELCB2ZXJzaW9uOiB0YXJnZXRWZXJzaW9uLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsKCi8vVEVTVCEhJwDwlsTyC9ejAQtpbnRlcmFjdE92bwIEAPCWxPILzeEB+wZAY29uc3Qgb3ZvQm90ID0gdGhhdCA/IHRoYXQgOiBsaW5rcy5vdm9Cb3Q7CgppZiAoIW92b0JvdCkKewogICAgcmV0dXJuOwp9CgpzaG91dCgib3ZvTWVudVJlc2V0Iik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJvdm8iOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgib3ZvTWVudVJlc2V0Iik7YDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gYEAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwptYXNrcy5vdm9NZW51UmVzZXQgPSBudWxsOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwpgOwoKbGV0IGVnZ01lbnVCdXR0b24gPSB7fTsKCm9zLnR3ZWVuVG8ob3ZvQm90LCAxNSw0NSw0NSwgNSk7CgplZ2dNZW51QnV0dG9uLm92byA9IHRydWU7CmVnZ01lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmVnZ01lbnVCdXR0b24ub3ZvQm90ID0gIvCflJciICsgb3ZvQm90LmlkOwplZ2dNZW51QnV0dG9uLnRhcmdldFZlcnNpb24gPSBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsID0gImhhdGNoICIgKyBvdm9Cb3QudGFncy5hYklEICsgIiB2IiArIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CmVnZ01lbnVCdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwplZ2dNZW51QnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwplZ2dNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKGxpbmtzLm92b0JvdCk7IjsKCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihlZ2dNZW51QnV0dG9uKTsnAPCWxPIL16MBBmNyZWF0ZQIEAPCWxPILxegBKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAPCWxPIL16MBDGFiMUxUTVNlYXJjaAIEAPCWxPIL7OgBH0B0aGlzQm90Lm9uTG9va3VwQUIxRWdncyh0aGF0KTsnAPCWxPIL16MBEGNoYW5nZU92b1ZlcnNpb24CBADwlsTyC4zpAfsBQGNvbnN0IG92b0JvdCA9IGxpbmtzLm92b0JvdDsKCmxldCBuZXdWZXJzaW9uID0gYXdhaXQgb3Muc2hvd0lucHV0Rm9yVGFnKG92b0JvdCwgInRhcmdldFZlcnNpb24iLCB7CiAgICBwbGFjZWhvbGRlcjogImVudGVyIGEgdmVyc2lvbiBmcm9tIDEgdG8gIiArIG92b0JvdC50YWdzLm1heFZlcnNpb24KfSk7Cgpvdm9Cb3QudGFncy5sYWJlbCA9ICd2Jysgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbjsKCnNob3V0KCJvdm9NZW51UmVzZXQiKTsnAPCWxPIL16MBBG1lbnUCBADwlsTyC4jrASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDwlsTyC9ejAQlhYjFJZ25vcmUCBADwlsTyC6/rAQR0cnVlKADwlsTyC9ejAQ1hYjFCb3RWZXJzaW9uAX0BJwEEYm90cyRlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcBJwDwlsTyC7XrAQZzeXN0ZW0CBADwlsTyC7brARJhYi0xLmNvcmUucmVtZW1iZXInAPCWxPILtesBBGZvcm0CBADwlsTyC8nrAQdub3RoaW5nKADwlsTyC7XrAQdhYjFDb3JlAXgoAPCWxPILtesBDWFiMUF3YWtlU3RhdGUBeScA8JbE8gu16wELZGVzY3JpcHRpb24CBADwlsTyC9PrAStUaGlzIGlzIG1lYW50IHRvIGJlIHRoZSBsb2NhbCBzdGF0ZSBob2xkZXIuJwDwlsTyC7XrAQxhYjFSZWNvcmRLZXkCBADwlsTyC//rAS52UksxLllXSXRNUT09Lk5IWnNVR3RvTm1GR1kzRkpkakpUTW1zMU5GbHFVVDA5JwDwlsTyC7XrARJhYjFBY3RpdmVEaW1lbnNpb24CBADwlsTyC67sAQRob21lJwDwlsTyC7XrAQxhYjFCYXNlQ29sb3ICBADwlsTyC7PsAQcjOTA4QkZDKADwlsTyC7XrARBhYjFHcmlkU25hcFN0YXRlAXgoAPCWxPILtesBD2FiMUJvdFNuYXBTdGF0ZQF4JwDwlsTyC7XrAQ5hYjFNZW51UmVmcmVzaAIEAPCWxPILvewBGEBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOygA8JbE8gu16wELaW5pdGlhbEJvb3QBeCcA8JbE8gu16wELYWIxRW5kcG9pbnQCBADwlsTyC9fsARZodHRwczovL3B1YmxpY29zLmxpbmsvJwDwlsTyC7XrAQlhYjFJZ25vcmUCBADwlsTyC+7sAQR0cnVlJwDwlsTyC7XrAQ5hYjFDb3JlVmVyc2lvbgIEAPCWxPIL8+wBATkoAPCWxPILtesBDWFiMUJvdFZlcnNpb24BfQEoAPCWxPILtesBEGFiMUNvcmVJdGVyYXRpb24BfQEnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnAPCWxPIL9+wBBnN5c3RlbQIEAPCWxPIL+OwBD2FiLTEuY29yZS5pbnB1dCcA8JbE8gv37AEEZm9ybQIEAPCWxPILiO0BB25vdGhpbmcnAPCWxPIL9+wBCW9uS2V5RG93bgIEAPCWxPILkO0BP0BpZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoKTsKfScA8JbE8gv37AEGb25DaGF0AgQA8JbE8gvQ7QGBFkBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQjEnOgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYjFDb3JlIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWIxR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWIxR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiMUdyb3VwW2ldLnRhZ3MuYWIxQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWIxR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiMUFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKCJzcGFjZSIsICJzaGFyZWQiKSwgImFiMUFsbCIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnVwbG9hZGA6CiAgICAgICAgICAgIG9zLnNob3dVcGxvYWRBdXhGaWxlKCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2xlZXBgOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC4uYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkF3YWtlIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID09IGFiMS5pZCArICIuYWIxTG9nIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBhYjEuaWQgKyAiLmFiMUxvZyI7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSAidGVtcExvY2FsIjsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCiAgICAgICAgICAgICAgICBvcy5zaG93Q2hhdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5oaWRlTG9nJzoKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CiAgICAgICAgICAgIGxldCBleGVjdXRhYmxlID0gbWVzc2FnZS5zbGljZSgxKTsKCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy5ydW4oZXhlY3V0YWJsZSk7ICAKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0KICAgIH0KfSgA8JbE8gv37AEHYWIxQ29yZQF4JwDwlsTyC/fsAQtkZXNjcmlwdGlvbgIEAPCWxPIL04MCQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicA8JbE8gv37AEMb25GaWxlVXBsb2FkAgQA8JbE8guWhAIlQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfScA8JbE8gv37AEFbGVhcm4CBADwlsTyC7yEAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDwlsTyC/fsAQhyZW1lbWJlcgIEAPCWxPIL44QCKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPCWxPIL9+wBDW1hbmlmZXN0YXRpb24CBADwlsTyC4qFAijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDwlsTyC/fsAQlhYjFJZ25vcmUCBADwlsTyC7GFAgR0cnVlKADwlsTyC/fsAQ1hYjFCb3RWZXJzaW9uAX0BAA=="}]}