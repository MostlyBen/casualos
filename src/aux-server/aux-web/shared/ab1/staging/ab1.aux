{"version":2,"updates":[{"id":0,"timestamp":1687877073488,"update":"AdYBnPDclQ8AJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwCc8NyVDwAGc3lzdGVtAgQAnPDclQ8BEGFiLmNvcmUucmVndWxhdGUnAJzw3JUPAARmb3JtAgQAnPDclQ8SB25vdGhpbmcnAJzw3JUPAAZhYkNvcmUCBACc8NyVDxoEdHJ1ZScAnPDclQ8ADG9uQW55Qm90RHJhZwIEAJzw3JUPH5IBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImdyaWQiKTsKfQoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJmYWNlIik7Cn0nAJzw3JUPAAhyZW1lbWJlcgIEAJzw3JUPsgEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAnPDclQ8ACGFiSWdub3JlAgQAnPDclQ/ZAQR0cnVlKACc8NyVDwAMYWJCb3RWZXJzaW9uAX0vJwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwCc8NyVD98BBnN5c3RlbQIEAJzw3JUP4AEOYWIuY29yZS5jcmVhdGUoAJzw3JUP3wEGYWJDb3JlAXgnAJzw3JUP3wEEZm9ybQIEAJzw3JUP8AEHbm90aGluZycAnPDclQ/fAQtkZXNjcmlwdGlvbgIEAJzw3JUP+AE9Qm90IHVzZWQgdG8gY3JlYXRlL21hbmlmZXN0IGJvdHMgaW50byBhbiBhY3R1YWwgc2NlbmUvcG9ydGFsLicAnPDclQ/fAQxhYkNyZWF0ZUJvdHMCBACc8NyVD7YCqBVALy9ORUVEIFRPIFVOREVSU1RBTkQgV0hBVCBUTyBETyBJRiBBTiBBUlJBWSBJUyBHSVZFTgpsZXQgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290OwpsZXQgYm90RGF0YSA9IHRoYXQuYm90czsKbGV0IG9yaWdpbiA9IHRoYXQub3JpZ2luOwpsZXQgdmVyc2lvbiA9IHRoYXQudmVyc2lvbjsKbGV0IGlkTWFwID0gbmV3IE1hcCgpOwpsZXQgbmV3Qm90cyA9IFtdOwoKZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBib3REYXRhKQp7CiAgICBjb25zdCBuZXdCb3QgPSBib3REYXRhW3Byb3BlcnR5XTsKICAgIGNvbnN0IGJvdFRvdGFsID0gT2JqZWN0LmtleXMoYm90RGF0YSkubGVuZ3RoOwogICAgY29uc3QgYWJJRE9yaWdpbiA9IHthYklET3JpZ2luOiBvcmlnaW59OwogICAgY29uc3QgYWJHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwoKICAgIGlmIChuZXdCb3QudGFncykgCiAgICB7CiAgICAgICAgaWYgKG5ld0JvdC50YWdzLmNyZWF0b3IpIAogICAgICAgIHsKICAgICAgICAgICAgYWJJRE9yaWdpbi5vbGRDcmVhdG9yID0gbmV3Qm90LnRhZ3MuY3JlYXRvcjsKICAgICAgICB9CgogICAgICAgIGxldCB0YXJnZXRQb3NpdGlvbjsKCiAgICAgICAgdHJ5IAogICAgICAgIHsKICAgICAgICAgICAgaWYgKGJvdFRvdGFsIDwgMiAmJiBhYkdyaWRGb2N1cykgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXREaW1lbnNpb24gPSBhYkdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiR3JpZEZvY3VzLnBvc2l0aW9uLngsIFt0YXJnZXREaW1lbnNpb24gKyAiWSJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi55IH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBiID0gY3JlYXRlKG5ld0JvdC50YWdzLCB0YXJnZXRQb3NpdGlvbiwgYWJJRE9yaWdpbik7CgogICAgICAgICAgICBpZE1hcC5zZXQocHJvcGVydHksIGIuaWQpOwogICAgICAgICAgICBuZXdCb3RzLnB1c2goYik7CgogICAgICAgICAgICBpZiAoYi50YWdzLmNyZWF0b3IgPT0gdGhpc0JvdC5pZCkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGIudGFncy5jcmVhdG9yID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyb3IpIAogICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImludmFsaWQgYm90IiwgZXJyb3IpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coInNraXBwZWQgYm90OiAiICsgbmV3Qm90KTsKICAgIH0KfQoKbGV0IGxpbmtUYWdzID0gWyJsaW5rIiwgImNyZWF0b3IiLCAiY29uZmlnQm90IiwgImxpbmVUbyIsICJ0cmFuc2Zvcm1lciJdOwoKZm9yIChsZXQgbmV3Qm90IG9mIG5ld0JvdHMpIAp7CiAgICBmb3IgKGxldCB0YWcgb2YgbGlua1RhZ3MpIAogICAgewogICAgICAgIGxldCB2YWx1ZSA9IG5ld0JvdC50YWdzW3RhZ107CgogICAgICAgIGlmICh0YWcgPT0gImNyZWF0b3IiKSAKICAgICAgICB7CiAgICAgICAgICAgIHZhbHVlID0gbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvcjsKICAgICAgICAgICAgbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVCb3RMaW5rcyhuZXdCb3QsIGlkTWFwKTsKCiAgICAgICAgaWYgKHZhbHVlKSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlLm1hcChpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkTWFwLmdldChpZCkgfHwgaWQ7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0lEID0gaWRNYXAuZ2V0KHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZiAobmV3SUQpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld0lEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgaWYgKCFwcmVoYXRjaCkgCiAgICB7CiAgICAgICAgYWJJbnN0TWVtb3J5LnRhZ3MuYmFzZUFCID0gb3JpZ2luOwogICAgfQogICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBvcmlnaW47Cn0KCndoaXNwZXIobmV3Qm90cywgIm9uRWdnSGF0Y2giLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwCc8NyVD98BCHJlbWVtYmVyAgQAnPDclQ/fFyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCc8NyVD98BCW9uQWJBZGRlZAIEAJzw3JUPhhhyQC8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7Cgpjb25zb2xlLmxvZygiYWI6ICIgKyB0aGF0LmFiLCAidmVyc2lvbjogIiArIHRoYXQudmVyc2lvbik7JwCc8NyVD98BCGFiSWdub3JlAgQAnPDclQ/5GAR0cnVlKACc8NyVD98BDGFiQm90VmVyc2lvbgF9LycBBGJvdHMkNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3AScAnPDclQ//GAZzeXN0ZW0CBACc8NyVD4AZDWFiLmNvcmUubGVhcm4nAJzw3JUP/xgEYWJJRAIEAJzw3JUPjhkFbGVhcm4nAJzw3JUP/xgEZm9ybQIEAJzw3JUPlBkHbm90aGluZycAnPDclQ//GAZhYkJvb3QCBACc8NyVD5wZrA9AbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiSW5zdE1lbW9yeSA9IGxpbmtzLnJlbWVtYmVyOy8vUkVQTEFDRUQKZ2xvYmFsVGhpcy5hYlJlbWVtYmVyID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJMb25nVGVybU1lbW9yeVNlYXJjaCA9IGxpbmtzLnNlYXJjaDsvL1JFUExBQ0VECmdsb2JhbFRoaXMuYWJTZWFyY2ggPSBsaW5rcy5zZWFyY2g7Cmdsb2JhbFRoaXMuYWJQdWJsaXNoID0gbGlua3Muc3RvcmU7Ly9SRVBMQUNFRApnbG9iYWxUaGlzLmFiU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7CgppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsZXQgcHJldmlvdXNCb3RzID0gZ2V0Qm90cyhieU1vZCh7ICJzcGFjZSI6ICJzaGFyZWQiLCAiYWJDb3JlIjogbnVsbCB9KSk7CgogICAgaWYgKHByZXZpb3VzQm90cykKICAgIHsKICAgICAgICBkZXN0cm95KHByZXZpb3VzQm90cyk7CiAgICB9Cn0KCgppZiAoaW5pdGlhbEJvb3QgJiYgYm9vdEZsYWcpCnsKICAgIGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKLy9VVUFCCi8vYm90LnZhcnMKCi8vIGlmIChhdXRvQUIpCi8vIHsKLy8gICAgIGxldCBlZ2dEYXRhID0gYXdhaXQgbGlua3Muc3RvcmUuYWJSZXRyaWV2ZVJlY29yZChhdXRvQUIpOwoKLy8gICAgIGNvbnNvbGUubG9nKGVnZ0RhdGEpOwovLyB9CgppZiAoaW5zdE1vZGVDaGVjayA9PSAiYnVpbGRlciIpCnsKICAgIGxldCBzdXBwb3J0c0FSID0gb3MuZGV2aWNlKCkuc3VwcG9ydHNBUjsKICAgIGxldCBzdXBwb3J0c1ZSID0gb3MuZGV2aWNlKCkuc3VwcG9ydHNWUjsKCiAgICBpZiAoc3VwcG9ydHNBUiB8fCBzdXBwb3J0c1ZSIHx8IGNvbmZpZ0JvdC50YWdzLmRldlZSKQogICAgewogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJJbW1lcnNpdmUiKTsKICAgICAgICAKICAgICAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gImltbWVyc2UiOwogICAgfQoKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlID0gdHJ1ZTsKCiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiSW50ZXJmYWNlIik7CgogICAgaWYgKGluaXRpYWxCb290ICYmICFib290RmxhZykKICAgIHsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCwgcG9zaXRpb246e3g6MCx5OjB9fSk7CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gdXVpZCgpOwoKICAgICAgICBpZiAoIXN1cHBvcnRzQVIgJiYgIXN1cHBvcnRzVlIgJiYgIWNvbmZpZ0JvdC50YWdzLmRldlZSKQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWVudS5hYkluaXRpYWxCb290TWVudSgpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYgKGluaXRpYWxCb290KQogICAgewogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gYm9vdEZsYWc7CiAgICB9Cn0KCmlmIChpbml0aWFsQm9vdCkKewogICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IGZhbHNlOwp9Cgphd2FpdCBvcy5zbGVlcCg1MDApOwoKc2hvdXQoIm9uQUJJbml0aWFsaXplZCIpOygAnPDclQ//GAZhYkNvcmUBeCcAnPDclQ//GAdhYkFkYXB0AgQAnPDclQ/KKOsFQGNvbnN0IHN5c3RlbUlEID0gdGhhdDsKY29uc3QgYm9vdFN0cmFwID0gb3MuZ2V0QUIxQm9vdHN0cmFwVVJMKCkKY29uc3Qgc2tpbGxGaWxlID0gYm9vdFN0cmFwLnNsaWNlKDAsIGJvb3RTdHJhcC5sZW5ndGgtNykgKyBzeXN0ZW1JRCArIi5hdXgiOwoKdHJ5CnsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7CiAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICB1cmw6IHNraWxsRmlsZQogICAgfSk7CgogICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1thYiBib290c3RyYXBdIENvdWxkIG5vdCBkb3dubG9hZCBza2lsbC4nKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXModXBkYXRlcyk7CiAgICBjb25zdCBpZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CiAgICAKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKCiAgICB3aGlzcGVyKGlkcywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgLy9hYi5sb2coImFiIGFkYXB0Iik7CiAgICBjb25zb2xlLmxvZygiYWIgYWRhcHQiKTsKCiAgICByZXR1cm4gdHJ1ZTsKfQpjYXRjaAp7CiAgICBjb25zb2xlLmxvZygnW2FiIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwp9JwCc8NyVD/8YC2Rlc2NyaXB0aW9uAgQAnPDclQ+2Lk9UaGlzIHNraWxsIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBib3RoIHJlY29uZmlndXJhdGlvbiBvZiBhYiBhbmQgaW5pdGlhbGl6YXRpb24uJwCc8NyVD/8YCm9uQm90QWRkZWQCBACc8NyVD4YvRkBjb25zb2xlLmxvZygiYWIgU1RBUlQgVVAiKTsKCnNldFRpbWVvdXQoKCkgPT4gdGhpc0JvdC5hYkJvb3QoKSwgNTAwKTsnAJzw3JUP/xgIcmVtZW1iZXICBACc8NyVD80vKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJzw3JUP/xgDbG9nAgQAnPDclQ/0L5ABQGxldCB1cGRhdGVkTG9nczsKCmlmICghdGFncy5hYkxvZykKewogICAgdXBkYXRlZExvZ3MgPSB0aGF0Owp9CmVsc2UKewogICAgdXBkYXRlZExvZ3MgPSB0YWdzLmFiTG9nICsgIlxuIiArIHRoYXQ7Cn0KCm1hc2tzLmFiTG9nID0gdXBkYXRlZExvZ3M7JwCc8NyVD/8YDW1hbmlmZXN0YXRpb24CBACc8NyVD4UxKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAJzw3JUP/xgMYWJDcmVhdGVIb3N0AgQAnPDclQ+sMeMHQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgb3MudG9hc3QoImNvZGUgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgpsZXQgbmV3SG9zdElEID0gdXVpZCgpLnJlcGxhY2VBbGwoIi0iLCAiIikuc3Vic3RyaW5nKDAsNik7CmxldCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKbGV0IHJlY29yZEtleSA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgImIyMDdhNWU0LWQ1MzEtNDg0Zi1hMGQ2LTY2MjZiZWY1OTAxMyIsICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKbGV0IHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleS5kYXRhLCBuZXdIb3N0SUQsIHt1cmw6IGNvbmZpZ0JvdC50YWdzLnVybCwgZGF0ZTogZGF0ZX0sICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKCmlmIChyZWNvcmREYXRhLnN1Y2Nlc3MpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpOwoKICAgIHRoYXQudGFncy5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpOwoKICAgIG9zLnRvYXN0KCJob3N0IGdlbmVyYXRlZCwgY29kZSBjb3BpZWQgdG8gY2xpcGJvYXJkOiAiICsgbmV3SG9zdElEKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0nAJzw3JUP/xgKYWJKb2luSG9zdAIEAJzw3JUPkDmeBkBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGpvaW5Db2RlID0gdGhhdC50ZXh0LnJlcGxhY2VBbGwoIi0iLCAiIik7CmxldCByZWNvcmRLZXkgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksICJiMjA3YTVlNC1kNTMxLTQ4NGYtYTBkNi02NjI2YmVmNTkwMTMiLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CmxldCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleS5kYXRhLCBqb2luQ29kZSwgImh0dHBzOi8vcHVibGljb3MubGluay8iKTsKCmlmIChnZXRSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IGRhdGUgPSBEYXRlVGltZS5ub3coKTsKICAgIGxldCBjcmVhdGVEYXRlID0gRGF0ZVRpbWUuZnJvbU1pbGxpcyhnZXRSZWNvcmQuZGF0YS5kYXRlKTsKICAgIGxldCBkaWZmZXJlbmNlID0gZGF0ZS5kaWZmKGNyZWF0ZURhdGUsICJkYXlzIikudG9PYmplY3QoKTsKCiAgICBkaWZmZXJlbmNlID0gTWF0aC5mbG9vcihkaWZmZXJlbmNlLmRheXMpOwoKICAgIGlmIChkaWZmZXJlbmNlIDwgOCkKICAgIHsKICAgICAgICBvcy50b2FzdCgiam9pbmluZyBob3N0IG5vdyIpOwogICAgCiAgICAgICAgb3MuZ29Ub1VSTChnZXRSZWNvcmQuZGF0YS51cmwpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luIGNvZGUgb3V0IG9mIGRhdGUsIHBsZWFzZSBnZW5lcmF0ZSBhIG5ldyBqb2luIGNvZGUiKTsKICAgIH0KfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjb2RlL2FiIGludmFsaWQsIHBsZWFzZSB0cnkgYWdhaW4iKTsKfScAnPDclQ//GAZzZWFyY2gCBACc8NyVD68/KPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAJzw3JUP/xgIYWJJZ25vcmUCBACc8NyVD9Y/BHRydWUoAJzw3JUP/xgMYWJCb3RWZXJzaW9uAX0vJwCc8NyVD/8YBG1lbnUCBACc8NyVD9w/KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAJzw3JUPg0AGc3lzdGVtAgQAnPDclQ+EQA1hYi5jb3JlLnN0b3JlKACc8NyVD4NABmFiQ29yZQF4JwCc8NyVD4NABGZvcm0CBACc8NyVD5NAB25vdGhpbmcnAJzw3JUPg0ALZGVzY3JpcHRpb24CBACc8NyVD5tAP1RoaXMgc2tpbGwgaXMgbWVhbnQgdG8gYmUgYSBjb25maWd1cmFibGUgbWVhbnMgdG8gcHVibGlzaCBkYXRhLicAnPDclQ+DQA9hYlB1Ymxpc2hSZWNvcmQCBACc8NyVD9tAgwJAbGV0IHJlY29yZERhdGEgPSB0aGF0LmRhdGE7CmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwoKaWYgKCFyZWNvcmREYXRhKQp7CiAgICByZXR1cm4gIm5vIGRhdGEgc3VwcGxpZWQiOwp9CgpyZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmREYXRhLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKcmV0dXJuIHJlY29yZERhdGE7JwCc8NyVD4NADWFiUHVibGlzaEZpbGUCBACc8NyVD99CgwNAbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleSA/IHRoYXQucmVjb3JkS2V5IDogbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CgpyZXR1cm4gZmlsZVVwbG9hZDsnAJzw3JUPg0AQYWJDb3JlTWVudUFjdGlvbgIEAJzw3JUP40UXQHRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAJzw3JUPg0ALb25TdG9yZU1lbnUCBACc8NyVD/tF4jlAbGV0IHBvc3NpYmxlUHVibGlzaEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxpbmtzLm1lbnUubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKY29uc3QgdXVhYiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudXVhYiA/IHRydWUgOiBmYWxzZTsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gImRvd25sb2FkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJnZXRfYXBwIjsKbWVudUJ1dHRvbi5jb2xvciA9ICIjNTVFNjc5IjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiRG93bmxvYWQoKTtgOwoKLy9jcmVhdGUgZG93bmxvYWQgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnBvaW50YWJsZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gbnVsbDsKICAgIG1lbnVCdXR0b24uc2NhbGVZID0gMC43NTsKICAgIAogICAgLy9jcmVhdGUgcHVibGlzaCBsYWJlbCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uZGltZW5zaW9uID0gImFiTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAtMTsKICAgIG1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSAiYXV0b21hdGljIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveCI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImF1dG9tYXRpYyB2ZXJzaW9uIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgaWYodGFncy5idXR0b25TdGF0ZSA9PSAnYXV0b21hdGljJykKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnbWFudWFsJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5idXR0b25TdGF0ZSA9ICdhdXRvbWF0aWMnOwogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ2F1dG9tYXRpYyB2ZXJzaW9uJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7CiAgICAgICAgfWA7CgogICAgLy9jcmVhdGUgdmVyc2lvbiBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgptZW51QnV0dG9uLmRpbWVuc2lvbiA9IG51bGw7Cm1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDI7Cm1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSBudWxsOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImVnZyI7CgppZiAodXVhYikKewogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gdHJ1ZTsKCiAgICAgICAgICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CgogICAgICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNjYW4geW91ciBwcmFjdGljZSBwZXJtaXQiKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJxciBjb2RlIHNjYW4gbm90IHN1cHBvcnRlZCBvbiB0aGlzIGRldmljZSIpOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICBgOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCIDogbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cy5pZDsKICAgIG1lbnVCdXR0b24udGFyZ2V0Qm90ID0gZ2V0TGluayhwb3NzaWJsZVB1Ymxpc2hCb3QpOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICAgICAgewogICAgICAgICAgICB0aGF0LnRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRleHQpCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiUHVibGlzaEFCKHthYjogdGhhdC50ZXh0LCBtYW51YWxQdWJsaXNoOiB0cnVlLCBib3Q6IGxpbmtzLnRhcmdldEJvdH0pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgiYWIgbm90IHNwZWNpZmllZCIpOwoKICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgIGxldCBzdGF0ZSA9IHt9CgogICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgYDsKICAgIAogICAgLy9jcmVhdGUgIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSB0cnVlOyBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpO2A7CgogICAgLy9jcmVhdGUgIHNjYW4gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCiAgICAvL05FRUQgVE8gVVBEQVRFCiAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ2lnKQogICAgewogICAgICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gLTU7CiAgICAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJDb2xsYWJTdWJtaXQiKTtgOwoKICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKICAgIH0KfQoKbGV0IGhvc3RCdXR0b24gPSB7fTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKTsKfQplbHNlCnsKICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiZ2VuZXJhdGUgam9pbiBjb2RlIjsKfQoKaG9zdEJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpob3N0QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDUwOwpob3N0QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cmhvc3RCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ3JvdXBfYWRkIjsKaG9zdEJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKaG9zdEJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cmhvc3RCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpob3N0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicAnPDclQ+DQA5hYkNvcmVNZW51SWNvbgIEAJzw3JUPzn8JaW9zX3NoYXJlJwCc8NyVD4NAD2FiQ29yZU1lbnVMYWJlbAIEAJzw3JUP2H8Fc2hhcmUnAJzw3JUPg0ATYWJDb3JlTWVudVNvcnRPcmRlcgIEAJzw3JUP3n8BMycAnPDclQ+DQAhyZW1lbWJlcgIEAJzw3JUP4H8o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAnPDclQ+DQAthYlB1Ymxpc2hBQgIEAJzw3JUPh4ABkidALy9zaG91dCgiYWJQdWJsaXNoQUIiLCB7YWI6ICIiLCBrZXk6ICIiLCB0YXJnZXQ6ICIifSk7CmFiLmxvZygiYWIgcHVibGlzaCIpOwoKbGV0IHByb2dyZXNzQnV0dG9uOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCiAgICBsZXQgbWVudUJ1dHRvbiA9IHt9OwoKICAgIG1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgIG1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKICAgIG1lbnVCdXR0b24ub25DcmVhdGUgPSBgQAogICAgaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKICAgIG1lbnVCdXR0b24ubGFiZWwwID0gInVwbG9hZGluZy4iOwogICAgbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwogICAgbWVudUJ1dHRvbi5sYWJlbDIgPSAidXBsb2FkaW5nLi4uIjsKICAgIG1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwogICAgbWVudUJ1dHRvbi5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKICAgIHByb2dyZXNzQnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KCmxldCBhYklEID0gdGhhdC5hYjsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgdGFyZ2V0ID0gdGhhdC50YXJnZXQ7CmxldCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpsZXQgc3RhdGUgPSB7fTsKbGV0IGZvcm1hdHRlZEZpbGUgPSB7fTsKCmlmICghQXJyYXkuaXNBcnJheSh0aGF0LmJvdCkpCnsKICAgIHRhcmdldCA9IHRoYXQuYm90Owp9CmVsc2UgaWYgKCF0YXJnZXQpCnsKICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSk7CgogICAgaWYgKHRhcmdldC5sZW5ndGggPCAxKQogICAgewogICAgICAgIG9zLnRvYXN0KCJObyBib3RzIGZvdW5kIHRvIHB1Ymxpc2giKTsKCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSkgCnsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGN1cnJlbnRCb3RJRCA9IHRhcmdldFtpXS5pZDsKICAgICAgICBsZXQgY3VycmVudEJvdCA9IHRhcmdldFtpXTsKICAgICAgICAKICAgICAgICBzdGF0ZVtjdXJyZW50Qm90SURdID0gY3VycmVudEJvdDsKICAgIH0KfQplbHNlIAp7CiAgICBzdGF0ZVt0YXJnZXQuaWRdID0gdGFyZ2V0Owp9CgpsZXQgZWdnQ2hlY2sgPSBhd2FpdCB0aGlzQm90LmFiUHJldmlvdXNFZ2dDaGVjayh7YWJJRDogYWJJRH0pOwoKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCmxldCBwdWJsaXNoRmlsZSA9IGF3YWl0IHRoaXNCb3QuYWJQdWJsaXNoRmlsZSh7ZmlsZTogZm9ybWF0dGVkRmlsZSwgZmlsZU5hbWU6IGFiSUR9KTsKCmVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkucHVzaChwdWJsaXNoRmlsZS51cmwpOwplZ2dDaGVjay5lZ2dEYXRhLm1heFZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKZWdnQ2hlY2suZWdnRGF0YS50YXJnZXRWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CgpsZXQgcHVibGlzaFJlY29yZCA9IGF3YWl0IHRoaXNCb3QuYWJQdWJsaXNoUmVjb3JkKHtkYXRhOiBlZ2dDaGVjay5lZ2dEYXRhLCByZWNvcmROYW1lOiBhYklEfSk7CmxldCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKCnNob3V0KCJvbkFCUHVibGlzaGVkIiwge3N1Y2Nlc3M6IHB1Ymxpc2hGaWxlLnN1Y2Nlc3MsIGFiOiBhYklELCBmaWxlQWRkcmVzczogcHVibGlzaEZpbGUudXJsfSkKCmlmIChwdWJsaXNoUmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCBnaWdBQiA9IGNvbmZpZ0JvdC50YWdzLmFiIHx8IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkIHx8IGNvbmZpZ0JvdC50YWdzLmF1eENvZGU7CiAgICBsZXQgZ2lnS2V5ID0gZ2lnQUIgPyBnaWdBQi5zdWJzdHJpbmcoNykgOiAibm9uZSI7CiAgICBsZXQgZ2lnRm9ybWF0ID0gImNvbGxhYl8iOwogICAgbGV0IGdpZ0Zvcm1hdENoZWNrID0gYWJJRC5pbmNsdWRlcyhnaWdGb3JtYXQpOwoKICAgIGlmIChnaWdGb3JtYXRDaGVjayAmJiBrZXkgPT0gZ2lnS2V5ICYmIGtleSkgCiAgICB7CiAgICAgICAgbGV0IGNvbGxhYlVSTCA9IHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCArICIma2V5PSIgKyBrZXk7CgogICAgICAgIHNob3V0KCJhYlN1Ym1pdENvbGxhYiIsIHsgdXJsOiBjb2xsYWJVUkwgfSkKICAgIH0KICAgIGVsc2UgaWYgKGtleSAmJiBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKSAKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEICsgIiZrZXk9IiArIGtleSk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEKTsKCiAgICAgICAgb3MudG9hc3QoInVybCBjb3BpZWQgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgaWYgKGtleSkgCiAgICB7CiAgICAgICAgd2ViaG9vay5wb3N0KCJodHRwczovL3FuaGNhMnM3aWMuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc2xhY2svVDAyOUFQNENRL0IwMUtOVEI4MjAxL2dDT1BscVFIc1JQM3RCSzlQWUhKQm1OcCIsIHsgInRleHQiOiBgUFJJVkFURSAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICB3ZWJob29rLnBvc3QoImh0dHBzOi8vcW5oY2EyczdpYy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9zbGFjay9UMDI5QVA0Q1EvQjAxS05UQjgyMDEvZ0NPUGxxUUhzUlAzdEJLOVBZSEpCbU5wIiwgeyAidGV4dCI6IGAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQoKICAgIHRyeSAKICAgIHsKICAgICAgICBhd2FpdCBhbmFseXRpY3MucmVjb3JkRXZlbnQoJ2FiX2VnZ19wdWJsaXNoJywgeyBhYjogYWJJRCwgdmVyc2lvbjogZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGggfSk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICB9Cn0KZWxzZQp7CiAgICBjb25zb2xlLmxvZyhwdWJsaXNoUmVjb3JkKTsKfQoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IG51bGw7CgpyZXR1cm4gcHVibGlzaFJlY29yZDsnAJzw3JUPg0AIYWJJZ25vcmUCBACc8NyVD5qnAQR0cnVlJwCc8NyVD4NACmFiRG93bmxvYWQCBACc8NyVD5+nAZQDQGxldCBkb3dubG9hZEJvdHM7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKewogICAgZG93bmxvYWRCb3RzID0gW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXNdOwoKICAgIGFiLmxvZygiZG93bmxvYWRpbmcgYm90Iik7Cn0KZWxzZQp7CiAgICBkb3dubG9hZEJvdHMgPSBnZXRCb3RzKGJ5TW9kKHsiYWJJZ25vcmUiOiBudWxsLCAic3BhY2UiOiAic2hhcmVkIn0pKTsKCiAgICBhYi5sb2coImRvd25sb2FkaW5nIGluc3QiKTsKfQoKbGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKCm9zLmRvd25sb2FkQm90cyhkb3dubG9hZEJvdHMsIGN1cnJlbnRJbnN0KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsnAJzw3JUPg0ANbWFuaWZlc3RhdGlvbgIEAJzw3JUPtKoBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAJzw3JUPg0AEbWVudQIEAJzw3JUP26oBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAJzw3JUPg0ASYWJQcmV2aW91c0VnZ0NoZWNrAgQAnPDclQ+CqwGEDUBjb25zdCBhYklEID0gdGhhdC5hYklEOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCByZWNvcmRMb29rdXAgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFiSUQsICJodHRwczovL3B1YmxpY29zLmxpbmsvIikuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBtYXhWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9IAplbHNlIAp7CiAgICBlZ2dIaXN0b3J5ID0gW107CiAgICBlZ2dJRCA9IHV1aWQoKTsKICAgIHRhcmdldFZlcnNpb25OdW0gPSAxOwogICAgbGFzdEhhc2ggPSAibm9uZSI7CiAgICBtYXhWZXJzaW9uTnVtID0gMTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkKSAKewogICAgY29uc3QgZGVmaW5lZFZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQobWF4VmVyc2lvbk51bSwgewogICAgICAgIHRpdGxlOiAnc2V0IGRlZmF1bHQgdmVyc2lvbicsCiAgICAgICAgcGxhY2Vob2xkZXI6IGAxIHRvICR7bWF4VmVyc2lvbk51bX0gKGxlYXZlIGFzICR7bWF4VmVyc2lvbk51bX0gZm9yIGxhdGVzdClgCiAgICB9KTsKCiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZGVmaW5lZFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbikgCnsKICAgIHRhcmdldFZlcnNpb25OdW0gPSBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uOwogICAgY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG51bGw7Cn0KCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLmFiSUQgPSBhYklEOwoKbGV0IHNpZ25hdHVyZSA9IHt9OwpsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CmxldCB0aW1lID0gZGF0ZS5nZXRUaW1lKCk7CgpzaWduYXR1cmUucHJldmlvdXNIYXNoID0gbGFzdEhhc2g7CnNpZ25hdHVyZS5hYlZlcnNpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZVZlcnNpb24rIi4iK2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlSXRlcmF0aW9uOwpzaWduYXR1cmUuZWdnVmVyc2lvbiA9IHRhZ3MuZWdnVVVJRDsKc2lnbmF0dXJlLmVnZ1ZlcnNpb25OdW0gPSB0YWdzLm92b1ZlcnNpb247CnNpZ25hdHVyZS50aW1lU3RhbXAgPSB0aW1lOwpzaWduYXR1cmUuY2FzdWFsT1NWZXJzaW9uID0gW29zLnZlcnNpb24oKV07CgpyZXR1cm4ge3NpZ25hdHVyZTogc2lnbmF0dXJlLCBlZ2dEYXRhOiBlZ2d9OygAnPDclQ+DQAxhYkJvdFZlcnNpb24BfS8nAJzw3JUPg0APYWJCb3RNZW51QWN0aW9uAgQAnPDclQ+IuAEXQHRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAJzw3JUPg0AOYWJCb3RNZW51TGFiZWwCBACc8NyVD6C4AQVzaGFyZScAnPDclQ+DQA1hYkJvdE1lbnVJY29uAgQAnPDclQ+muAEJaW9zX3NoYXJlJwCc8NyVD4NAEmFiQm90TWVudVNvcnRPcmRlcgIEAJzw3JUPsLgBATMnAJzw3JUPg0AFbGVhcm4CBACc8NyVD7K4ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCc8NyVD4NADWFiUHVibGlzaFVVQUICBACc8NyVD9m4AecPQGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKCmxldCB1dWFiQ29uZmlnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy51dWFiLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxldCBwaW4gPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCx7CiAgICB0aXRsZTogImVudGVyIHBpbiIsCiAgICB0eXBlOiAic2VjcmV0Igp9KTsKCmlmIChwaW4pCnsKICAgIGxldCBwaCA9IGNyeXB0by5zaGEyNTYocGluKS5zdWJzdHJpbmcoMCw0KTsKCiAgICBpZiAocGggPT0gY29uZmlnQm90LnRhZ3MucGgpCiAgICB7CiAgICAgICAgbGV0IHJlY29yZEtleTsKICAgICAgICBsZXQgZWdnRGF0YUNoZWNrOwogICAgICAgIGxldCBlZ2dEYXRhOwoKICAgICAgICBmb3IgKHRhZyBpbiB1dWFiQ29uZmlnLnN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRhZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVjb3JkS2V5ID0gdXVhYkNvbmZpZy5zdGF0ZVt0YWddLnRhZ3MucmVjb3JkS2V5OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdCkKICAgICAgICB7CiAgICAgICAgICAgIGVnZ0RhdGFDaGVjayA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKCiAgICAgICAgICAgIGlmIChlZ2dEYXRhQ2hlY2suc3VjY2VzcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gSlNPTi5wYXJzZShlZ2dEYXRhQ2hlY2suZGF0YS5lZ2dzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZ2dEYXRhLmxlbmd0aCA+PSAxMikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MudG9hc3QoInByYWN0aWNlIHBlcm1pdCBmdWxsIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVnZyBkYXRhIG5vdCByZWFkYWJsZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiUmVjb3JkS2V5ID0gcmVjb3JkS2V5OwoKICAgICAgICBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gdHJ1ZTsKCiAgICAgICAgdGhpc0JvdC5hYlB1Ymxpc2hBQih7YWI6IGNvbmZpZ0JvdC50YWdzLmFiLCBrZXk6IGNvbmZpZ0JvdC50YWdzLmtleX0pOwoKICAgICAgICBlZ2dEYXRhLnB1c2goY29uZmlnQm90LnRhZ3MuYWIpOwoKICAgICAgICBlZ2dEYXRhVG9QdWJsaXNoID0ge2VnZ3M6IEpTT04uc3RyaW5naWZ5KGVnZ0RhdGEpfTsKCiAgICAgICAgYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBlZ2dEYXRhVG9QdWJsaXNoLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGF3YWl0IG9zLnRvYXN0KCJwaW4gZG9lcyBub3QgbWF0Y2giLCAyKTsKCiAgICAgICAgc2hvdXQoImFiUmVmcmVzaCIpOwogICAgfQp9CmVsc2UKewogICAgYXdhaXQgb3MudG9hc3QoIm5vIHBpbiBnaXZlbiIsIDIpOwoKICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICByZXR1cm4KfScAnPDclQ+DQAthYlFSUHVibGlzaAIEAJzw3JUPwcgB7wRAY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSBudWxsOwoKbGV0IHNjYW5uZWRVUkw7Cgp0cnkgCnsKICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwp9CmNhdGNoIChlKSB7CiAgICBzaG91dCgiYWJQdWJsaXNoQUIiLCB7YWI6IHRoYXR9KTsKCiAgICB0aGlzQm90LmFiUHVibGlzaEFCKHthYjogdGhhdH0pOwoKICAgIHJldHVybjsKfQoKaWYgKHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKSkgCnsKICAgIGxldCB0YXJnZXRSZWNvcmQgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImluc3QiKTsKCiAgICBjb25maWdCb3QudGFncy51dWFiID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhYiIpOwogICAgY29uZmlnQm90LnRhZ3MucGggPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIik7CiAgICBjb25maWdCb3QudGFncy5hYiA9IHV1aWQoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmtleSA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKCiAgICB0aGlzQm90LmFiUHVibGlzaFVVQUIoe3RhcmdldFJlY29yZDogdGFyZ2V0UmVjb3JkfSk7Cn0KZWxzZSAKewogICAgb3MudG9hc3QoInVuc3VwcG9ydGVkIHVybCBmb3JtYXQiKTsKfScAnPDclQ+DQAZzZWFyY2gCBACc8NyVD7HNASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwCc8NyVD9jNAQZzeXN0ZW0CBACc8NyVD9nNAQ5hYi5jb3JlLnNlYXJjaCcAnPDclQ/YzQEEZm9ybQIEAJzw3JUP6M0BB25vdGhpbmcnAJzw3JUP2M0BBmFiQ29yZQIEAJzw3JUP8M0BBHRydWUnAJzw3JUP2M0BDmFiUmV0cmlldmVGaWxlAgQAnPDclQ/1zQFsQGlmICghdGhhdC51cmwpCnsKICAgIHJldHVybiAibm8gZmlsZSB1cmwgc3VwcGxpZWQiOwp9CgpsZXQgZGF0YSA9IGF3YWl0IG9zLmdldEZpbGUodGhhdC51cmwpOwoKcmV0dXJuIGRhdGE7JwCc8NyVD9jNARBhYlJldHJpZXZlUmVjb3JkAgQAnPDclQ/izgHoAkBsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8gdGhhdC5yZWNvcmRLZXkgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwpsZXQgcmVjb3JkRW5kcG9pbnQgPSB0aGF0LnJlY29yZEVuZHBvaW50ID8gdGhhdC5yZWNvcmRFbmRwb2ludCA6ICJodHRwczovL3B1YmxpY29zLmxpbmsiOwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgpyZXR1cm4gZ2V0UmVjb3JkOycAnPDclQ/YzQEIcmVtZW1iZXICBACc8NyVD8vRASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCc8NyVD9jNAQ1tYW5pZmVzdGF0aW9uAgQAnPDclQ/y0QEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAnPDclQ/YzQEOb25Mb29rdXBBQkVnZ3MCBACc8NyVD5nSAfAbQC8vc2hvdXQoIm9uTG9va3VwQUJFZ2dzIiwge2FiSUQ6IGFiSUQsIGtleToga2V5LCBhdXRvSGF0Y2g6IGJvb2xlYW4sIHJldHVyblR5cGU6IGRhdGEvbnVsbH0pOwphYi5sb2coImFiIGFiIGxvYWQgIiArIHRoYXQpOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwp9Cgpjb25zdCBhYklEID0gdGhhdC5hYklEOwpjb25zdCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmNvbnN0IGF1dG9IYXRjaCA9IHRoYXQuYXV0b0hhdGNoOwpjb25zdCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFiSUQsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CgpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgbmV3RWdnOwoKaWYgKCFnZXRSZWNvcmQuc3VjY2VzcyAmJiBjb25maWdCb3QudGFncy5naWcpLy9CUklORyBJTiBJTklUQUlBTCBDT0xMQUIgU0VUVVAKewogICAgbGV0IGNvbGxhYkJvdCA9IGdldEJvdCgiYWJJRE9yaWdpbiIsICJjb2xsYWJTZXR1cCIpOwoKICAgIGlmICghY29sbGFiQm90KQogICAgewogICAgICAgIHRoaXNCb3Qub25Mb29rdXBBQkVnZ3Moe2FiSUQ6ICJjb2xsYWJTZXR1cCIsIGF1dG9IYXRjaDogdHJ1ZX0pOwogICAgfQp9CmVsc2UgaWYgKCFnZXRSZWNvcmQuc3VjY2VzcykKewogICAgLy9NQVlCRSBSRU1PVkUgVEhJUyBTT09OPz8/CiAgICBjb25zb2xlLmxvZyhnZXRSZWNvcmQsICJjaGVja2luZyBvbGQgU1RNIik7CgogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoYWJJRCk7CiAgICBsZXQgZmlsZXVybGhhc2ggPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2ggKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0VVJMID0gImh0dHBzOi8vYnVpbGRlci1zdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2g7CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBsZXQgbHRtUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgICAgICBuZXdFZ2cgPSBsdG1SZXNwb25zZS5kYXRhLnN0YXRlOwoKICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIG5ld0VnZykKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IG5ld01PRCA9IG5ld0VnZ1twcm9wZXJ0eV07CgogICAgICAgICAgICBuZXdFZ2cgPSBuZXdNT0Q7CiAgICAgICAgfQogICAgfSAKICAgIGNhdGNoIChlKSAKICAgIHsKCiAgICAgICAgb3MudG9hc3QoYG5vIGRhdGEgZm91bmQgaW4gJHthYklEfWApOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gImFiSUQgbm90IGZvdW5kIjsKICAgIH0KfQplbHNlCnsKICAgIG5ld0VnZyA9IGdldFJlY29yZC5kYXRhOwp9CgppZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIgJiYgZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCB2ZXJzaW9uID0gZ2V0UmVjb3JkLmRhdGEudGFyZ2V0VmVyc2lvbiAtIDE7CgogICAgaWYgKHRoYXQuYWJWZXJzaW9uKQogICAgewogICAgICAgIGlmICghaXNOYU4odGhhdC5hYlZlcnNpb24pKQogICAgICAgIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHRoYXQuYWJWZXJzaW9uIC0gMTsKICAgICAgICB9CiAgICB9CgogICAgbGV0IGVnZ0RhdGFVUkwgPSBnZXRSZWNvcmQuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeVt2ZXJzaW9uXTsKICAgIGxldCByZXR1cm5EYXRhID0gYXdhaXQgb3MuZ2V0RmlsZShlZ2dEYXRhVVJMKTsKCiAgICByZXR1cm4gcmV0dXJuRGF0YTsKfQplbHNlIGlmIChyZXR1cm5UeXBlID09ICJkYXRhIikKewogICAgbGV0IHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2UobmV3RWdnLmVnZ1ZlcnNpb25IaXN0b3J5KTsKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtuZXdFZ2cubWF4VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaExUTSA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoTFRNID0gImF1eF8iICsgZmlsZW5hbWVoYXNoTFRNICsgJy5hdXgnOwogICAgbGV0IHRhcmdldExUTVVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoTFRNOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldExUTVVSTDsKCiAgICBmaWxlR2V0ID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9CgogICAgcmV0dXJuIGZpbGVHZXQ7Cn0KCmxldCBjdXJyZW50RGltOwpsZXQgc3BhY2VNb2Q7CmxldCBkaW1lbnNpb25YOwpsZXQgZGltZW5zaW9uWTsKbGV0IGRpbU1vZDsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBjb25zdCBhYkJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7CgogICAgICAgIGN1cnJlbnREaW0gPSBhYkJvdC50YWdzLmRpbWVuc2lvbjsKICAgIH0KfQplbHNlCnsKICAgIGN1cnJlbnREaW0gPSBvcy5nZXRDdXJyZW50RGltZW5zaW9uKCk7Cn0KCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CgogICAgY3VycmVudERpbSA9IGhhdGNoUG9pbnQuZGltZW5zaW9uOwogICAgZGltZW5zaW9uWCA9IGhhdGNoUG9pbnQucG9zaXRpb24ueDsKICAgIGRpbWVuc2lvblkgPSBoYXRjaFBvaW50LnBvc2l0aW9uLnk7CiAgICBzcGFjZU1vZCA9IHtzcGFjZTogInNoYXJlZCJ9Owp9CgppZiAoIWF1dG9IYXRjaCAmJiBjb25maWdCb3QudGFncy5hYiA9PSBudWxsKQp7CiAgICBkaW1Nb2QgPSB7W2N1cnJlbnREaW1dOiB0cnVlLCBbY3VycmVudERpbSsiWCJdOiBkaW1lbnNpb25YLCBbY3VycmVudERpbSsiWSJdOiBkaW1lbnNpb25ZLCBkaW1lbnNpb246IGN1cnJlbnREaW19Owp9CmVsc2UKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmtleSAmJiAhdGhhdC5rZXkpCiAgICB7CiAgICAgICAga2V5ID0gY29uZmlnQm90LnRhZ3Mua2V5CiAgICB9CgogICAgZGltTW9kID0ge2F1dG9IYXRjaDogdHJ1ZSwga2V5OiBrZXl9Owp9Cgp0aGlzQm90Lm1hbmlmZXN0T3ZvKHthYklEOiBhYklELCBkaW1Nb2Q6IGRpbU1vZCwgc3BhY2VNb2Q6IHNwYWNlTW9kLCBlZ2dEYXRhOiBuZXdFZ2csIGluaXRpYWxCb290OiBpbml0aWFsQm9vdH0pOycAnPDclQ/YzQELbWFuaWZlc3RPdm8CBACc8NyVD4ruAdMKQHNob3V0KCJhYk1lbnVSZXNldCIpOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCmlmIChsaW5rcy5vdm9Cb3QpCnsKICAgIGRlc3Ryb3kobGlua3Mub3ZvQm90KTsKfQoKbGV0IHNwYWNlTW9kID0gdGhhdC5zcGFjZU1vZDsKbGV0IGRpbU1vZCA9IHRoYXQuZGltTW9kOwpsZXQgZWdnRGF0YSA9IHRoYXQuZWdnRGF0YTsKbGV0IGVnZ01vZCA9IHt9OwoKZWdnTW9kLnNwYWNlID0gInRlbXBMb2NhbCI7CmVnZ01vZC5pbml0aWFsVGltZXIgPSB0cnVlOwplZ2dNb2QuYWJJRCA9IHRoYXQuYWJJRDsKZWdnTW9kLmluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKZWdnTW9kLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNb2Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIuaW50ZXJhY3RPdm8oKTtgOwplZ2dNb2Qub25DcmVhdGUgPSBgQCBpZiAodGFncy5hdXRvSGF0Y2gpCnsKICAgIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8odGhpc0JvdCk7Cn0KZWxzZQp7CiAgICB0YWdzLnByb2dyZXNzQmFyID0gMDsgCgogICAgc2V0VGltZW91dCgoKSA9PiB7d2hpc3Blcih0aGlzQm90LCAiZWdnVGltZXIiKTt9LCA3NSk7Cn1gOwplZ2dNb2QuZm9ybSA9ICJlZ2ciOwplZ2dNb2QucHJvZ3Jlc3NCYXJDb2xvciA9ICIjQkY1RTY2IjsKZWdnTW9kLnByb2dyZXNzQmFyQmFja2dyb3VuZENvbG9yID0gIiM1OTI5ODkiOwplZ2dNb2QubGFiZWxTaXplID0gMC41OwplZ2dNb2QubGFiZWxDb2xvciA9ICIjNDA0MDQwIjsKZWdnTW9kLm9uUG9pbnRlckVudGVyID0gIkAgb3MudG9hc3QodGFncy5hYklEICsgJyB2Jyt0YWdzLnRhcmdldFZlcnNpb24pOyI7CmVnZ01vZC5sYWJlbFBvc2l0aW9uID0gImZyb250IjsKZWdnTW9kLm9yaWVudGF0aW9uTW9kZSA9ICJiaWxsYm9hcmRGcm9udCI7CmVnZ01vZC5vbkRlc3Ryb3kgPSBgQCBsaW5rcy5tYW5hZ2VyLm1hc2tzLm92b0JvdCA9IG51bGw7YDsKZWdnTW9kLmVnZ1RpbWVyID0gYEAgaWYgKHRhZ3MucHJvZ3Jlc3NCYXIgPCAxKSAKewogICAgdGFncy5wcm9ncmVzc0JhciArPSAwLjE7CgogICAgc2V0VGltZW91dCgoKSA9PiB7d2hpc3Blcih0aGlzQm90LCAiZWdnVGltZXIiKTt9LCA3NSk7Cn0KZWxzZQp7CiAgICB0aGlzQm90Lm9uQ2xpY2soKTsKICAgIAogICAgdGFncy5wcm9ncmVzc0JhciA9IG51bGw7Cn1gOwoKbGV0IG92byA9IGNyZWF0ZShlZ2dEYXRhLCBlZ2dNb2QsIGRpbU1vZCwgc3BhY2VNb2QpOwoKbWFza3Mub3ZvQm90ID0gIvCflJciICsgb3ZvLmlkOycAnPDclQ/YzQEJb25LZXlEb3duAgQAnPDclQ/a+AGzBUBpZiAoIWxpbmtzLm92b0JvdCB8fCBjb25maWdCb3QudGFncy5tZW51UG9ydGFsICE9ICJvdm8iKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gIlNoaWZ0IikKewogICAgbGV0IHZlcnNpb25CdXR0b24gPSB7fTsKCiAgICB2ZXJzaW9uQnV0dG9uLm92byA9IHRydWU7CiAgICB2ZXJzaW9uQnV0dG9uLm92b1NvcnRPcmRlciA9IC0xOwogICAgdmVyc2lvbkJ1dHRvbi5tYXhWZXJzaW9uID0gbGlua3Mub3ZvQm90LnRhZ3MubWF4VmVyc2lvbjsKICAgIHZlcnNpb25CdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CiAgICB2ZXJzaW9uQnV0dG9uLmxhYmVsID0gImNoYW5nZSBlZ2cgdmVyc2lvbiI7CiAgICB2ZXJzaW9uQnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICB2ZXJzaW9uQnV0dG9uLm92b01lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKICAgIHZlcnNpb25CdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uS2V5VXAgPSAiQCBpZih0aGF0LmtleXMgPT0gJ1NoaWZ0Jyl7ZGVzdHJveSh0aGlzQm90KX07IjsKICAgIHZlcnNpb25CdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuY2hhbmdlT3ZvVmVyc2lvbigpOyI7CgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24odmVyc2lvbkJ1dHRvbik7Cn0nAJzw3JUP2M0BCGhhdGNoT3ZvAgQAnPDclQ+M/gH2DEBzaG91dCgnb3ZvTWVudVJlc2V0Jyk7Cgpjb25zdCBvdm8gPSB0aGF0OwoKbGV0IGluaXRpYWxCb290ID0gb3ZvLnRhZ3MuaW5pdGlhbEJvb3Q7CmxldCB0YXJnZXRWZXJzaW9uID0gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uICYmIGNvbmZpZ0JvdC50YWdzLmFiID09IG92by50YWdzLmFiSUQgPyBjb25maWdCb3QudGFncy5hYlZlcnNpb24gOiBvdm8udGFncy50YXJnZXRWZXJzaW9uOwpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7Cgp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZygiY2hlY2tpbmcgb2xkIExUTSIsIGVycm9yKTsKCiAgICB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5KTsKCiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbb3ZvLnRhZ3MudGFyZ2V0VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoID0gImF1eF8iICsgZmlsZW5hbWVoYXNoICsgJy5hdXgnOwogICAgbGV0IHRhcmdldFVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoOwogICAgbGV0IG8gPSB7fTsKICAgIAogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChmaWxlR2V0LnN0YXR1cyAhPSAyMDApCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9Cn0KCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKZGVzdHJveShvdm8pOwoKbGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7Ym90czogZmlsZUdldCwgb3JpZ2luOiBvdm8udGFncy5hYklELCB2ZXJzaW9uOiB0YXJnZXRWZXJzaW9uLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAJzw3JUP2M0BC2ludGVyYWN0T3ZvAgQAnPDclQ+DiwL6BkBjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm92byI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24ub3ZvID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24udGFyZ2V0VmVyc2lvbiA9IG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWwgPSAiaGF0Y2ggIiArIG92b0JvdC50YWdzLmFiSUQgKyAiIHYiICsgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92b0JvdC50YWdzLm1heFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKZWdnTWVudUJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmVnZ01lbnVCdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CmVnZ01lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8obGlua3Mub3ZvQm90KTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oZWdnTWVudUJ1dHRvbik7JwCc8NyVD9jNAQZjcmVhdGUCBACc8NyVD/qRAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwCc8NyVD9jNAQthYkxUTVNlYXJjaAIEAJzw3JUPoZICHkB0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOycAnPDclQ/YzQEQY2hhbmdlT3ZvVmVyc2lvbgIEAJzw3JUPwJICkAJAY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQob3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG5ld1ZlcnNpb247Cm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycAnPDclQ/YzQEEbWVudQIEAJzw3JUP0ZQCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAJzw3JUP2M0BCGFiSWdub3JlAgQAnPDclQ/4lAIEdHJ1ZSgAnPDclQ/YzQEMYWJCb3RWZXJzaW9uAX0vJwEEYm90cyRlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcBJwCc8NyVD/6UAgZzeXN0ZW0CBACc8NyVD/+UAhBhYi5jb3JlLnJlbWVtYmVyJwCc8NyVD/6UAgRmb3JtAgQAnPDclQ+QlQIHbm90aGluZygAnPDclQ/+lAIGYWJDb3JlAXgoAJzw3JUP/pQCDGFiQXdha2VTdGF0ZQF4JwCc8NyVD/6UAgtkZXNjcmlwdGlvbgIEAJzw3JUPmpUCK1RoaXMgaXMgbWVhbnQgdG8gYmUgdGhlIGxvY2FsIHN0YXRlIGhvbGRlci4nAJzw3JUP/pQCC2FiUmVjb3JkS2V5AgQAnPDclQ/GlQIudlJLMS5ZV0l0TVE9PS5OSFpzVUd0b05tRkdZM0ZKZGpKVE1tczFORmxxVVQwOScAnPDclQ/+lAIRYWJBY3RpdmVEaW1lbnNpb24CBACc8NyVD/WVAgRob21lJwCc8NyVD/6UAgthYkJhc2VDb2xvcgIEAJzw3JUP+pUCByM5MDhCRkMoAJzw3JUP/pQCD2FiR3JpZFNuYXBTdGF0ZQF4KACc8NyVD/6UAg5hYkJvdFNuYXBTdGF0ZQF4JwCc8NyVD/6UAg1hYk1lbnVSZWZyZXNoAgQAnPDclQ+ElgIYQGNsZWFyVGFnTWFza3ModGhpc0JvdCk7KACc8NyVD/6UAgtpbml0aWFsQm9vdAF4JwCc8NyVD/6UAgphYkVuZHBvaW50AgQAnPDclQ+elgIWaHR0cHM6Ly9wdWJsaWNvcy5saW5rLycAnPDclQ/+lAIIYWJJZ25vcmUCBACc8NyVD7WWAgR0cnVlJwCc8NyVD/6UAg1hYkNvcmVWZXJzaW9uAgQAnPDclQ+6lgIBOSgAnPDclQ/+lAIMYWJCb3RWZXJzaW9uAX0vKACc8NyVD/6UAg9hYkNvcmVJdGVyYXRpb24BfS8nAJzw3JUP/pQCGWFiTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMCBACc8NyVD76WAgR0cnVlJwCc8NyVD/6UAgZiYXNlQUICBACc8NyVD8OWAiRjM2Q4NmJiZS1jZjgyLTQxMzYtYjNjZi02MzA4YjgxMGNlN2MnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnAJzw3JUP6JYCBnN5c3RlbQIEAJzw3JUP6ZYCDWFiLmNvcmUuaW5wdXQnAJzw3JUP6JYCBGZvcm0CBACc8NyVD/eWAgdub3RoaW5nJwCc8NyVD+iWAglvbktleURvd24CBACc8NyVD/+WAj9AaWYgKHRoYXQua2V5cyA9PSAiYCIgJiYgYnVpbGRlclZlcnNpb24pCnsKICAgIG9zLnNob3dDaGF0KCk7Cn0nAJzw3JUP6JYCBm9uQ2hhdAIEAJzw3JUPv5cC+RZAaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5tZXNzYWdlWzBdID09ICIuIikgCnsKICAgIG9zLmhpZGVDaGF0KCk7CgogICAgc3dpdGNoICh0aGF0Lm1lc3NhZ2UpCiAgICB7CiAgICAgICAgY2FzZSAnLmRvd25sb2FkQUInOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBhd2FpdCBvcy5zaG93SW5wdXQoImdyb3VwIik7CgogICAgICAgICAgICBpZiAoZ3JvdXAgPT0gImFiQ29yZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWJHcm91cCA9IGdldEJvdHMoZ3JvdXApOwoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhYkdyb3VwLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBhYkdyb3VwW2ldLnRhZ3MuYWJCb3RWZXJzaW9uKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90c0FzSW5pdGlhbHphdGlvblVwZGF0ZShhYkdyb3VwLCBncm91cCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5sb2FkU2tpbGxgOgogICAgICAgICAgICBsZXQgc2tpbGwgPSBhd2FpdCBvcy5zaG93SW5wdXQoInNraWxsIik7CgogICAgICAgICAgICBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC51cGxvYWRgOgogICAgICAgICAgICBvcy5zaG93VXBsb2FkQXV4RmlsZSgpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNsZWVwYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC4uYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkF3YWtlIiwgImFiTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkludGVyZmFjZSIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmxvZyc6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy50YWdQb3J0YWwgPT0gYWIuaWQgKyAiLmFiTG9nIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBhYi5pZCArICIuYWJMb2ciOwogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gInRlbXBMb2NhbCI7CgogICAgICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7CgogICAgICAgICAgICAgICAgb3Muc2hvd0NoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICcuaGlkZUxvZyc6CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKCiAgICAgICAgICAgIG9zLmhpZGVDaGF0KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwogICAgICAgICAgICBsZXQgZXhlY3V0YWJsZSA9IG1lc3NhZ2Uuc2xpY2UoMSk7CgogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3MucnVuKGV4ZWN1dGFibGUpOyAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB9CiAgICB9Cn0oAJzw3JUP6JYCBmFiQ29yZQF4JwCc8NyVD+iWAgtkZXNjcmlwdGlvbgIEAJzw3JUPuq4CQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicAnPDclQ/olgIMb25GaWxlVXBsb2FkAgQAnPDclQ/9rgLHFEBpZiAoIWJ1aWxkZXJWZXJzaW9uIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcyAhPT0gdHJ1ZSkKewogICAgcmV0dXJuOwp9CgpsZXQgZmlsZUV4dGVuc2lvbiA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykuc2hpZnQoKTsKbGV0IHNpemUgPSB0aGF0LmZpbGUuc2l6ZTsKbGV0IG1pbWVUeXBlOwpsZXQgYm90SW5mbyA9IHt9OwoKaWYgKHNpemUgPiAyMDAwMDAwMDApCnsKICBvcy50b2FzdCgibWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQgKDIwMCBtYikiKTsKCiAgcmV0dXJuOwp9Cgpzd2l0Y2goZmlsZUV4dGVuc2lvbikKewogIGNhc2UgJ2pwZyc6CiAgY2FzZSAnanBlZyc6CiAgY2FzZSAnd2VicCc6CiAgY2FzZSAnZ2lmJzoKICBjYXNlICdwbmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2UvIiArIGZpbGVFeHRlbnNpb247CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ3N2Zyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS9zdmcreG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnZ2xiJzoKICBjYXNlICdnbHRmJzoKICAgIG1pbWVUeXBlID0gInRleHQveG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJtZXNoIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAiZ2x0ZiI7CiAgICBicmVhazsKICBjYXNlICdhdXgnOgogIGNhc2UgJ3BkZic6CiAgICBsZXQgYm90RGF0YSA9IGZpbGVFeHRlbnNpb24gPT0gIi5hdXgiID8gSlNPTi5wYXJzZSh0aGF0LmZpbGUuZGF0YSkuc3RhdGUgOiBvcy5wYXJzZUJvdHNGcm9tRGF0YSh0aGF0LmZpbGUuZGF0YSk7CgogICAgbGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7Ym90czogYm90RGF0YSwgb3JpZ2luOiBmaWxlTmFtZX0pOwoKICAgIHJldHVybjsKLy8gICBjYXNlICdwZGYnOgovLyAgICAgYnJlYWs7CiAgY2FzZSAnbXAzJzoKICAgIG1pbWVUeXBlID0gJ2F1ZGlvL21wZWcnOwogICAgYm90SW5mby5vbkNsaWNrID0gIkAgb3MucGxheVNvdW5kKHRhZ3MuZm9ybUFkZHJlc3MpOyI7CiAgICBib3RJbmZvLmxhYmVsID0gIkNsaWNrIHRvIFBsYXkiOwogICAgYnJlYWs7CiAgY2FzZSAnbXA0JzoKICAgIG1pbWVUeXBlID0gJ3ZpZGVvL21wNCc7CiAgICBib3RJbmZvLmZvcm0gPSAiaWZyYW1lIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAic3JjIjsKICAgIGJyZWFrOwogIGRlZmF1bHQ6CiAgICBsZXQgcmVzdWx0ID0gbmV3IEVycm9yKCJ1bmhhbmRsZWQgZmlsZSB0eXBlOiAiICsgZmlsZUV4dGVuc2lvbik7CiAgICBvcy50b2FzdCgiZmlsZSB0eXBlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIGNvbnNvbGUud2FybihyZXN1bHQpCiAgICByZXR1cm4gcmVzdWx0Owp9Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHVwbG9hZFJlc3VsdDsKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi50cmFja051bSA9IC0xOwptZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7Cm1lbnVCdXR0b24ubGFiZWwwID0gInVwbG9hZGluZy4iOwptZW51QnV0dG9uLmxhYmVsMSA9ICJ1cGxvYWRpbmcuLiI7Cm1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7Cm1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7Cm1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7Cm1lbnVCdXR0b24ub25EZXN0cm95ID0gIkAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOyI7Cgpwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKdXBsb2FkUmVzdWx0ID0gYXdhaXQgbGlua3Muc3RvcmUuYWJQdWJsaXNoRmlsZSh7ZmlsZTogdGhhdC5maWxlLmRhdGEsIGZpbGVOYW1lOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSk7CgppZiAoT2JqZWN0LmtleXMoYm90SW5mbykubGVuZ3RoID4gMCkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmZvcm1BZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CgpyZXR1cm4gdXBsb2FkUmVzdWx0OycAnPDclQ/olgIFbGVhcm4CBACc8NyVD8XDAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCc8NyVD+iWAghyZW1lbWJlcgIEAJzw3JUP7MMCKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJzw3JUP6JYCDW1hbmlmZXN0YXRpb24CBACc8NyVD5PEAijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCc8NyVD+iWAghhYklnbm9yZQIEAJzw3JUPusQCBHRydWUoAJzw3JUP6JYCDGFiQm90VmVyc2lvbgF9LycAnPDclQ/olgIGY3JlYXRlAgQAnPDclQ/AxAIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAnPDclQ/olgIFc3RvcmUCBACc8NyVD+fEAijwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCc8NyVD+iWAgRtZW51AgQAnPDclQ+OxQIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgA="}]}