{"version":2,"updates":[{"id":0,"timestamp":1681329795730,"update":"Ad4BjLC8sQQAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwCMsLyxBAAGc3lzdGVtAgQAjLC8sQQBEmFiLTEuY29yZS5yZWd1bGF0ZScAjLC8sQQABGZvcm0CBACMsLyxBBQHbm90aGluZycAjLC8sQQAB2FiMUNvcmUCBACMsLyxBBwEdHJ1ZScAjLC8sQQADG9uQW55Qm90RHJhZwIEAIywvLEEIZQBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImZhY2UiKTsKfScAjLC8sQQACHJlbWVtYmVyAgQAjLC8sQS2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCMsLyxBAAJYWIxSWdub3JlAgQAjLC8sQTdAQR0cnVlKACMsLyxBAANYWIxQm90VmVyc2lvbgF9IycBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScAjLC8sQTjAQZzeXN0ZW0CBACMsLyxBOQBEGFiLTEuY29yZS5jcmVhdGUoAIywvLEE4wEHYWIxQ29yZQF4JwCMsLyxBOMBBGZvcm0CBACMsLyxBPYBB25vdGhpbmcnAIywvLEE4wELZGVzY3JpcHRpb24CBACMsLyxBP4BPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAIywvLEE4wENYWIxQ3JlYXRlQm90cwIEAIywvLEEvAKwFUAvL05FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmxldCBib3REYXRhID0gdGhhdC5ib3RzOwpsZXQgb3JpZ2luID0gdGhhdC5vcmlnaW47CmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107Cgpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYjFHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWIxR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiMUdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiMUdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWIxR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgpsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07Cgpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5hYjFTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgaWYgKCFwcmVoYXRjaCkgCiAgICB7CiAgICAgICAgYWIxSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9Cgp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycAjLC8sQTjAQhyZW1lbWJlcgIEAIywvLEE7Rco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjLC8sQTjAQlvbkFiQWRkZWQCBACMsLyxBJQYSkAvL05FRUQgVE8gSU1QTEVNRU5UCi8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwCMsLyxBOMBCWFiMUlnbm9yZQIEAIywvLEE3xgEdHJ1ZSgAjLC8sQTjAQ1hYjFCb3RWZXJzaW9uAX0jJwEEYm90cyQ2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcBJwCMsLyxBOUYBnN5c3RlbQIEAIywvLEE5hgPYWItMS5jb3JlLmxlYXJuJwCMsLyxBOUYBWFiMUlEAgQAjLC8sQT2GAVsZWFybicAjLC8sQTlGARmb3JtAgQAjLC8sQT8GAdub3RoaW5nJwCMsLyxBOUYB2FiMUJvb3QCBACMsLyxBIQZzw5AbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiMUluc3RNZW1vcnkgPSBsaW5rcy5yZW1lbWJlcjsvL1JFUExBQ0VECmdsb2JhbFRoaXMuYWIxUmVtZW1iZXIgPSBsaW5rcy5yZW1lbWJlcjsKZ2xvYmFsVGhpcy5hYjFMb25nVGVybU1lbW9yeVNlYXJjaCA9IGxpbmtzLnNlYXJjaDsvL1JFUExBQ0VECmdsb2JhbFRoaXMuYWIxU2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiMVB1Ymxpc2ggPSBsaW5rcy5zdG9yZTsvL1JFUExBQ0VECmdsb2JhbFRoaXMuYWIxU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYjEgPSB0aGlzQm90OwoKaWYgKGluaXRpYWxCb290KSAKewogICAgbGV0IHByZXZpb3VzQm90cyA9IGdldEJvdHMoYnlNb2QoeyAic3BhY2UiOiAic2hhcmVkIiwgImFiMUNvcmUiOiBudWxsIH0pKTsKCiAgICBpZiAocHJldmlvdXNCb3RzKQogICAgewogICAgICAgIGRlc3Ryb3kocHJldmlvdXNCb3RzKTsKICAgIH0KfQoKCmlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykKewogICAgYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUIxRWdncyh7YWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKLy9VVUFCCi8vYm90LnZhcnMKCi8vIGlmIChhdXRvQUIpCi8vIHsKLy8gICAgIGxldCBlZ2dEYXRhID0gYXdhaXQgbGlua3Muc3RvcmUuYWIxUmV0cmlldmVSZWNvcmQoYXV0b0FCKTsKCi8vICAgICBjb25zb2xlLmxvZyhlZ2dEYXRhKTsKLy8gfQoKaWYgKGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiKQp7CiAgICBsZXQgc3VwcG9ydHNBUiA9IG9zLmRldmljZSgpLnN1cHBvcnRzQVI7CiAgICBsZXQgc3VwcG9ydHNWUiA9IG9zLmRldmljZSgpLnN1cHBvcnRzVlI7CgogICAgaWYgKHN1cHBvcnRzQVIgfHwgc3VwcG9ydHNWUikKICAgIHsKICAgICAgICBhd2FpdCB0aGlzQm90LmFiMUFkYXB0KCJhYjFJbW1lcnNpdmUiKTsKICAgICAgICAKICAgICAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gImltbWVyc2l2ZSI7CiAgICB9CgogICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFBd2FrZVN0YXRlID0gdHJ1ZTsKCiAgICBhd2FpdCB0aGlzQm90LmFiMUFkYXB0KCJhYjFJbnRlcmZhY2UiKTsKCiAgICBpZiAoaW5pdGlhbEJvb3QgJiYgIWJvb3RGbGFnKQogICAgewogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCwgcG9zaXRpb246e3g6MCx5OjB9fSk7CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gdXVpZCgpOwoKICAgICAgICBsaW5rcy5tZW51LmFiMUluaXRpYWxCb290TWVudSgpOwogICAgfQogICAgZWxzZSBpZiAoaW5pdGlhbEJvb3QpCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBib290RmxhZzsKICAgIH0KfQoKaWYgKGluaXRpYWxCb290KQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gZmFsc2U7Cn0KCmF3YWl0IG9zLnNsZWVwKDUwMCk7CgpzaG91dCgib25BQjFJbml0aWFsaXplZCIpOygAjLC8sQTlGAdhYjFDb3JlAXgnAIywvLEE5RgIYWIxQWRhcHQCBACMsLyxBNUn8gVAY29uc3Qgc3lzdGVtSUQgPSB0aGF0Owpjb25zdCBib290U3RyYXAgPSBvcy5nZXRBQjFCb290c3RyYXBVUkwoKQpjb25zdCBza2lsbEZpbGUgPSBib290U3RyYXAuc2xpY2UoMCwgYm9vdFN0cmFwLmxlbmd0aC03KSArIHN5c3RlbUlEICsiLmF1eCI7Cgp0cnkKewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgIHVybDogc2tpbGxGaWxlCiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICBjb25zb2xlLmxvZygnW2FiMSBib290c3RyYXBdIENvdWxkIG5vdCBkb3dubG9hZCBza2lsbC4nKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXModXBkYXRlcyk7CiAgICBjb25zdCBpZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CiAgICAKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKCiAgICB3aGlzcGVyKGlkcywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgLy9hYjEubG9nKCJhYi0xIGFkYXB0Iik7CiAgICBjb25zb2xlLmxvZygiYWItMSBhZGFwdCIpOwoKICAgIHJldHVybiB0cnVlOwp9CmNhdGNoCnsKICAgIGNvbnNvbGUubG9nKCdbYWIxIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwp9JwCMsLyxBOUYC2Rlc2NyaXB0aW9uAgQAjLC8sQTILVFUaGlzIHNraWxsIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBib3RoIHJlY29uZmlndXJhdGlvbiBvZiBhYi0xIGFuZCBpbml0aWFsaXphdGlvbi4nAIywvLEE5RgKb25Cb3RBZGRlZAIEAIywvLEEmi5JQGNvbnNvbGUubG9nKCJhYi0xIFNUQVJUIFVQIik7CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWIxQm9vdCgpLCA1MDApOycAjLC8sQTlGAhyZW1lbWJlcgIEAIywvLEE5C4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjLC8sQTlGANsb2cCBACMsLyxBIsvkwFAbGV0IHVwZGF0ZWRMb2dzOwoKaWYgKCF0YWdzLmFiMUxvZykKewogICAgdXBkYXRlZExvZ3MgPSB0aGF0Owp9CmVsc2UKewogICAgdXBkYXRlZExvZ3MgPSB0YWdzLmFiMUxvZyArICJcbiIgKyB0aGF0Owp9CgptYXNrcy5hYjFMb2cgPSB1cGRhdGVkTG9nczsnAIywvLEE5RgNbWFuaWZlc3RhdGlvbgIEAIywvLEEnzAo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAjLC8sQTlGA1hYjFDcmVhdGVIb3N0AgQAjLC8sQTGMOUHQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgb3MudG9hc3QoImNvZGUgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgpsZXQgbmV3SG9zdElEID0gdXVpZCgpLnJlcGxhY2VBbGwoIi0iLCAiIikuc3Vic3RyaW5nKDAsNik7CmxldCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKbGV0IHJlY29yZEtleSA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksICJiMjA3YTVlNC1kNTMxLTQ4NGYtYTBkNi02NjI2YmVmNTkwMTMiLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CmxldCByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXkuZGF0YSwgbmV3SG9zdElELCB7dXJsOiBjb25maWdCb3QudGFncy51cmwsIGRhdGU6IGRhdGV9LCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CgppZiAocmVjb3JkRGF0YS5zdWNjZXNzKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKTsKCiAgICB0aGF0LnRhZ3MubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy50b2FzdCgiaG9zdCBnZW5lcmF0ZWQsIGNvZGUgY29waWVkIHRvIGNsaXBib2FyZDogIiArIG5ld0hvc3RJRCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKfScAjLC8sQTlGAthYjFKb2luSG9zdAIEAIywvLEErDiuBkBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBqb2luQ29kZSA9IHRoYXQudGV4dC5yZXBsYWNlQWxsKCItIiwgIiIpOwpsZXQgcmVjb3JkS2V5ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgImIyMDdhNWU0LWQ1MzEtNDg0Zi1hMGQ2LTY2MjZiZWY1OTAxMyIsICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LmRhdGEsIGpvaW5Db2RlLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rLyIpOwoKaWYgKGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgZGF0ZSA9IERhdGVUaW1lLm5vdygpOwogICAgbGV0IGNyZWF0ZURhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKGdldFJlY29yZC5kYXRhLmRhdGUpOwogICAgbGV0IGRpZmZlcmVuY2UgPSBkYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwoKICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UuZGF5cyk7CgogICAgaWYgKGRpZmZlcmVuY2UgPCA4KQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CiAgICAKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoImpvaW4gY29kZSBvdXQgb2YgZGF0ZSwgcGxlYXNlIGdlbmVyYXRlIGEgbmV3IGpvaW4gY29kZSIpOwogICAgfQp9CmVsc2UKewogICAgb3MudG9hc3QoInVuYWJsZSB0byBqb2luLCBwbGVhc2UgY2hlY2sgY29kZSBhbmQgdHJ5IGFnYWluIik7Cn0nAIywvLEE5RgGc2VhcmNoAgQAjLC8sQTbPijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCMsLyxBOUYCWFiMUlnbm9yZQIEAIywvLEEgj8EdHJ1ZSgAjLC8sQTlGA1hYjFCb3RWZXJzaW9uAX0jJwCMsLyxBOUYBG1lbnUCBACMsLyxBIg/KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAIywvLEErz8Gc3lzdGVtAgQAjLC8sQSwPw9hYi0xLmNvcmUuc3RvcmUoAIywvLEErz8HYWIxQ29yZQF4JwCMsLyxBK8/BGZvcm0CBACMsLyxBME/B25vdGhpbmcnAIywvLEErz8LZGVzY3JpcHRpb24CBACMsLyxBMk/P1RoaXMgc2tpbGwgaXMgbWVhbnQgdG8gYmUgYSBjb25maWd1cmFibGUgbWVhbnMgdG8gcHVibGlzaCBkYXRhLicAjLC8sQSvPxBhYjFQdWJsaXNoUmVjb3JkAgQAjLC8sQSJQIUCQGxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIHJlY29yZERhdGE7JwCMsLyxBK8/DmFiMVB1Ymxpc2hGaWxlAgQAjLC8sQSPQoYDQGxldCBmaWxlID0gdGhhdC5maWxlOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGVOYW1lOwpsZXQgbWltZVR5cGUgPSB0aGF0Lm1pbWVUeXBlOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwoKaWYgKCFmaWxlKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgc3VwcGxpZWQiOwp9CgpsZXQgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIGZpbGVVcGxvYWQ7JwCMsLyxBK8/EWFiMUNvcmVNZW51QWN0aW9uAgQAjLC8sQSWRRdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycAjLC8sQSvPwtvblN0b3JlTWVudQIEAIywvLEErkWHOUBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7IjsKCmNvbnN0IHV1YWIgPSBsaW5rcy5yZW1lbWJlci50YWdzLnV1YWIgPyB0cnVlIDogZmFsc2U7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzU1RTY3OSI7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYjFEb3dubG9hZCgpO2A7CgovL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5wb2ludGFibGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IG51bGw7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDAuNzU7CiAgICAKICAgIC8vY3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5kaW1lbnNpb24gPSAiYWIxTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTE7CiAgICBtZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gImF1dG9tYXRpYyI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KCm1lbnVCdXR0b24uZGltZW5zaW9uID0gbnVsbDsKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJlZ2ciOwoKaWYgKHV1YWIpCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAicXJfY29kZV9zY2FubmVyIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IHRydWU7CgogICAgICAgICAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKICAgICAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzY2FuIHlvdXIgcHJhY3RpY2UgcGVybWl0Iik7CiAgICAgICAgfQogICAgICAgIGNhdGNoCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgicXIgY29kZSBzY2FuIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UiKTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMgPyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA6IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzLmlkOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQogICAgICAgIHsKICAgICAgICAgICAgdGhhdC50ZXh0ID0gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50ZXh0KQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWV9KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImFiIG5vdCBzcGVjaWZpZWQiKTsKCiAgICAgICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdEZvY3VzOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MudGFyZ2V0Qm90OwogICAgbGV0IHByZXBwZWRCb3QgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEJvdCk7CiAgICBsZXQgc3RhdGUgPSB7fQoKICAgIHN0YXRlW2FiMUluc3RNZW1vcnkudGFncy5hYjFGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgCiAgICAvL2NyZWF0ZSAgY29weSB0byBjbGlwYm9hcmQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDEwOwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInNjYW4iOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIC8vTkVFRCBUTyBVUERBVEUKICAgIGlmIChjb25maWdCb3QudGFncy5naWcpCiAgICB7CiAgICAgICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTU7CiAgICAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWIxQ29sbGFiU3VibWl0Iik7YDsKCiAgICAgICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHt9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9Cgpob3N0QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwpob3N0QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSA1MDsKaG9zdEJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwpob3N0QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwpob3N0QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKaG9zdEJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7Cmhvc3RCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmxlYXJuLmFiMUNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihob3N0QnV0dG9uKTsvL2dlbmVyYXRlIGEgaG9zdCBidXR0b24nAIywvLEErz8PYWIxQ29yZU1lbnVJY29uAgQAjLC8sQSmfglpb3Nfc2hhcmUnAIywvLEErz8QYWIxQ29yZU1lbnVMYWJlbAIEAIywvLEEsH4Fc2hhcmUnAIywvLEErz8UYWIxQ29yZU1lbnVTb3J0T3JkZXICBACMsLyxBLZ+ATMnAIywvLEErz8IcmVtZW1iZXICBACMsLyxBLh+KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIywvLEErz8MYWIxUHVibGlzaEFCAgQAjLC8sQTffsUnQC8vc2hvdXQoImFiMVB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIxLmxvZygiYWItMSBwdWJsaXNoIik7CgpzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCk7CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYjFNZW51IjsKCiAgICBsZXQgbWVudUJ1dHRvbiA9IHt9OwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IHRydWU7CiAgICBtZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7CiAgICBtZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7CiAgICBtZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKICAgIG1lbnVCdXR0b24ubGFiZWwxID0gInVwbG9hZGluZy4uIjsKICAgIG1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7CiAgICBtZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwogICAgbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKICAgIG1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCiAgICBwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldDsKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBzdGF0ZSA9IHt9OwpsZXQgZm9ybWF0dGVkRmlsZSA9IHt9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIHRhcmdldCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzOwp9CmVsc2UgaWYgKCF0YXJnZXQpCnsKICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWIxSWdub3JlOiBudWxsfSkpOwoKICAgIGlmICh0YXJnZXQubGVuZ3RoIDwgMSkKICAgIHsKICAgICAgICBvcy50b2FzdCgiTm8gYm90cyBmb3VuZCB0byBwdWJsaXNoIik7CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCmxldCBlZ2dDaGVjayA9IGF3YWl0IHRoaXNCb3QuYWIxUHJldmlvdXNFZ2dDaGVjayh7YWJJRDogYWJJRH0pOwoKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCmxldCBwdWJsaXNoRmlsZSA9IGF3YWl0IHRoaXNCb3QuYWIxUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiMVB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUR9KTsKbGV0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKc2hvdXQoIm9uQUJQdWJsaXNoZWQiLCB7c3VjY2VzczogcHVibGlzaEZpbGUuc3VjY2VzcywgYWI6IGFiSUQsIGZpbGVBZGRyZXNzOiBwdWJsaXNoRmlsZS51cmx9KQoKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IGdpZ0FCID0gY29uZmlnQm90LnRhZ3MuYWIgfHwgY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgfHwgY29uZmlnQm90LnRhZ3MuYXV4Q29kZTsKICAgIGxldCBnaWdLZXkgPSBnaWdBQiA/IGdpZ0FCLnN1YnN0cmluZyg3KSA6ICJub25lIjsKICAgIGxldCBnaWdGb3JtYXQgPSAiY29sbGFiXyI7CiAgICBsZXQgZ2lnRm9ybWF0Q2hlY2sgPSBhYklELmluY2x1ZGVzKGdpZ0Zvcm1hdCk7CgogICAgaWYgKGdpZ0Zvcm1hdENoZWNrICYmIGtleSA9PSBnaWdLZXkgJiYga2V5KSAKICAgIHsKICAgICAgICBsZXQgY29sbGFiVVJMID0gc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEICsgIiZrZXk9IiArIGtleTsKCiAgICAgICAgc2hvdXQoImFiMVN1Ym1pdENvbGxhYiIsIHsgdXJsOiBjb2xsYWJVUkwgfSkKICAgIH0KICAgIGVsc2UgaWYgKGtleSAmJiBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKSAKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEICsgIiZrZXk9IiArIGtleSk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2FiPSIgKyBhYklEKTsKCiAgICAgICAgb3MudG9hc3QoInVybCBjb3BpZWQgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgaWYgKGtleSkgCiAgICB7CiAgICAgICAgd2ViaG9vay5wb3N0KCJodHRwczovL3FuaGNhMnM3aWMuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc2xhY2svVDAyOUFQNENRL0IwMUtOVEI4MjAxL2dDT1BscVFIc1JQM3RCSzlQWUhKQm1OcCIsIHsgInRleHQiOiBgUFJJVkFURSAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICB3ZWJob29rLnBvc3QoImh0dHBzOi8vcW5oY2EyczdpYy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9zbGFjay9UMDI5QVA0Q1EvQjAxS05UQjgyMDEvZ0NPUGxxUUhzUlAzdEJLOVBZSEpCbU5wIiwgeyAidGV4dCI6IGAke2FiSUR9IHYke2VnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtwdWJsaXNoRmlsZS5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQoKICAgIHRyeSAKICAgIHsKICAgICAgICBhd2FpdCBhbmFseXRpY3MucmVjb3JkRXZlbnQoJ2FiMV9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgY29uc29sZS5sb2cocHVibGlzaFJlY29yZCk7Cn0KCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSBudWxsOwoKcmV0dXJuIHB1Ymxpc2hSZWNvcmQ7JwCMsLyxBK8/CWFiMUlnbm9yZQIEAIywvLEEpaYBBHRydWUnAIywvLEErz8LYWIxRG93bmxvYWQCBACMsLyxBKqmAZsDQGxldCBkb3dubG9hZEJvdHM7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIGRvd25sb2FkQm90cyA9IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1c107CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgYm90Iik7Cn0KZWxzZQp7CiAgICBkb3dubG9hZEJvdHMgPSBnZXRCb3RzKGJ5TW9kKHsiYWIxSWdub3JlIjogbnVsbCwgInNwYWNlIjogInNoYXJlZCJ9KSk7CgogICAgYWIxLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7JwCMsLyxBK8/DW1hbmlmZXN0YXRpb24CBACMsLyxBMapASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCMsLyxBK8/BG1lbnUCBACMsLyxBO2pASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCMsLyxBK8/E2FiMVByZXZpb3VzRWdnQ2hlY2sCBACMsLyxBJSqAYgNQGNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CgpsZXQgZWdnSGlzdG9yeTsKbGV0IGVnZ0lEOwpsZXQgdGFyZ2V0VmVyc2lvbk51bTsKbGV0IGxhc3RIYXNoOwpsZXQgbWF4VmVyc2lvbk51bTsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGFiSUQsICJodHRwczovL3B1YmxpY29zLmxpbmsvIikuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBtYXhWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9IAplbHNlIAp7CiAgICBlZ2dIaXN0b3J5ID0gW107CiAgICBlZ2dJRCA9IHV1aWQoKTsKICAgIHRhcmdldFZlcnNpb25OdW0gPSAxOwogICAgbGFzdEhhc2ggPSAibm9uZSI7CiAgICBtYXhWZXJzaW9uTnVtID0gMTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkKSAKewogICAgY29uc3QgZGVmaW5lZFZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQobWF4VmVyc2lvbk51bSwgewogICAgICAgIHRpdGxlOiAnc2V0IGRlZmF1bHQgdmVyc2lvbicsCiAgICAgICAgcGxhY2Vob2xkZXI6IGAxIHRvICR7bWF4VmVyc2lvbk51bX0gKGxlYXZlIGFzICR7bWF4VmVyc2lvbk51bX0gZm9yIGxhdGVzdClgCiAgICB9KTsKCiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZGVmaW5lZFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbikgCnsKICAgIHRhcmdldFZlcnNpb25OdW0gPSBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uOwogICAgY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG51bGw7Cn0KCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLmFiSUQgPSBhYklEOwoKbGV0IHNpZ25hdHVyZSA9IHt9OwpsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CmxldCB0aW1lID0gZGF0ZS5nZXRUaW1lKCk7CgpzaWduYXR1cmUucHJldmlvdXNIYXNoID0gbGFzdEhhc2g7CnNpZ25hdHVyZS5hYjFWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uOwpzaWduYXR1cmUuZWdnVmVyc2lvbiA9IHRhZ3MuZWdnVVVJRDsKc2lnbmF0dXJlLmVnZ1ZlcnNpb25OdW0gPSB0YWdzLm92b1ZlcnNpb247CnNpZ25hdHVyZS50aW1lU3RhbXAgPSB0aW1lOwpzaWduYXR1cmUuY2FzdWFsT1NWZXJzaW9uID0gW29zLnZlcnNpb24oKV07CgpyZXR1cm4ge3NpZ25hdHVyZTogc2lnbmF0dXJlLCBlZ2dEYXRhOiBlZ2d9OygAjLC8sQSvPw1hYjFCb3RWZXJzaW9uAX0jJwCMsLyxBK8/EGFiMUJvdE1lbnVBY3Rpb24CBACMsLyxBJ63ARdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycAjLC8sQSvPw9hYjFCb3RNZW51TGFiZWwCBACMsLyxBLa3AQVzaGFyZScAjLC8sQSvPw5hYjFCb3RNZW51SWNvbgIEAIywvLEEvLcBCWlvc19zaGFyZScAjLC8sQSvPxNhYjFCb3RNZW51U29ydE9yZGVyAgQAjLC8sQTGtwEBMygAjLC8sQSvPwxvbkZpbGVVcGxvYWQBficAjLC8sQSvPwVsZWFybgIEAIywvLEEybcBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIywvLEErz8OYWIxUHVibGlzaFVVQUICBACMsLyxBPC3Ae8PQGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKCmxldCB1dWFiQ29uZmlnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUIxRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MudXVhYiwgcmV0dXJuVHlwZTogImRhdGEifSk7CgpsZXQgcGluID0gYXdhaXQgb3Muc2hvd0lucHV0KG51bGwsewogICAgdGl0bGU6ICJlbnRlciBwaW4iLAogICAgdHlwZTogInNlY3JldCIKfSk7CgppZiAocGluKQp7CiAgICBsZXQgcGggPSBjcnlwdG8uc2hhMjU2KHBpbikuc3Vic3RyaW5nKDAsNCk7CgogICAgaWYgKHBoID09IGNvbmZpZ0JvdC50YWdzLnBoKQogICAgewogICAgICAgIGxldCByZWNvcmRLZXk7CiAgICAgICAgbGV0IGVnZ0RhdGFDaGVjazsKICAgICAgICBsZXQgZWdnRGF0YTsKCiAgICAgICAgZm9yICh0YWcgaW4gdXVhYkNvbmZpZy5zdGF0ZSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0YWcpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlY29yZEtleSA9IHV1YWJDb25maWcuc3RhdGVbdGFnXS50YWdzLnJlY29yZEtleTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoYXQpCiAgICAgICAgewogICAgICAgICAgICBlZ2dEYXRhQ2hlY2sgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5zdWNjZXNzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLmRhdGEuZWdncykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBKU09OLnBhcnNlKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGEubGVuZ3RoID49IDEyKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy50b2FzdCgicHJhY3RpY2UgcGVybWl0IGZ1bGwiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVnZyBkYXRhIG5vdCByZWFkYWJsZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiMVJlY29yZEtleSA9IHJlY29yZEtleTsKCiAgICAgICAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7CgogICAgICAgIHRoaXNCb3QuYWIxUHVibGlzaEFCKHthYjogY29uZmlnQm90LnRhZ3MuYWIsIGtleTogY29uZmlnQm90LnRhZ3Mua2V5fSk7CgogICAgICAgIGVnZ0RhdGEucHVzaChjb25maWdCb3QudGFncy5hYik7CgogICAgICAgIGVnZ0RhdGFUb1B1Ymxpc2ggPSB7ZWdnczogSlNPTi5zdHJpbmdpZnkoZWdnRGF0YSl9OwoKICAgICAgICBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGVnZ0RhdGFUb1B1Ymxpc2gsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGF3YWl0IG9zLnRvYXN0KCJwaW4gZG9lcyBub3QgbWF0Y2giLCAyKTsKCiAgICAgICAgc2hvdXQoImFiMVJlZnJlc2giKTsKICAgIH0KfQplbHNlCnsKICAgIGF3YWl0IG9zLnRvYXN0KCJubyBwaW4gZ2l2ZW4iLCAyKTsKCiAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgIHJldHVybgp9JwCMsLyxBK8/DGFiMVFSUHVibGlzaAIEAIywvLEE4McB8gRAY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSBudWxsOwoKbGV0IHNjYW5uZWRVUkw7Cgp0cnkgCnsKICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwp9CmNhdGNoIChlKSB7CiAgICBzaG91dCgiYWIxUHVibGlzaEFCIiwge2FiOiB0aGF0fSk7CgogICAgdGhpc0JvdC5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9CgppZiAoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpKSAKewogICAgbGV0IHRhcmdldFJlY29yZCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiaW5zdCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLnV1YWIgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIik7CiAgICBjb25maWdCb3QudGFncy5waCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiID0gdXVpZCgpOwogICAgY29uZmlnQm90LnRhZ3Mua2V5ID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwoKICAgIHRoaXNCb3QuYWIxUHVibGlzaFVVQUIoe3RhcmdldFJlY29yZDogdGFyZ2V0UmVjb3JkfSk7Cn0KZWxzZSAKewogICAgb3MudG9hc3QoInVuc3VwcG9ydGVkIHVybCBmb3JtYXQiKTsKfScAjLC8sQSvPwZzZWFyY2gCBACMsLyxBNPMASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwCMsLyxBPrMAQZzeXN0ZW0CBACMsLyxBPvMARBhYi0xLmNvcmUuc2VhcmNoJwCMsLyxBPrMAQRmb3JtAgQAjLC8sQSMzQEHbm90aGluZycAjLC8sQT6zAEHYWIxQ29yZQIEAIywvLEElM0BBHRydWUnAIywvLEE+swBD2FiMVJldHJpZXZlRmlsZQIEAIywvLEEmc0BbEBpZiAoIXRoYXQudXJsKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgdXJsIHN1cHBsaWVkIjsKfQoKbGV0IGRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKHRoYXQudXJsKTsKCnJldHVybiBkYXRhOycAjLC8sQT6zAERYWIxUmV0cmlldmVSZWNvcmQCBACMsLyxBIbOAekCQGxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwpsZXQgcmVjb3JkRW5kcG9pbnQgPSB0aGF0LnJlY29yZEVuZHBvaW50ID8gdGhhdC5yZWNvcmRFbmRwb2ludCA6ICJodHRwczovL3B1YmxpY29zLmxpbmsiOwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgpyZXR1cm4gZ2V0UmVjb3JkOygAjLC8sQT6zAERYWIxQ29yZU1lbnVBY3Rpb24BfigAjLC8sQT6zAEMb25TZWFyY2hNZW51AX4oAIywvLEE+swBD2FiMUNvcmVNZW51SWNvbgF+KACMsLyxBPrMARBhYjFDb3JlTWVudUxhYmVsAX4oAIywvLEE+swBFWFiMUNvcmVNZW51T25HZW5lcmF0ZQF+KACMsLyxBPrMARRhYjFDb3JlTWVudVNvcnRPcmRlcgF+JwCMsLyxBPrMAQhyZW1lbWJlcgIEAIywvLEE9tABKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIywvLEE+swBDW1hbmlmZXN0YXRpb24CBACMsLyxBJ3RASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCMsLyxBPrMAQ9vbkxvb2t1cEFCMUVnZ3MCBACMsLyxBMTRAYAcQC8vc2hvdXQoIm9uTG9va3VwQUIxRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIxLmxvZygiYWItMSBhYiBsb2FkICIgKyB0aGF0KTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7Cn0KCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKY29uc3QgYXV0b0hhdGNoID0gdGhhdC5hdXRvSGF0Y2g7CmNvbnN0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGFiSUQsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IG5ld0VnZzsKCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MgJiYgY29uZmlnQm90LnRhZ3MuZ2lnKS8vQlJJTkcgSU4gSU5JVEFJQUwgQ09MTEFCIFNFVFVQCnsKICAgIGxldCBjb2xsYWJCb3QgPSBnZXRCb3QoImFiSURPcmlnaW4iLCAiY29sbGFiU2V0dXAiKTsKCiAgICBpZiAoIWNvbGxhYkJvdCkKICAgIHsKICAgICAgICB0aGlzQm90Lm9uTG9va3VwQUIxRWdncyh7YWJJRDogImNvbGxhYlNldHVwIiwgYXV0b0hhdGNoOiB0cnVlfSk7CiAgICB9Cn0KZWxzZSBpZiAoIWdldFJlY29yZC5zdWNjZXNzKQp7CiAgICAvL01BWUJFIFJFTU9WRSBUSElTIFNPT04/Pz8KICAgIGNvbnNvbGUubG9nKGdldFJlY29yZCwgImNoZWNraW5nIG9sZCBTVE0iKTsKCiAgICBsZXQgZmlsZW5hbWVoYXNoID0gY3J5cHRvLnNoYTI1NihhYklEKTsKICAgIGxldCBmaWxldXJsaGFzaCA9ICJhdXhfIiArIGZpbGVuYW1laGFzaCArICcuYXV4JzsKICAgIGxldCB0YXJnZXRVUkwgPSAiaHR0cHM6Ly9idWlsZGVyLXN0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaDsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIGxldCBsdG1SZXNwb25zZSA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgICAgIG5ld0VnZyA9IGx0bVJlc3BvbnNlLmRhdGEuc3RhdGU7CgogICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gbmV3RWdnKQogICAgICAgIHsKICAgICAgICAgICAgY29uc3QgbmV3TU9EID0gbmV3RWdnW3Byb3BlcnR5XTsKCiAgICAgICAgICAgIG5ld0VnZyA9IG5ld01PRDsKICAgICAgICB9CiAgICB9IAogICAgY2F0Y2ggKGUpIAogICAgewoKICAgICAgICBvcy50b2FzdChgbm8gZGF0YSBmb3VuZCBpbiAke2FiSUR9YCk7CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gImFiSUQgbm90IGZvdW5kIjsKICAgIH0KfQplbHNlCnsKICAgIG5ld0VnZyA9IGdldFJlY29yZC5kYXRhOwp9CgppZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIgJiYgZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCB2ZXJzaW9uID0gZ2V0UmVjb3JkLmRhdGEudGFyZ2V0VmVyc2lvbiAtIDE7CgogICAgaWYgKHRoYXQuYWJWZXJzaW9uKQogICAgewogICAgICAgIGlmICghaXNOYU4odGhhdC5hYlZlcnNpb24pKQogICAgICAgIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHRoYXQuYWJWZXJzaW9uIC0gMTsKICAgICAgICB9CiAgICB9CgogICAgbGV0IGVnZ0RhdGFVUkwgPSBnZXRSZWNvcmQuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeVt2ZXJzaW9uXTsKICAgIGxldCByZXR1cm5EYXRhID0gYXdhaXQgb3MuZ2V0RmlsZShlZ2dEYXRhVVJMKTsKCiAgICByZXR1cm4gcmV0dXJuRGF0YTsKfQplbHNlIGlmIChyZXR1cm5UeXBlID09ICJkYXRhIikKewogICAgbGV0IHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2UobmV3RWdnLmVnZ1ZlcnNpb25IaXN0b3J5KTsKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtuZXdFZ2cubWF4VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaExUTSA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoTFRNID0gImF1eF8iICsgZmlsZW5hbWVoYXNoTFRNICsgJy5hdXgnOwogICAgbGV0IHRhcmdldExUTVVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoTFRNOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldExUTVVSTDsKCiAgICBmaWxlR2V0ID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYjFSZWZyZXNoIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBmaWxlR2V0ID0gZmlsZUdldC5kYXRhOwogICAgfQoKICAgIHJldHVybiBmaWxlR2V0Owp9CgpsZXQgY3VycmVudERpbTsKbGV0IHNwYWNlTW9kOwpsZXQgZGltZW5zaW9uWDsKbGV0IGRpbWVuc2lvblk7CmxldCBkaW1Nb2Q7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KQogICAgewogICAgICAgIGNvbnN0IGFiMUJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90OwoKICAgICAgICBjdXJyZW50RGltID0gYWIxQm90LnRhZ3MuZGltZW5zaW9uOwogICAgfQp9CmVsc2UKewogICAgY3VycmVudERpbSA9IG9zLmdldEN1cnJlbnREaW1lbnNpb24oKTsKfQoKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxR3JpZEZvY3VzOwoKICAgIGN1cnJlbnREaW0gPSBoYXRjaFBvaW50LmRpbWVuc2lvbjsKICAgIGRpbWVuc2lvblggPSBoYXRjaFBvaW50LnBvc2l0aW9uLng7CiAgICBkaW1lbnNpb25ZID0gaGF0Y2hQb2ludC5wb3NpdGlvbi55OwogICAgc3BhY2VNb2QgPSB7c3BhY2U6ICJzaGFyZWQifTsKfQoKaWYgKCFhdXRvSGF0Y2ggJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gbnVsbCkKewogICAgZGltTW9kID0ge1tjdXJyZW50RGltXTogdHJ1ZSwgW2N1cnJlbnREaW0rIlgiXTogZGltZW5zaW9uWCwgW2N1cnJlbnREaW0rIlkiXTogZGltZW5zaW9uWSwgZGltZW5zaW9uOiBjdXJyZW50RGltfTsKfQplbHNlCnsKICAgIGlmIChjb25maWdCb3QudGFncy5rZXkgJiYgIXRoYXQua2V5KQogICAgewogICAgICAgIGtleSA9IGNvbmZpZ0JvdC50YWdzLmtleQogICAgfQoKICAgIGRpbU1vZCA9IHthdXRvSGF0Y2g6IHRydWUsIGtleToga2V5fTsKfQoKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAIywvLEE+swBC21hbmlmZXN0T3ZvAgQAjLC8sQTF7QHWCkBzaG91dCgiYWIxTWVudVJlc2V0Iik7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsoAIywvLEE+swBCG92b0hhdGNoAX4nAIywvLEE+swBCW9uS2V5RG93bgIEAIywvLEEmfgBtAVAaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAib3ZvIikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5vdm8gPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScAjLC8sQT6zAEIaGF0Y2hPdm8CBACMsLyxBMz9AfcMQHNob3V0KCdvdm9NZW51UmVzZXQnKTsKCmNvbnN0IG92byA9IHRoYXQ7CgpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBjb25maWdCb3QudGFncy5hYlZlcnNpb24gJiYgY29uZmlnQm90LnRhZ3MuYWIgPT0gb3ZvLnRhZ3MuYWJJRCA/IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiA6IG92by50YWdzLnRhcmdldFZlcnNpb247CmxldCB2ZXJzaW9uQXJyYXkgPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeTsKbGV0IGZpbGVVUkwgPSB2ZXJzaW9uQXJyYXlbdGFyZ2V0VmVyc2lvbiAtIDFdOwpsZXQga2V5ID0gb3ZvLnRhZ3Mua2V5ID8gb3ZvLnRhZ3Mua2V5IDogY29uZmlnQm90LnRhZ3Mua2V5OwpsZXQgZmlsZUdldDsKCnRyeQp7CiAgICBmaWxlR2V0ID0gYXdhaXQgb3MuZ2V0RmlsZShmaWxlVVJMKTsKfQpjYXRjaCAoZXJyb3IpCnsKICAgIGNvbnNvbGUubG9nKCJjaGVja2luZyBvbGQgTFRNIiwgZXJyb3IpOwoKICAgIHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2Uob3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkpOwoKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtvdm8udGFncy50YXJnZXRWZXJzaW9uIC0gMV07CiAgICBsZXQgZmlsZW5hbWVoYXNoID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2ggPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2ggKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0VVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2g7CiAgICBsZXQgbyA9IHt9OwogICAgCiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRVUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KfQoKaWYgKGNyeXB0by5pc0VuY3J5cHRlZChmaWxlR2V0KSkKewogICAgaWYgKCFrZXkpCiAgICB7CiAgICAgICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCcnLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ0VudGVyIGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICB0cnkKICAgIHsKICAgICAgICBmaWxlR2V0ID0gY3J5cHRvLmRlY3J5cHQoa2V5LCBmaWxlR2V0KTsKICAgIH0KICAgIGNhdGNoIChlcnJvcikKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKCiAgICAgICAgb3MudG9hc3QoImtleSBkb2VzIG5vdCBtYXRjaCBmaWxlIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgCiAgICBmaWxlR2V0ID0gSlNPTi5wYXJzZShmaWxlR2V0KTsKCiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQplbHNlCnsKICAgIGZpbGVHZXQgPSBmaWxlR2V0LnN0YXRlOwp9CgpkZXN0cm95KG92byk7CgpsaW5rcy5jcmVhdGUuYWIxQ3JlYXRlQm90cyh7Ym90czogZmlsZUdldCwgb3JpZ2luOiBvdm8udGFncy5hYklELCB2ZXJzaW9uOiB0YXJnZXRWZXJzaW9uLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAIywvLEE+swBC2ludGVyYWN0T3ZvAgQAjLC8sQTEigL7BkBjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm92byI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24ub3ZvID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24udGFyZ2V0VmVyc2lvbiA9IG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWwgPSAiaGF0Y2ggIiArIG92b0JvdC50YWdzLmFiSUQgKyAiIHYiICsgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92b0JvdC50YWdzLm1heFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKZWdnTWVudUJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmVnZ01lbnVCdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CmVnZ01lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8obGlua3Mub3ZvQm90KTsiOwoKbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKGVnZ01lbnVCdXR0b24pOycAjLC8sQT6zAEGY3JlYXRlAgQAjLC8sQS8kQIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAjLC8sQT6zAEMYWIxTFRNU2VhcmNoAgQAjLC8sQTjkQIfQHRoaXNCb3Qub25Mb29rdXBBQjFFZ2dzKHRoYXQpOycAjLC8sQT6zAEQY2hhbmdlT3ZvVmVyc2lvbgIEAIywvLEEg5IC+wFAY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXRGb3JUYWcob3ZvQm90LCAidGFyZ2V0VmVyc2lvbiIsIHsKICAgIHBsYWNlaG9sZGVyOiAiZW50ZXIgYSB2ZXJzaW9uIGZyb20gMSB0byAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbgp9KTsKCm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycAjLC8sQT6zAEEbWVudQIEAIywvLEE/5MCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAIywvLEE+swBCWFiMUlnbm9yZQIEAIywvLEEppQCBHRydWUoAIywvLEE+swBDWFiMUJvdFZlcnNpb24BfSMnAQRib3RzJGU1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNwEnAIywvLEErJQCBnN5c3RlbQIEAIywvLEErZQCEmFiLTEuY29yZS5yZW1lbWJlcicAjLC8sQSslAIEZm9ybQIEAIywvLEEwJQCB25vdGhpbmcoAIywvLEErJQCB2FiMUNvcmUBeCgAjLC8sQSslAINYWIxQXdha2VTdGF0ZQF4JwCMsLyxBKyUAgtkZXNjcmlwdGlvbgIEAIywvLEEypQCK1RoaXMgaXMgbWVhbnQgdG8gYmUgdGhlIGxvY2FsIHN0YXRlIGhvbGRlci4nAIywvLEErJQCDGFiMVJlY29yZEtleQIEAIywvLEE9pQCLnZSSzEuWVdJdE1RPT0uTkhac1VHdG9ObUZHWTNGSmRqSlRNbXMxTkZscVVUMDknAIywvLEErJQCEmFiMUFjdGl2ZURpbWVuc2lvbgIEAIywvLEEpZUCBGhvbWUnAIywvLEErJQCDGFiMUJhc2VDb2xvcgIEAIywvLEEqpUCByM5MDhCRkMoAIywvLEErJQCEGFiMUdyaWRTbmFwU3RhdGUBeCgAjLC8sQSslAIPYWIxQm90U25hcFN0YXRlAXgnAIywvLEErJQCDmFiMU1lbnVSZWZyZXNoAgQAjLC8sQS0lQIYQGNsZWFyVGFnTWFza3ModGhpc0JvdCk7KACMsLyxBKyUAgtpbml0aWFsQm9vdAF4JwCMsLyxBKyUAgthYjFFbmRwb2ludAIEAIywvLEEzpUCFmh0dHBzOi8vcHVibGljb3MubGluay8nAIywvLEErJQCCWFiMUlnbm9yZQIEAIywvLEE5ZUCBHRydWUnAIywvLEErJQCDmFiMUNvcmVWZXJzaW9uAgQAjLC8sQTqlQIBOSgAjLC8sQSslAINYWIxQm90VmVyc2lvbgF9IygAjLC8sQSslAIQYWIxQ29yZUl0ZXJhdGlvbgF9IycAjLC8sQSslAIaYWIxTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMCBACMsLyxBO6VAgR0cnVlJwCMsLyxBKyUAgZiYXNlQUICBACMsLyxBPOVAiQ0NDMwMTg3YS0wZjBiLTRlZjctYTQ0Mi00YWFjNGRiOTBjZWUnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnAIywvLEEmJYCBnN5c3RlbQIEAIywvLEEmZYCD2FiLTEuY29yZS5pbnB1dCcAjLC8sQSYlgIEZm9ybQIEAIywvLEEqZYCB25vdGhpbmcnAIywvLEEmJYCCW9uS2V5RG93bgIEAIywvLEEsZYCP0BpZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoKTsKfScAjLC8sQSYlgIGb25DaGF0AgQAjLC8sQTxlgLXFkBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQjEnOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYjFDb3JlIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWIxR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWIxR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiMUdyb3VwW2ldLnRhZ3MuYWIxQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWIxR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiMUFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiMUlnbm9yZTogbnVsbH0pKSk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAudXBsb2FkYDoKICAgICAgICAgICAgb3Muc2hvd1VwbG9hZEF1eEZpbGUoKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zbGVlcGA6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBc2xlZXAiLCAiYWIxTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLi5gOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXdha2UiLCAiYWIxTWFuaWZlc3RTdGF0ZSIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmxvZyc6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy50YWdQb3J0YWwgPT0gYWIxLmlkICsgIi5hYjFMb2ciKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKCiAgICAgICAgICAgICAgICBvcy5oaWRlQ2hhdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IGFiMS5pZCArICIuYWIxTG9nIjsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9ICJ0ZW1wTG9jYWwiOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKICAgICAgICAgICAgICAgIG9zLnNob3dDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmhpZGVMb2cnOgogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICBvcy5oaWRlQ2hhdCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHRoYXQubWVzc2FnZTsKICAgICAgICAgICAgbGV0IGV4ZWN1dGFibGUgPSBtZXNzYWdlLnNsaWNlKDEpOwoKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG9zLnJ1bihleGVjdXRhYmxlKTsgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgfQp9KACMsLyxBJiWAgdhYjFDb3JlAXgnAIywvLEEmJYCC2Rlc2NyaXB0aW9uAgQAjLC8sQTKrQJCVGhpcyBpcyBtZWFudCB0byBoYW5kbGUgYW55IG5vbmUgbWVudSByZWxhdGVkIGlucHV0cy9pbnRlcmFjdGlvbnMuJwCMsLyxBJiWAgxvbkZpbGVVcGxvYWQCBACMsLyxBI2uAs0UQGlmICghYnVpbGRlclZlcnNpb24gfHwgbGlua3MucmVtZW1iZXIudGFncy5hYjFMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcyAhPT0gdHJ1ZSkKewogICAgcmV0dXJuOwp9CgpsZXQgZmlsZUV4dGVuc2lvbiA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykuc2hpZnQoKTsKbGV0IHNpemUgPSB0aGF0LmZpbGUuc2l6ZTsKbGV0IG1pbWVUeXBlOwpsZXQgYm90SW5mbyA9IHt9OwoKaWYgKHNpemUgPiAyMDAwMDAwMDApCnsKICBvcy50b2FzdCgibWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQgKDIwMCBtYikiKTsKCiAgcmV0dXJuOwp9Cgpzd2l0Y2goZmlsZUV4dGVuc2lvbikKewogIGNhc2UgJ2pwZyc6CiAgY2FzZSAnanBlZyc6CiAgY2FzZSAnd2VicCc6CiAgY2FzZSAnZ2lmJzoKICBjYXNlICdwbmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2UvIiArIGZpbGVFeHRlbnNpb247CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ3N2Zyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS9zdmcreG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnZ2xiJzoKICBjYXNlICdnbHRmJzoKICAgIG1pbWVUeXBlID0gInRleHQveG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJtZXNoIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAiZ2x0ZiI7CiAgICBicmVhazsKICBjYXNlICdhdXgnOgogIGNhc2UgJ3BkZic6CiAgICBsZXQgYm90RGF0YSA9IGZpbGVFeHRlbnNpb24gPT0gIi5hdXgiID8gSlNPTi5wYXJzZSh0aGF0LmZpbGUuZGF0YSkuc3RhdGUgOiBvcy5wYXJzZUJvdHNGcm9tRGF0YSh0aGF0LmZpbGUuZGF0YSk7CgogICAgbGlua3MuY3JlYXRlLmFiMUNyZWF0ZUJvdHMoe2JvdHM6IGJvdERhdGEsIG9yaWdpbjogZmlsZU5hbWV9KTsKCiAgICByZXR1cm47Ci8vICAgY2FzZSAncGRmJzoKLy8gICAgIGJyZWFrOwogIGNhc2UgJ21wMyc6CiAgICBtaW1lVHlwZSA9ICdhdWRpby9tcGVnJzsKICAgIGJvdEluZm8ub25DbGljayA9ICJAIG9zLnBsYXlTb3VuZCh0YWdzLmZvcm1BZGRyZXNzKTsiOwogICAgYm90SW5mby5sYWJlbCA9ICJDbGljayB0byBQbGF5IjsKICAgIGJyZWFrOwogIGNhc2UgJ21wNCc6CiAgICBtaW1lVHlwZSA9ICd2aWRlby9tcDQnOwogICAgYm90SW5mby5mb3JtID0gImlmcmFtZSI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gInNyYyI7CiAgICBicmVhazsKICBkZWZhdWx0OgogICAgbGV0IHJlc3VsdCA9IG5ldyBFcnJvcigidW5oYW5kbGVkIGZpbGUgdHlwZTogIiArIGZpbGVFeHRlbnNpb24pOwogICAgb3MudG9hc3QoImZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIik7CiAgICBjb25zb2xlLndhcm4ocmVzdWx0KQogICAgcmV0dXJuIHJlc3VsdDsKfQoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWIxTWVudSI7CgpsZXQgdXBsb2FkUmVzdWx0OwpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi50cmFja051bSA9IC0xOwptZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7Cm1lbnVCdXR0b24ubGFiZWwwID0gInVwbG9hZGluZy4iOwptZW51QnV0dG9uLmxhYmVsMSA9ICJ1cGxvYWRpbmcuLiI7Cm1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7Cm1lbnVCdXR0b24uZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7Cm1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7Cm1lbnVCdXR0b24ub25EZXN0cm95ID0gIkAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOyI7Cgpwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCnVwbG9hZFJlc3VsdCA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiMVB1Ymxpc2hGaWxlKHtmaWxlOiB0aGF0LmZpbGUuZGF0YSwgZmlsZU5hbWU6IGZpbGVOYW1lLCBtaW1lVHlwZTogbWltZVR5cGV9KTsKCmlmIChPYmplY3Qua2V5cyhib3RJbmZvKS5sZW5ndGggPiAwKQp7CiAgICBib3RJbmZvW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWxdID0gdHJ1ZTsKICAgIGJvdEluZm8uZm9ybUFkZHJlc3MgPSB1cGxvYWRSZXN1bHQudXJsID8gdXBsb2FkUmVzdWx0LnVybCA6IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7CgogICAgY3JlYXRlKGJvdEluZm8pOwp9Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgpkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKCnJldHVybiB1cGxvYWRSZXN1bHQ7JwCMsLyxBJiWAgVsZWFybgIEAIywvLEE28ICKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIywvLEEmJYCCHJlbWVtYmVyAgQAjLC8sQSCwwIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjLC8sQSYlgINbWFuaWZlc3RhdGlvbgIEAIywvLEEqcMCKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIywvLEEmJYCCWFiMUlnbm9yZQIEAIywvLEE0MMCBHRydWUoAIywvLEEmJYCDWFiMUJvdFZlcnNpb24BfSMnAIywvLEEmJYCBmNyZWF0ZQIEAIywvLEE1sMCKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAIywvLEEmJYCBXN0b3JlAgQAjLC8sQT9wwIo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAjLC8sQSYlgIEbWVudQIEAIywvLEEpMQCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IA"}]}