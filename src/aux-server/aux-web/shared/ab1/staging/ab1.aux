{"version":2,"updates":[{"id":0,"timestamp":1680203115052,"update":"AdwBysrwogsAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwDKyvCiCwAGc3lzdGVtAgQAysrwogsBEmFiLTEuY29yZS5yZWd1bGF0ZScAysrwogsABGZvcm0CBADKyvCiCxQHbm90aGluZycAysrwogsAB2FiMUNvcmUCBADKyvCiCxwEdHJ1ZScAysrwogsADG9uQW55Qm90RHJhZwIEAMrK8KILIZQBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImZhY2UiKTsKfScAysrwogsACHJlbWVtYmVyAgQAysrwogu2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDKyvCiCwAJYWIxSWdub3JlAgQAysrwogvdAQR0cnVlKADKyvCiCwANYWIxQm90VmVyc2lvbgF9FScBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScAysrwogvjAQZzeXN0ZW0CBADKyvCiC+QBEGFiLTEuY29yZS5jcmVhdGUoAMrK8KIL4wEHYWIxQ29yZQF4JwDKyvCiC+MBBGZvcm0CBADKyvCiC/YBB25vdGhpbmcnAMrK8KIL4wELZGVzY3JpcHRpb24CBADKyvCiC/4BPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAMrK8KIL4wENYWIxQ3JlYXRlQm90cwIEAMrK8KILvAK/FUAvL05FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmxldCBib3REYXRhID0gdGhhdC5ib3RzOwpsZXQgb3JpZ2luID0gdGhhdC5vcmlnaW47CmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107Cgpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYjFHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWIxR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiMUdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiMUdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWIxR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgpsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07Cgpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5hYjFTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgLy8gbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgLy8gaWYgKCFwcmVoYXRjaCkgCiAgICAvLyB7CiAgICAvLyAgICAgYWIxSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIC8vIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9Cgp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycAysrwogvjAQhyZW1lbWJlcgIEAMrK8KIL/Bco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAysrwogvjAQlvbkFiQWRkZWQCBADKyvCiC6MYSkAvL05FRUQgVE8gSU1QTEVNRU5UCi8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwDKyvCiC+MBCWFiMUlnbm9yZQIEAMrK8KIL7hgEdHJ1ZSgAysrwogvjAQ1hYjFCb3RWZXJzaW9uAX0VJwEEYm90cyQ2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcBJwDKyvCiC/QYBnN5c3RlbQIEAMrK8KIL9RgPYWItMS5jb3JlLmxlYXJuJwDKyvCiC/QYBWFiMUlEAgQAysrwoguFGQVsZWFybicAysrwogv0GARmb3JtAgQAysrwoguLGQdub3RoaW5nJwDKyvCiC/QYB2FiMUJvb3QCBADKyvCiC5MZ9wxAbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiMSA9IHRoaXNCb3Q7CgppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsZXQgcHJldmlvdXNCb3RzID0gZ2V0Qm90cyhieU1vZCh7ICJzcGFjZSI6ICJzaGFyZWQiLCAiYWIxQ29yZSI6IG51bGwgfSkpOwoKICAgIGlmIChwcmV2aW91c0JvdHMpCiAgICB7CiAgICAgICAgZGVzdHJveShwcmV2aW91c0JvdHMpOwogICAgfQp9CgppZiAoaW5zdE1vZGVDaGVjayA9PSAiYnVpbGRlciIpCnsKICAgIC8vQ0hFQ0sgRk9SIFZSL0FSIEhFUkUKICAgIC8vaWYgKGdldEJvdCgicmN4ciIpKQogICAgICAgICAgICAvLyB7CiAgICAgICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgLy8gYWIxTWVudUJ1dHRvbi5sYWJlbCA9ICJlbmFibGUgQVIvVlIgc3VwcG9ydCI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlld19pbl9hciI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlzaWJpbGl0eV9vZmYiOwogICAgICAgICAgICAvLyBhYjFNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWIxQWRhcHQnLCAncmN4cicpOyAKCiAgICAgICAgICAgIC8vIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyAKCiAgICAgICAgICAgIC8vIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKICAgICAgICAgICAgLy8gYDsKCiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSB0cnVlOwoKICAgIGF3YWl0IHRoaXNCb3QuYWIxQWRhcHQoImFiMUludGVyZmFjZSIpOwoKICAgIGlmIChpbml0aWFsQm9vdCkKICAgIHsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMU1hbmlmZXN0Qm90KHtkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwsIHBvc2l0aW9uOnt4OjAseTowfX0pOwoKICAgICAgICBsaW5rcy5tZW51LmFiMUluaXRpYWxCb290TWVudSgpOwogICAgfQp9CgppZiAoaW5pdGlhbEJvb3QgJiYgYm9vdEZsYWcpCnsKICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6IGJvb3RGbGFnLCBpbml0aWFsQm9vdDogdHJ1ZSwgYXV0b0hhdGNoOiB0cnVlfSk7Cn0KCi8vVVVBQgovL2JvdC52YXJzCgovLyBpZiAoYXV0b0FCKQovLyB7Ci8vICAgICBsZXQgZWdnRGF0YSA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiMVJldHJpZXZlUmVjb3JkKGF1dG9BQik7CgovLyAgICAgY29uc29sZS5sb2coZWdnRGF0YSk7Ci8vIH0KCmlmIChpbml0aWFsQm9vdCkKewogICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IGZhbHNlOwp9CgpzaG91dCgib25BQjFJbml0aWFsaXplZCIpOygAysrwogv0GAdhYjFDb3JlAXgnAMrK8KIL9BgIYWIxQWRhcHQCBADKyvCiC4wm8gVAY29uc3Qgc3lzdGVtSUQgPSB0aGF0Owpjb25zdCBib290U3RyYXAgPSBvcy5nZXRBQjFCb290c3RyYXBVUkwoKQpjb25zdCBza2lsbEZpbGUgPSBib290U3RyYXAuc2xpY2UoMCwgYm9vdFN0cmFwLmxlbmd0aC03KSArIHN5c3RlbUlEICsiLmF1eCI7Cgp0cnkKewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgIHVybDogc2tpbGxGaWxlCiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICBjb25zb2xlLmxvZygnW2FiMSBib290c3RyYXBdIENvdWxkIG5vdCBkb3dubG9hZCBza2lsbC4nKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXModXBkYXRlcyk7CiAgICBjb25zdCBpZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CiAgICAKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKCiAgICB3aGlzcGVyKGlkcywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgLy9hYjEubG9nKCJhYi0xIGFkYXB0Iik7CiAgICBjb25zb2xlLmxvZygiYWItMSBhZGFwdCIpOwoKICAgIHJldHVybiB0cnVlOwp9CmNhdGNoCnsKICAgIGNvbnNvbGUubG9nKCdbYWIxIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwp9JwDKyvCiC/QYC2Rlc2NyaXB0aW9uAgQAysrwogv/K1FUaGlzIHNraWxsIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBib3RoIHJlY29uZmlndXJhdGlvbiBvZiBhYi0xIGFuZCBpbml0aWFsaXphdGlvbi4nAMrK8KIL9BgKb25Cb3RBZGRlZAIEAMrK8KIL0SxJQGNvbnNvbGUubG9nKCJhYi0xIFNUQVJUIFVQIik7CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWIxQm9vdCgpLCA1MDApOycAysrwogv0GAhyZW1lbWJlcgIEAMrK8KILmy0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAysrwogv0GANsb2cCBADKyvCiC8ItkwFAbGV0IHVwZGF0ZWRMb2dzOwoKaWYgKCF0YWdzLmFiMUxvZykKewogICAgdXBkYXRlZExvZ3MgPSB0aGF0Owp9CmVsc2UKewogICAgdXBkYXRlZExvZ3MgPSB0YWdzLmFiMUxvZyArICJcbiIgKyB0aGF0Owp9CgptYXNrcy5hYjFMb2cgPSB1cGRhdGVkTG9nczsnAMrK8KIL9BgNbWFuaWZlc3RhdGlvbgIEAMrK8KIL1i4o8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAysrwogv0GA1hYjFDcmVhdGVIb3N0AgQAysrwogv9LuUHQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgb3MudG9hc3QoImNvZGUgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgpsZXQgbmV3SG9zdElEID0gdXVpZCgpLnJlcGxhY2VBbGwoIi0iLCAiIikuc3Vic3RyaW5nKDAsNik7CmxldCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKbGV0IHJlY29yZEtleSA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksICJiMjA3YTVlNC1kNTMxLTQ4NGYtYTBkNi02NjI2YmVmNTkwMTMiLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CmxldCByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXkuZGF0YSwgbmV3SG9zdElELCB7dXJsOiBjb25maWdCb3QudGFncy51cmwsIGRhdGU6IGRhdGV9LCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CgppZiAocmVjb3JkRGF0YS5zdWNjZXNzKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKTsKCiAgICB0aGF0LnRhZ3MubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy50b2FzdCgiaG9zdCBnZW5lcmF0ZWQsIGNvZGUgY29waWVkIHRvIGNsaXBib2FyZDogIiArIG5ld0hvc3RJRCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKfScAysrwogv0GAthYjFKb2luSG9zdAIEAMrK8KIL4zauBkBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBqb2luQ29kZSA9IHRoYXQudGV4dC5yZXBsYWNlQWxsKCItIiwgIiIpOwpsZXQgcmVjb3JkS2V5ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgImIyMDdhNWU0LWQ1MzEtNDg0Zi1hMGQ2LTY2MjZiZWY1OTAxMyIsICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LmRhdGEsIGpvaW5Db2RlLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rLyIpOwoKaWYgKGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgZGF0ZSA9IERhdGVUaW1lLm5vdygpOwogICAgbGV0IGNyZWF0ZURhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKGdldFJlY29yZC5kYXRhLmRhdGUpOwogICAgbGV0IGRpZmZlcmVuY2UgPSBkYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwoKICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UuZGF5cyk7CgogICAgaWYgKGRpZmZlcmVuY2UgPCA4KQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CiAgICAKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoImpvaW4gY29kZSBvdXQgb2YgZGF0ZSwgcGxlYXNlIGdlbmVyYXRlIGEgbmV3IGpvaW4gY29kZSIpOwogICAgfQp9CmVsc2UKewogICAgb3MudG9hc3QoInVuYWJsZSB0byBqb2luLCBwbGVhc2UgY2hlY2sgY29kZSBhbmQgdHJ5IGFnYWluIik7Cn0nAMrK8KIL9BgGc2VhcmNoAgQAysrwoguSPSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDKyvCiC/QYCWFiMUlnbm9yZQIEAMrK8KILuT0EdHJ1ZSgAysrwogv0GA1hYjFCb3RWZXJzaW9uAX0VJwDKyvCiC/QYBG1lbnUCBADKyvCiC789KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAMrK8KIL5j0Gc3lzdGVtAgQAysrwogvnPQ9hYi0xLmNvcmUuc3RvcmUoAMrK8KIL5j0HYWIxQ29yZQF4JwDKyvCiC+Y9BGZvcm0CBADKyvCiC/g9B25vdGhpbmcnAMrK8KIL5j0LZGVzY3JpcHRpb24CBADKyvCiC4A+P1RoaXMgc2tpbGwgaXMgbWVhbnQgdG8gYmUgYSBjb25maWd1cmFibGUgbWVhbnMgdG8gcHVibGlzaCBkYXRhLicAysrwogvmPRBhYjFQdWJsaXNoUmVjb3JkAgQAysrwogvAPoUCQGxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIHJlY29yZERhdGE7JwDKyvCiC+Y9DmFiMVB1Ymxpc2hGaWxlAgQAysrwogvGQIYDQGxldCBmaWxlID0gdGhhdC5maWxlOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGVOYW1lOwpsZXQgbWltZVR5cGUgPSB0aGF0Lm1pbWVUeXBlOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwoKaWYgKCFmaWxlKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgc3VwcGxpZWQiOwp9CgpsZXQgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIGZpbGVVcGxvYWQ7JwDKyvCiC+Y9EWFiMUNvcmVNZW51QWN0aW9uAgQAysrwogvNQxdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycAysrwogvmPQtvblN0b3JlTWVudQIEAMrK8KIL5UOiOUBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7IjsKCmNvbnN0IHV1YWIgPSBsaW5rcy5yZW1lbWJlci50YWdzLnV1YWIgPyB0cnVlIDogZmFsc2U7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzU1RTY3OSI7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYjFEb3dubG9hZCgpO2A7CgovL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5wb2ludGFibGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IG51bGw7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDAuNzU7CiAgICAKICAgIC8vY3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5kaW1lbnNpb24gPSAiYWIxTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTE7CiAgICBtZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gImF1dG9tYXRpYyI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KCm1lbnVCdXR0b24uZGltZW5zaW9uID0gbnVsbDsKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJlZ2ciOwoKaWYgKHV1YWIpCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAicXJfY29kZV9zY2FubmVyIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IHRydWU7CgogICAgICAgICAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKICAgICAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzY2FuIHlvdXIgcHJhY3RpY2UgcGVybWl0Iik7CiAgICAgICAgfQogICAgICAgIGNhdGNoCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgicXIgY29kZSBzY2FuIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UiKTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMgPyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRm9jdXNEYXRhOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQogICAgICAgIHsKICAgICAgICAgICAgdGhhdC50ZXh0ID0gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50ZXh0KQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWV9KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImFiIG5vdCBzcGVjaWZpZWQiKTsKCiAgICAgICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdEZvY3VzOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MudGFyZ2V0Qm90OwogICAgbGV0IHByZXBwZWRCb3QgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEJvdCk7CiAgICBsZXQgc3RhdGUgPSB7fQoKICAgIHN0YXRlW2FiMUluc3RNZW1vcnkudGFncy5hYjFGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgCiAgICAvL2NyZWF0ZSAgY29weSB0byBjbGlwYm9hcmQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDEwOwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInNjYW4iOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIC8vTkVFRCBUTyBVUERBVEUKICAgIC8vIGlmIChjb25maWdCb3QudGFncy5naWcpCiAgICAvLyB7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTU7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIC8vICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgLy8gICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIC8vICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWIxQ29sbGFiU3VibWl0Iik7YDsKCiAgICAvLyAgICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgLy8gfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHt9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9Cgpob3N0QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwpob3N0QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSA1MDsKaG9zdEJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwpob3N0QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwpob3N0QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKaG9zdEJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7Cmhvc3RCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmxlYXJuLmFiMUNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihob3N0QnV0dG9uKTsvL2dlbmVyYXRlIGEgaG9zdCBidXR0b24nAMrK8KIL5j0PYWIxQ29yZU1lbnVJY29uAgQAysrwogv4fAlpb3Nfc2hhcmUnAMrK8KIL5j0QYWIxQ29yZU1lbnVMYWJlbAIEAMrK8KILgn0Fc2hhcmUnAMrK8KIL5j0UYWIxQ29yZU1lbnVTb3J0T3JkZXICBADKyvCiC4h9ATMnAMrK8KIL5j0IcmVtZW1iZXICBADKyvCiC4p9KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMrK8KIL5j0MYWIxUHVibGlzaEFCAgQAysrwoguxfeYmQC8vc2hvdXQoImFiMVB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIxLmxvZygiYWItMSBwdWJsaXNoIik7CgpzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCk7CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYjFNZW51IjsKCiAgICBsZXQgbWVudUJ1dHRvbiA9IHt9OwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IHRydWU7CiAgICBtZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7CiAgICBtZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7CiAgICBtZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKICAgIG1lbnVCdXR0b24ubGFiZWwxID0gInVwbG9hZGluZy4uIjsKICAgIG1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7CiAgICBtZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwogICAgbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKICAgIG1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCiAgICBwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldDsKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBzdGF0ZSA9IHt9OwpsZXQgZm9ybWF0dGVkRmlsZSA9IHt9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIHRhcmdldCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzOwp9CmVsc2UgaWYgKCF0YXJnZXQpCnsKICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWIxSWdub3JlOiBudWxsfSkpOwoKICAgIGlmICh0YXJnZXQubGVuZ3RoIDwgMSkKICAgIHsKICAgICAgICBvcy50b2FzdCgiTm8gYm90cyBmb3VuZCB0byBwdWJsaXNoIik7CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCmxldCBlZ2dDaGVjayA9IGF3YWl0IHRoaXNCb3QuYWIxUHJldmlvdXNFZ2dDaGVjayh7YWJJRDogYWJJRH0pOwoKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCmxldCBwdWJsaXNoRmlsZSA9IGF3YWl0IHRoaXNCb3QuYWIxUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiMVB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUR9KTsKbGV0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKc2hvdXQoIm9uQUJQdWJsaXNoZWQiLCB7c3VjY2VzczogcHVibGlzaEZpbGUuc3VjY2VzcywgYWI6IGFiSUQsIGZpbGVBZGRyZXNzOiBwdWJsaXNoRmlsZS51cmx9KQoKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IGdpZ0FCID0gY29uZmlnQm90LnRhZ3MuYWIgfHwgY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgfHwgY29uZmlnQm90LnRhZ3MuYXV4Q29kZTsKICAgIGxldCBnaWdLZXkgPSBnaWdBQiA/IGdpZ0FCLnN1YnN0cmluZyg3KSA6ICJub25lIjsKICAgIGxldCBnaWdGb3JtYXQgPSAiY29sbGFiXyI7CiAgICBsZXQgZ2lnRm9ybWF0Q2hlY2sgPSBhYklELmluY2x1ZGVzKGdpZ0Zvcm1hdCk7CgogICAgaWYgKGdpZ0Zvcm1hdENoZWNrICYmIGtleSA9PSBnaWdLZXkgJiYga2V5KSAKICAgIHsKICAgICAgICAvL05PIENPUFkgTkVDRVNTQVJZCiAgICB9CiAgICBlbHNlIGlmIChrZXkgJiYgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkgCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCArICIma2V5PSIgKyBrZXkpOwoKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQoKICAgIGlmIChrZXkpIAogICAgewogICAgICAgIHdlYmhvb2sucG9zdCgiaHR0cHM6Ly9xbmhjYTJzN2ljLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3NsYWNrL1QwMjlBUDRDUS9CMDFLTlRCODIwMS9nQ09QbHFRSHNSUDN0Qks5UFlISkJtTnAiLCB7ICJ0ZXh0IjogYFBSSVZBVEUgJHthYklEfSB2JHtlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aH0gcmVjb3JkICR7cHVibGlzaEZpbGUuc2hhMjU2SGFzaH1gIH0sIGBPcmlnaW46ICR7c2l0ZU9yaWdpbn1gKTsKICAgIH0KICAgIGVsc2UgCiAgICB7CiAgICAgICAgd2ViaG9vay5wb3N0KCJodHRwczovL3FuaGNhMnM3aWMuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc2xhY2svVDAyOUFQNENRL0IwMUtOVEI4MjAxL2dDT1BscVFIc1JQM3RCSzlQWUhKQm1OcCIsIHsgInRleHQiOiBgJHthYklEfSB2JHtlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aH0gcmVjb3JkICR7cHVibGlzaEZpbGUuc2hhMjU2SGFzaH1gIH0sIGBPcmlnaW46ICR7c2l0ZU9yaWdpbn1gKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYjFfZWdnX3B1Ymxpc2gnLCB7IGFiOiBhYklELCB2ZXJzaW9uOiBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aCB9KTsKICAgIH0KICAgIGNhdGNoIChlKSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgIH0KfQplbHNlCnsKICAgIGNvbnNvbGUubG9nKHB1Ymxpc2hSZWNvcmQpOwp9CgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9Cgpjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gbnVsbDsKCnJldHVybiBwdWJsaXNoUmVjb3JkOycAysrwogvmPQlhYjFJZ25vcmUCBADKyvCiC5ikAQR0cnVlJwDKyvCiC+Y9C2FiMURvd25sb2FkAgQAysrwogudpAGbA0BsZXQgZG93bmxvYWRCb3RzOwoKaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQp7CiAgICBkb3dubG9hZEJvdHMgPSBbbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXNdOwoKICAgIGFiMS5sb2coImRvd25sb2FkaW5nIGJvdCIpOwp9CmVsc2UKewogICAgZG93bmxvYWRCb3RzID0gZ2V0Qm90cyhieU1vZCh7ImFiMUlnbm9yZSI6IG51bGwsICJzcGFjZSI6ICJzaGFyZWQifSkpOwoKICAgIGFiMS5sb2coImRvd25sb2FkaW5nIGluc3QiKTsKfQoKbGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKCm9zLmRvd25sb2FkQm90cyhkb3dubG9hZEJvdHMsIGN1cnJlbnRJbnN0KTsKCnNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOycAysrwogvmPQ1tYW5pZmVzdGF0aW9uAgQAysrwogu5pwEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAysrwogvmPQRtZW51AgQAysrwogvgpwEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAysrwogvmPRNhYjFQcmV2aW91c0VnZ0NoZWNrAgQAysrwoguHqAGIDUBjb25zdCBhYklEID0gdGhhdC5hYklEOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCByZWNvcmRMb29rdXAgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5LCBhYklELCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rLyIpLmNhdGNoKGUgPT4ge30pOwoKaWYgKHJlY29yZExvb2t1cC5zdWNjZXNzKSAKewogICAgZWdnSGlzdG9yeSA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ1ZlcnNpb25IaXN0b3J5OwogICAgZWdnSUQgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dJRDsKICAgIHRhcmdldFZlcnNpb25OdW0gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7CiAgICBsYXN0SGFzaCA9IGVnZ0hpc3RvcnlbdGFyZ2V0VmVyc2lvbk51bSAtIDFdOwogICAgbWF4VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKfSAKZWxzZSAKewogICAgZWdnSGlzdG9yeSA9IFtdOwogICAgZWdnSUQgPSB1dWlkKCk7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gMTsKICAgIGxhc3RIYXNoID0gIm5vbmUiOwogICAgbWF4VmVyc2lvbk51bSA9IDE7Cn0KCmlmIChjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCkgCnsKICAgIGNvbnN0IGRlZmluZWRWZXJzaW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KG1heFZlcnNpb25OdW0sIHsKICAgICAgICB0aXRsZTogJ3NldCBkZWZhdWx0IHZlcnNpb24nLAogICAgICAgIHBsYWNlaG9sZGVyOiBgMSB0byAke21heFZlcnNpb25OdW19IChsZWF2ZSBhcyAke21heFZlcnNpb25OdW19IGZvciBsYXRlc3QpYAogICAgfSk7CgogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGRlZmluZWRWZXJzaW9uOwogICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb24pIAp7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gY29uZmlnQm90LnRhZ3MudGFyZ2V0VmVyc2lvbjsKICAgIGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb24gPSBudWxsOwp9CgpsZXQgZWdnID0ge307CgplZ2cuZWdnVmVyc2lvbkhpc3RvcnkgPSBlZ2dIaXN0b3J5OwplZ2cuZWdnRm9ybWF0VmVyc2lvbiA9IGVnZ0lEOwplZ2cudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb25OdW07CmVnZy5tYXhWZXJzaW9uID0gbWF4VmVyc2lvbk51bTsKZWdnLmxhYmVsID0gInYiK3RhcmdldFZlcnNpb25OdW07CmVnZy5hYklEID0gYWJJRDsKCmxldCBzaWduYXR1cmUgPSB7fTsKbGV0IGRhdGUgPSBuZXcgRGF0ZSgpOwpsZXQgdGltZSA9IGRhdGUuZ2V0VGltZSgpOwoKc2lnbmF0dXJlLnByZXZpb3VzSGFzaCA9IGxhc3RIYXNoOwpzaWduYXR1cmUuYWIxVmVyc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxQ29yZVZlcnNpb24rIi4iK2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxQ29yZUl0ZXJhdGlvbjsKc2lnbmF0dXJlLmVnZ1ZlcnNpb24gPSB0YWdzLmVnZ1VVSUQ7CnNpZ25hdHVyZS5lZ2dWZXJzaW9uTnVtID0gdGFncy5vdm9WZXJzaW9uOwpzaWduYXR1cmUudGltZVN0YW1wID0gdGltZTsKc2lnbmF0dXJlLmNhc3VhbE9TVmVyc2lvbiA9IFtvcy52ZXJzaW9uKCldOwoKcmV0dXJuIHtzaWduYXR1cmU6IHNpZ25hdHVyZSwgZWdnRGF0YTogZWdnfTsoAMrK8KIL5j0NYWIxQm90VmVyc2lvbgF9FScAysrwogvmPRBhYjFCb3RNZW51QWN0aW9uAgQAysrwoguRtQEXQHRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAMrK8KIL5j0PYWIxQm90TWVudUxhYmVsAgQAysrwoguptQEFc2hhcmUnAMrK8KIL5j0OYWIxQm90TWVudUljb24CBADKyvCiC6+1AQlpb3Nfc2hhcmUnAMrK8KIL5j0TYWIxQm90TWVudVNvcnRPcmRlcgIEAMrK8KILubUBATMoAMrK8KIL5j0Mb25GaWxlVXBsb2FkAX4nAMrK8KIL5j0FbGVhcm4CBADKyvCiC7y1ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDKyvCiC+Y9DmFiMVB1Ymxpc2hVVUFCAgQAysrwogvjtQHvD0Bjb25maWdCb3QudGFncy51dWFiU2NhbiA9IG51bGw7CgpsZXQgdXVhYkNvbmZpZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnV1YWIsIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbGV0IHBpbiA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLHsKICAgIHRpdGxlOiAiZW50ZXIgcGluIiwKICAgIHR5cGU6ICJzZWNyZXQiCn0pOwoKaWYgKHBpbikKewogICAgbGV0IHBoID0gY3J5cHRvLnNoYTI1NihwaW4pLnN1YnN0cmluZygwLDQpOwoKICAgIGlmIChwaCA9PSBjb25maWdCb3QudGFncy5waCkKICAgIHsKICAgICAgICBsZXQgcmVjb3JkS2V5OwogICAgICAgIGxldCBlZ2dEYXRhQ2hlY2s7CiAgICAgICAgbGV0IGVnZ0RhdGE7CgogICAgICAgIGZvciAodGFnIGluIHV1YWJDb25maWcuc3RhdGUpCiAgICAgICAgewogICAgICAgICAgICBpZiAodGFnKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWNvcmRLZXkgPSB1dWFiQ29uZmlnLnN0YXRlW3RhZ10udGFncy5yZWNvcmRLZXk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGF0KQogICAgICAgIHsKICAgICAgICAgICAgZWdnRGF0YUNoZWNrID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUVuZHBvaW50KTsKCiAgICAgICAgICAgIGlmIChlZ2dEYXRhQ2hlY2suc3VjY2VzcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gSlNPTi5wYXJzZShlZ2dEYXRhQ2hlY2suZGF0YS5lZ2dzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZ2dEYXRhLmxlbmd0aCA+PSAxMikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MudG9hc3QoInByYWN0aWNlIHBlcm1pdCBmdWxsIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoImFiMVJlZnJlc2giKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJlZ2cgZGF0YSBub3QgcmVhZGFibGUiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYjFSZWNvcmRLZXkgPSByZWNvcmRLZXk7CgogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOwoKICAgICAgICB0aGlzQm90LmFiMVB1Ymxpc2hBQih7YWI6IGNvbmZpZ0JvdC50YWdzLmFiLCBrZXk6IGNvbmZpZ0JvdC50YWdzLmtleX0pOwoKICAgICAgICBlZ2dEYXRhLnB1c2goY29uZmlnQm90LnRhZ3MuYWIpOwoKICAgICAgICBlZ2dEYXRhVG9QdWJsaXNoID0ge2VnZ3M6IEpTT04uc3RyaW5naWZ5KGVnZ0RhdGEpfTsKCiAgICAgICAgYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBlZ2dEYXRhVG9QdWJsaXNoLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUVuZHBvaW50KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBhd2FpdCBvcy50b2FzdCgicGluIGRvZXMgbm90IG1hdGNoIiwgMik7CgogICAgICAgIHNob3V0KCJhYjFSZWZyZXNoIik7CiAgICB9Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy50b2FzdCgibm8gcGluIGdpdmVuIiwgMik7CgogICAgc2hvdXQoImFiMVJlZnJlc2giKTsKCiAgICByZXR1cm4KfScAysrwogvmPQxhYjFRUlB1Ymxpc2gCBADKyvCiC9PFAfIEQGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gbnVsbDsKCmxldCBzY2FubmVkVVJMOwoKdHJ5IAp7CiAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKfQpjYXRjaCAoZSkgewogICAgc2hvdXQoImFiMVB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWIxUHVibGlzaEFCKHthYjogdGhhdH0pOwoKICAgIHJldHVybjsKfQoKaWYgKHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKSkgCnsKICAgIGxldCB0YXJnZXRSZWNvcmQgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImluc3QiKTsKCiAgICBjb25maWdCb3QudGFncy51dWFiID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhYiIpOwogICAgY29uZmlnQm90LnRhZ3MucGggPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIik7CiAgICBjb25maWdCb3QudGFncy5hYiA9IHV1aWQoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmtleSA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKCiAgICB0aGlzQm90LmFiMVB1Ymxpc2hVVUFCKHt0YXJnZXRSZWNvcmQ6IHRhcmdldFJlY29yZH0pOwp9CmVsc2UgCnsKICAgIG9zLnRvYXN0KCJ1bnN1cHBvcnRlZCB1cmwgZm9ybWF0Iik7Cn0nAMrK8KIL5j0Gc2VhcmNoAgQAysrwogvGygEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScBBGJvdHMkZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1AScAysrwogvtygEGc3lzdGVtAgQAysrwogvuygEQYWItMS5jb3JlLnNlYXJjaCcAysrwogvtygEEZm9ybQIEAMrK8KIL/8oBB25vdGhpbmcnAMrK8KIL7coBB2FiMUNvcmUCBADKyvCiC4fLAQR0cnVlJwDKyvCiC+3KAQ9hYjFSZXRyaWV2ZUZpbGUCBADKyvCiC4zLAWxAaWYgKCF0aGF0LnVybCkKewogICAgcmV0dXJuICJubyBmaWxlIHVybCBzdXBwbGllZCI7Cn0KCmxldCBkYXRhID0gYXdhaXQgb3MuZ2V0RmlsZSh0aGF0LnVybCk7CgpyZXR1cm4gZGF0YTsnAMrK8KIL7coBEWFiMVJldHJpZXZlUmVjb3JkAgQAysrwogv5ywHpAkBsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8gdGhhdC5yZWNvcmRLZXkgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleTsKbGV0IHJlY29yZEVuZHBvaW50ID0gdGhhdC5yZWNvcmRFbmRwb2ludCA/IHRoYXQucmVjb3JkRW5kcG9pbnQgOiAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIjsKCmlmICghcmVjb3JkTmFtZSkKewogICAgcmV0dXJuICJubyByZWNvcmQgbmFtZSBzdXBwbGllZCI7Cn0KCmxldCBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgcmVjb3JkTmFtZSwgcmVjb3JkRW5kcG9pbnQpOwoKcmV0dXJuIGdldFJlY29yZDsoAMrK8KIL7coBEWFiMUNvcmVNZW51QWN0aW9uAX4oAMrK8KIL7coBDG9uU2VhcmNoTWVudQF+KADKyvCiC+3KAQ9hYjFDb3JlTWVudUljb24BfigAysrwogvtygEQYWIxQ29yZU1lbnVMYWJlbAF+KADKyvCiC+3KARVhYjFDb3JlTWVudU9uR2VuZXJhdGUBfigAysrwogvtygEUYWIxQ29yZU1lbnVTb3J0T3JkZXIBficAysrwogvtygEIcmVtZW1iZXICBADKyvCiC+nOASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDKyvCiC+3KAQ1tYW5pZmVzdGF0aW9uAgQAysrwoguQzwEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAysrwogvtygEPb25Mb29rdXBBQjFFZ2dzAgQAysrwogu3zwHIG0AvL3Nob3V0KCJvbkxvb2t1cEFCMUVnZ3MiLCB7YWJJRDogYWJJRCwga2V5OiBrZXksIGF1dG9IYXRjaDogYm9vbGVhbiwgcmV0dXJuVHlwZTogZGF0YS9udWxsfSk7CmFiMS5sb2coImFiLTEgYWIgbG9hZCAiICsgdGhhdCk7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwp9Cgpjb25zdCBhYklEID0gdGhhdC5hYklEOwpjb25zdCBrZXkgPSB0aGF0LmtleTsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKY29uc3QgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKY29uc3QgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgYWJJRCwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CgpsZXQgbmV3RWdnOwoKaWYgKCFnZXRSZWNvcmQuc3VjY2VzcyAmJiBjb25maWdCb3QudGFncy5naWcpLy9CUklORyBJTiBJTklUQUlBTCBDT0xMQUIgU0VUVVAKewogICAgY29uc3QgY29sbGFiQm90ID0gZ2V0Qm90KCJhYklET3JpZ2luIiwgImNvbGxhYlNldHVwIik7CgogICAgaWYgKCFjb2xsYWJCb3QpCiAgICB7CiAgICAgICAgdGhpc0JvdC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6ICJjb2xsYWJTZXR1cCIsIGF1dG9IYXRjaDogdHJ1ZX0pOwogICAgfQp9CmVsc2UgaWYgKCFnZXRSZWNvcmQuc3VjY2VzcykKewogICAgLy9NQVlCRSBSRU1PVkUgVEhJUyBTT09OPz8/CiAgICBjb25zb2xlLmxvZyhnZXRSZWNvcmQsICJjaGVja2luZyBvbGQgU1RNIik7CgogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoYWJJRCk7CiAgICBsZXQgZmlsZXVybGhhc2ggPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2ggKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0VVJMID0gImh0dHBzOi8vYnVpbGRlci1zdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2g7CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBsZXQgbHRtUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgICAgICBuZXdFZ2cgPSBsdG1SZXNwb25zZS5kYXRhLnN0YXRlOwoKICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIG5ld0VnZykKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IG5ld01PRCA9IG5ld0VnZ1twcm9wZXJ0eV07CgogICAgICAgICAgICBuZXdFZ2cgPSBuZXdNT0Q7CiAgICAgICAgfQogICAgfSAKICAgIGNhdGNoIChlKSAKICAgIHsKCiAgICAgICAgb3MudG9hc3QoYG5vIGRhdGEgZm91bmQgaW4gJHthYklEfWApOwoKICAgICAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgcmV0dXJuICJhYklEIG5vdCBmb3VuZCI7CiAgICB9Cn0KZWxzZQp7CiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgcmV0dXJuIHJldHVybkRhdGE7Cn0KZWxzZSBpZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIpCnsKICAgIGxldCB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG5ld0VnZy5lZ2dWZXJzaW9uSGlzdG9yeSk7CiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbbmV3RWdnLm1heFZlcnNpb24gLSAxXTsKICAgIGxldCBmaWxlbmFtZWhhc2hMVE0gPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaExUTSA9ICJhdXhfIiArIGZpbGVuYW1laGFzaExUTSArICcuYXV4JzsKICAgIGxldCB0YXJnZXRMVE1VUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaExUTTsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRMVE1VUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KCiAgICByZXR1cm4gZmlsZUdldDsKfQoKbGV0IGN1cnJlbnREaW07CmxldCBzcGFjZU1vZDsKbGV0IGRpbWVuc2lvblg7CmxldCBkaW1lbnNpb25ZOwpsZXQgZGltTW9kOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGNvbnN0IGFiMUJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90OwoKICAgIGN1cnJlbnREaW0gPSBhYjFCb3QudGFncy5kaW1lbnNpb247Cn0KZWxzZQp7CiAgICBjdXJyZW50RGltID0gb3MuZ2V0Q3VycmVudERpbWVuc2lvbigpOwp9CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxR3JpZEZvY3VzKSAKewogICAgZGltZW5zaW9uWCA9IG51bGw7CiAgICBkaW1lbnNpb25ZID0gbnVsbDsKfQplbHNlCnsKICAgIGxldCBoYXRjaFBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYjFHcmlkRm9jdXM7CgogICAgY3VycmVudERpbSA9IGhhdGNoUG9pbnQuZGltZW5zaW9uOwogICAgZGltZW5zaW9uWCA9IGhhdGNoUG9pbnQucG9zaXRpb24ueDsKICAgIGRpbWVuc2lvblkgPSBoYXRjaFBvaW50LnBvc2l0aW9uLnk7CiAgICBzcGFjZU1vZCA9IHtzcGFjZTogInNoYXJlZCJ9Owp9CgppZiAoIWF1dG9IYXRjaCAmJiBjb25maWdCb3QudGFncy5hYiA9PSBudWxsKQp7CiAgICBkaW1Nb2QgPSB7W2N1cnJlbnREaW1dOiB0cnVlLCBbY3VycmVudERpbSsiWCJdOiBkaW1lbnNpb25YLCBbY3VycmVudERpbSsiWSJdOiBkaW1lbnNpb25ZLCBkaW1lbnNpb246IGN1cnJlbnREaW19Owp9CmVsc2UKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmtleSAmJiAhdGhhdC5rZXkpCiAgICB7CiAgICAgICAga2V5ID0gY29uZmlnQm90LnRhZ3Mua2V5CiAgICB9CgogICAgZGltTW9kID0ge2F1dG9IYXRjaDogdHJ1ZSwga2V5OiBrZXl9Owp9Cgp0aGlzQm90Lm1hbmlmZXN0T3ZvKHthYklEOiBhYklELCBkaW1Nb2Q6IGRpbU1vZCwgc3BhY2VNb2Q6IHNwYWNlTW9kLCBlZ2dEYXRhOiBuZXdFZ2csIGluaXRpYWxCb290OiBpbml0aWFsQm9vdH0pOycAysrwogvtygELbWFuaWZlc3RPdm8CBADKyvCiC4DrAdYKQHNob3V0KCJhYjFNZW51UmVzZXQiKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYjFCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCk7CiAgICB9Cn0KCmlmIChsaW5rcy5vdm9Cb3QpCnsKICAgIGRlc3Ryb3kobGlua3Mub3ZvQm90KTsKfQoKbGV0IHNwYWNlTW9kID0gdGhhdC5zcGFjZU1vZDsKbGV0IGRpbU1vZCA9IHRoYXQuZGltTW9kOwpsZXQgZWdnRGF0YSA9IHRoYXQuZWdnRGF0YTsKbGV0IGVnZ01vZCA9IHt9OwoKZWdnTW9kLnNwYWNlID0gInRlbXBMb2NhbCI7CmVnZ01vZC5pbml0aWFsVGltZXIgPSB0cnVlOwplZ2dNb2QuYWJJRCA9IHRoYXQuYWJJRDsKZWdnTW9kLmluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKZWdnTW9kLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNb2Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIuaW50ZXJhY3RPdm8oKTtgOwplZ2dNb2Qub25DcmVhdGUgPSBgQCBpZiAodGFncy5hdXRvSGF0Y2gpCnsKICAgIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8odGhpc0JvdCk7Cn0KZWxzZQp7CiAgICB0YWdzLnByb2dyZXNzQmFyID0gMDsgCgogICAgc2V0VGltZW91dCgoKSA9PiB7d2hpc3Blcih0aGlzQm90LCAiZWdnVGltZXIiKTt9LCA3NSk7Cn1gOwplZ2dNb2QuZm9ybSA9ICJlZ2ciOwplZ2dNb2QucHJvZ3Jlc3NCYXJDb2xvciA9ICIjQkY1RTY2IjsKZWdnTW9kLnByb2dyZXNzQmFyQmFja2dyb3VuZENvbG9yID0gIiM1OTI5ODkiOwplZ2dNb2QubGFiZWxTaXplID0gMC41OwplZ2dNb2QubGFiZWxDb2xvciA9ICIjNDA0MDQwIjsKZWdnTW9kLm9uUG9pbnRlckVudGVyID0gIkAgb3MudG9hc3QodGFncy5hYklEICsgJyB2Jyt0YWdzLnRhcmdldFZlcnNpb24pOyI7CmVnZ01vZC5sYWJlbFBvc2l0aW9uID0gImZyb250IjsKZWdnTW9kLm9yaWVudGF0aW9uTW9kZSA9ICJiaWxsYm9hcmRGcm9udCI7CmVnZ01vZC5vbkRlc3Ryb3kgPSBgQCBsaW5rcy5tYW5hZ2VyLm1hc2tzLm92b0JvdCA9IG51bGw7YDsKZWdnTW9kLmVnZ1RpbWVyID0gYEAgaWYgKHRhZ3MucHJvZ3Jlc3NCYXIgPCAxKSAKewogICAgdGFncy5wcm9ncmVzc0JhciArPSAwLjE7CgogICAgc2V0VGltZW91dCgoKSA9PiB7d2hpc3Blcih0aGlzQm90LCAiZWdnVGltZXIiKTt9LCA3NSk7Cn0KZWxzZQp7CiAgICB0aGlzQm90Lm9uQ2xpY2soKTsKICAgIAogICAgdGFncy5wcm9ncmVzc0JhciA9IG51bGw7Cn1gOwoKbGV0IG92byA9IGNyZWF0ZShlZ2dEYXRhLCBlZ2dNb2QsIGRpbU1vZCwgc3BhY2VNb2QpOwoKbWFza3Mub3ZvQm90ID0gIvCflJciICsgb3ZvLmlkOygAysrwogvtygEIb3ZvSGF0Y2gBficAysrwogvtygEJb25LZXlEb3duAgQAysrwogvU9QG0BUBpZiAoIWxpbmtzLm92b0JvdCB8fCBjb25maWdCb3QudGFncy5tZW51UG9ydGFsICE9ICJvdm8iKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gIlNoaWZ0IikKewogICAgbGV0IHZlcnNpb25CdXR0b24gPSB7fTsKCiAgICB2ZXJzaW9uQnV0dG9uLm92byA9IHRydWU7CiAgICB2ZXJzaW9uQnV0dG9uLm92b1NvcnRPcmRlciA9IC0xOwogICAgdmVyc2lvbkJ1dHRvbi5tYXhWZXJzaW9uID0gbGlua3Mub3ZvQm90LnRhZ3MubWF4VmVyc2lvbjsKICAgIHZlcnNpb25CdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CiAgICB2ZXJzaW9uQnV0dG9uLmxhYmVsID0gImNoYW5nZSBlZ2cgdmVyc2lvbiI7CiAgICB2ZXJzaW9uQnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICB2ZXJzaW9uQnV0dG9uLm92b01lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKICAgIHZlcnNpb25CdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uS2V5VXAgPSAiQCBpZih0aGF0LmtleXMgPT0gJ1NoaWZ0Jyl7ZGVzdHJveSh0aGlzQm90KX07IjsKICAgIHZlcnNpb25CdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuY2hhbmdlT3ZvVmVyc2lvbigpOyI7CgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKHZlcnNpb25CdXR0b24pOwp9JwDKyvCiC+3KAQhoYXRjaE92bwIEAMrK8KILh/sB7gxAc2hvdXQoJ292b01lbnVSZXNldCcpOwoKY29uc3Qgb3ZvID0gdGhhdDsKCmxldCBpbml0aWFsQm9vdCA9IG92by50YWdzLmluaXRpYWxCb290OwpsZXQgdGFyZ2V0VmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiAmJiBjb25maWdCb3QudGFncy5hYiA9PSBvdm8udGFncy5hYklEID8gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uIDogb3ZvLnRhZ3MudGFyZ2V0VmVyc2lvbjsKbGV0IHZlcnNpb25BcnJheSA9IG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5OwpsZXQgZmlsZVVSTCA9IHZlcnNpb25BcnJheVt0YXJnZXRWZXJzaW9uIC0gMV07CmxldCBrZXkgPSBvdm8udGFncy5rZXkgPyBvdm8udGFncy5rZXkgOiBjb25maWdCb3QudGFncy5rZXk7CmxldCBmaWxlR2V0OwoKdHJ5CnsKICAgIGZpbGVHZXQgPSBhd2FpdCBvcy5nZXRGaWxlKGZpbGVVUkwpOwp9CmNhdGNoIChlcnJvcikKewogICAgY29uc29sZS5sb2coImNoZWNraW5nIG9sZCBMVE0iLCBlcnJvcik7CgogICAgdmVyc2lvbkFycmF5ID0gSlNPTi5wYXJzZShvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeSk7CgogICAgbGV0IGZpbGVVVUlEID0gdmVyc2lvbkFycmF5W292by50YWdzLnRhcmdldFZlcnNpb25dOwogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoID0gImF1eF8iICsgZmlsZW5hbWVoYXNoICsgJy5hdXgnOwogICAgbGV0IHRhcmdldFVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldFVSTDsKCiAgICBmaWxlR2V0ID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBmaWxlR2V0ID0gZmlsZUdldC5kYXRhOwogICAgfQp9CgppZiAoY3J5cHRvLmlzRW5jcnlwdGVkKGZpbGVHZXQpKQp7CiAgICBpZiAoIWtleSkKICAgIHsKICAgICAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoJycsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnRW50ZXIga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIHRyeQogICAgewogICAgICAgIGZpbGVHZXQgPSBjcnlwdG8uZGVjcnlwdChrZXksIGZpbGVHZXQpOwogICAgfQogICAgY2F0Y2ggKGVycm9yKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQoKICAgICAgICBvcy50b2FzdCgia2V5IGRvZXMgbm90IG1hdGNoIGZpbGUiKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAKICAgIGZpbGVHZXQgPSBKU09OLnBhcnNlKGZpbGVHZXQpOwoKICAgIGZpbGVHZXQgPSBmaWxlR2V0LnN0YXRlOwp9CmVsc2UKewogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KCmRlc3Ryb3kob3ZvKTsKCmxpbmtzLmNyZWF0ZS5hYjFDcmVhdGVCb3RzKHtib3RzOiBmaWxlR2V0LCBvcmlnaW46IG92by50YWdzLmFiSUQsIHZlcnNpb246IHRhcmdldFZlcnNpb24sIGluaXRpYWxCb290OiBpbml0aWFsQm9vdH0pOycAysrwogvtygELaW50ZXJhY3RPdm8CBADKyvCiC/aHAvsGQGNvbnN0IG92b0JvdCA9IHRoYXQgPyB0aGF0IDogbGlua3Mub3ZvQm90OwoKaWYgKCFvdm9Cb3QpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoIm92b01lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAib3ZvIjsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgc2hvdXQoIm92b01lbnVSZXNldCIpO2A7Cm1hc2tzLm92b01lbnVSZXNldCA9IGBAIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gbnVsbDsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBlZ2dNZW51QnV0dG9uID0ge307Cgpvcy50d2VlblRvKG92b0JvdCwgMTUsNDUsNDUsIDUpOwoKZWdnTWVudUJ1dHRvbi5vdm8gPSB0cnVlOwplZ2dNZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNZW51QnV0dG9uLm92b0JvdCA9ICLwn5SXIiArIG92b0JvdC5pZDsKZWdnTWVudUJ1dHRvbi50YXJnZXRWZXJzaW9uID0gb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbCA9ICJoYXRjaCAiICsgb3ZvQm90LnRhZ3MuYWJJRCArICIgdiIgKyBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uICsgIiBvZiAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwplZ2dNZW51QnV0dG9uLm92b01lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKZWdnTWVudUJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKZWdnTWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5oYXRjaE92byhsaW5rcy5vdm9Cb3QpOyI7CgpsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24oZWdnTWVudUJ1dHRvbik7JwDKyvCiC+3KAQZjcmVhdGUCBADKyvCiC+6OAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDKyvCiC+3KAQxhYjFMVE1TZWFyY2gCBADKyvCiC5WPAh9AdGhpc0JvdC5vbkxvb2t1cEFCMUVnZ3ModGhhdCk7JwDKyvCiC+3KARBjaGFuZ2VPdm9WZXJzaW9uAgQAysrwogu1jwL7AUBjb25zdCBvdm9Cb3QgPSBsaW5rcy5vdm9Cb3Q7CgpsZXQgbmV3VmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dEZvclRhZyhvdm9Cb3QsICJ0YXJnZXRWZXJzaW9uIiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MubGFiZWwgPSAndicrIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CgpzaG91dCgib3ZvTWVudVJlc2V0Iik7JwDKyvCiC+3KAQRtZW51AgQAysrwoguxkQIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAysrwogvtygEJYWIxSWdub3JlAgQAysrwogvYkQIEdHJ1ZSgAysrwogvtygENYWIxQm90VmVyc2lvbgF9FScBBGJvdHMkZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3AScAysrwogvekQIGc3lzdGVtAgQAysrwogvfkQISYWItMS5jb3JlLnJlbWVtYmVyJwDKyvCiC96RAgRmb3JtAgQAysrwogvykQIHbm90aGluZygAysrwogvekQIHYWIxQ29yZQF4KADKyvCiC96RAg1hYjFBd2FrZVN0YXRlAXknAMrK8KIL3pECC2Rlc2NyaXB0aW9uAgQAysrwogv8kQIrVGhpcyBpcyBtZWFudCB0byBiZSB0aGUgbG9jYWwgc3RhdGUgaG9sZGVyLicAysrwogvekQIMYWIxUmVjb3JkS2V5AgQAysrwoguokgIudlJLMS5ZV0l0TVE9PS5OSFpzVUd0b05tRkdZM0ZKZGpKVE1tczFORmxxVVQwOScAysrwogvekQISYWIxQWN0aXZlRGltZW5zaW9uAgQAysrwogvXkgIEaG9tZScAysrwogvekQIMYWIxQmFzZUNvbG9yAgQAysrwogvckgIHIzkwOEJGQygAysrwogvekQIQYWIxR3JpZFNuYXBTdGF0ZQF4KADKyvCiC96RAg9hYjFCb3RTbmFwU3RhdGUBeCcAysrwogvekQIOYWIxTWVudVJlZnJlc2gCBADKyvCiC+aSAhhAY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsoAMrK8KIL3pECC2luaXRpYWxCb290AXgnAMrK8KIL3pECC2FiMUVuZHBvaW50AgQAysrwoguAkwIWaHR0cHM6Ly9wdWJsaWNvcy5saW5rLycAysrwogvekQIJYWIxSWdub3JlAgQAysrwoguXkwIEdHJ1ZScAysrwogvekQIOYWIxQ29yZVZlcnNpb24CBADKyvCiC5yTAgE5KADKyvCiC96RAg1hYjFCb3RWZXJzaW9uAX0VKADKyvCiC96RAhBhYjFDb3JlSXRlcmF0aW9uAX0VJwDKyvCiC96RAhphYjFMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcwIEAMrK8KILoJMCBHRydWUnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnAMrK8KILpZMCBnN5c3RlbQIEAMrK8KILppMCD2FiLTEuY29yZS5pbnB1dCcAysrwogulkwIEZm9ybQIEAMrK8KILtpMCB25vdGhpbmcnAMrK8KILpZMCCW9uS2V5RG93bgIEAMrK8KILvpMCP0BpZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoKTsKfScAysrwogulkwIGb25DaGF0AgQAysrwogv+kwK0FkBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQjEnOgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYjFDb3JlIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWIxR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWIxR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiMUdyb3VwW2ldLnRhZ3MuYWIxQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWIxR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiMUFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKCJzcGFjZSIsICJzaGFyZWQiKSwgImFiMUFsbCIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnVwbG9hZGA6CiAgICAgICAgICAgIG9zLnNob3dVcGxvYWRBdXhGaWxlKCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2xlZXBgOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC4uYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkF3YWtlIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID09IGFiMS5pZCArICIuYWIxTG9nIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBhYjEuaWQgKyAiLmFiMUxvZyI7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSAidGVtcExvY2FsIjsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCiAgICAgICAgICAgICAgICBvcy5zaG93Q2hhdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5oaWRlTG9nJzoKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CiAgICAgICAgICAgIGxldCBleGVjdXRhYmxlID0gbWVzc2FnZS5zbGljZSgxKTsKCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy5ydW4oZXhlY3V0YWJsZSk7ICAKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0KICAgIH0KfSgAysrwogulkwIHYWIxQ29yZQF4JwDKyvCiC6WTAgtkZXNjcmlwdGlvbgIEAMrK8KILtKoCQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicAysrwogulkwIMb25GaWxlVXBsb2FkAgQAysrwogv3qgLNFEBpZiAoIWJ1aWxkZXJWZXJzaW9uIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMgIT09IHRydWUpCnsKICAgIHJldHVybjsKfQoKbGV0IGZpbGVFeHRlbnNpb24gPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnNoaWZ0KCk7CmxldCBzaXplID0gdGhhdC5maWxlLnNpemU7CmxldCBtaW1lVHlwZTsKbGV0IGJvdEluZm8gPSB7fTsKCmlmIChzaXplID4gMjAwMDAwMDAwKQp7CiAgb3MudG9hc3QoIm1heGltdW0gZmlsZSBzaXplIGV4Y2VlZGVkICgyMDAgbWIpIik7CgogIHJldHVybjsKfQoKc3dpdGNoKGZpbGVFeHRlbnNpb24pCnsKICBjYXNlICdqcGcnOgogIGNhc2UgJ2pwZWcnOgogIGNhc2UgJ3dlYnAnOgogIGNhc2UgJ2dpZic6CiAgY2FzZSAncG5nJzoKICAgIG1pbWVUeXBlID0gImltYWdlLyIgKyBmaWxlRXh0ZW5zaW9uOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdzdmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ2dsYic6CiAgY2FzZSAnZ2x0Zic6CiAgICBtaW1lVHlwZSA9ICJ0ZXh0L3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAibWVzaCI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gImdsdGYiOwogICAgYnJlYWs7CiAgY2FzZSAnYXV4JzoKICBjYXNlICdwZGYnOgogICAgbGV0IGJvdERhdGEgPSBmaWxlRXh0ZW5zaW9uID09ICIuYXV4IiA/IEpTT04ucGFyc2UodGhhdC5maWxlLmRhdGEpLnN0YXRlIDogb3MucGFyc2VCb3RzRnJvbURhdGEodGhhdC5maWxlLmRhdGEpOwoKICAgIGxpbmtzLmNyZWF0ZS5hYjFDcmVhdGVCb3RzKHtib3RzOiBib3REYXRhLCBvcmlnaW46IGZpbGVOYW1lfSk7CgogICAgcmV0dXJuOwovLyAgIGNhc2UgJ3BkZic6Ci8vICAgICBicmVhazsKICBjYXNlICdtcDMnOgogICAgbWltZVR5cGUgPSAnYXVkaW8vbXBlZyc7CiAgICBib3RJbmZvLm9uQ2xpY2sgPSAiQCBvcy5wbGF5U291bmQodGFncy5mb3JtQWRkcmVzcyk7IjsKICAgIGJvdEluZm8ubGFiZWwgPSAiQ2xpY2sgdG8gUGxheSI7CiAgICBicmVhazsKICBjYXNlICdtcDQnOgogICAgbWltZVR5cGUgPSAndmlkZW8vbXA0JzsKICAgIGJvdEluZm8uZm9ybSA9ICJpZnJhbWUiOwogICAgYm90SW5mby5mb3JtU3VidHlwZSA9ICJzcmMiOwogICAgYnJlYWs7CiAgZGVmYXVsdDoKICAgIGxldCByZXN1bHQgPSBuZXcgRXJyb3IoInVuaGFuZGxlZCBmaWxlIHR5cGU6ICIgKyBmaWxlRXh0ZW5zaW9uKTsKICAgIG9zLnRvYXN0KCJmaWxlIHR5cGUgbm90IHN1cHBvcnRlZCIpOwogICAgY29uc29sZS53YXJuKHJlc3VsdCkKICAgIHJldHVybiByZXN1bHQ7Cn0KCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGV0IHVwbG9hZFJlc3VsdDsKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uYWIxTWVudSA9IHRydWU7Cm1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKbWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0gPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwptZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwptZW51QnV0dG9uLmxhYmVsMiA9ICJ1cGxvYWRpbmcuLi4iOwptZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwptZW51QnV0dG9uLmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKcHJvZ3Jlc3NCdXR0b24gPSBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cgp1cGxvYWRSZXN1bHQgPSBhd2FpdCBsaW5rcy5zdG9yZS5hYjFQdWJsaXNoRmlsZSh7ZmlsZTogdGhhdC5maWxlLmRhdGEsIGZpbGVOYW1lOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSk7CgppZiAoT2JqZWN0LmtleXMoYm90SW5mbykubGVuZ3RoID4gMCkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmZvcm1BZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CgpyZXR1cm4gdXBsb2FkUmVzdWx0OycAysrwogulkwIFbGVhcm4CBADKyvCiC8W/Aijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDKyvCiC6WTAghyZW1lbWJlcgIEAMrK8KIL7L8CKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMrK8KILpZMCDW1hbmlmZXN0YXRpb24CBADKyvCiC5PAAijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDKyvCiC6WTAglhYjFJZ25vcmUCBADKyvCiC7rAAgR0cnVlKADKyvCiC6WTAg1hYjFCb3RWZXJzaW9uAX0VJwDKyvCiC6WTAgZjcmVhdGUCBADKyvCiC8DAAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDKyvCiC6WTAgVzdG9yZQIEAMrK8KIL58ACKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAMrK8KILpZMCBG1lbnUCBADKyvCiC47BAijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAA=="}]}