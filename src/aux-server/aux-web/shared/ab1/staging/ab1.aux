{"version":2,"updates":[{"id":0,"timestamp":1680122630717,"update":"AdwB2/CtnwoAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwDb8K2fCgAGc3lzdGVtAgQA2/CtnwoBEmFiLTEuY29yZS5yZWd1bGF0ZScA2/CtnwoABGZvcm0CBADb8K2fChQHbm90aGluZycA2/CtnwoAB2FiMUNvcmUCBADb8K2fChwEdHJ1ZScA2/CtnwoADG9uQW55Qm90RHJhZwIEANvwrZ8KIZQBQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdFNuYXBTdGF0ZSkKewogICAgb3MuYWRkRHJvcFNuYXAoImZhY2UiKTsKfScA2/CtnwoACHJlbWVtYmVyAgQA2/Ctnwq2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDb8K2fCgAJYWIxSWdub3JlAgQA2/CtnwrdAQR0cnVlKADb8K2fCgANYWIxQm90VmVyc2lvbgF9EScBBGJvdHMkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczAScA2/CtnwrjAQZzeXN0ZW0CBADb8K2fCuQBEGFiLTEuY29yZS5jcmVhdGUoANvwrZ8K4wEHYWIxQ29yZQF4JwDb8K2fCuMBBGZvcm0CBADb8K2fCvYBB25vdGhpbmcnANvwrZ8K4wELZGVzY3JpcHRpb24CBADb8K2fCv4BPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nANvwrZ8K4wENYWIxQ3JlYXRlQm90cwIEANvwrZ8KvAK/FUAvL05FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmxldCBib3REYXRhID0gdGhhdC5ib3RzOwpsZXQgb3JpZ2luID0gdGhhdC5vcmlnaW47CmxldCB2ZXJzaW9uID0gdGhhdC52ZXJzaW9uOwpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107Cgpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYjFHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3RUb3RhbCA8IDIgJiYgYWIxR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiMUdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiMUdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWIxR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgpsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07Cgpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5hYjFTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKaWYgKGluaXRpYWxCb290KSAKewogICAgLy8gbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgLy8gaWYgKCFwcmVoYXRjaCkgCiAgICAvLyB7CiAgICAvLyAgICAgYWIxSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIC8vIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9Cgp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycA2/CtnwrjAQhyZW1lbWJlcgIEANvwrZ8K/Bco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA2/CtnwrjAQlvbkFiQWRkZWQCBADb8K2fCqMYSkAvL05FRUQgVE8gSU1QTEVNRU5UCi8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7JwDb8K2fCuMBCWFiMUlnbm9yZQIEANvwrZ8K7hgEdHJ1ZSgA2/CtnwrjAQ1hYjFCb3RWZXJzaW9uAX0RJwEEYm90cyQ2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcBJwDb8K2fCvQYBnN5c3RlbQIEANvwrZ8K9RgPYWItMS5jb3JlLmxlYXJuJwDb8K2fCvQYBWFiMUlEAgQA2/CtnwqFGQVsZWFybicA2/Ctnwr0GARmb3JtAgQA2/CtnwqLGQdub3RoaW5nJwDb8K2fCvQYB2FiMUJvb3QCBADb8K2fCpMZ9wxAbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MuYWIgPyBjb25maWdCb3QudGFncy5hYiA6IGNvbmZpZ0JvdC50YWdzLmF1dG9Mb2FkID8gY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgOiBjb25maWdCb3QudGFncy5hdXhDb2RlOwoKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiMSA9IHRoaXNCb3Q7CgppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsZXQgcHJldmlvdXNCb3RzID0gZ2V0Qm90cyhieU1vZCh7ICJzcGFjZSI6ICJzaGFyZWQiLCAiYWIxQ29yZSI6IG51bGwgfSkpOwoKICAgIGlmIChwcmV2aW91c0JvdHMpCiAgICB7CiAgICAgICAgZGVzdHJveShwcmV2aW91c0JvdHMpOwogICAgfQp9CgppZiAoaW5zdE1vZGVDaGVjayA9PSAiYnVpbGRlciIpCnsKICAgIC8vQ0hFQ0sgRk9SIFZSL0FSIEhFUkUKICAgIC8vaWYgKGdldEJvdCgicmN4ciIpKQogICAgICAgICAgICAvLyB7CiAgICAgICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgLy8gYWIxTWVudUJ1dHRvbi5sYWJlbCA9ICJlbmFibGUgQVIvVlIgc3VwcG9ydCI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlld19pbl9hciI7CiAgICAgICAgICAgIC8vIGFiMU1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlzaWJpbGl0eV9vZmYiOwogICAgICAgICAgICAvLyBhYjFNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWIxQWRhcHQnLCAncmN4cicpOyAKCiAgICAgICAgICAgIC8vIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyAKCiAgICAgICAgICAgIC8vIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKICAgICAgICAgICAgLy8gYDsKCiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSB0cnVlOwoKICAgIGF3YWl0IHRoaXNCb3QuYWIxQWRhcHQoImFiMUludGVyZmFjZSIpOwoKICAgIGlmIChpbml0aWFsQm9vdCkKICAgIHsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMU1hbmlmZXN0Qm90KHtkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwsIHBvc2l0aW9uOnt4OjAseTowfX0pOwoKICAgICAgICBsaW5rcy5tZW51LmFiMUluaXRpYWxCb290TWVudSgpOwogICAgfQp9CgppZiAoaW5pdGlhbEJvb3QgJiYgYm9vdEZsYWcpCnsKICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCMUVnZ3Moe2FiSUQ6IGJvb3RGbGFnLCBpbml0aWFsQm9vdDogdHJ1ZSwgYXV0b0hhdGNoOiB0cnVlfSk7Cn0KCi8vVVVBQgovL2JvdC52YXJzCgovLyBpZiAoYXV0b0FCKQovLyB7Ci8vICAgICBsZXQgZWdnRGF0YSA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiMVJldHJpZXZlUmVjb3JkKGF1dG9BQik7CgovLyAgICAgY29uc29sZS5sb2coZWdnRGF0YSk7Ci8vIH0KCmlmIChpbml0aWFsQm9vdCkKewogICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IGZhbHNlOwp9CgpzaG91dCgib25BQjFJbml0aWFsaXplZCIpOygA2/Ctnwr0GAdhYjFDb3JlAXgnANvwrZ8K9BgIYWIxQWRhcHQCBADb8K2fCowm8gVAY29uc3Qgc3lzdGVtSUQgPSB0aGF0Owpjb25zdCBib290U3RyYXAgPSBvcy5nZXRBQjFCb290c3RyYXBVUkwoKQpjb25zdCBza2lsbEZpbGUgPSBib290U3RyYXAuc2xpY2UoMCwgYm9vdFN0cmFwLmxlbmd0aC03KSArIHN5c3RlbUlEICsiLmF1eCI7Cgp0cnkKewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgIHVybDogc2tpbGxGaWxlCiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICBjb25zb2xlLmxvZygnW2FiMSBib290c3RyYXBdIENvdWxkIG5vdCBkb3dubG9hZCBza2lsbC4nKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXModXBkYXRlcyk7CiAgICBjb25zdCBpZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CiAgICAKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKCiAgICB3aGlzcGVyKGlkcywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgLy9hYjEubG9nKCJhYi0xIGFkYXB0Iik7CiAgICBjb25zb2xlLmxvZygiYWItMSBhZGFwdCIpOwoKICAgIHJldHVybiB0cnVlOwp9CmNhdGNoCnsKICAgIGNvbnNvbGUubG9nKCdbYWIxIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwp9JwDb8K2fCvQYC2Rlc2NyaXB0aW9uAgQA2/Ctnwr/K1FUaGlzIHNraWxsIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBib3RoIHJlY29uZmlndXJhdGlvbiBvZiBhYi0xIGFuZCBpbml0aWFsaXphdGlvbi4nANvwrZ8K9BgKb25Cb3RBZGRlZAIEANvwrZ8K0SxJQGNvbnNvbGUubG9nKCJhYi0xIFNUQVJUIFVQIik7CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWIxQm9vdCgpLCA1MDApOycA2/Ctnwr0GAhyZW1lbWJlcgIEANvwrZ8Kmy0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA2/Ctnwr0GANsb2cCBADb8K2fCsItkwFAbGV0IHVwZGF0ZWRMb2dzOwoKaWYgKCF0YWdzLmFiMUxvZykKewogICAgdXBkYXRlZExvZ3MgPSB0aGF0Owp9CmVsc2UKewogICAgdXBkYXRlZExvZ3MgPSB0YWdzLmFiMUxvZyArICJcbiIgKyB0aGF0Owp9CgptYXNrcy5hYjFMb2cgPSB1cGRhdGVkTG9nczsnANvwrZ8K9BgNbWFuaWZlc3RhdGlvbgIEANvwrZ8K1i4o8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA2/Ctnwr0GA1hYjFDcmVhdGVIb3N0AgQA2/Ctnwr9LuUHQGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgb3MudG9hc3QoImNvZGUgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgpsZXQgbmV3SG9zdElEID0gdXVpZCgpLnJlcGxhY2VBbGwoIi0iLCAiIikuc3Vic3RyaW5nKDAsNik7CmxldCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKbGV0IHJlY29yZEtleSA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksICJiMjA3YTVlNC1kNTMxLTQ4NGYtYTBkNi02NjI2YmVmNTkwMTMiLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CmxldCByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXkuZGF0YSwgbmV3SG9zdElELCB7dXJsOiBjb25maWdCb3QudGFncy51cmwsIGRhdGU6IGRhdGV9LCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rIik7CgppZiAocmVjb3JkRGF0YS5zdWNjZXNzKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKTsKCiAgICB0aGF0LnRhZ3MubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy50b2FzdCgiaG9zdCBnZW5lcmF0ZWQsIGNvZGUgY29waWVkIHRvIGNsaXBib2FyZDogIiArIG5ld0hvc3RJRCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKfScA2/Ctnwr0GAthYjFKb2luSG9zdAIEANvwrZ8K4zauBkBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBqb2luQ29kZSA9IHRoYXQudGV4dC5yZXBsYWNlQWxsKCItIiwgIiIpOwpsZXQgcmVjb3JkS2V5ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgImIyMDdhNWU0LWQ1MzEtNDg0Zi1hMGQ2LTY2MjZiZWY1OTAxMyIsICJodHRwczovL3B1YmxpY29zLmxpbmsiKTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LmRhdGEsIGpvaW5Db2RlLCAiaHR0cHM6Ly9wdWJsaWNvcy5saW5rLyIpOwoKaWYgKGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgZGF0ZSA9IERhdGVUaW1lLm5vdygpOwogICAgbGV0IGNyZWF0ZURhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKGdldFJlY29yZC5kYXRhLmRhdGUpOwogICAgbGV0IGRpZmZlcmVuY2UgPSBkYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwoKICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UuZGF5cyk7CgogICAgaWYgKGRpZmZlcmVuY2UgPCA4KQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CiAgICAKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoImpvaW4gY29kZSBvdXQgb2YgZGF0ZSwgcGxlYXNlIGdlbmVyYXRlIGEgbmV3IGpvaW4gY29kZSIpOwogICAgfQp9CmVsc2UKewogICAgb3MudG9hc3QoInVuYWJsZSB0byBqb2luLCBwbGVhc2UgY2hlY2sgY29kZSBhbmQgdHJ5IGFnYWluIik7Cn0nANvwrZ8K9BgGc2VhcmNoAgQA2/CtnwqSPSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDb8K2fCvQYCWFiMUlnbm9yZQIEANvwrZ8KuT0EdHJ1ZSgA2/Ctnwr0GA1hYjFCb3RWZXJzaW9uAX0RJwDb8K2fCvQYBG1lbnUCBADb8K2fCr89KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnANvwrZ8K5j0Gc3lzdGVtAgQA2/CtnwrnPQ9hYi0xLmNvcmUuc3RvcmUoANvwrZ8K5j0HYWIxQ29yZQF4JwDb8K2fCuY9BGZvcm0CBADb8K2fCvg9B25vdGhpbmcnANvwrZ8K5j0LZGVzY3JpcHRpb24CBADb8K2fCoA+P1RoaXMgc2tpbGwgaXMgbWVhbnQgdG8gYmUgYSBjb25maWd1cmFibGUgbWVhbnMgdG8gcHVibGlzaCBkYXRhLicA2/CtnwrmPRBhYjFQdWJsaXNoUmVjb3JkAgQA2/CtnwrAPoUCQGxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIHJlY29yZERhdGE7JwDb8K2fCuY9DmFiMVB1Ymxpc2hGaWxlAgQA2/CtnwrGQIYDQGxldCBmaWxlID0gdGhhdC5maWxlOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGVOYW1lOwpsZXQgbWltZVR5cGUgPSB0aGF0Lm1pbWVUeXBlOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxUmVjb3JkS2V5OwoKaWYgKCFmaWxlKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgc3VwcGxpZWQiOwp9CgpsZXQgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKcmV0dXJuIGZpbGVVcGxvYWQ7JwDb8K2fCuY9EWFiMUNvcmVNZW51QWN0aW9uAgQA2/CtnwrNQxdAdGhpc0JvdC5vblN0b3JlTWVudSgpOycA2/CtnwrmPQtvblN0b3JlTWVudQIEANvwrZ8K5UOiOUBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYjFNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7IjsKCmNvbnN0IHV1YWIgPSBsaW5rcy5yZW1lbWJlci50YWdzLnV1YWIgPyB0cnVlIDogZmFsc2U7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzU1RTY3OSI7Cm1lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYjFEb3dubG9hZCgpO2A7CgovL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5wb2ludGFibGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IG51bGw7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDAuNzU7CiAgICAKICAgIC8vY3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5kaW1lbnNpb24gPSAiYWIxTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTE7CiAgICBtZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gImF1dG9tYXRpYyI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KCm1lbnVCdXR0b24uZGltZW5zaW9uID0gbnVsbDsKbWVudUJ1dHRvbi5hYjFNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJlZ2ciOwoKaWYgKHV1YWIpCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAicXJfY29kZV9zY2FubmVyIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IHRydWU7CgogICAgICAgICAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKICAgICAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzY2FuIHlvdXIgcHJhY3RpY2UgcGVybWl0Iik7CiAgICAgICAgfQogICAgICAgIGNhdGNoCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgicXIgY29kZSBzY2FuIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UiKTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMgPyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRm9jdXNEYXRhOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzKQogICAgICAgIHsKICAgICAgICAgICAgdGhhdC50ZXh0ID0gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50ZXh0KQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYjFQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWV9KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImFiIG5vdCBzcGVjaWZpZWQiKTsKCiAgICAgICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYjFDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUJvdEZvY3VzOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MudGFyZ2V0Qm90OwogICAgbGV0IHByZXBwZWRCb3QgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEJvdCk7CiAgICBsZXQgc3RhdGUgPSB7fQoKICAgIHN0YXRlW2FiMUluc3RNZW1vcnkudGFncy5hYjFGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CiAgICBgOwogICAgCiAgICAvL2NyZWF0ZSAgY29weSB0byBjbGlwYm9hcmQgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWIxTWVudVNvcnRPcmRlciA9IDEwOwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInNjYW4iOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIC8vTkVFRCBUTyBVUERBVEUKICAgIC8vIGlmIChjb25maWdCb3QudGFncy5naWcpCiAgICAvLyB7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5hYjFNZW51U29ydE9yZGVyID0gLTU7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIC8vICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgLy8gICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAvLyAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgIC8vICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWIxQ29sbGFiU3VibWl0Iik7YDsKCiAgICAvLyAgICAgbGlua3MubWVudS5hYjFDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgLy8gfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHt9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9Cgpob3N0QnV0dG9uLmFiMU1lbnUgPSB0cnVlOwpob3N0QnV0dG9uLmFiMU1lbnVTb3J0T3JkZXIgPSA1MDsKaG9zdEJ1dHRvbi5hYjFNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwpob3N0QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwpob3N0QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKaG9zdEJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7Cmhvc3RCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmxlYXJuLmFiMUNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihob3N0QnV0dG9uKTsvL2dlbmVyYXRlIGEgaG9zdCBidXR0b24nANvwrZ8K5j0PYWIxQ29yZU1lbnVJY29uAgQA2/Ctnwr4fAlpb3Nfc2hhcmUnANvwrZ8K5j0QYWIxQ29yZU1lbnVMYWJlbAIEANvwrZ8Kgn0Fc2hhcmUnANvwrZ8K5j0UYWIxQ29yZU1lbnVTb3J0T3JkZXICBADb8K2fCoh9ATMnANvwrZ8K5j0IcmVtZW1iZXICBADb8K2fCop9KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnANvwrZ8K5j0MYWIxUHVibGlzaEFCAgQA2/CtnwqxfZwmQC8vc2hvdXQoImFiMVB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIxLmxvZygiYWItMSBwdWJsaXNoIik7CgpzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCkKewogICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiMUJvdCk7Cn0KCmlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYjFNZW51IjsKCiAgICBsZXQgbWVudUJ1dHRvbiA9IHt9OwoKICAgIG1lbnVCdXR0b24uYWIxTWVudSA9IHRydWU7CiAgICBtZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7CiAgICBtZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7CiAgICBtZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKICAgIG1lbnVCdXR0b24ubGFiZWwxID0gInVwbG9hZGluZy4uIjsKICAgIG1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7CiAgICBtZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwogICAgbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKICAgIG1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCiAgICBwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWIxQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldDsKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBzdGF0ZSA9IHt9OwpsZXQgZm9ybWF0dGVkRmlsZSA9IHt9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWIxQm90Rm9jdXMpCnsKICAgIHRhcmdldCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzOwp9CmVsc2UgaWYgKCF0YXJnZXQpCnsKICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWIxSWdub3JlOiBudWxsfSkpOwoKICAgIGlmICh0YXJnZXQubGVuZ3RoIDwgMSkKICAgIHsKICAgICAgICBvcy50b2FzdCgiTm8gYm90cyBmb3VuZCB0byBwdWJsaXNoIik7CgogICAgICAgIHNob3V0KCJhYjFNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiMUNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCmxldCBlZ2dDaGVjayA9IGF3YWl0IHRoaXNCb3QuYWIxUHJldmlvdXNFZ2dDaGVjayh7YWJJRDogYWJJRH0pOwoKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCmxldCBwdWJsaXNoRmlsZSA9IGF3YWl0IHRoaXNCb3QuYWIxUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiMVB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUR9KTsKbGV0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKc2hvdXQoIm9uQUJQdWJsaXNoZWQiLCB7c3VjY2VzczogcHVibGlzaEZpbGUuc3VjY2VzcywgYWI6IGFiSUQsIGZpbGVBZGRyZXNzOiBwdWJsaXNoRmlsZS51cmx9KQoKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IGdpZ0FCID0gY29uZmlnQm90LnRhZ3MuYWIgfHwgY29uZmlnQm90LnRhZ3MuYXV0b0xvYWQgfHwgY29uZmlnQm90LnRhZ3MuYXV4Q29kZTsKICAgIGxldCBnaWdLZXkgPSBnaWdBQiA/IGdpZ0FCLnN1YnN0cmluZyg3KSA6ICJub25lIjsKICAgIGxldCBnaWdGb3JtYXQgPSAiY29sbGFiXyI7CiAgICBsZXQgZ2lnRm9ybWF0Q2hlY2sgPSBhYklELmluY2x1ZGVzKGdpZ0Zvcm1hdCk7CgogICAgaWYgKGdpZ0Zvcm1hdENoZWNrICYmIGtleSA9PSBnaWdLZXkgJiYga2V5KSAKICAgIHsKICAgICAgICAvL05PIENPUFkgTkVDRVNTQVJZCiAgICB9CiAgICBlbHNlIGlmIChrZXkgJiYgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkgCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCArICIma2V5PSIgKyBrZXkpOwoKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQoKICAgIGlmIChrZXkpIAogICAgewogICAgICAgIHdlYmhvb2sucG9zdCgiaHR0cHM6Ly9xbmhjYTJzN2ljLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3NsYWNrL1QwMjlBUDRDUS9CMDFLTlRCODIwMS9nQ09QbHFRSHNSUDN0Qks5UFlISkJtTnAiLCB7ICJ0ZXh0IjogYFBSSVZBVEUgJHthYklEfSB2JHtlZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aH0gcmVjb3JkICR7ZmlsZVVwbG9hZC5zaGEyNTZIYXNofWAgfSwgYE9yaWdpbjogJHtzaXRlT3JpZ2lufWApOwogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICB3ZWJob29rLnBvc3QoImh0dHBzOi8vcW5oY2EyczdpYy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9zbGFjay9UMDI5QVA0Q1EvQjAxS05UQjgyMDEvZ0NPUGxxUUhzUlAzdEJLOVBZSEpCbU5wIiwgeyAidGV4dCI6IGAke2FiSUR9IHYke2VnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RofSByZWNvcmQgJHtmaWxlVXBsb2FkLnNoYTI1Nkhhc2h9YCB9LCBgT3JpZ2luOiAke3NpdGVPcmlnaW59YCk7CiAgICB9CgogICAgdHJ5IAogICAgewogICAgICAgIGF3YWl0IGFuYWx5dGljcy5yZWNvcmRFdmVudCgnYWIxX2VnZ19wdWJsaXNoJywgeyBhYjogYWJJRCwgdmVyc2lvbjogZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGggfSk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICB9Cn0KZWxzZQp7CiAgICBjb25zb2xlLmxvZyhwdWJsaXNoUmVjb3JkKTsKfQoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IG51bGw7CgpyZXR1cm4gcHVibGlzaFJlY29yZDsnANvwrZ8K5j0JYWIxSWdub3JlAgQA2/CtnwrOowEEdHJ1ZScA2/CtnwrmPQthYjFEb3dubG9hZAIEANvwrZ8K06MBmwNAbGV0IGRvd25sb2FkQm90czsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYjFCb3RGb2N1cykKewogICAgZG93bmxvYWRCb3RzID0gW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiMUJvdEZvY3VzXTsKCiAgICBhYjEubG9nKCJkb3dubG9hZGluZyBib3QiKTsKfQplbHNlCnsKICAgIGRvd25sb2FkQm90cyA9IGdldEJvdHMoYnlNb2QoeyJhYjFJZ25vcmUiOiBudWxsLCAic3BhY2UiOiAic2hhcmVkIn0pKTsKCiAgICBhYjEubG9nKCJkb3dubG9hZGluZyBpbnN0Iik7Cn0KCmxldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7Cgpvcy5kb3dubG9hZEJvdHMoZG93bmxvYWRCb3RzLCBjdXJyZW50SW5zdCk7CgpzaG91dCgiYWIxTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsnANvwrZ8K5j0NbWFuaWZlc3RhdGlvbgIEANvwrZ8K76YBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnANvwrZ8K5j0EbWVudQIEANvwrZ8KlqcBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InANvwrZ8K5j0TYWIxUHJldmlvdXNFZ2dDaGVjawIEANvwrZ8KvacBiA1AY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKCmxldCBlZ2dIaXN0b3J5OwpsZXQgZWdnSUQ7CmxldCB0YXJnZXRWZXJzaW9uTnVtOwpsZXQgbGFzdEhhc2g7CmxldCBtYXhWZXJzaW9uTnVtOwpsZXQgcmVjb3JkTG9va3VwID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiMVJlY29yZEtleSwgYWJJRCwgImh0dHBzOi8vcHVibGljb3MubGluay8iKS5jYXRjaChlID0+IHt9KTsKCmlmIChyZWNvcmRMb29rdXAuc3VjY2VzcykgCnsKICAgIGVnZ0hpc3RvcnkgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeTsKICAgIGVnZ0lEID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnSUQ7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwogICAgbGFzdEhhc2ggPSBlZ2dIaXN0b3J5W3RhcmdldFZlcnNpb25OdW0gLSAxXTsKICAgIG1heFZlcnNpb25OdW0gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0gCmVsc2UgCnsKICAgIGVnZ0hpc3RvcnkgPSBbXTsKICAgIGVnZ0lEID0gdXVpZCgpOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IDE7CiAgICBsYXN0SGFzaCA9ICJub25lIjsKICAgIG1heFZlcnNpb25OdW0gPSAxOwp9CgppZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQpIAp7CiAgICBjb25zdCBkZWZpbmVkVmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChtYXhWZXJzaW9uTnVtLCB7CiAgICAgICAgdGl0bGU6ICdzZXQgZGVmYXVsdCB2ZXJzaW9uJywKICAgICAgICBwbGFjZWhvbGRlcjogYDEgdG8gJHttYXhWZXJzaW9uTnVtfSAobGVhdmUgYXMgJHttYXhWZXJzaW9uTnVtfSBmb3IgbGF0ZXN0KWAKICAgIH0pOwoKICAgIHRhcmdldFZlcnNpb25OdW0gPSBkZWZpbmVkVmVyc2lvbjsKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uKSAKewogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uID0gbnVsbDsKfQoKbGV0IGVnZyA9IHt9OwoKZWdnLmVnZ1ZlcnNpb25IaXN0b3J5ID0gZWdnSGlzdG9yeTsKZWdnLmVnZ0Zvcm1hdFZlcnNpb24gPSBlZ2dJRDsKZWdnLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uTnVtOwplZ2cubWF4VmVyc2lvbiA9IG1heFZlcnNpb25OdW07CmVnZy5sYWJlbCA9ICJ2Iit0YXJnZXRWZXJzaW9uTnVtOwplZ2cuYWJJRCA9IGFiSUQ7CgpsZXQgc2lnbmF0dXJlID0ge307CmxldCBkYXRlID0gbmV3IERhdGUoKTsKbGV0IHRpbWUgPSBkYXRlLmdldFRpbWUoKTsKCnNpZ25hdHVyZS5wcmV2aW91c0hhc2ggPSBsYXN0SGFzaDsKc2lnbmF0dXJlLmFiMVZlcnNpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUNvcmVWZXJzaW9uKyIuIitsaW5rcy5yZW1lbWJlci50YWdzLmFiMUNvcmVJdGVyYXRpb247CnNpZ25hdHVyZS5lZ2dWZXJzaW9uID0gdGFncy5lZ2dVVUlEOwpzaWduYXR1cmUuZWdnVmVyc2lvbk51bSA9IHRhZ3Mub3ZvVmVyc2lvbjsKc2lnbmF0dXJlLnRpbWVTdGFtcCA9IHRpbWU7CnNpZ25hdHVyZS5jYXN1YWxPU1ZlcnNpb24gPSBbb3MudmVyc2lvbigpXTsKCnJldHVybiB7c2lnbmF0dXJlOiBzaWduYXR1cmUsIGVnZ0RhdGE6IGVnZ307KADb8K2fCuY9DWFiMUJvdFZlcnNpb24BfREnANvwrZ8K5j0QYWIxQm90TWVudUFjdGlvbgIEANvwrZ8Kx7QBF0B0aGlzQm90Lm9uU3RvcmVNZW51KCk7JwDb8K2fCuY9D2FiMUJvdE1lbnVMYWJlbAIEANvwrZ8K37QBBXNoYXJlJwDb8K2fCuY9DmFiMUJvdE1lbnVJY29uAgQA2/CtnwrltAEJaW9zX3NoYXJlJwDb8K2fCuY9E2FiMUJvdE1lbnVTb3J0T3JkZXICBADb8K2fCu+0AQEzKADb8K2fCuY9DG9uRmlsZVVwbG9hZAF+JwDb8K2fCuY9BWxlYXJuAgQA2/CtnwrytAEo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA2/CtnwrmPQ5hYjFQdWJsaXNoVVVBQgIEANvwrZ8KmbUB7w9AY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwoKbGV0IHV1YWJDb25maWcgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQjFFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy51dWFiLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxldCBwaW4gPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCx7CiAgICB0aXRsZTogImVudGVyIHBpbiIsCiAgICB0eXBlOiAic2VjcmV0Igp9KTsKCmlmIChwaW4pCnsKICAgIGxldCBwaCA9IGNyeXB0by5zaGEyNTYocGluKS5zdWJzdHJpbmcoMCw0KTsKCiAgICBpZiAocGggPT0gY29uZmlnQm90LnRhZ3MucGgpCiAgICB7CiAgICAgICAgbGV0IHJlY29yZEtleTsKICAgICAgICBsZXQgZWdnRGF0YUNoZWNrOwogICAgICAgIGxldCBlZ2dEYXRhOwoKICAgICAgICBmb3IgKHRhZyBpbiB1dWFiQ29uZmlnLnN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRhZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVjb3JkS2V5ID0gdXVhYkNvbmZpZy5zdGF0ZVt0YWddLnRhZ3MucmVjb3JkS2V5OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdCkKICAgICAgICB7CiAgICAgICAgICAgIGVnZ0RhdGFDaGVjayA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CgogICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLnN1Y2Nlc3MpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChlZ2dEYXRhQ2hlY2suZGF0YS5lZ2dzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IEpTT04ucGFyc2UoZWdnRGF0YUNoZWNrLmRhdGEuZWdncyk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YS5sZW5ndGggPj0gMTIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnRvYXN0KCJwcmFjdGljZSBwZXJtaXQgZnVsbCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCJhYjFSZWZyZXNoIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZWdnIGRhdGEgbm90IHJlYWRhYmxlIik7CgogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWIxUmVjb3JkS2V5ID0gcmVjb3JkS2V5OwoKICAgICAgICBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gdHJ1ZTsKCiAgICAgICAgdGhpc0JvdC5hYjFQdWJsaXNoQUIoe2FiOiBjb25maWdCb3QudGFncy5hYiwga2V5OiBjb25maWdCb3QudGFncy5rZXl9KTsKCiAgICAgICAgZWdnRGF0YS5wdXNoKGNvbmZpZ0JvdC50YWdzLmFiKTsKCiAgICAgICAgZWdnRGF0YVRvUHVibGlzaCA9IHtlZ2dzOiBKU09OLnN0cmluZ2lmeShlZ2dEYXRhKX07CgogICAgICAgIGF3YWl0IG9zLnJlY29yZERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCwgZWdnRGF0YVRvUHVibGlzaCwgbGlua3MucmVtZW1iZXIudGFncy5hYjFFbmRwb2ludCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgYXdhaXQgb3MudG9hc3QoInBpbiBkb2VzIG5vdCBtYXRjaCIsIDIpOwoKICAgICAgICBzaG91dCgiYWIxUmVmcmVzaCIpOwogICAgfQp9CmVsc2UKewogICAgYXdhaXQgb3MudG9hc3QoIm5vIHBpbiBnaXZlbiIsIDIpOwoKICAgIHNob3V0KCJhYjFSZWZyZXNoIik7CgogICAgcmV0dXJuCn0nANvwrZ8K5j0MYWIxUVJQdWJsaXNoAgQA2/CtnwqJxQHyBEBjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbiA9IG51bGw7CgpsZXQgc2Nhbm5lZFVSTDsKCnRyeSAKewogICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7Cn0KY2F0Y2ggKGUpIHsKICAgIHNob3V0KCJhYjFQdWJsaXNoQUIiLCB7YWI6IHRoYXR9KTsKCiAgICB0aGlzQm90LmFiMVB1Ymxpc2hBQih7YWI6IHRoYXR9KTsKCiAgICByZXR1cm47Cn0KCmlmIChzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIikpIAp7CiAgICBsZXQgdGFyZ2V0UmVjb3JkID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJpbnN0Iik7CgogICAgY29uZmlnQm90LnRhZ3MudXVhYiA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiYWIiKTsKICAgIGNvbmZpZ0JvdC50YWdzLnBoID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwogICAgY29uZmlnQm90LnRhZ3MuYWIgPSB1dWlkKCk7CiAgICBjb25maWdCb3QudGFncy5rZXkgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIik7CgogICAgdGhpc0JvdC5hYjFQdWJsaXNoVVVBQih7dGFyZ2V0UmVjb3JkOiB0YXJnZXRSZWNvcmR9KTsKfQplbHNlIAp7CiAgICBvcy50b2FzdCgidW5zdXBwb3J0ZWQgdXJsIGZvcm1hdCIpOwp9JwDb8K2fCuY9BnNlYXJjaAIEANvwrZ8K/MkBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAQRib3RzJGQ4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNQEnANvwrZ8Ko8oBBnN5c3RlbQIEANvwrZ8KpMoBEGFiLTEuY29yZS5zZWFyY2gnANvwrZ8Ko8oBBGZvcm0CBADb8K2fCrXKAQdub3RoaW5nJwDb8K2fCqPKAQdhYjFDb3JlAgQA2/Ctnwq9ygEEdHJ1ZScA2/CtnwqjygEPYWIxUmV0cmlldmVGaWxlAgQA2/CtnwrCygFsQGlmICghdGhhdC51cmwpCnsKICAgIHJldHVybiAibm8gZmlsZSB1cmwgc3VwcGxpZWQiOwp9CgpsZXQgZGF0YSA9IGF3YWl0IG9zLmdldEZpbGUodGhhdC51cmwpOwoKcmV0dXJuIGRhdGE7JwDb8K2fCqPKARFhYjFSZXRyaWV2ZVJlY29yZAIEANvwrZ8Kr8sB6QJAbGV0IHJlY29yZE5hbWUgPSB0aGF0LnJlY29yZE5hbWU7CmxldCByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleSA/IHRoYXQucmVjb3JkS2V5IDogbGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXk7CmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogImh0dHBzOi8vcHVibGljb3MubGluayI7CgppZiAoIXJlY29yZE5hbWUpCnsKICAgIHJldHVybiAibm8gcmVjb3JkIG5hbWUgc3VwcGxpZWQiOwp9CgpsZXQgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZEVuZHBvaW50KTsKCnJldHVybiBnZXRSZWNvcmQ7KADb8K2fCqPKARFhYjFDb3JlTWVudUFjdGlvbgF+KADb8K2fCqPKAQxvblNlYXJjaE1lbnUBfigA2/CtnwqjygEPYWIxQ29yZU1lbnVJY29uAX4oANvwrZ8Ko8oBEGFiMUNvcmVNZW51TGFiZWwBfigA2/CtnwqjygEVYWIxQ29yZU1lbnVPbkdlbmVyYXRlAX4oANvwrZ8Ko8oBFGFiMUNvcmVNZW51U29ydE9yZGVyAX4nANvwrZ8Ko8oBCHJlbWVtYmVyAgQA2/CtnwqfzgEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA2/CtnwqjygENbWFuaWZlc3RhdGlvbgIEANvwrZ8Kxs4BKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnANvwrZ8Ko8oBD29uTG9va3VwQUIxRWdncwIEANvwrZ8K7c4BtxtALy9zaG91dCgib25Mb29rdXBBQjFFZ2dzIiwge2FiSUQ6IGFiSUQsIGtleToga2V5LCBhdXRvSGF0Y2g6IGJvb2xlYW4sIHJldHVyblR5cGU6IGRhdGEvbnVsbH0pOwphYjEubG9nKCJhYi0xIGFiIGxvYWQgIiArIHRoYXQpOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWIxQ2xpY2soKTsKfQoKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3Qga2V5ID0gdGhhdC5rZXk7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKY29uc3QgYXV0b0hhdGNoID0gdGhhdC5hdXRvSGF0Y2g7CmNvbnN0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmNvbnN0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYjFSZWNvcmRLZXksIGFiSUQsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxRW5kcG9pbnQpOwoKbGV0IG5ld0VnZzsKCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MgJiYgY29uZmlnQm90LnRhZ3MuZ2lnKS8vQlJJTkcgSU4gSU5JVEFJQUwgQ09MTEFCIFNFVFVQCnsKICAgIGNvbnN0IGNvbGxhYkJvdCA9IGdldEJvdCgiYWJJRE9yaWdpbiIsICJjb2xsYWJTZXR1cCIpOwoKICAgIGlmICghY29sbGFiQm90KQogICAgewogICAgICAgIHRoaXNCb3Qub25Mb29rdXBBQjFFZ2dzKHthYklEOiAiY29sbGFiU2V0dXAiLCBhdXRvSGF0Y2g6IHRydWV9KTsKICAgIH0KfQplbHNlIGlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIC8vTUFZQkUgUkVNT1ZFIFRISVMgU09PTj8/PwogICAgY29uc29sZS5sb2coZ2V0UmVjb3JkLCAiY2hlY2tpbmcgb2xkIFNUTSIpOwoKICAgIGxldCBmaWxlbmFtZWhhc2ggPSBjcnlwdG8uc2hhMjU2KGFiSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoID0gImF1eF8iICsgZmlsZW5hbWVoYXNoICsgJy5hdXgnOwogICAgbGV0IHRhcmdldFVSTCA9ICJodHRwczovL2J1aWxkZXItc3RtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgbGV0IGx0bVJlc3BvbnNlID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICAgICAgbmV3RWdnID0gbHRtUmVzcG9uc2UuZGF0YS5zdGF0ZTsKCiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBuZXdFZ2cpCiAgICAgICAgewogICAgICAgICAgICBjb25zdCBuZXdNT0QgPSBuZXdFZ2dbcHJvcGVydHldOwoKICAgICAgICAgICAgbmV3RWdnID0gbmV3TU9EOwogICAgICAgIH0KICAgIH0gCiAgICBjYXRjaCAoZSkgCiAgICB7CgogICAgICAgIG9zLnRvYXN0KGBubyBkYXRhIGZvdW5kIGluICR7YWJJRH1gKTsKCiAgICAgICAgc2hvdXQoImFiMU1lbnVSZWZyZXNoIik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIHJldHVybiAiYWJJRCBub3QgZm91bmQiOwogICAgfQp9CmVsc2UKewogICAgbmV3RWdnID0gZ2V0UmVjb3JkLmRhdGE7Cn0KCmlmIChyZXR1cm5UeXBlID09ICJkYXRhIiAmJiBnZXRSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IHZlcnNpb24gPSBnZXRSZWNvcmQuZGF0YS50YXJnZXRWZXJzaW9uIC0gMTsKCiAgICBpZiAodGhhdC5hYlZlcnNpb24pCiAgICB7CiAgICAgICAgaWYgKCFpc05hTih0aGF0LmFiVmVyc2lvbikpCiAgICAgICAgewogICAgICAgICAgICB2ZXJzaW9uID0gdGhhdC5hYlZlcnNpb24gLSAxOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgZWdnRGF0YVVSTCA9IGdldFJlY29yZC5kYXRhLmVnZ1ZlcnNpb25IaXN0b3J5W3ZlcnNpb25dOwogICAgbGV0IHJldHVybkRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKGVnZ0RhdGFVUkwpOwoKICAgIHJldHVybiByZXR1cm5EYXRhOwp9CmVsc2UgaWYgKHJldHVyblR5cGUgPT0gImRhdGEiKQp7CiAgICBsZXQgdmVyc2lvbkFycmF5ID0gSlNPTi5wYXJzZShuZXdFZ2cuZWdnVmVyc2lvbkhpc3RvcnkpOwogICAgbGV0IGZpbGVVVUlEID0gdmVyc2lvbkFycmF5W25ld0VnZy5tYXhWZXJzaW9uIC0gMV07CiAgICBsZXQgZmlsZW5hbWVoYXNoTFRNID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2hMVE0gPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2hMVE0gKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0TFRNVVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2hMVE07CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0TFRNVVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChmaWxlR2V0LnN0YXR1cyAhPSAyMDApCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICAgICAgc2hvdXQoImFiMVJlZnJlc2giKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9CgogICAgcmV0dXJuIGZpbGVHZXQ7Cn0KCmNvbnN0IGFiMUJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90OwoKbGV0IGN1cnJlbnREaW07CmxldCBzcGFjZU1vZDsKbGV0IGRpbWVuc2lvblg7CmxldCBkaW1lbnNpb25ZOwpsZXQgZGltTW9kOwoKaWYgKGFiMUJvdCkKewogICAgY3VycmVudERpbSA9IGFiMUJvdC50YWdzLmRpbWVuc2lvbjsKfQplbHNlCnsKICAgIGN1cnJlbnREaW0gPSBvcy5nZXRDdXJyZW50RGltZW5zaW9uKCk7Cn0KCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYjFHcmlkRm9jdXMpIAp7CiAgICBkaW1lbnNpb25YID0gbnVsbDsKICAgIGRpbWVuc2lvblkgPSBudWxsOwp9CmVsc2UKewogICAgbGV0IGhhdGNoUG9pbnQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUdyaWRGb2N1czsKCiAgICBjdXJyZW50RGltID0gaGF0Y2hQb2ludC5kaW1lbnNpb247CiAgICBkaW1lbnNpb25YID0gaGF0Y2hQb2ludC5wb3NpdGlvbi54OwogICAgZGltZW5zaW9uWSA9IGhhdGNoUG9pbnQucG9zaXRpb24ueTsKICAgIHNwYWNlTW9kID0ge3NwYWNlOiAic2hhcmVkIn07Cn0KCmlmICghYXV0b0hhdGNoICYmIGNvbmZpZ0JvdC50YWdzLmFiID09IG51bGwpCnsKICAgIGRpbU1vZCA9IHtbY3VycmVudERpbV06IHRydWUsIFtjdXJyZW50RGltKyJYIl06IGRpbWVuc2lvblgsIFtjdXJyZW50RGltKyJZIl06IGRpbWVuc2lvblksIGRpbWVuc2lvbjogY3VycmVudERpbX07Cn0KZWxzZQp7CiAgICBpZiAoY29uZmlnQm90LnRhZ3Mua2V5ICYmICF0aGF0LmtleSkKICAgIHsKICAgICAgICBrZXkgPSBjb25maWdCb3QudGFncy5rZXkKICAgIH0KCiAgICBkaW1Nb2QgPSB7YXV0b0hhdGNoOiB0cnVlLCBrZXk6IGtleX07Cn0KCnRoaXNCb3QubWFuaWZlc3RPdm8oe2FiSUQ6IGFiSUQsIGRpbU1vZDogZGltTW9kLCBzcGFjZU1vZDogc3BhY2VNb2QsIGVnZ0RhdGE6IG5ld0VnZywgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290fSk7JwDb8K2fCqPKAQttYW5pZmVzdE92bwIEANvwrZ8KpeoBqQpAc2hvdXQoImFiMU1lbnVSZXNldCIpOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWIxQm90KTsKfQoKaWYgKGxpbmtzLm92b0JvdCkKewogICAgZGVzdHJveShsaW5rcy5vdm9Cb3QpOwp9CgpsZXQgc3BhY2VNb2QgPSB0aGF0LnNwYWNlTW9kOwpsZXQgZGltTW9kID0gdGhhdC5kaW1Nb2Q7CmxldCBlZ2dEYXRhID0gdGhhdC5lZ2dEYXRhOwpsZXQgZWdnTW9kID0ge307CgplZ2dNb2Quc3BhY2UgPSAidGVtcExvY2FsIjsKZWdnTW9kLmluaXRpYWxUaW1lciA9IHRydWU7CmVnZ01vZC5hYklEID0gdGhhdC5hYklEOwplZ2dNb2QuaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290OwplZ2dNb2QubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmVnZ01vZC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5pbnRlcmFjdE92bygpO2A7CmVnZ01vZC5vbkNyZWF0ZSA9IGBAIGlmICh0YWdzLmF1dG9IYXRjaCkKewogICAgbGlua3MubWFuYWdlci5oYXRjaE92byh0aGlzQm90KTsKfQplbHNlCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSAwOyAKCiAgICBzZXRUaW1lb3V0KCgpID0+IHt3aGlzcGVyKHRoaXNCb3QsICJlZ2dUaW1lciIpO30sIDc1KTsKfWA7CmVnZ01vZC5mb3JtID0gImVnZyI7CmVnZ01vZC5wcm9ncmVzc0JhckNvbG9yID0gIiNCRjVFNjYiOwplZ2dNb2QucHJvZ3Jlc3NCYXJCYWNrZ3JvdW5kQ29sb3IgPSAiIzU5Mjk4OSI7CmVnZ01vZC5sYWJlbFNpemUgPSAwLjU7CmVnZ01vZC5sYWJlbENvbG9yID0gIiM0MDQwNDAiOwplZ2dNb2Qub25Qb2ludGVyRW50ZXIgPSAiQCBvcy50b2FzdCh0YWdzLmFiSUQgKyAnIHYnK3RhZ3MudGFyZ2V0VmVyc2lvbik7IjsKZWdnTW9kLmxhYmVsUG9zaXRpb24gPSAiZnJvbnQiOwplZ2dNb2Qub3JpZW50YXRpb25Nb2RlID0gImJpbGxib2FyZEZyb250IjsKZWdnTW9kLm9uRGVzdHJveSA9IGBAIGxpbmtzLm1hbmFnZXIubWFza3Mub3ZvQm90ID0gbnVsbDtgOwplZ2dNb2QuZWdnVGltZXIgPSBgQCBpZiAodGFncy5wcm9ncmVzc0JhciA8IDEpIAp7CiAgICB0YWdzLnByb2dyZXNzQmFyICs9IDAuMTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHt3aGlzcGVyKHRoaXNCb3QsICJlZ2dUaW1lciIpO30sIDc1KTsKfQplbHNlCnsKICAgIHRoaXNCb3Qub25DbGljaygpOwogICAgCiAgICB0YWdzLnByb2dyZXNzQmFyID0gbnVsbDsKfWA7CgpsZXQgb3ZvID0gY3JlYXRlKGVnZ0RhdGEsIGVnZ01vZCwgZGltTW9kLCBzcGFjZU1vZCk7CgptYXNrcy5vdm9Cb3QgPSAi8J+UlyIgKyBvdm8uaWQ7KADb8K2fCqPKAQhvdm9IYXRjaAF+JwDb8K2fCqPKAQlvbktleURvd24CBADb8K2fCsz0AbQFQGlmICghbGlua3Mub3ZvQm90IHx8IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgIT0gIm92byIpCnsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiU2hpZnQiKQp7CiAgICBsZXQgdmVyc2lvbkJ1dHRvbiA9IHt9OwoKICAgIHZlcnNpb25CdXR0b24ub3ZvID0gdHJ1ZTsKICAgIHZlcnNpb25CdXR0b24ub3ZvU29ydE9yZGVyID0gLTE7CiAgICB2ZXJzaW9uQnV0dG9uLm1heFZlcnNpb24gPSBsaW5rcy5vdm9Cb3QudGFncy5tYXhWZXJzaW9uOwogICAgdmVyc2lvbkJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIHZlcnNpb25CdXR0b24ubGFiZWwgPSAiY2hhbmdlIGVnZyB2ZXJzaW9uIjsKICAgIHZlcnNpb25CdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIHZlcnNpb25CdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgdmVyc2lvbkJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKICAgIHZlcnNpb25CdXR0b24ub25LZXlVcCA9ICJAIGlmKHRoYXQua2V5cyA9PSAnU2hpZnQnKXtkZXN0cm95KHRoaXNCb3QpfTsiOwogICAgdmVyc2lvbkJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5jaGFuZ2VPdm9WZXJzaW9uKCk7IjsKCiAgICBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24odmVyc2lvbkJ1dHRvbik7Cn0nANvwrZ8Ko8oBCGhhdGNoT3ZvAgQA2/Ctnwr/+QH4DEBzaG91dCgnb3ZvTWVudVJlc2V0Jyk7Cgpjb25zdCBvdm8gPSB0aGF0OwoKbGV0IGluaXRpYWxCb290ID0gb3ZvLnRhZ3MuaW5pdGlhbEJvb3Q7CmxldCB0YXJnZXRWZXJzaW9uID0gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uICYmIGNvbmZpZ0JvdC50YWdzLmFiID09IG92by50YWdzLmFiSUQgPyBjb25maWdCb3QudGFncy5hYlZlcnNpb24gOiBvdm8udGFncy50YXJnZXRWZXJzaW9uOwpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7Cgp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZygiY2hlY2tpbmcgb2xkIExUTSIsIGVycm9yKTsKCiAgICB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5KTsKCiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbb3ZvLnRhZ3MudGFyZ2V0VmVyc2lvbl07CiAgICBsZXQgZmlsZW5hbWVoYXNoID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2ggPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2ggKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0VVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2g7CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChmaWxlR2V0LnN0YXR1cyAhPSAyMDApCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9Cn0KCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKZGVzdHJveShvdm8pOwoKbGlua3MuY3JlYXRlLmFiMUNyZWF0ZUJvdHMoe2JvdHM6IGZpbGVHZXQsIG9yaWdpbjogb3ZvLnRhZ3MuYWJJRCwgdmVyc2lvbjogdGFyZ2V0VmVyc2lvbiwgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290fSk7CgovL1RFU1QhIScA2/CtnwqjygELaW50ZXJhY3RPdm8CBADb8K2fCviGAvsGQGNvbnN0IG92b0JvdCA9IHRoYXQgPyB0aGF0IDogbGlua3Mub3ZvQm90OwoKaWYgKCFvdm9Cb3QpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoIm92b01lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAib3ZvIjsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgc2hvdXQoIm92b01lbnVSZXNldCIpO2A7Cm1hc2tzLm92b01lbnVSZXNldCA9IGBAIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gbnVsbDsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBlZ2dNZW51QnV0dG9uID0ge307Cgpvcy50d2VlblRvKG92b0JvdCwgMTUsNDUsNDUsIDUpOwoKZWdnTWVudUJ1dHRvbi5vdm8gPSB0cnVlOwplZ2dNZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNZW51QnV0dG9uLm92b0JvdCA9ICLwn5SXIiArIG92b0JvdC5pZDsKZWdnTWVudUJ1dHRvbi50YXJnZXRWZXJzaW9uID0gb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbCA9ICJoYXRjaCAiICsgb3ZvQm90LnRhZ3MuYWJJRCArICIgdiIgKyBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uICsgIiBvZiAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwplZ2dNZW51QnV0dG9uLm92b01lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKZWdnTWVudUJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKZWdnTWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5oYXRjaE92byhsaW5rcy5vdm9Cb3QpOyI7CgpsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24oZWdnTWVudUJ1dHRvbik7JwDb8K2fCqPKAQZjcmVhdGUCBADb8K2fCvCNAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDb8K2fCqPKAQxhYjFMVE1TZWFyY2gCBADb8K2fCpeOAh9AdGhpc0JvdC5vbkxvb2t1cEFCMUVnZ3ModGhhdCk7JwDb8K2fCqPKARBjaGFuZ2VPdm9WZXJzaW9uAgQA2/Ctnwq3jgL7AUBjb25zdCBvdm9Cb3QgPSBsaW5rcy5vdm9Cb3Q7CgpsZXQgbmV3VmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dEZvclRhZyhvdm9Cb3QsICJ0YXJnZXRWZXJzaW9uIiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MubGFiZWwgPSAndicrIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CgpzaG91dCgib3ZvTWVudVJlc2V0Iik7JwDb8K2fCqPKAQRtZW51AgQA2/CtnwqzkAIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA2/CtnwqjygEJYWIxSWdub3JlAgQA2/CtnwrakAIEdHJ1ZSgA2/CtnwqjygENYWIxQm90VmVyc2lvbgF9EScBBGJvdHMkZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3AScA2/CtnwrgkAIGc3lzdGVtAgQA2/CtnwrhkAISYWItMS5jb3JlLnJlbWVtYmVyJwDb8K2fCuCQAgRmb3JtAgQA2/Ctnwr0kAIHbm90aGluZygA2/CtnwrgkAIHYWIxQ29yZQF4KADb8K2fCuCQAg1hYjFBd2FrZVN0YXRlAXknANvwrZ8K4JACC2Rlc2NyaXB0aW9uAgQA2/Ctnwr+kAIrVGhpcyBpcyBtZWFudCB0byBiZSB0aGUgbG9jYWwgc3RhdGUgaG9sZGVyLicA2/CtnwrgkAIMYWIxUmVjb3JkS2V5AgQA2/CtnwqqkQIudlJLMS5ZV0l0TVE9PS5OSFpzVUd0b05tRkdZM0ZKZGpKVE1tczFORmxxVVQwOScA2/CtnwrgkAISYWIxQWN0aXZlRGltZW5zaW9uAgQA2/CtnwrZkQIEaG9tZScA2/CtnwrgkAIMYWIxQmFzZUNvbG9yAgQA2/CtnwrekQIHIzkwOEJGQygA2/CtnwrgkAIQYWIxR3JpZFNuYXBTdGF0ZQF4KADb8K2fCuCQAg9hYjFCb3RTbmFwU3RhdGUBeCcA2/CtnwrgkAIOYWIxTWVudVJlZnJlc2gCBADb8K2fCuiRAhhAY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsoANvwrZ8K4JACC2luaXRpYWxCb290AXgnANvwrZ8K4JACC2FiMUVuZHBvaW50AgQA2/CtnwqCkgIWaHR0cHM6Ly9wdWJsaWNvcy5saW5rLycA2/CtnwrgkAIJYWIxSWdub3JlAgQA2/CtnwqZkgIEdHJ1ZScA2/CtnwrgkAIOYWIxQ29yZVZlcnNpb24CBADb8K2fCp6SAgE5KADb8K2fCuCQAg1hYjFCb3RWZXJzaW9uAX0RKADb8K2fCuCQAhBhYjFDb3JlSXRlcmF0aW9uAX0RJwDb8K2fCuCQAhphYjFMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcwIEANvwrZ8KopICBHRydWUnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnANvwrZ8Kp5ICBnN5c3RlbQIEANvwrZ8KqJICD2FiLTEuY29yZS5pbnB1dCcA2/CtnwqnkgIEZm9ybQIEANvwrZ8KuJICB25vdGhpbmcnANvwrZ8Kp5ICCW9uS2V5RG93bgIEANvwrZ8KwJICP0BpZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoKTsKfScA2/CtnwqnkgIGb25DaGF0AgQA2/CtnwqAkwK0FkBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQjEnOgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiMUF3YWtlU3RhdGUgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYjFDb3JlIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYjFDb3JlSXRlcmF0aW9uKys7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuY29yZUFCID0gbnVsbDsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWIxR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWIxR3JvdXAubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiMUdyb3VwW2ldLnRhZ3MuYWIxQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWIxR3JvdXAsIGdyb3VwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLmxvYWRTa2lsbGA6CiAgICAgICAgICAgIGxldCBza2lsbCA9IGF3YWl0IG9zLnNob3dJbnB1dCgic2tpbGwiKTsKCiAgICAgICAgICAgIGxpbmtzLmxlYXJuLmFiMUFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKCJzcGFjZSIsICJzaGFyZWQiKSwgImFiMUFsbCIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnVwbG9hZGA6CiAgICAgICAgICAgIG9zLnNob3dVcGxvYWRBdXhGaWxlKCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2xlZXBgOgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXNsZWVwIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC4uYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkF3YWtlIiwgImFiMU1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID09IGFiMS5pZCArICIuYWIxTG9nIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBhYjEuaWQgKyAiLmFiMUxvZyI7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSAidGVtcExvY2FsIjsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCiAgICAgICAgICAgICAgICBvcy5zaG93Q2hhdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5oaWRlTG9nJzoKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CiAgICAgICAgICAgIGxldCBleGVjdXRhYmxlID0gbWVzc2FnZS5zbGljZSgxKTsKCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy5ydW4oZXhlY3V0YWJsZSk7ICAKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0KICAgIH0KfSgA2/CtnwqnkgIHYWIxQ29yZQF4JwDb8K2fCqeSAgtkZXNjcmlwdGlvbgIEANvwrZ8KtqkCQlRoaXMgaXMgbWVhbnQgdG8gaGFuZGxlIGFueSBub25lIG1lbnUgcmVsYXRlZCBpbnB1dHMvaW50ZXJhY3Rpb25zLicA2/CtnwqnkgIMb25GaWxlVXBsb2FkAgQA2/Ctnwr5qQLNFEBpZiAoIWJ1aWxkZXJWZXJzaW9uIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWIxTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMgIT09IHRydWUpCnsKICAgIHJldHVybjsKfQoKbGV0IGZpbGVFeHRlbnNpb24gPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnNoaWZ0KCk7CmxldCBzaXplID0gdGhhdC5maWxlLnNpemU7CmxldCBtaW1lVHlwZTsKbGV0IGJvdEluZm8gPSB7fTsKCmlmIChzaXplID4gMjAwMDAwMDAwKQp7CiAgb3MudG9hc3QoIm1heGltdW0gZmlsZSBzaXplIGV4Y2VlZGVkICgyMDAgbWIpIik7CgogIHJldHVybjsKfQoKc3dpdGNoKGZpbGVFeHRlbnNpb24pCnsKICBjYXNlICdqcGcnOgogIGNhc2UgJ2pwZWcnOgogIGNhc2UgJ3dlYnAnOgogIGNhc2UgJ2dpZic6CiAgY2FzZSAncG5nJzoKICAgIG1pbWVUeXBlID0gImltYWdlLyIgKyBmaWxlRXh0ZW5zaW9uOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdzdmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ2dsYic6CiAgY2FzZSAnZ2x0Zic6CiAgICBtaW1lVHlwZSA9ICJ0ZXh0L3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAibWVzaCI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gImdsdGYiOwogICAgYnJlYWs7CiAgY2FzZSAnYXV4JzoKICBjYXNlICdwZGYnOgogICAgbGV0IGJvdERhdGEgPSBmaWxlRXh0ZW5zaW9uID09ICIuYXV4IiA/IEpTT04ucGFyc2UodGhhdC5maWxlLmRhdGEpLnN0YXRlIDogb3MucGFyc2VCb3RzRnJvbURhdGEodGhhdC5maWxlLmRhdGEpOwoKICAgIGxpbmtzLmNyZWF0ZS5hYjFDcmVhdGVCb3RzKHtib3RzOiBib3REYXRhLCBvcmlnaW46IGZpbGVOYW1lfSk7CgogICAgcmV0dXJuOwovLyAgIGNhc2UgJ3BkZic6Ci8vICAgICBicmVhazsKICBjYXNlICdtcDMnOgogICAgbWltZVR5cGUgPSAnYXVkaW8vbXBlZyc7CiAgICBib3RJbmZvLm9uQ2xpY2sgPSAiQCBvcy5wbGF5U291bmQodGFncy5mb3JtQWRkcmVzcyk7IjsKICAgIGJvdEluZm8ubGFiZWwgPSAiQ2xpY2sgdG8gUGxheSI7CiAgICBicmVhazsKICBjYXNlICdtcDQnOgogICAgbWltZVR5cGUgPSAndmlkZW8vbXA0JzsKICAgIGJvdEluZm8uZm9ybSA9ICJpZnJhbWUiOwogICAgYm90SW5mby5mb3JtU3VidHlwZSA9ICJzcmMiOwogICAgYnJlYWs7CiAgZGVmYXVsdDoKICAgIGxldCByZXN1bHQgPSBuZXcgRXJyb3IoInVuaGFuZGxlZCBmaWxlIHR5cGU6ICIgKyBmaWxlRXh0ZW5zaW9uKTsKICAgIG9zLnRvYXN0KCJmaWxlIHR5cGUgbm90IHN1cHBvcnRlZCIpOwogICAgY29uc29sZS53YXJuKHJlc3VsdCkKICAgIHJldHVybiByZXN1bHQ7Cn0KCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiMU1lbnUiOwoKbGV0IHVwbG9hZFJlc3VsdDsKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uYWIxTWVudSA9IHRydWU7Cm1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKbWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0gPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwptZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwptZW51QnV0dG9uLmxhYmVsMiA9ICJ1cGxvYWRpbmcuLi4iOwptZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwptZW51QnV0dG9uLmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKcHJvZ3Jlc3NCdXR0b24gPSBsaW5rcy5tZW51LmFiMUNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cgp1cGxvYWRSZXN1bHQgPSBhd2FpdCBsaW5rcy5zdG9yZS5hYjFQdWJsaXNoRmlsZSh7ZmlsZTogdGhhdC5maWxlLmRhdGEsIGZpbGVOYW1lOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSk7CgppZiAoT2JqZWN0LmtleXMoYm90SW5mbykubGVuZ3RoID4gMCkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmZvcm1BZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CgpyZXR1cm4gdXBsb2FkUmVzdWx0OycA2/CtnwqnkgIFbGVhcm4CBADb8K2fCse+Aijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDb8K2fCqeSAghyZW1lbWJlcgIEANvwrZ8K7r4CKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnANvwrZ8Kp5ICDW1hbmlmZXN0YXRpb24CBADb8K2fCpW/Aijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDb8K2fCqeSAglhYjFJZ25vcmUCBADb8K2fCry/AgR0cnVlKADb8K2fCqeSAg1hYjFCb3RWZXJzaW9uAX0RJwDb8K2fCqeSAgZjcmVhdGUCBADb8K2fCsK/Aijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDb8K2fCqeSAgVzdG9yZQIEANvwrZ8K6b8CKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnANvwrZ8Kp5ICBG1lbnUCBADb8K2fCpDAAijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAA=="}]}