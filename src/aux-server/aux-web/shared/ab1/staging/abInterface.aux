{"version":2,"updates":[{"id":0,"timestamp":1688394685560,"update":"AYoBhYfp1gIAJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCFh+nWAgAGc3lzdGVtAgQAhYfp1gIBEWFiLmludGVyZmFjZS5zY2FuJwCFh+nWAgAEZm9ybQIEAIWH6dYCEwdub3RoaW5nJwCFh+nWAgALYWJJbnRlcmZhY2UCBACFh+nWAhsEdHJ1ZScAhYfp1gIACGFiSWdub3JlAgQAhYfp1gIgBHRydWUoAIWH6dYCAAxhYkJvdFZlcnNpb24BfRQnAIWH6dYCAA9vblFSQ29kZVNjYW5uZWQCBACFh+nWAiaIDUBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZygiYWIgc2NhbiIgKyB0aGF0KTsKCmlmIChjb25maWdCb3QudGFncy51dWFiU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJQdWJsaXNoVVVBQih0aGF0KTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLmFiTFRNU2VhcmNoKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIikgPT0gImVnZ0NhcnRvbiIpCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBsaW5rcy5zZWFyY2guYWJMVE1TZWFyY2goe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLmFifSk7CiAgICB9Cn0nAIWH6dYCAAVzdG9yZQIEAIWH6dYCrw0o8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAhYfp1gIABnNlYXJjaAIEAIWH6dYC1g0o8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAhYfp1gIAEGFiQ29yZU1lbnVBY3Rpb24CBACFh+nWAv0NN0Bvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsnAIWH6dYCAA9hYkNvcmVNZW51TGFiZWwCBACFh+nWArUOBHNjYW4nAIWH6dYCAA5hYkNvcmVNZW51SWNvbgIEAIWH6dYCug4PcXJfY29kZV9zY2FubmVyJwCFh+nWAgATYWJDb3JlTWVudVNvcnRPcmRlcgIEAIWH6dYCyg4BMycBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAhYfp1gLMDgZzeXN0ZW0CBACFh+nWAs0OE2FiLmludGVyZmFjZS5udWdnZXQnAIWH6dYCzA4EZm9ybQIEAIWH6dYC4Q4Hbm90aGluZycAhYfp1gLMDgthYkludGVyZmFjZQIEAIWH6dYC6Q4EdHJ1ZScAhYfp1gLMDghhYklnbm9yZQIEAIWH6dYC7g4EdHJ1ZSgAhYfp1gLMDgxhYkJvdFZlcnNpb24BfRUnAIWH6dYCzA4MYWJMb2FkTnVnZ2V0AgQAhYfp1gL0DpgCQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXROYW1lOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrbnVnZ2V0TmFtZTsKbGV0IGxvYWRlZE51Z2dldCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogZm9ybWF0dGVkTnVnZ2V0QUIsIGFiVmVyc2lvbjogdGhhdC52ZXJzaW9uLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxvYWRlZE51Z2dldCA9IGxvYWRlZE51Z2dldC5zdGF0ZVtudWdnZXROYW1lXS5udWdnZXQ7CgpyZXR1cm4gbG9hZGVkTnVnZ2V0OycAhYfp1gLMDg9hYlB1Ymxpc2hOdWdnZXQCBACFh+nWAo0R7QJALy9zaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogIm51Z05hbWUiLCBkYXRhOiBkYXRhfSk7ICBBREQgRUdHIElEIEVWRU5UVUFMTFkKbGV0IHRlc3ROdWdnZXQgPSB0aGF0LmRhdGE7CmxldCBmb3JtYXR0ZWROdWdnZXQgPSB7aWQ6IHRoYXQubnVnLCBudWdnZXQ6IHRlc3ROdWdnZXR9OwpsZXQgdGVzdE51Z2dldE5hbWUgPSB0aGF0Lm51ZzsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK3Rlc3ROdWdnZXROYW1lOwoKbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gZm9ybWF0dGVkTnVnZ2V0QUI7CgpsaW5rcy5zdG9yZS5hYlB1Ymxpc2hBQih7YWI6IGZvcm1hdHRlZE51Z2dldEFCLCB0YXJnZXQ6IGZvcm1hdHRlZE51Z2dldH0pOycAhYfp1gLMDg9pbXBsZW1lbnROdWdnZXQCBACFh+nWAvsTsQdAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldDsKbGV0IG51Z2dldFZlcnNpb25DaGVjayA9IG51Z2dldE5hbWUuaW5kZXhPZigiLnYiKTsKbGV0IHZlcnNpb247CgppZiAobnVnZ2V0VmVyc2lvbkNoZWNrICE9IC0xKQp7CiAgICBudWdnZXROYW1lID0gbnVnZ2V0TmFtZS5zdWJzdHJpbmcoMCwgbnVnZ2V0VmVyc2lvbkNoZWNrKTsKCiAgICBsZXQgdmVyc2lvbkNoZWNrID0gdGhhdC5udWdnZXQuc3Vic3RyaW5nKG51Z2dldFZlcnNpb25DaGVjayArIDIpOwoKICAgIGlmIChpc05hTih2ZXJzaW9uQ2hlY2spKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKHZlcnNpb25DaGVjaywgInZlcnNpb24gaXMgbm90IGEgbnVtYmVyIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdmVyc2lvbiA9IE51bWJlcih2ZXJzaW9uQ2hlY2spOwogICAgfQp9CmNvbnNvbGUubG9nKG51Z2dldE5hbWUsIHZlcnNpb24pOwpsZXQgbnVnRGF0YSA9IGF3YWl0IHRoaXNCb3QuYWJMb2FkTnVnZ2V0KHtudWdnZXROYW1lOiBudWdnZXROYW1lLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7CgppZiAobnVnRGF0YSA9PSAiYWJJRCBub3QgZm91bmQiKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IG5vdCBmb3VuZCIpOwp9CmVsc2UKewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CiAgICBsZXQgdGFyZ2V0VGFnID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10udG9TdHJpbmcoKTsKICAgIGxldCB0YXJnZXROdWcgPSAieyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0VGFnLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7CiAgICBpbnNlcnRUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgbnVnRGF0YSk7Cn0nAIWH6dYCzA4MbnVnZ2V0QnV0dG9uAgQAhYfp1gKtG/UMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwCFh+nWAswOC251Z2dldFBhcnNlAgQAhYfp1gKhKKcPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCFh+nWAswODW9uQUJQdWJsaXNoZWQCBACFh+nWAsk3wQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwCFh+nWAswOEG9uQW55Qm90c0NoYW5nZWQCBACFh+nWAos5twRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAIWH6dYCzA4Ib25DcmVhdGUCBACFh+nWAsE9TEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAIWH6dYCzA4NcGFja2FnZU51Z2dldAIEAIWH6dYCjj74BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScAhYfp1gLMDghyZW1lbWJlcgIEAIWH6dYCh0Uo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAhYfp1gLMDgZzZWFyY2gCBACFh+nWAq5FKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIWH6dYCzA4Fc3RvcmUCBACFh+nWAtVFKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAIWH6dYCzA4JbGlzdGVuaW5nAgQAhYfp1gL8RQVmYWxzZScBBGJvdHMkYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAScAhYfp1gKCRgZzeXN0ZW0CBACFh+nWAoNGEWFiLmludGVyZmFjZS5tZW51JwCFh+nWAoJGBGZvcm0CBACFh+nWApVGB25vdGhpbmcnAIWH6dYCgkYLZGVzY3JpcHRpb24CBACFh+nWAp1GJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKACFh+nWAoJGC2FiSW50ZXJmYWNlAXgnAIWH6dYCgkYKYWJPcGVuTWVudQIEAIWH6dYCxUatCkBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KCk7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7JwCFh+nWAoJGEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAIWH6dYC8VCVA0BsZXQgYWRkaXRpb25hbFRhZ3MgPSB0aGF0OwpsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyAiYm9yZGVyLXJhZGl1cyI6IjhweCIsICJtYXJnaW4tdG9wIjoiM3B4In07Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycAhYfp1gKCRg1hYk1lbnVSZWZyZXNoAgQAhYfp1gKHVD5AY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOycAhYfp1gKCRghyZW1lbWJlcgIEAIWH6dYCxlQo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAhYfp1gKCRg1tYW5pZmVzdGF0aW9uAgQAhYfp1gLtVCjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCFh+nWAoJGEWFiRW52aXJvbm1lbnRNZW51AgQAhYfp1gKUVYowQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmZvciAobGV0IGkgPSAwOyBpIDwgMTI7IGkrKykKewogICAgc3dpdGNoIChpKQogICAgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmxhYmVsID0gImhpZGUiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlzaWJpbGl0eV9vZmYiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24ubWFza3MuYWJCb3QgPSBudWxsOwogICAgICAgICAgICBgOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAiY29sb3IiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAicGFsZXR0ZSI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgb3Muc2hvd0lucHV0Rm9yVGFnKGxpbmtzLnJlbWVtYmVyLCAiYWJCYXNlQ29sb3IiLCB7CiAgICAgICAgICAgIHR5cGU6ICdjb2xvcicsCiAgICAgICAgICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24ubWFza3MuYWJCb3QgPSBudWxsOwogICAgICAgICAgICBgOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAic2xlZXAiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAibmlnaHRzX3N0YXkiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24ub25DbGljayA9IGBAZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24ubWFza3MuYWJCb3QgPSBudWxsOwogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICBgOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAiY2hhdCI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGF0IjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBvcy5zaG93Q2hhdCgpO2A7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9ICJudWdnZXRzIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm51Z01hbmFnZXIgPSB0YWdzLm51Z2dldDsKCiAgICAgICAgICAgIGlmIChsaW5rcy5udWdnZXQudGFncy5saXN0ZW5pbmcpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIG51bGwpOyI7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94IjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpOyI7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9ICJzeXN0ZW1Qb3J0YWw9dHJ1ZSI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7YDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWYgKCFsaW5rcy5ncHQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAiZWRpdCAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgcHJvbXB0IjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImVkaXRfbm90ZSI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncHRCb3QgPSB0YWdzLmdwdDsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpO2A7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9ICJncmlkIHNuYXAiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICJjaGVja19ib3giIDogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICJjaGVja19ib3giIDogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgODoKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmxhYmVsID0gImJvdCBzbmFwIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICJjaGVja19ib3giIDogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7CiAgICAgICAgICAgIAogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICJjaGVja19ib3giIDogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOToKICAgICAgICAgICAgaWYgKCFsaW5rcy50ZXN0cykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9ICJyZWNvcmQgdGVzdCI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJzY2llbmNlIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uS2V5RG93biA9ICJAICI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbktleVVwID0gIkAgIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CiAgICAgICAgICAgIGxldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRlc3QnKTsKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIGlmICghbGlua3MudGVzdHMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAicmVjb3JkIHRyYWNlIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInRpbWVsaW5lIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uS2V5RG93biA9ICJAICI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbktleVVwID0gIkAgIjsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CiAgICAgICAgICAgIGxldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRyYWNlJyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAvL1VQREFURSBMQUJFTAogICAgICAgICAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSAiZGVsZXRlICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiB2IiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlVmVyc2lvbiArICIuIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlSXRlcmF0aW9uOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZGVsZXRlX2ZvcmV2ZXIiOwogICAgICAgICAgICBhYk1lbnVCdXR0b24uY29sb3IgPSAiI0Q2NkQ1RSI7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGV0IGFsbEJvdHMgPSBnZXRCb3RzKCJzcGFjZSIsICJzaGFyZWQiKTsKCiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbEJvdHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChhbGxCb3RzW2ldLnRhZ3Muc3lzdGVtKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmIChhbGxCb3RzW2ldLnRhZ3Muc3lzdGVtLmluY2x1ZGVzKCJhYiIpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShhbGxCb3RzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAKICAgIH0KCiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gaTsKCiAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsKCi8vIGFiTWVudUJ1dHRvbi5sYWJlbCA9ICJjb2xsYWIgcG92IjsKLy8gLy9DSEVDSyBGT1IgSUNPTgovLyBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAidmlzaWJpbGl0eV9vZmYiOwovLyBhYk1lbnVCdXR0b24ub25DbGljayA9ICJAIG9zLnRvYXN0KCd3b3JrIGluIHByb2dyZXNzJykiOwoKLy8gYWJNZW51QnV0dG9uLmxhYmVsID0gIm51Z2dldHMiOwovLyAvL0NIRUNLIEZPUiBJQ09OCi8vIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwovLyBhYk1lbnVCdXR0b24ub25DbGljayA9ICJAIG9zLnRvYXN0KCd3b3JrIGluIHByb2dyZXNzJykiOycAhYfp1gKCRgVsZWFybgIEAIWH6dYCn4UBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIWH6dYCgkYDZ3B0AgQAhYfp1gLGhQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAhYfp1gKCRghhYklnbm9yZQIEAIWH6dYC7YUBBHRydWUoAIWH6dYCgkYMYWJCb3RWZXJzaW9uAX0ZJwCFh+nWAoJGEWFiSW5pdGlhbEJvb3RNZW51AgQAhYfp1gLzhQH3CUBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYkluaXRpYWxNZW51IjsKCm1hc2tzLmFiTWVudVJlZnJlc2ggPSAiQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7IjsKbWFza3Mub25HcmlkQ2xpY2sgPSAiQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKbGV0IG1lbnVCdXR0b24gPSB7fTsKCm1lbnVCdXR0b24uYWJJbml0aWFsTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uZ3JpZENsaWNrID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwptZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Cm1lbnVCdXR0b24uc2VhcmNoID0gdGFncy5zZWFyY2g7Cm1lbnVCdXR0b24uYXNrID0gdGFncy5hc2s7Cm1lbnVCdXR0b24ubGFiZWwgPSAiYnVpbGQiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImN1YmUiOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7YDsKCi8vdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgptZW51QnV0dG9uLmxhYmVsID0gImFzayAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKbWVudUJ1dHRvbi5mb3JtID0gImlucHV0IjsKbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjdWJlIjsKbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0KTtgOwoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7Cm1lbnVCdXR0b24uZm9ybSA9IG51bGw7Cm1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7Cm1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSB0cnVlOwoKb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7JwCFh+nWAoJGBnNlYXJjaAIEAIWH6dYC648BKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIWH6dYCgkYGbnVnZ2V0AgQAhYfp1gKSkAEo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicAhYfp1gKCRgV0ZXN0cwIEAIWH6dYCuZABKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAIWH6dYCgkYPb25Qb3J0YWxDaGFuZ2VkAgQAhYfp1gLgkAFuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAIWH6dYCgkYDYXNrAgQAhYfp1gLPkQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycBBGJvdHMkZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkAScAhYfp1gL2kQEGc3lzdGVtAgQAhYfp1gL3kQEaYWIuaW50ZXJmYWNlLm1hbmlmZXN0YXRpb24nAIWH6dYC9pEBBGZvcm0CBACFh+nWApKSAQdub3RoaW5nKACFh+nWAvaRAQthYkludGVyZmFjZQF4JwCFh+nWAvaRAQtkZXNjcmlwdGlvbgIEAIWH6dYCm5IBOFRoaXMgc2tpbGwgY29udHJvbHMgdGhlIGFjdHVhbCBib3QgZm9yIHRoZSBhYiBpbnRlcmZhY2UuJwCFh+nWAvaRAQVsZWFybgIEAIWH6dYC1JIBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIWH6dYC9pEBD29uUG9ydGFsQ2hhbmdlZAIEAIWH6dYC+5IBwgVAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSB8fCB0aGF0LnBvcnRhbCA9PSAidGFnUG9ydGFsIikKewogICAgcmV0dXJuOwp9CgpsZXQgcG9ydGFsQXJyYXkgPSBbIm1pbmlHcmlkUG9ydGFsIiwgImdyaWRQb3J0YWwiLCAibWFwUG9ydGFsIiwgIm1pbmlNYXBQb3J0YWwiLCAibGVmdFdyaXN0UG9ydGFsIiwgInJpZ2h0V3Jpc3RQb3J0YWwiXTsKCmlmIChwb3J0YWxBcnJheS5pbmRleE9mKHRoYXQucG9ydGFsKSAhPSAtMSAmJiB0aGF0LmRpbWVuc2lvbikKewogICAgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKfQplbHNlIGlmIChwb3J0YWxBcnJheS5pbmRleE9mKHRoYXQucG9ydGFsKSA9PSAtMSAmJiAhdGhhdC5kaW1lbnNpb24gJiYgdGhhdC5wb3J0YWwgIT0gIm1lbnVQb3J0YWwiKQp7CiAgICBsZXQgc3VtbW9uRGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKCiAgICB0aGlzQm90LmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKfQplbHNlIGlmICh0aGF0LnBvcnRhbCAhPSAibWVudVBvcnRhbCIpCnsKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwp9JwCFh+nWAvaRAQhyZW1lbWJlcgIEAIWH6dYCvpgBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIWH6dYC9pEBDWFiTWFuaWZlc3RCb3QCBACFh+nWAuWYAbgJQGlmICh0YWdzLmFiQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKfQoKbGV0IGFiID0ge307CgphYi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphYi5jb2xvciA9ICJjbGVhciI7CmFiLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsiOwphYi5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKYWJbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKYWJbdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwphYlt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmFiLnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKYWIubGluZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKYWIubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmFiLmFuaW1hdGVCb3QgPSBgQCBjb25zdCByb3RaID0gdGFncy5kaW1lbnNpb24gKyAiUm90YXRpb25aIjsKbGV0IHRhcmdldFNjYWxlID0gMC42NTsKCmlmICh0YWdzLnNjYWxlIDw9IDAuNjUxKQp7CiAgICB0YXJnZXRTY2FsZSA9IDAuOTU7Cn0KCmF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwKewogICAgZnJvbVZhbHVlOiB7CiAgICAgICAgW3JvdFpdOiAwLAogICAgICAgIHNjYWxlOiB0YWdzLnNjYWxlCiAgICB9LAogICAgdG9WYWx1ZTogewogICAgICAgIFtyb3RaXTogMy4xNSwvLzYuMywKICAgICAgICBzY2FsZTogdGFyZ2V0U2NhbGUKICAgIH0sCiAgICBlYXNpbmc6IHsKICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgbW9kZTogImlub3V0IgogICAgfSwKICAgIGR1cmF0aW9uOiAyCn0pLmNhdGNoKGUgPT4ge30pOwpgOwphYi5vbkNyZWF0ZSA9IGBAIHRoaXNCb3QuYW5pbWF0ZUJvdCgpOwoKbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7CmA7CmFiLm9uRGVzdHJveSA9IGBACmNsZWFySW50ZXJ2YWwodGFncy5pbnRlcnZhbCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwpgOwphYi5kcmFnZ2FibGUgPSBmYWxzZTsKYWIuc2NhbGUgPSAwLjk7CgpsZXQgYWJNYW5pZmVzdGVkID0gYXdhaXQgY3JlYXRlKGFiKTsKCm1hc2tzLmFiQm90ID0gIvCflJciICsgYWJNYW5pZmVzdGVkLmlkOwoKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsnAIWH6dYC9pEBD2FiTWFuaWZlc3RTdGF0ZQIEAIWH6dYCmqIBBkFzbGVlcCcAhYfp1gL2kQEcYWJNYW5pZmVzdFN0YXRlQXNsZWVwT25FbnRlcgIEAIWH6dYCoaIBVkBkZXN0cm95KGxpbmtzLmFiQm90KTsKCm1hc2tzLmFiQm90ID0gbnVsbDsKCmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlID0gZmFsc2U7JwCFh+nWAvaRAQtvbkdyaWRDbGljawIEAIWH6dYC+KIBhghAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSkKewogICAgcmV0dXJuOwp9CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGZvb3RwcmludCA9IHt9OwoKZm9vdHByaW50LnNwYWNlID0gInRlbXBMb2NhbCI7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwpmb290cHJpbnQuZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmZvb3RwcmludC5zY2FsZVogPSAwLjAxOwpmb290cHJpbnQub25DbGljayA9IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CgpsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3QodGFncy5wb3NpdGlvbkluZm8pOwpgOwpmb290cHJpbnQucG9zaXRpb25JbmZvID0gdGhhdDsKZm9vdHByaW50LmNvbG9yID0gImNsZWFyIjsKZm9vdHByaW50LnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKZm9vdHByaW50LmRyYWdnYWJsZSA9IGZhbHNlOwpmb290cHJpbnQubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmZvb3RwcmludC5vbkNyZWF0ZSA9IGBAIHNldFRpbWVvdXQoKCkgPT4gZGVzdHJveSh0aGlzQm90KSwgODAwKTsKCiAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgc2NhbGVYOiAwLjEsCiAgICAgICAgICAgIHNjYWxlWTogMC4xCiAgICAgICAgfSwKICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgIHNjYWxlWDogMS4xLAogICAgICAgICAgICBzY2FsZVk6IDEuMQogICAgICAgIH0sCiAgICAgICAgZHVyYXRpb246IDAuNSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgIH0KICAgIH0pLmNhdGNoKGUgPT4ge30pOwpgOwoKY3JlYXRlKGZvb3RwcmludCk7JwCFh+nWAvaRAQRtZW51AgQAhYfp1gL9qgEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAhYfp1gL2kQEHYWJDbGljawIEAIWH6dYCpKsBhwlAaWYgKCFsaW5rcy5hYkJvdCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCBtZW51VHlwZSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsIHx8IHN0YXRlKQp7CiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gbnVsbDsKCiAgICBjbGVhckFuaW1hdGlvbnMobGlua3MuYWJCb3QpOwoKICAgIGNvbnN0IHJvdFogPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwoKICAgIGlmIChzdGF0ZSAmJiBtZW51VHlwZSAhPSAibXVsdGlwbGVCb3QiKQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiT3Blbk1lbnUobWVudVR5cGUpOwogICAgfQoKICAgIGF3YWl0IGFuaW1hdGVUYWcobGlua3MuYWJCb3QsCiAgICB7CiAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgIFtyb3RaXTogbGlua3MuYWJCb3QudGFnc1tyb3RaXSwKICAgICAgICAgICAgc2NhbGU6IGxpbmtzLmFiQm90LnRhZ3Muc2NhbGUKICAgICAgICB9LAogICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiAwLAogICAgICAgICAgICBzY2FsZTogMC45CiAgICAgICAgfSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogInNpbnVzb2lkYWwiLAogICAgICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICAgICAgfSwKICAgICAgICBkdXJhdGlvbjogMC41CiAgICB9KS5jYXRjaChlID0+IHt9KTsKfQplbHNlCnsKICAgIGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwoKICAgIGlmIChsaW5rcy5hYkJvdC50YWdzLmFybSkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7Cn0KJwCFh+nWAvaRARthYk1hbmlmZXN0U3RhdGVBd2FrZU9uRW50ZXICBACFh+nWAqy0AfQBQGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlID0gdHJ1ZTsKCmxldCBkaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwoKaWYgKCFkaW1lbnNpb24pCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IGRpbWVuc2lvbiwgcG9zaXRpb246IHt4OiAwLCB5OiAwfX0pOycAhYfp1gL2kQEMb25BbnlCb3REcmFnAgQAhYfp1gKhtgGjB0BpZiAodGhhdC5ib3QgIT0gbGlua3MuYWJCb3QpIHJldHVybjsKCmlmIChsaW5rcy5hYkJvdC50YWdzLmFybSkKewogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwp9CgppZiAoIXRoYXQuYm90LnRhZ3MuaW50ZXJ2YWwpCnsKICAgIHRoaXNCb3QuYWJDbGljaygpOwp9CgpsZXQgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwpsZXQgYXJtID0ge307Cgphcm0uc3BhY2UgPSAidGVtcExvY2FsIjsKYXJtW3RoYXQuZnJvbS5kaW1lbnNpb25dID0gdHJ1ZTsKYXJtLmRpbWVuc2lvbiA9IHRoYXQuZnJvbS5kaW1lbnNpb247CmFybS5zY2FsZSA9IDAuOTsKYXJtLnNjYWxlWiA9IDAuMDE7CmFybS5jb2xvciA9ICJjbGVhciI7CmFybS5zdHJva2VDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CmFybS5saW5lQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwphcm0ubGluZVRvID0gdGhhdC5ib3QuaWQ7CmFybS5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKYXJtLm9uQ2xpY2sgPSBgQCBkZXN0cm95KHRoaXNCb3QpOwoKbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlgiXSx5OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWSJdfX0pO2A7CgppZiAoc3RhdGUpCnsKICAgIGFybS5tdWx0aVNlbGVjdCA9IHRydWU7CiAgICBhcm0uZm9ybSA9ICJzcGhlcmUiOwogICAgYXJtLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKfQoKbGV0IG5ld0FybSA9IGF3YWl0IGNyZWF0ZShhcm0pOwoKbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOwoKb3MucmVwbGFjZURyYWdCb3QobmV3QXJtKTsnAIWH6dYC9pEBEW9uQW55Qm90RHJvcEVudGVyAgQAhYfp1gLBvQG5B0BpZiAoIXRhZ3MuYWJCb3QpIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5tdWx0aVNlbGVjdCkKewogICAgaWYgKEFycmF5LmlzQXJyYXkobGlua3MuYWJCb3QudGFncy5saW5lVG8pKQogICAgewogICAgICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUby5wdXNoKHRoYXQudG8uYm90LmlkKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBbdGhhdC50by5ib3QuaWRdOwogICAgfQoKICAgIGxldCBuZXdMaW5rOwoKICAgIGlmICghbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzKQogICAgewogICAgICAgIG5ld0xpbmsgPSBnZXRMaW5rKHRoYXQudG8uYm90KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsZXQgcHJldmlvdXNMaW5rQm90cyA9IGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHM7CgogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShwcmV2aW91c0xpbmtCb3RzKSkKICAgICAgICB7CiAgICAgICAgICAgIHByZXZpb3VzTGlua0JvdHMgPSBbcHJldmlvdXNMaW5rQm90c10KICAgICAgICB9CgogICAgICAgIHByZXZpb3VzTGlua0JvdHMucHVzaCh0aGF0LnRvLmJvdCk7CgogICAgICAgIG5ld0xpbmsgPSBnZXRMaW5rKHByZXZpb3VzTGlua0JvdHMpOwogICAgfQoKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cyA9IG5ld0xpbms7Cn0KZWxzZQp7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3Muc3Ryb2tlQ29sb3IgPSAiY2xlYXIiOwogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLmxpbmVUbyA9IGZhbHNlOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IHRoYXQudG8uYm90LmlkOwp9JwCFh+nWAvaRARBvbkFueUJvdERyb3BFeGl0AgQAhYfp1gL7xAGeAkBpZiAoIXRhZ3MuYWJCb3QpIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmICghbGlua3MuYWJCb3QubGlua3MuYXJtLi50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3Muc3Ryb2tlQ29sb3IgPSBudWxsOwogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLmxpbmVUbyA9IG51bGw7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbGlua3MuYWJCb3QubGlua3MuYXJtLmlkOwp9CgonAIWH6dYC9pEBDG9uQW55Qm90RHJvcAIEAIWH6dYCmscB3AVAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0gIT0gdGhhdC5kcmFnQm90KSByZXR1cm47CgppZiAobGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiTXVsdGlwbGVCb3RGb2N1cyA9IGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90czsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJtdWx0aXBsZUJvdCJ9KTsKCiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KZWxzZSBpZiAodGhhdC50by5ib3QpCnsKICAgIGlmICh0aGF0LnRvLmJvdCA9PSBsaW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIHRoYXQudG8uYm90LmlkOwoKICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICB9CgogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwp9CmVsc2UKewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSB7ZGltZW5zaW9uOiB0aGF0LnRvLmRpbWVuc2lvbiwgcG9zaXRpb246IHt4OiB0aGF0LnRvLngsIHk6IHRoYXQudG8ueX19OwoKICAgIHRoaXNCb3QuYWJDbGljayh7bWVudTogImdyaWQifSk7Cn0nAIWH6dYC9pEBCGFiSWdub3JlAgQAhYfp1gL1zAEEdHJ1ZSgAhYfp1gL2kQEMYWJCb3RWZXJzaW9uAX0ZAA=="}]}